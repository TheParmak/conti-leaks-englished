2020-10-16T12:09:49 frog -> kaktus
Добрый день! Пишу бэкдор, 7 группа.

2020-10-16T12:12:34 kaktus -> frog
Привет!

2020-10-16T12:14:55 kaktus -> frog
скажи у тебя БК сейчас чистый, готов к работе?

2020-10-16T12:15:43 kaktus -> frog
еще вопрос - прокладочные адреса как ты получаешь, и какие последние есть?

2020-10-16T12:18:01 kaktus -> frog
у тебя сейчас только одна группа 7 - еще есть какие?

2020-10-16T12:18:37 frog -> kaktus
Вчера последний раз отправлял на тестирование Bentley (7 группа) и Xenon'у (4 группа). Ничего пока не ответили.

2020-10-16T12:20:11 kaktus -> frog
понятно. Смысл в чем - Буза сформировал команду отдельную, во главе со мной. Наша задача - обеспечивать сборками нескольких спамеров. У них свои группы.

2020-10-16T12:20:53 kaktus -> frog
я пока до конца не понял как все лучше организовать, по ходу производственный процесс наладим.

2020-10-16T12:21:33 frog -> kaktus
IP-адреса мне всегда писал Mushroom. Ещё есть список emercoin-адресов. Но они, наверное, не использовались ни разу.

2020-10-16T12:22:33 kaktus -> frog
скажи, как ты готовишь сборку - проверяешь вручную на АВ, или автотестами?

2020-10-16T12:22:53 kaktus -> frog
и крипт сам заказывал, или этим тестировщики занимались?

2020-10-16T12:28:26 kaktus -> frog
еще скажи - в твоей сборке есть какие-нибудь особенности - что за пределы стандартного ТЗ выходит, сообщение для пользователя например?

2020-10-16T12:29:36 frog -> kaktus
Какое-то время на dyncheck проверял. Автотестами особо не пользовался. Были особо проблемные антивирусники (Bullguard, Kaspersky и некоторые другие), их сам устанавливал у себя. Тестировщики всегда говорили, какие детекты возникают. Если был детект, исправлял его.
Крипт не делал.

2020-10-16T12:32:18 kaktus -> frog
напиши свой ник в админке ботлеггерс, сейчас группу тебе добавим

2020-10-16T12:33:41 frog -> kaktus
ник - b16
Из особенностей: маскировка запускается отдельным процессом всегда (но это в ТЗ не оговаривалось). Т.е. загрузчик -> маскировщик -> бот.

2020-10-16T12:34:40 kaktus -> frog
то есть как - загрузчик себя перезапускает сначала?

2020-10-16T12:35:14 frog -> kaktus
Да

2020-10-16T12:36:56 kaktus -> frog
ну это нормальное явление, для пряток от АВ

2020-10-16T12:39:17 frog -> kaktus
Недавно перенёс закрепление в системе внутрь бота. Бот закрепляет загрузчик всегда. Команду 18 сделал, но оставил пока обязательное закрепление в системе.

2020-10-16T12:41:15 frog -> kaktus
Потому что, если тестировщики проверяют и комплект не закрепляется, они начинают негодовать)

2020-10-16T12:54:33 kaktus -> frog
скажи у тебя группа 54 появилась в админке?

2020-10-16T12:56:08 frog -> kaktus
Появилась

2020-10-16T13:09:33 kaktus -> frog
скажи группу 7 для кого делаешь и работают ли с ней - в курсе?

2020-10-16T13:11:26 frog -> kaktus
Буза писал, что с ней работали. Ну и в админке тоже видел, что с ней работали. Но в последнее время активности нет никакой.

2020-10-16T13:11:45 kaktus -> frog
вообще БК давно занимаешься? когда в работу запустили первый раз?

2020-10-16T13:13:18 frog -> kaktus
Недавно работаю - 6-ой месяц примерно. Первый раз запускали в работу в сентябре.

2020-10-16T13:23:55 kaktus -> frog
ты делал x32 сборку, или только x64?

2020-10-16T13:30:58 frog -> kaktus
Все делал, но в работе была только 64-разрядная версия

2020-10-16T15:46:45 kaktus -> frog
скажи, какой у тебя график работы

2020-10-16T15:46:55 kaktus -> frog
в какое время обычно здесь онлайн?

2020-10-16T15:51:24 kaktus -> frog
[16:30:59] <frog> Все делал, но в работе была только 64-разрядная версия

2020-10-16T15:51:34 kaktus -> frog
проверь X32, что она работает корректно и не палится

2020-10-16T15:51:51 kaktus -> frog
возможно скоро придется также ее в работу пускать

2020-10-16T15:56:08 frog -> kaktus
По разному. Если что-то программирую, то обычно по выходным (пн, сб, вс), вечером, ночью. Онлайн днём и вечером стараюсь находится (пн-пн), но отхожу от компа периодически. Сборки обычно по вечерам отправляю тестировщикам.

2020-10-16T15:57:19 frog -> kaktus
В некоторые дни могу не выйти онлайн.

2020-10-16T15:59:49 kaktus -> frog
лоадеры:
titlecs.com mixcinc.com nicknamec.com

боты:
freedubcs.com 18.188.194.80

2020-10-16T16:00:08 kaktus -> frog
сделай сборку БК для группы 54 - вот с этими адресами

2020-10-16T16:00:45 kaktus -> frog
если есть другие рабочие адреса - их тоже оставляй в конце списка

2020-10-16T16:00:59 kaktus -> frog
сборку выдавай на тестирование и криптование Хлору

2020-10-16T16:01:16 kaktus -> frog
hlor@q3mcco35auwcstmt.onion

2020-10-16T16:05:44 kaktus -> frog
[19:04:53] <hlor@q3mcco35auwcstmt.onion> окей, понял, я наверное уже в понедельник писать ему буду про пересборку, сегодня уже вряд ли успею, т.к. другой заказ висит

2020-10-16T16:06:06 kaktus -> frog
отбой, сейчас сборку не надо.

2020-10-16T16:06:23 kaktus -> frog
в понедельник состыкуешься с ним

2020-10-16T16:14:47 kaktus -> frog
[18:57:19] <frog> В некоторые дни могу не выйти онлайн.

2020-10-16T16:15:03 kaktus -> frog
заранее сможешь сказать когда не выйдешь, или это внезапно может быть?

2020-10-16T16:19:53 frog -> kaktus
Да, скажу

2020-10-19T12:28:26 frog -> kaktus
Привет. Какие сегодня IP-адреса?

2020-10-19T12:30:11 kaktus -> frog
привет чуть позднее напишу

2020-10-19T12:52:34 kaktus -> frog
у тебя админка БК работат?

2020-10-19T12:53:19 frog -> kaktus
Не работала, недавно заходил. Писала: 404.

2020-10-19T12:53:28 kaktus -> frog
та же тема

2020-10-19T12:53:53 kaktus -> frog
там сегодня Талар химичил, новую версию накатил. В ней требуются изменения БК.

2020-10-19T12:54:30 kaktus -> frog
я уже спамерам сказал что сегодня нет групп - тестируем и дорабатываем. А он потом откатить решил)

2020-10-19T12:55:30 kaktus -> frog
сегодняшние адреса:

2020-10-19T12:55:31 kaktus -> frog
[11:23:24] <green> bot
195.123.240.252
94.140.115.242
5.181.156.240 

loader

89.32.41.191
195.123.241.204
194.5.249.46

2020-10-19T12:56:07 frog -> kaktus
А какие изменения требуются?

2020-10-19T12:56:40 kaktus -> frog
будут разные ссылки на каждый файл, вместо /api/vXXX

2020-10-19T12:57:01 kaktus -> frog
в том числе разные для Staget и Production версий можно ставить (зачем только непонятно)

2020-10-19T12:57:15 kaktus -> frog
в лоадере также надо будет отправлять куки с группойъ

2020-10-19T12:57:47 kaktus -> frog
уникальный ключ для каждой группы будет (это еще в процессе, не тестил)

2020-10-19T13:01:20 kaktus -> frog
два момента по выдаче сборок БК тестировщикам:

2020-10-19T13:01:59 kaktus -> frog
1) с очередной сборкой ты должен сообщать тестировщику, какие есть изменения (или прикладывать файл RELEASE_NOTES.txt)

2020-10-19T13:02:29 kaktus -> frog
смысл в том, чтобы тестировщик не тратил время каждый раз на полный тест функционала, если поменялись например только адреса или изменения в лоадере ( а бота не касаются)

2020-10-19T13:03:41 kaktus -> frog
2) столкнулись с проблемой в пятницу - почему может не быть отстука у тестировщика или оператора - дело в ID бота, который привязывается к группе при первом его обращении в админку.

2020-10-19T13:04:31 kaktus -> frog
то есть - тестировщик гонял твою (или другую) сборку БК на своей ВМ для одной группы, потом че-то переиграли и с этой группы доступ у него сняли. Дальше он берет сборку для новой группы - айди не меняется при этом. Бот стучит а он этого не видит

2020-10-19T13:05:17 kaktus -> frog
Буза говорит, это не устранимо. Решение - предложить пользователю поменять данные, которые влияют на ID (хостнейм, даты создания системных папок)

2020-10-19T13:05:57 frog -> kaktus
Да, знаю об этом. Бывало. Можно сделать, чтобы ID зависел от названия группы.

2020-10-19T13:06:13 kaktus -> frog
я предлагал, не одобрили, нельзя

2020-10-20T08:38:10 kaktus -> frog
привет!

2020-10-20T08:38:24 frog -> kaktus
привет

2020-10-20T08:38:32 kaktus -> frog
свежие прокладки

2020-10-20T08:38:33 kaktus -> frog
bot

18.224.30.70 duckgb.xyz
54.212.116.99 myjusts.xyz


loader

52.90.14.44  egwn.xyz
34.238.84.181 xobjective.com
3.137.174.178 onepolks.com

2020-10-20T08:38:54 kaktus -> frog
скажи, тебе Грин не присылает их? А то может я повторяюсь

2020-10-20T08:39:10 frog -> kaktus
Не присылает

2020-10-20T08:39:54 kaktus -> frog
сборку 54 вчера делал, на тест отдавал?

2020-10-20T08:40:57 frog -> kaktus
Не отдавал. В админку же так и не зашёл.

2020-10-20T08:41:32 kaktus -> frog
группу 4 когда последний раз делал и кому давал?

2020-10-20T08:42:17 frog -> kaktus
Вчера отдавал Bentley

2020-10-20T08:42:36 frog -> kaktus
Xenon, ошибся

2020-10-20T08:42:49 kaktus -> frog
какой ник у него полностью

2020-10-20T08:44:04 frog -> kaktus
xenon@q3mcco35auwcstmt.onion

2020-10-20T08:45:03 kaktus -> frog
ок

2020-10-20T08:45:14 kaktus -> frog
сегодня 54 делай для Хлора, насчет 4 я уточню

2020-10-20T08:45:33 kaktus -> frog
других больше нет групп, 7 не делаешь?

2020-10-20T08:45:55 frog -> kaktus
Хорошо

2020-10-20T08:47:03 kaktus -> frog
кроме 7 4 54 - есть другие группы?

2020-10-20T08:47:05 frog -> kaktus
7 не просят пока.

2020-10-20T08:47:44 frog -> kaktus
Других нет.

2020-10-20T09:31:55 kaktus -> frog
4 сборку тоже делай, как раньше на тестирование давай xenon@

2020-10-20T14:28:07 frog -> kaktus
Отправил за сегодня на тестирование комплекты 4 и 54

2020-10-20T14:33:10 kaktus -> frog
ты с утра отправлял?

2020-10-20T14:33:43 kaktus -> frog
4 уже в работу передали

2020-10-20T14:34:14 frog -> kaktus
4 группу сейчас отправил

2020-10-20T14:34:57 frog -> kaktus
54 несколько часов назад

2020-10-20T14:35:21 kaktus -> frog
я понял значит 4 вчерашнюю выпускали, ты же вечером выдаешь

2020-10-20T14:37:15 kaktus -> frog
скажи, у тебя лоадер в формате dll можно формировать? dll для крипты

2020-10-20T14:37:36 kaktus -> frog
В: Каков должен быть комплект, выдаваемый в крипт?
О:
Полный:
лоадер 32 exe
лоадер 32 dll
лоадер 64 exe
лоадер 64 dll
бот 32 exe
бот 32 dll
бот 64 exe
бот 64 dll

Сокращенный: только 64-битные файлы из полного комплекта

В: Зачем готовить и .dll и .exe?
О: Криптер использует тот из файлов, который ему удобнее.
Обычно для криптования удобней .dll, но иногда - .exe
Кроме того, .exe является контрольным образцом - на случай, если что-то не заработало, можно запустить .exe и проверить работоспособность функционала.

2020-10-20T14:37:39 kaktus -> frog
такое знакомо?

2020-10-20T14:40:34 frog -> kaktus
Нет. С тех пор, как начал разработку, про dll мне не говорили. Единственное что помню, где-то было написано, что развёртывание из dll удобнее.

2020-10-20T14:51:03 kaktus -> frog
тебе надо будет сделать чтобы собирался в формате dll, тот же самый лоадер

2020-10-20T14:51:25 kaktus -> frog
отдельный проект в солюшне, или даже отдельная конфигурация в том же проекте

2020-10-20T14:51:46 kaktus -> frog
примерно так, вот главный модуль dll-сборки:

2020-10-20T14:52:00 kaktus -> frog
#include "includes.h"
#include "LoaderMain.h"

#pragma comment(linker, "/ENTRY:StartFunc")

BOOL WINAPI DllMain(_In_ HINSTANCE hinstDLL,
  _In_ DWORD     fdwReason,
  _In_ LPVOID    lpvReserved)
{ //пустышка
	return 0;
}

#ifdef __cplusplus
extern "C"
{
#endif
	__declspec(dllexport) int __stdcall StartFunc();
#ifdef __cplusplus
}
#endif


__declspec(dllexport) int __stdcall StartFunc()
{
	Loader_Main();
	return 0;
}

2020-10-20T14:52:16 kaktus -> frog
точка входа для криптера StartFunc

2020-10-20T14:52:36 kaktus -> frog
у меня здесь явно указана точка входа и пустой дллмейн - чтобы CRT не линковался

2020-10-20T14:52:44 kaktus -> frog
если ты собираешь с CRT тогда это не надо

2020-10-20T14:53:29 kaktus -> frog
в StartFunc() ты вызываешь точку входа exe-лоадера, условно говоря

2020-10-20T14:54:13 frog -> kaktus
Понял

2020-10-20T14:54:29 kaktus -> frog
ты при перезапуске параметры командной строки используешь?

2020-10-20T14:55:17 frog -> kaktus
Да.

2020-10-20T14:57:05 frog -> kaktus
Для закрепления в системе передаю боту путь к загрузчику в командной строке

2020-10-20T14:59:09 kaktus -> frog
тебе надо их будет брать через API тогда - GetCommandLine() / CommandLineToArgvW()

2020-10-20T14:59:41 kaktus -> frog
если сейчас через argc argv - то в длл не получиться

2020-10-20T15:01:09 kaktus -> frog
ну или из PEB напрямую

2020-10-20T15:02:40 frog -> kaktus
Понял. А вообще есть другой простой способ передачи параметров? Думал ещё через каналы передавать, но решил, что через аргументы cmd проще.

2020-10-20T15:03:25 kaktus -> frog
через переменную среды окружения еще можно

2020-10-20T15:03:39 kaktus -> frog
но если из закрепа стартует с параметром, то так не получится

2020-10-20T15:04:21 kaktus -> frog
можно через реестр, временный файл

2020-10-20T15:04:40 kaktus -> frog
у тебя же где-то должен сохраняться последний проверенный командный сервер?

2020-10-20T15:05:48 kaktus -> frog
я вот про это из ТЗ - После прохождения валидации, сервер помечается как надежный и в дальнейшем валидация не требуется.

2020-10-20T15:07:18 frog -> kaktus
В программе только сохраняется.

2020-10-21T13:02:52 kaktus -> frog
привет!

2020-10-21T13:03:04 frog -> kaktus
привет

2020-10-21T13:03:18 kaktus -> frog
по поводу лоадера в формате dll

2020-10-21T13:03:33 kaktus -> frog
можешь плановые сроки обозначить

2020-10-21T13:03:43 kaktus -> frog
когда получится в таком формате собрать

2020-10-21T13:10:08 frog -> kaktus
В пятницу начну разбираться. Недели 2, думаю. Но возможно, и за выходные сделаю.

2020-10-21T13:10:44 kaktus -> frog
от двух дней до двух недель - больно расплывчато)

2020-10-21T13:12:05 frog -> kaktus
Если сложностей не будет никаких, тогда всё быстро сделаю. Затягивать у меня желания нет.

2020-10-21T13:33:52 kaktus -> frog
[20.10.2020 02:50:40] <frog> Обычно высылаю несколько сборок. Если одна будет детектироваться, можно другую протестировать.

2020-10-21T13:34:17 kaktus -> frog
скажи а чем у тебя сборки различаются, только разный ребилд в LlVMO или еще какие отличия?

2020-10-21T13:37:23 frog -> kaktus
Разные способы закрепления в системе (1-A - ярлык, 1-B - задание BITS). 1-H - в нём ставится ловушка на BaseThreadInitThunk.

2020-10-21T13:39:41 frog -> kaktus
1-H сделал недавно, отправляю её на тестирование, чтобы проверили, работает или нет на разных ОС. Про это меня Буза спрашивал, ну и решил попробовать сделать.

2020-10-21T14:26:02 frog -> kaktus
Т.е. Буза спрашивал, делаю ли запрет потоков. Попробовал отсеять потоки, поставил ловушку на BaseThreadInitThunk. Теперь же нужно проверить, как это работает, поэтому отправляю тестировщикам этот комплект (1-H). Правда, до сих пор, никто так и не сказал из тестировщиков, работает он или нет (

2020-10-21T14:26:36 kaktus -> frog
это не метод закрепления?

2020-10-21T14:27:08 kaktus -> frog
запрет потоков - это что-то из митигаций?

2020-10-21T14:29:20 frog -> kaktus
Да, близко. С митигациями не разбирался. Для митигаций там есть специальные функции. А это вроде бы другой приём, но результат похожий. Он разрешает только наши потоки, а все остальные запрещает.

2020-10-21T14:30:40 frog -> kaktus
Не совсем правда понимаю, что это даст. Может АВ усложнит работу.

2020-10-21T14:31:51 kaktus -> frog
а где про этот способ инфа - в инете есть, или Буза инструкцию давал как сделать?

2020-10-21T14:34:12 frog -> kaktus
В redmine написано немного. В интернете написано, что так Mozilla FireFox делает, а больше ничего не нашёл. Сам разбирался

2020-10-21T14:35:10 kaktus -> frog
ПЕРЕХВАТ ЧУЖИХ ПОТОКОВ (ЗАЩИТА ОТ ИНЪЕКЦИИ)

Перехватить чужую инъекцию в процесс можно, поставив свой обработчик на функцию BaseThreadInitThunk().

2020-10-21T14:35:12 kaktus -> frog
вот это видимо

2020-10-21T14:35:21 frog -> kaktus
да

2020-10-21T14:37:03 frog -> kaktus
    BYTE* p = (BYTE*)pBaseThreadInitThunk;
    // Поставим ловушку на функцию BaseThreadInitThunk также, как это делает лисичка
    // Команда MOV r11, pBaseThreadInitThunk
    p[0] = 0x49;    p[1] = 0xBB;
    *((unsigned __int64*)(p + 2)) = (__int64)&BaseThreadInitThunk;
    // Команда JMP r11
    p[10] = 0x41;
    p[11] = 0xFF;
    p[12] = 0xE3;

2020-10-21T14:37:36 frog -> kaktus
И пишем своё тело:
__int64 __fastcall BaseThreadInitThunk(int a, __int64(__fastcall* func) (__int64), __int64 parameter)
{
}

2020-10-21T14:40:04 kaktus -> frog
r11 - это под какую архитектуру проца

2020-10-21T14:40:17 frog -> kaktus
x64

2020-10-21T14:40:38 frog -> kaktus
C 32-разрядной не разбирался.

2020-10-21T14:43:07 kaktus -> frog
а проверял - какие потоки создаются для разных АВ

2020-10-21T14:43:18 kaktus -> frog
в своем обработчике, или он только блокирует создание потоков?

2020-10-21T15:40:28 kaktus -> frog
скажи, ты с делал сборку с иконкой?

2020-10-21T15:43:20 kaktus -> frog
нужна в группе 4 сборка с иконкой txt

2020-10-21T15:43:41 kaktus -> frog
[18:37:44] <kramer> https://www.google.com/url?sa=i&url=https%3A%2F%2Ficonscout.com%2Ficon%2Ftxt-file-20&psig=AOvVaw1nTpjIPO0LyI6OKoEernq1&ust=1603381019822000&source=images&cd=vfe&ved=2ahUKEwjN3KPygcbsAhWNeDABHXGSCeQQjRx6BAgAEAc

что то такое 
[18:38:53] <kramer> https://www.google.com/url?sa=i&url=https%3A%2F%2Fdryicons.com%2Ficon%2Fflat-txt-file-type-icon-8198&psig=AOvVaw2Q4_kdVVPPTtyc1Tv6k87i&ust=1603381117855000&source=images&cd=vfe&ved=2ahUKEwiej4OhgsbsAhU4cTABHUVWAbQQjRx6BAgAEAc

или вот, как вариант

2020-10-21T15:44:28 kaktus -> frog
иконку приложи отдельно в файл с лоадером

2020-10-21T15:45:15 kaktus -> frog
желательно чтобы в завтрашний крипт вошло

2020-10-21T15:46:02 kaktus -> frog
т.е. сборку Ксенону новую до 11 МСК завтра надо

2020-10-21T15:46:44 kaktus -> frog
[18:44:28] <kaktus> иконку приложи отдельно в файл с лоадером - отдельным файлом, в папку с лоадером*

2020-10-21T15:54:01 frog -> kaktus
Какие IP-адреса сейчас?

2020-10-21T15:55:56 kaktus -> frog

bot

18.224.30.70 duckgb.xyz
54.212.116.99 myjusts.xyz


loader

52.90.14.44  egwn.xyz
34.238.84.181 xobjective.com
3.137.174.178 onepolks.com

2020-10-21T15:57:44 frog -> kaktus
Т.е. иконку просто приложить? Компилировать с ней не нужно?

2020-10-21T15:58:10 kaktus -> frog
компилировать с ней не обязательно, главное чтобы она отдельным файлом .ico была

2020-10-22T06:50:47 kaktus -> frog
привет!

2020-10-22T06:51:06 kaktus -> frog
ты сборки БК по прежнему вечером делаешь?

2020-10-22T06:53:46 kaktus -> frog
возможно ли будет изменить график - делать сборки утром, в районе 10-11 МСК?

2020-10-22T06:54:52 frog -> kaktus
привет!

2020-10-22T06:54:52 frog -> kaktus
ты сборки БК по прежнему вечером делаешь?

2020-10-22T06:54:52 frog -> kaktus
возможно ли будет изменить график - делать сборки утром, в районе 10-11 МСК?

2020-10-22T07:45:39 kaktus -> frog
адреса на сегодня:

2020-10-22T07:45:41 kaktus -> frog
боты
54.212.116.99
94.140.115.242
5.181.156.240 
18.224.30.70

лоадеры
34.238.84.181 xobjective.com
3.137.174.178 onepolks.com 
52.90.14.44  egwn.xyz
195.123.241.204
89.32.41.191

2020-10-22T07:45:55 kaktus -> frog
[09:51:07] <kaktus> ты сборки БК по прежнему вечером делаешь? 
[09:53:46] <kaktus> возможно ли будет изменить график - делать сборки утром, в районе 10-11 МСК?

2020-10-22T07:48:20 frog -> kaktus
Привет. Неудобно по времени. Буду  стараться делать утром

2020-10-22T07:49:51 kaktus -> frog
если неудобно  -то не надо, я техпроцесс подстрою

2020-10-22T07:51:49 kaktus -> frog
а вечером это во сколько?

2020-10-22T07:52:19 frog -> kaktus
19:00 мск

2020-10-22T09:05:01 kaktus -> frog
ты группу 4 с иконкой делал?

2020-10-22T09:06:02 frog -> kaktus
Сделал со вчерашними адресами вчера. Сегодня ещё не сделал

2020-10-22T09:06:24 kaktus -> frog
продублируй ксенону вчерашнюю, он говорит не было

2020-10-22T09:06:30 kaktus -> frog
с иконкой*

2020-10-22T09:06:56 frog -> kaktus
Да, новые адреса получил, поэтому высылать не стал.

2020-10-22T09:07:31 kaktus -> frog
так подожди

2020-10-22T09:07:34 kaktus -> frog
я про адреса забыл)

2020-10-22T09:07:40 kaktus -> frog
иконку я ему кинул если что

2020-10-22T09:08:21 kaktus -> frog
если есть возможность сейчас собрать с новыми адресами - собери тогда и с иконкой ему направь.

2020-10-22T09:08:37 kaktus -> frog
в течении часа если не сможешь собрать - тогда не надо

2020-10-22T09:08:51 frog -> kaktus
Хорошо.

2020-10-22T12:16:41 kaktus -> frog
что там с 4 группой?

2020-10-22T12:16:54 kaktus -> frog
[15:10:00] <xenon> новая сборка не работает 
[15:10:07] <xenon> фрог переделывает

2020-10-22T12:17:40 kaktus -> frog
ты на отстук проверяешь перед выдачей?

2020-10-22T12:18:10 frog -> kaktus
Разбираюсь. С другой группой работает, а с четвёртой нет. 
Да проверяю

2020-10-22T12:54:32 kaktus -> frog
в карточке группы 4 поле Cookies Names ты заполнял?

2020-10-22T12:55:01 kaktus -> frog
твой БК работает с этим полем корректно?

2020-10-22T12:57:01 frog -> kaktus
Просил Ксенона сегодня, он заполнил эти поля. Нормально работает.

2020-10-22T12:57:20 kaktus -> frog
понятно

2020-10-22T12:57:46 kaktus -> frog
в чем тогда проблема, не ясно пока?

2020-10-22T12:59:43 frog -> kaktus
Да заработало вроде бы. Ксенон написал, что второй комплект проверяет. В первом детект появился. 
Попросил его загрузить exe-файлы и в Stages, и в Productions, и заработало

2020-10-22T13:00:10 kaktus -> frog
кстати, хотел уточнить насчет версии

2020-10-22T13:00:44 kaktus -> frog
если в админке стоит текущая версия лоадера - он будет файл скачивать хоть раз?

2020-10-22T13:02:43 frog -> kaktus
Будет

2020-10-22T13:03:24 kaktus -> frog
надо бы сделать, чтобы не качал, если версия совпадает

2020-10-22T13:03:59 kaktus -> frog
иначе приходится для теста исходник заливать, причем тебе в продакшн

2020-10-22T13:04:11 kaktus -> frog
а он там палится

2020-10-22T13:04:58 kaktus -> frog
плюс, не будет качать себя - меньше палива на АВ

2020-10-22T13:05:07 frog -> kaktus
Понятно. Не знал об этом. Думал, что всё в Stages тестируется.

2020-10-22T13:05:35 kaktus -> frog
не факт, один тестировщик тут со своими ВМ работал, ему приходилось в продакшн лить

2020-10-22T13:05:54 kaktus -> frog
к тому же твои адреса не в списке для Staged - тебе придется полюбому в продакт заливать

2020-10-22T13:07:45 frog -> kaktus
Странно. А для чего тогда в админке эта колонка Stages, если ей пользоваться, получается, нельзя?

2020-10-22T13:08:08 kaktus -> frog
ей тестировщики пользуются, но не факт что все

2020-10-22T13:08:13 kaktus -> frog
и автотесты*

2020-10-22T13:09:54 kaktus -> frog
Для обновления используется дополнительный линк, зашитый в код. Обновляться следует только если отличается версия (произвольная строка)
(сервер должен отдать версию файла на запрос HEAD /update HTTP/1.1 в заголовке X-Tag)

2020-10-22T13:09:57 kaktus -> frog
у тебя в ТЗ есть такое?

2020-10-22T13:11:15 kaktus -> frog
строку с версией зашиваешь в модуль, потом сверяешь ее с тем что в админке. Если совпадает - не обновляешься.

2020-10-22T13:11:40 kaktus -> frog
95% ботов одним днем работают

2020-10-22T13:12:30 kaktus -> frog
обновление при отсутствии изменений - лишнее телодвижение, причем оно привлекает внимание АВ

2020-10-22T13:12:49 kaktus -> frog
как вариант - при первом запуске вообще обновление не проверять, только при запуске из закрепа

2020-10-22T13:14:45 frog -> kaktus
Понял

2020-10-22T13:16:00 kaktus -> frog
текущую версию лоадера - т.е. полученную из админки ты как сохраняешь?

2020-10-22T13:16:55 kaktus -> frog
еще момент - у тебя в системе параметры статические используются какие?

2020-10-22T13:17:19 kaktus -> frog
имя мьютекса, файла/папки, раздела, ключа реестра, аргумент командной строки и тд

2020-10-22T13:18:41 kaktus -> frog
если есть - желательно все "попрятать" - чтобы параметры были на разных машинах не совпадали

2020-10-22T13:19:29 kaktus -> frog
и генерировались на основе BOT ID, или BOT ID + группа [+ версия]

2020-10-22T13:38:49 frog -> kaktus
Мьютексы использую для синхронизации, аргументы командной строки. Реестр, доп. файлы не использую

2020-10-22T13:40:02 kaktus -> frog
что по сборке гр. 4?

2020-10-22T13:40:11 kaktus -> frog
[16:34:11] <xenon> на первом комплекте был детект, на втором после перезагрущки 
[16:34:13] <xenon> не стучит

2020-10-22T13:40:35 frog -> kaktus
Разбираться  нужно

2020-10-22T13:40:56 kaktus -> frog
а закреп не проверяешь перед выдачей?

2020-10-22T13:41:54 frog -> kaktus
Не всегда. Если не меняю его, то не проверяю.

2020-10-22T14:39:58 kaktus -> frog
[17:36:29] <xenon> 1.6 детект 
[17:36:35] <xenon> 1.8 1а сборка палится 
[17:36:44] <xenon> 1в после перезагрузки не стучит

2020-10-22T14:40:28 kaktus -> frog
какая перспектива по группе 4 - в течении получаса рабочую сборку сделать выйдет?

2020-10-22T14:40:42 frog -> kaktus
На какой ОС не стучит? На Windows 10?

2020-10-22T14:40:58 kaktus -> frog
теке ксенон не писал?

2020-10-22T14:41:01 kaktus -> frog
тебе*

2020-10-22T14:41:58 frog -> kaktus
Там задание BITS. Оно, бывает, с запозданием запускается

2020-10-22T14:42:21 kaktus -> frog
ну за 10 минут должен отстучать?

2020-10-22T14:43:54 frog -> kaktus
Разобраться надо. За полчаса не успею

2020-10-22T16:44:29 kaktus -> frog
так, принимай важные указания) 
[18:20:41] <kaktus> 1) нам уточнили требования по детектам в сборках: 
[18:20:59] <kaktus> - полное отсутствие статических детектов (ноль на динчеке) в исходнике лоадера. 
[18:21:13] <kaktus> Желательно статику проверяй сам перед выдачей сборки 
[18:21:32] <kaktus> - в динамике на исходнике не должно быть детектов в АВ: WinDef, BitDefender, ESET, Avast 
[18:21:53] <kaktus> отныне такие требования действуют у Хлора при подготовке сборок к работе 
[18:22:24] <kaktus> 2) перед выдачей сборки обязательно проверяй ее на отстук и закреп. Минимум - одна сборка X64 на Win10 
[18:23:09] <kaktus> Смотри, чтобы отстук был после ручного запуска лоадера. Затем перезапускай ВМ и проверяй что есть отстук при запуске из закрепа. 
[18:24:44] <kaktus> проверяй так для каждой группы сборку, даже если обе одновременно выдаешь

2020-10-22T16:45:56 frog -> kaktus
принял

2020-10-22T16:48:21 kaktus -> frog
дальше, есть проблема с вечерним формированием тобой сборок, обойти не получается

2020-10-22T16:49:16 kaktus -> frog
смысл в чем - адреса новые получаем утром, тестировщики также работают днем и если все по плану - сборки уходят в работу к вечеру. Если ты делаешь сборку вечером, то она на крипт только на следующий день уйдет

2020-10-22T16:49:33 kaktus -> frog
за ночь адреса в ней могут сгореть или в блек-лист

2020-10-22T16:49:57 kaktus -> frog
тоесть твой БК в работу затруднительно выпускать, если сборку вечером делаешь

2020-10-22T16:50:28 kaktus -> frog
поэтому я предлагал вариант с утра формировать

2020-10-22T16:50:47 kaktus -> frog
но есть другие возможные решения - патчер/билдер сделать, чтобы адреса при необходимости менять в готовых бинарниках

2020-10-22T16:52:15 kaktus -> frog
или доступ к исходникам твоим настроить мне или другому кодеру, чтобы мы смогли пересобрать сами

2020-10-22T16:52:29 kaktus -> frog
подумай, какой вариант лучше подходит

2020-10-22T16:55:20 frog -> kaktus
Хорошо. Всё понял. Буду стараться по утрам пока делать. Идея с патчером интересная

2020-10-23T08:46:03 kaktus -> frog
привет!

2020-10-23T08:46:06 kaktus -> frog
адреса на сегодня не меняются

2020-10-23T08:46:17 frog -> kaktus
Привет.

2020-10-23T08:46:23 kaktus -> frog
тебе вчера тестировщики о детектах в БК сообщали?

2020-10-23T08:46:57 frog -> kaktus
Да, сообщали

2020-10-23T08:47:19 kaktus -> frog
Хлор и Ксенон, оба?

2020-10-23T08:48:40 frog -> kaktus
Да, про Avast говорили и на Windows Defender был детект

2020-10-23T08:49:04 kaktus -> frog
какую инфу передали по детектам

2020-10-23T08:49:49 kaktus -> frog
название ОС, скриншот с детектом, запись журнала АВ, когда детект (при запуске или после перезагрузки) - говорят?

2020-10-23T08:49:54 frog -> kaktus
Trojan:Win64/Bazar!MSR

2020-10-23T08:50:18 kaktus -> frog
ну то есть инфу сразу дают необходимую или выпытывать приходится

2020-10-23T08:51:00 frog -> kaktus
Да, полную дают.

2020-10-23T08:52:08 kaktus -> frog
[22.10.2020 16:16:00] <kaktus> текущую версию лоадера - т.е. полученную из админки ты как сохраняешь?

2020-10-23T08:52:20 kaktus -> frog
вчера не нашел ответа на это, ответь или продублируй если писал

2020-10-23T08:53:50 frog -> kaktus
Сравниваю со своей, вшитой внутрь exe-файла. Нигде не сохраняю.

2020-10-23T08:54:26 frog -> kaktus
Из админке же версия только для сравнения нужна, насколько понимаю

2020-10-23T08:54:41 kaktus -> frog
ок

2020-10-23T08:55:27 kaktus -> frog
по чистке как обстоят дела?

2020-10-23T08:55:59 kaktus -> frog
нажна помощь, советы?

2020-10-23T08:58:08 kaktus -> frog
сегодня сборка чистая у тебя?

2020-10-23T08:58:33 kaktus -> frog
ксенон будет проверять вчерашнюю 1в еще раз, вчера были проблемы с серверной частью - возможно из-за этого не стучала

2020-10-23T08:58:47 frog -> kaktus
Работаю над детектами. Время только нужно. Avast детектирует.

2020-10-23T08:59:25 kaktus -> frog
Работаю над детектами. Время только нужно. Avast детектирует.

2020-10-23T08:59:44 kaktus -> frog
[11:58:07] <kaktus> сегодня сборка чистая у тебя?

2020-10-23T09:01:27 frog -> kaktus
Сегодня нет.
[23.10.2020 11:58:49] <frog> Работаю над детектами. Время только нужно. Avast детектирует.

2020-10-23T09:02:02 kaktus -> frog
по статике?

2020-10-23T09:02:16 kaktus -> frog
ты используешь LLVMO и avclean?

2020-10-23T09:02:40 frog -> kaktus
да

2020-10-23T09:02:40 frog -> kaktus
Не использую. Не слышал про них

2020-10-23T09:05:54 kaktus -> frog
LLVMO - обфусцирующий компилятор, облегчает чистку по статике. avclean - средство для поиска конкретных точек в которых сигнатурный детект сейчас скину

2020-10-23T09:08:44 kaktus -> frog
fbN7dsjC$haNxk2gBx

2020-10-23T09:08:46 kaktus -> frog
Download: https://qaz.im/load/59tsnr/ae2kdn
Delete: https://qaz.im/index.php?a=delete&q=2053839098

2020-10-23T09:12:20 frog -> kaktus
Сейчас сборки делать? Или после устранения детекта на Avast?

2020-10-23T09:12:56 kaktus -> frog
у тебя детект, занимайся чисткой

2020-10-23T09:16:47 kaktus -> frog
до тебя указания доводили, как надо документировать чистку?

2020-10-23T09:17:44 frog -> kaktus
Да, NOTES_RELEASE.txt создавать, читал.

2020-10-23T09:20:18 frog -> kaktus
Просто Xenon будет тестировать вчерашнюю сборку. Вчера убрал лишние загрузки с сервера при совпадении версии, про которые ты говорил. 
Исправленную версию могу выслать на тестирование, и далее устранять этот стат. детект c аваста.

2020-10-23T09:28:26 kaktus -> frog
>Вчера убрал лишние загрузки с сервера при совпадении версии, про которые ты говорил.

2020-10-23T09:28:52 kaktus -> frog
если это сняло детекты, о которых вчера сообщали тестировщики - тогда делай новую сборку. Если детект остался, то занимайся чисткой

2020-10-23T09:29:50 frog -> kaktus
Хорошо

2020-10-23T15:54:49 kaktus -> frog
насчет отладочный версии твоего лоадера

2020-10-23T15:55:04 kaktus -> frog
1) то что выводится в окно - гдето еще сохраняется?

2020-10-23T15:55:16 kaktus -> frog
2) алгоритмы отладочного и боевого модуля идентичны?

2020-10-23T15:56:27 kaktus -> frog
это про 1-B файл dl4_x64_logs.exe

2020-10-23T16:04:55 kaktus -> frog
ты в курсе что лог в консоли нечитабелен на тестовой ВМ - которая без русской раскладки

2020-10-23T16:05:08 kaktus -> frog
v7nSjfwe%nvsBsWgd

2020-10-23T16:05:08 kaktus -> frog
Download: https://qaz.im/load/E6ht43/b85t98
Delete: https://qaz.im/index.php?a=delete&q=1268639313

2020-10-23T16:06:30 kaktus -> frog
еще момент - что за пустые мессаджи перед телеметрией почти всегда

2020-10-23T16:06:35 kaktus -> frog
https://scrytnuuszglaugg.onion:4247/testbots/command?id=cfbaa86e827d7f586393fa8e135c97ff

2020-10-23T16:25:47 kaktus -> frog
еще, в телеметрии аптайма нет

2020-10-23T17:06:59 frog -> kaktus
Лог сохраняется на рабочий стол в текстовый файл. У логированной и нелогированной версий алгоритмы идентичны. Про лог в курсе. На сервер периодически отправляется время работы и последний IP-адрес сервера.

2020-10-23T17:11:51 frog -> kaktus
Есть пример какой-нибудь, как из PEB считать аргументы командной строки?

2020-10-23T17:28:01 kaktus -> frog
я тестировал твою сборку и есть замечания

2020-10-23T17:28:08 kaktus -> frog
самое существенное:

2020-10-23T17:28:44 kaktus -> frog
[20:06:59] <frog> Лог сохраняется на рабочий стол в текстовый файл. - в файле нет того что в консоле. В консоле гдето три страницы было, а в файле 4 строчки всего.

2020-10-23T17:29:13 kaktus -> frog
и с экрана нечитабельно, русские символы крякозябрами.

2020-10-23T17:29:20 kaktus -> frog
Поэтому надо сделать чтобы в файл полный лог выводился

2020-10-23T17:29:56 kaktus -> frog
второе - я так понял к айпи адресам одна попытка коннекта только, затем сразу переходит к следующему

2020-10-23T17:30:07 frog -> kaktus
Странно. У меня же debug_printf везде. Одно и тоже на экран печатается и в файл.

2020-10-23T17:30:27 kaktus -> frog
нужно минимум три попытки коннекта к адресам из первого и второго списка

2020-10-23T17:31:40 kaktus -> frog
третье - уже менее существенно, но все же важно. Отладочный лог должен быть на английском языке.

2020-10-23T17:31:57 kaktus -> frog
во-первых, есть риск утечки модуля как показала практика. во-вторых, можно будет читать на тестовой ВМ сразу

2020-10-23T17:32:24 kaktus -> frog
и в случае утечки не должно палиться что русские писали)

2020-10-23T17:33:06 frog -> kaktus
Понятно. Не думал, что логированная версия может утечь)

2020-10-23T17:33:41 kaktus -> frog
вот только сегодня Свифт наш коллега написал, что его модуль отладочный слили

2020-10-23T17:34:10 kaktus -> frog
[23.10.2020 13:01:50] <swift> team9_restart_loader
[23.10.2020 13:01:52] <swift> загугли

2020-10-23T17:34:43 kaktus -> frog
остальное не так важно, посмотри уже по мере возможности:

2020-10-23T17:34:44 kaktus -> frog
[19:06:30] <kaktus> еще момент - что за пустые мессаджи перед телеметрией почти всегда

2020-10-23T17:34:56 kaktus -> frog
[19:25:47] <kaktus> еще, в телеметрии аптайма нет - по крайней мере в первом при запуске сообщении нет времени

2020-10-23T17:35:14 frog -> kaktus
На сервер периодически отправляется время работы и последний IP-адрес сервера.

2020-10-23T17:35:29 kaktus -> frog
тоесть в первом сообщении нет времени - так и задумано?

2020-10-23T17:38:11 frog -> kaktus
Сразу сейчас не вспомню. Много кода уже написано. Сейчас гляну.

2020-10-23T17:38:38 kaktus -> frog
еще вопрос - как лоадер будет реагировать в таких ситуациях:

2020-10-23T17:39:36 kaktus -> frog
с линка бота/обновления лоадера  пришел некорректный файл - неполный, либо мусор, либо вообще пусто

2020-10-23T17:41:02 frog -> kaktus
Проверяется первый байт. Если он равен MZ, то всё нормально:
    // Проверим заголовок исполняемого файла загрузчика
    if (((WORD*)data)[0] != IMAGE_DOS_SIGNATURE)
    {
        debug_printfA("%s> Загруженный файл не является исполняемым (первые два байта не равны \"MZ\")\r\n", __FUNCTION__);
        GET_API(HeapFree)(GET_API(GetProcessHeap)(), 0, data);
        return -1;
    }

2020-10-23T17:42:16 kaktus -> frog
а если заголовок норм, а дальше битое - файл инжектнет?

2020-10-23T17:43:03 kaktus -> frog
рекомендую проверку добавить хотябы что размер полученных данных соответствует размеру модуля по минимуму

2020-10-23T17:43:35 kaktus -> frog
если пришло тело размером 5 Кбайт - это явно не модуль

2020-10-23T17:45:41 frog -> kaktus
Понятно. Сразу исправил.

2020-10-26T10:43:36 kaktus -> frog
привет!

2020-10-26T10:43:45 kaktus -> frog
1) гитом не пользуйся пока - переезд. 
когда штатно заработает - напишу отдельно

2020-10-26T10:44:15 kaktus -> frog
2) Напиши свой резервный контакт в другой жабе, на случай если эта будет недоступна. Если резерва нет - то заведи аккаунт на exploit.im или другом сервере.

2020-10-26T10:44:26 kaktus -> frog
Мой резервный аккаунт на случай потери связи: dpigeon@exploit.im

2020-10-26T10:57:05 frog -> kaktus
Хорошо. Сделаю.

2020-10-26T11:17:31 kaktus -> frog
как успехи по чистке?

2020-10-26T11:28:39 frog -> kaktus
В общем, чем занимался. С авастом разобрался (был и статический детект, и динамический, долго с ним возился). Потом был статический детект AhnLab, его тоже устранил. Теперь нужно проверить, как всё будет работать при подключении к серверу с перезагрузкой на Windows Defender, потому что на выходных не было подключения, не смог проверить.
Потом попробовал скомпилировать на обфусцирующем компиляторе CLang. Всё получилось, но тоже всё нужно проверить при подключении к серверу, когда будут известны IP-адреса.
dll-библиотеки тоже получилось скомпилировать, но проверить их не успел. Хотел проверить работу через LoadLibrary, GetProcAddress, не успел.

2020-10-26T11:30:48 kaktus -> frog
ну dll в исходнике затруднитеьлно проверить, это надо с криптом

2020-10-26T11:30:57 kaktus -> frog
особенно если там перезапуски есть

2020-10-26T11:31:18 kaktus -> frog
админка и сервер пока не работает, новый делают

2020-10-26T11:32:29 frog -> kaktus
А LLVM правда так хорош при борьбе со статическими детектами?

2020-10-26T11:33:05 kaktus -> frog
он дает плюс, но не для всех АВ и типов детектов эффективен

2020-10-26T11:33:23 kaktus -> frog
статические детекты разных типов бывают - от сигнатурных и частично эвреститческих он помогает

2020-10-26T11:33:31 kaktus -> frog
если детект по эмуляции то не поможет

2020-10-26T11:35:14 frog -> kaktus
Эмуляции - это песочницы?

2020-10-27T09:31:40 kaktus -> frog
привет!

2020-10-27T09:32:33 kaktus -> frog
[23.10.2020 20:11:55] <frog> Есть пример какой-нибудь, как из PEB считать аргументы командной строки? - извиняюсь, пропустил этот вопрос

2020-10-27T09:33:04 kaktus -> frog
сам я так не делал - получал параметры через АПИ GetCommandLineA(), поэтому кода нет

2020-10-27T09:33:49 kaktus -> frog
загугли Process Environment Block - он всегда доступен через один из сегментных регистров, в нем есть структура с параметрами текущего процесса

2020-10-27T09:34:11 kaktus -> frog
или исходник реализации GetCommandLineA()/GetCommandLineW() посмотри

2020-10-27T09:49:46 frog -> kaktus
Привет!
Да, спасибо, разобрался.
Вот так сделал:
wchar_t* getCommandLine(void)
{return ((PPEB)PEBGet())->ProcessParameters->CommandLine.Buffer;
}

2020-10-27T09:51:44 frog -> kaktus
Создал резервный аккаунт в случае потери связи:
crazy_digger@jabber.ru

2020-10-27T09:53:00 kaktus -> frog
принял, хорошо

2020-10-27T10:22:13 kaktus -> frog
новые требования по использованию динчек:

2020-10-27T10:22:36 kaktus -> frog
если пользуешься служебным акком (graddds@xmpp.jp) - удаляй из истории все свои тесты

2020-10-27T10:22:55 frog -> kaktus
понятно

2020-11-02T13:55:20 kaktus -> frog
привет!

2020-11-02T13:55:31 kaktus -> frog
[16:52:19] <kaktus> [16:37:00] <defender> другим кого знаешь, у кого есть рез жабы, пусть мне стукнут [16:37:19] <defender> сегодня будем раздавать акки новой жабы 
[16:52:22] <kaktus> polanders@exploit.im 
[16:52:29] <kaktus> это дефендер, добавься к нему в резервной жабе. Дальше связь на резервном акке пока не будет новой жабы

2020-11-02T13:57:08 frog -> kaktus
Привет. 
Хорошо. Какой полный ник у Defender'а?

2020-11-02T13:58:16 kaktus -> frog
вот в этот добавься из своего резервного акка: polanders@exploit.im

2020-11-02T13:58:31 kaktus -> frog
и напиши ему свой ник в тор-жабе

