[15.11.21 10:11:48] alik:		Во норм
[15.11.21 10:11:53] jaime:		Ок! :)
[15.11.21 10:11:58] jaime:		Да на мне webinject
[15.11.21 10:12:13] jaime:		Сейчас отрабатываю по замечанием
[15.11.21 10:12:18] alik:		Все браузеры ына хромиуме, ие и тд?
[15.11.21 10:12:22] jaime:		замечаниям
[15.11.21 10:12:46] jaime:		Работают хром, ff, ie
[15.11.21 10:13:05] alik:		Перехват ssl фнукций или митим с прокси и сертификатами?
[15.11.21 10:13:36] jaime:		митм с прокси и сертификатами :)
[15.11.21 10:13:55] alik:		Отлично
[15.11.21 10:14:06] alik:		В своем время дико устал от поиска функций в хроме
[15.11.21 10:14:57] jaime:		Есть два основных режима: формграббер - граб POST запросов, и инжект -вставка в страницу кода
[15.11.21 10:15:18] jaime:		Конфиг вставки в формате зевса
[15.11.21 10:15:47] alik:		Сертификаты создаются на лету или есть рут сертификат в системе?
[15.11.21 10:17:39] jaime:		на лету + хуки на CertGetCertificateChain  и CertVerifyCertificateChainPolicy
[15.11.21 10:17:56] alik:		Это хорошо
[15.11.21 10:19:13] alik:		Я позабыл, в перехватчике модифицируешь CERT_CHAIN_POLICY_STATUS, чтобы серт прошел проверку?
[15.11.21 10:22:57] jaime:		Обе ф-ции возвращают всегда true. Есть легкая модификация флагов PCERT_CHAIN_CONTEXT в CertGetCertificateChain
[15.11.21 10:23:12] alik:		Ага
[15.11.21 10:23:40] alik:		А контент http2 как к тебе приходит? Уже распакованный или как?
[15.11.21 10:24:54] jaime:		http2 запрещаем, наблюдаем за процессами при запуске нового, перезапускам с нужными флажками, в том числе запрещаем  http2
[15.11.21 10:25:23] alik:		Окей. Я делал поддержку хттп2 в зевсе, если что добавим
[15.11.21 10:25:53] jaime:		О отлично. Пока задачу не ставили.
[15.11.21 10:26:11] alik:		Да, если что дам сорцы, там довольно просто все
[15.11.21 10:28:04] jaime:		:) отлично.
[15.11.21 10:28:18] jaime:		Так что если что знаешь кого пинать!
[15.11.21 10:28:30] alik:		Рад знакомству)
[15.11.21 10:29:24] jaime:		Взаимно! :)
[15.11.21 10:33:32] jaime:		У тебя наша жаба есть? Добавишь для резервного канала? flip@q3mcco35auwcstmt.onion
[15.11.21 10:33:59] alik:		Джаббер донастраиваю, добавлю
[15.11.21 11:12:53] jaime:		Я код vnc клиента и сервера сейчас посматриваю
[15.11.21 13:35:24] jaime:		https://mb5fbvx72fbod2hkirfecc5nh7lwq6ke7xocn7j2u7raiwbytvevpbad.onion/soft/WebInject.git добавил тебя в проект
[15.11.21 13:36:26] alik:		Перешли пожалуйста, последнее сообщение, отр перезагрузился
[15.11.21 13:36:40] jaime:		https://mb5fbvx72fbod2hkirfecc5nh7lwq6ke7xocn7j2u7raiwbytvevpbad.onion/soft/WebInject.git добавил тебя в проект
[15.11.21 13:36:49] alik:		Окей, спасибо
[01.12.21 07:58:51] alik:		Привет, стукни как будешь
[01.12.21 08:58:34] jaime:		Привет!
[01.12.21 08:58:36] jaime:		Тут!
[01.12.21 09:16:00] alik:		Привет, в модуле вебинжектов надо переделать сетевую модель у прокси
Отойти от 1 поток - 1 соединение
[01.12.21 09:16:49] alik:		Я пока разбираюсь в исходниках, помогу сделать
[01.12.21 09:18:49] jaime:		Переделать на select?
[01.12.21 09:19:19] jaime:		Там так  уже исторически было, я не стал ломать
[01.12.21 09:20:57] alik:		Наверное добьем асинхронную модель
[01.12.21 09:23:03] jaime:		Думаешь сам не осилю? :) Там сейчас хорошо, но ресурсоемко конечно.
[01.12.21 09:23:19] alik:		Осилишь, просто помогу
[01.12.21 09:26:52] jaime:		Накидывают все дискрипторы с массив, через селект выбираю, ну и там типа машины состояний. Так в общих чертах? Или по другому?
[01.12.21 09:27:53] alik:		Нет, это никак не добавит производительности
[01.12.21 09:28:40] jaime:		Памяти на тридах сэкономим.
[01.12.21 09:28:53] alik:		у тебя какая текущая ветка в гите для разработки?
[01.12.21 09:29:30] jaime:		jaime_research
[01.12.21 09:36:21] jaime:		Там в этом плане ничего не изменилось
[01.12.21 09:39:02] alik:		Я кажется писал самую первую версию вебинжектов в этому модуле
[01.12.21 09:39:17] alik:		Калбеки On_Create, On_Data, On_Form
[01.12.21 09:39:25] jaime:		Знакомый код? :)
[01.12.21 09:39:26] alik:		Парсер тоже мой
[01.12.21 09:39:43] jaime:		Мне этот код Сильвер передал!
[01.12.21 09:40:04] alik:		Да, я делал черех 3-4 посредников это лет пять назад)
[01.12.21 09:41:55] jaime:		Вот это мощно! :)
[01.12.21 09:44:01] alik:		объясни пожалуйста про эти файлы

webinject_data_x64.h
webinject_data_x86.h
webinject_rdata_x64.h
webinject_rdata_x86.h
webinject_text_x64.h
webinject_text_x86.h

payload_x86.h
payload_x64.h
loader_x64.h
[01.12.21 09:50:26] jaime:		payload_xx - это код который инжектится в собственно браузер, там хуки
[01.12.21 09:54:05] jaime:		webinject_ по секциям, для проекта  когда у нас один exe файл или dll, loader + webinject в одном. Без трика, пока не понадобилось, думаю для БК
[01.12.21 09:56:09] jaime:		loader_x64.h это вообще не нужно, я видимо случайно его добавил. В студии. вот те .hники то же не нужны, они генерятся при билде.
[01.12.21 09:57:07] alik:		Окей
[01.12.21 09:58:47] jaime:		Так что мне посмотреть в каком направлении?
[01.12.21 10:02:49] alik:		Вечером сформулирую, пока разбираюсь с исходниками
[01.12.21 10:09:36] jaime:		А модуль сейчас используют? Сейчас какое то затишье
[01.12.21 10:11:26] alik:		Увы, не знаю
[06.12.21 07:47:34] alik:		Привет, стукни как будешь
[06.12.21 07:58:51] jaime:		Привет!
[06.12.21 07:58:53] jaime:		Тут
[06.12.21 08:09:55] jaime:		Привет! Если что я тут!
[06.12.21 08:57:39] jaime:		Привет! от меня доходят сообщения?
[06.12.21 09:37:34] alik:		Привет, да. Собираю модуль инжектов
[06.12.21 09:39:43] jaime:		Собирается? Возможно не все закомитил
[06.12.21 09:40:41] jaime:		Можно вопрос, дурацкий. :)
[06.12.21 09:42:00] jaime:		Заработал тут падение на memmove, просмотрел все аргуементы, все ок
[06.12.21 09:42:10] jaime:		```
03.12.2021 20:29:12 7: KiUserExceptionDispatcher (:0) - 0x49190BD0
03.12.2021 20:29:12 6: MoveSmall (d:\agent\_work\3\s\src\vctools\crt\vcruntime\src\string\amd64\memcpy.asm:521) - 0xB5E0197

```
[06.12.21 09:42:34] jaime:		Не могу понять, заменил на memmove_s, все ок
[06.12.21 09:51:47] alik:		в memcpy - dst инициализирован?
[06.12.21 09:52:05] jaime:		да там копирование с перекрытием
[06.12.21 09:52:28] alik:		с размером тоже все норм?
[06.12.21 09:52:48] alik:		типы не кастуешь там при копировании
[06.12.21 09:53:20] jaime:		да там образно говоря на 200 байт уменьшаем буффер, нет каста вообще нет
[06.12.21 09:54:07] jaime:		Я уж грешу может на какие то выравнивания? Или оптимизацию
[06.12.21 09:57:15] alik:		Если не структура, то вряд ли связано с выравниванием
[06.12.21 10:03:09] jaime:		редиска, перестало падать. :(
[06.12.21 12:01:45] jaime:		не писал мне? Был в офе, рубанули электричество.
[06.12.21 12:09:30] alik:		неа
[15.12.21 10:06:55] alik:		Привет, нашел старые сорцы по митму у себя. Там более менее бытрая рабочая модель прокси, глянь пожалуйста, мб что то полезное найдешь для себя
[15.12.21 10:09:11] alik:		
[15.12.21 10:12:06] jaime:		Привет!
[15.12.21 10:12:17] jaime:		Ага забрал посмотрю! :)
[15.12.21 10:12:54] alik:		Там используется класический перехват, но получение конфига идет по ipc
[15.12.21 10:14:06] alik:		ipc - сетевая модель
[15.12.21 10:16:11] jaime:		там прокси не в отдельном потоке для каждого запроса?
[15.12.21 10:16:30] alik:		Вроде нет, надо глянуть
[15.12.21 10:16:41] jaime:		да я посмотрю.
[16.12.21 07:35:41] jaime:		Привет.
[16.12.21 07:35:52] jaime:		Есть тут вопросик по сборке!
[16.12.21 07:35:57] alik:		Привет
[16.12.21 07:36:16] jaime:		dumpbin_Release.aplib.h вот этот h чем собрать?
[16.12.21 07:36:50] alik:		Это дамп длл, в событиях сборки запускается упаковщик и потом преводится в хекс
[16.12.21 07:37:50] jaime:		А нашел! У dll есть такое событие.
[16.12.21 07:38:08] alik:		REACTOR_USE_APLIB поставь в 0, если не хочешь заморачиваться со сжатием
[16.12.21 07:38:31] alik:		в ReactorMain.cpp
[16.12.21 07:42:00] jaime:		В студии вообще постоянно какие то левые ошибки лезут! :)
[16.12.21 07:42:15] alik:		Проект старый, наверное будут ошибки
[16.12.21 07:43:44] jaime:		'Cannot open include file: 'xdebug': No such file or directory' пока вот такого плана
[16.12.21 07:43:58] jaime:		А ты писал что у тебя есть реализация http2.0?
[16.12.21 07:44:06] alik:		да
[16.12.21 07:44:50] jaime:		Закинешь как нибудь? :)
[16.12.21 07:44:56] alik:		да конечно
[16.12.21 07:51:31] jaime:		Не могу нагуглить про xdebug это часть portable_stl? Там смотрю в путях инклюдов к ней путь есть
[16.12.21 07:52:08] alik:		а убери эти инклуды вообще
[16.12.21 07:52:30] alik:		это stlport
его поддерживает только 2013 студия
[16.12.21 10:04:16] alik:		Как иходники? Нужна помощь?
[16.12.21 10:12:52] jaime:		Пока нет.
[16.12.21 10:13:00] jaime:		Не линкует :)
[16.12.21 10:13:33] alik:		На что ругается?
[16.12.21 10:16:54] jaime:		```
>NSPRInjects.obj : error LNK2001: unresolved external symbol "void __cdecl operator delete(void *,unsigned int)" (??3@YAXPAXI@Z)
1>WinSockHook.obj : error LNK2001: unresolved external symbol "void __cdecl operator delete(void *,unsigned int)" (??3@YAXPAXI@Z)
```
[16.12.21 10:16:56] jaime:		Типа того
[16.12.21 10:17:06] alik:		Ща
[16.12.21 10:18:21] jaime:		Да тут может приколюхи моей 2019
[16.12.21 10:23:16] alik:		
[16.12.21 10:23:45] alik:		
[16.12.21 10:24:01] alik:		
[16.12.21 10:24:39] alik:		
[16.12.21 10:24:47] alik:		Блин, файл не грузится сюда
[16.12.21 10:26:15] alik:		https://www.sendspace.com/file/iqriep
https://www.sendspace.com/delete/iqriep/667d52e18227a610f0016bf4b7412897

пасс 1

собирается в релизе, 2019
[16.12.21 10:30:25] jaime:		А выложи пожалуйста еще раз.
[16.12.21 11:04:21] alik:		сек
[16.12.21 11:04:32] alik:		https://www.sendspace.com/file/0yzfo8
https://www.sendspace.com/delete/0yzfo8/a3e2574e65615c5023cc9012b7e75bbb
[16.12.21 11:37:09] jaime:		Все забрал. Спасибо.
[21.12.21 14:22:35] alik:		Привет, как успехи с задачой?
[21.12.21 14:23:05] jaime:		Привет!
[21.12.21 14:23:10] jaime:		Ты мне писал?
[21.12.21 14:23:35] alik:		Тут? Отр глчит
[21.12.21 14:23:46] jaime:		Тут
[21.12.21 14:23:48] alik:		Из исходников смог забрать прокси?
[21.12.21 14:24:05] jaime:		Да все собрал
[21.12.21 14:24:05] alik:		Или не подошло?
[21.12.21 14:24:22] jaime:		Там нескольких файлов не хватало, я их из первого архива взял.
[21.12.21 14:24:37] jaime:		Посмотрел, на днях собирался
[21.12.21 14:25:10] jaime:		Посмотрел там чтение конфиги зевса
[21.12.21 14:32:59] jaime:		Ты в офф ушел
[21.12.21 14:53:19] alik:		Да, тор заглючил
Там парсер зевса, но поддерживает вложенные инжекты
[21.12.21 14:53:32] alik:		Не поддерживает
[12.01.22 20:42:50] alik:		Привет, как успехи с переводом вебинжей на асинхронную модель?
[13.01.22 10:02:54] jaime:		Привет.
[13.01.22 10:09:47] alik:		Привет
[13.01.22 10:18:43] jaime:		С асинхронной моделью пока разбираюсь, твой пример у меня почему то не заработал. Все запускается, но на этом все. До нового года, дорабатывал некоторые фичи существующего модуля, добавлял отправку лог поста в base64 (Франк попросил были подоздения что, что двоичные данные теряются), потом добавлял отдельный дамп лог поста в отдельный файл,  для Хаммера, и наши не смогли убрать конфигу, зевса (для инжекта в страницу), она каждый раз присылалась. Пришлось добавить небольшой http сервер, который перехватывает запрос и позволяет немного конфигурировать модуль, но это только в режиме с логами.
[13.01.22 14:45:31] jaime:		В ReactorDemo есть proxy сервере на 32767 порту, могу я на него непосредственно браузером подключиться?
[13.01.22 14:52:28] alik:		Привет, вроде да. Насчет работоспособности - он не работает с новыми браузерами, только для 32 бит, поставь браузеры 2013 года версий, так сможешь чекнуть работу. Фф, ие
[13.01.22 15:02:15] jaime:		Это я понял. Я и смотрел на ФФ 32. Пишет что все ок, но нет подключения на порт. Указываю порт как прокси то подключение есть, но браузер не работает.
[13.01.22 15:02:35] jaime:		Ты мне скажи что почитать у MS на эту тему. :)
[13.01.22 15:03:27] alik:		Стой стой, порт что выделяет реактор - к нему подключается только длл
Он не обрабатывает соединения как сокс
[13.01.22 15:03:55] jaime:		Ага понял.
[13.01.22 15:05:41] jaime:		```Reactor: Loading ...
REACTOR: OK, config compiled: 1 blocks
GzDecompSrv started on port 32769
REACTOR: Unpacking ApLib'ed DLL image ...
We are injected to firefox.exe (00001F6C)
We are injected to firefox.exe (00000F0C)
We are injected to firefox.exe (00002FC4)
We are injected to firefox.exe (00002FF4)
We are injected to firefox.exe (00002AFC)
We are injected to firefox.exe (00002E74)
We are injected to firefox.exe (00000BF8)
We are injected to firefox.exe (000004F8)

```
[13.01.22 15:09:29] alik:		лучше тестирую на фф, которая не перешл на мультпроц модель
[13.01.22 15:12:16] jaime:		Ага понял. Сейчас найду
[14.01.22 13:54:08] jaime:		Привет.
[14.01.22 13:54:26] jaime:		Со старым FF все ок заработало. Спасибо.
[14.01.22 13:59:13] jaime:		Я правда не понял в чем профит? Там то же отдельный поток на каждое соединение.
[14.01.22 14:04:54] alik:		не асинхронное в неск потоков?
[14.01.22 14:09:05] jaime:		Ну да создается поток ServerClientThread в common.cpp
[14.01.22 14:13:25] jaime:		пришел коннект на порт прокси, он создает поток для подключения Common.cpp:640
[14.01.22 14:13:49] jaime:		Там правда eventы прокидываются
[14.01.22 14:14:05] jaime:		но они как я понял больше для завершения
[14.01.22 14:15:50] jaime:		сокет делаем неблокируемым и работаем через select, ну и через event проверяем свою смерть
