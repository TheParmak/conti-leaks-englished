[27.07.21 09:10:21] ruben:		Привет
[27.07.21 09:10:27] ruben:		тута?
[27.07.21 09:11:29] ruben:		Ты Confluence бекапы еще не делал?
[27.07.21 09:12:27] ruben:		А то, там кто-то не в ту диру бекапы заливает, причем не раз в час, а раз в минуту. За сутки 17 гигов залили.
[27.07.21 09:13:22] ruben:		Я на своих 3-ех серверах отключил заливку, но кто-то продолжает заливать.
[27.07.21 09:24:44] ruben:		посмотри плз, а то у меня из-за этого все стоит
[27.07.21 09:25:28] ruben:		там в скриптах надо логин/пароль от твоего юзера прописать
[27.07.21 09:25:51] ruben:		а кто еще может быть? вроде, я никому больше доступ не давал
[27.07.21 09:26:10] ruben:		ты еще не настраивал вообще?
[27.07.21 09:40:06] ruben:		во блин, удалил вчерашнее залитое -- больше не заливается
[27.07.21 09:40:39] ruben:		походу, это от моих серверов-таки было, в фоне заливалось -- пока все не залилось, не остановилось
[06.09.21 12:52:07] ruben:		hi
[06.09.21 12:52:45] ruben:		сервак root 82.117.252.142 e1CwYIn9kqvN US my.itldc.com marlbor@inbox.lv bxydoBEv9S6whDMG $49.90
[06.09.21 12:53:41] ruben:		домен tdh-best.com
[06.09.21 12:53:50] ruben:		https://namecheap.com
[06.09.21 12:54:28] ruben:		marlbor@inbox.lv/FzeYcwUx29jW2Cbx
[06.09.21 12:54:54] rocco:		аг агуд спс
[06.09.21 12:55:08] ruben:		там надо глянуть на ДНС-сервере -- что-то имя в старый IP по-прежнему разрешается
[06.09.21 12:55:15] rocco:		уже привязан домен?
[06.09.21 12:55:24] rocco:		аа, ща гляну
[06.09.21 12:55:30] ruben:		нет, не привязался что-то пока
[06.09.21 12:55:53] ruben:		надо поковырять настройки на ДНС-сервере, чтобы указывал на сервак
[06.09.21 12:56:59] rocco:		можешь верифицировать почту?
[06.09.21 12:57:16] ruben:		так она верифицирована
[06.09.21 12:57:23] ruben:		могу доступ в почту дать
[06.09.21 12:57:25] rocco:		они опять просят
[06.09.21 12:57:31] rocco:		да давай
[06.09.21 12:57:37] rocco:		на будущее
[06.09.21 12:57:55] ruben:		там намечип при каждом входе почту спрашивает
[06.09.21 12:58:29] rocco:		да
[06.09.21 12:58:55] ruben:		почта https://login.inbox.lv/login marlbor@inbox.lv/kiFBV6mb8uAWQvYy
[06.09.21 13:03:09] rocco:		зашел
[06.09.21 13:03:23] rocco:		домены тогда не надо, 2 серва зарегай пжл
[06.09.21 13:04:41] ruben:		ладно, ок
[06.09.21 16:12:37] ruben:		один сервак уже готов
[06.09.21 16:12:42] ruben:		root 162.244.81.132 43rdpktv US serverroom.net/login marlbor@inbox.lv MFhrZwhX2QkkiE5r $48.59
[06.09.21 16:12:45] rocco:		ага давай
[06.09.21 16:12:50] rocco:		забрал спс
[06.09.21 16:13:05] ruben:		второй заказал, жду пока выдадут
[06.09.21 16:21:38] rocco:		чето не пинугет
[06.09.21 16:24:43] ruben:		ага, пну суппорт
[06.09.21 16:25:48] rocco:		страноо в личке, в пендинге ешо, тебе н амыло скинули данные?
[06.09.21 16:27:33] ruben:		скинули, откуда я тебе их и передал
[06.09.21 16:27:56] ruben:		ты уже с ними разговариваешь?
[06.09.21 16:28:03] ruben:		я тоже
[06.09.21 16:30:24] rocco:		все пошло
[06.09.21 16:30:33] rocco:		активный
[06.09.21 16:30:42] ruben:		блин, сказали, что это Custom configurastion, ждать надо 24-48 48 часов
[06.09.21 16:30:51] ruben:		законнектился уже?
[06.09.21 16:30:58] rocco:		ага
[06.09.21 16:31:09] ruben:		тогда гут
[06.09.21 16:33:14] ruben:		насчет 24-48 часов это суппорт перепутал с другим клиентом
[06.09.21 16:35:33] rocco:		да там ест ь такое когда custov делаешь, можно до 2 суток ждать
[06.09.21 16:35:43] rocco:		или переустановку
[06.09.21 16:36:02] ruben:		пронесло
[06.09.21 16:36:38] rocco:		самый норм в этом плане itldc, но он уже задроченный до дыр
[06.09.21 16:37:03] rocco:		я уже по 3 разу оттуда ip получаю
[06.09.21 16:37:10] rocco:		одни и те же
[06.09.21 16:47:59] ruben:		второй сервак на активации, написано, что занимает  обычно 1-24 часа (в среднем 2 часа)
[06.09.21 16:48:10] ruben:		наверное, в течение часа сделают
[06.09.21 16:51:16] rocco:		ага
[06.09.21 18:44:03] rocco:		рубен ну как не активировали?
[06.09.21 18:46:25] ruben:		готово уже
[06.09.21 18:46:28] ruben:		root 148.251.137.68 np3NmJf7mMpgyQ DE 4dedic.su marlbor@inbox.lv x8khFhm4f3iZ6ZMT 3750RUB
[06.09.21 18:48:46] rocco:		ага спс
[13.09.21 13:39:19] rocco:		рубен привет
[13.09.21 13:42:58] ruben:		Привет
[13.09.21 13:43:21] rocco:		мне вот бени дал скрипт для генерации ссл который
[13.09.21 13:43:49] rocco:		и почемуто сами серты пустые получаются, факер не отдает начения в subj для openssl
[13.09.21 13:44:05] rocco:		бени на тебя сослал
[13.09.21 13:44:11] rocco:		можешь посмотреть?
[13.09.21 13:44:50] rocco:		```
198.244.180.69 ansible_user=root ansible_password=34fhjdgEN3rE5ff
```
[13.09.21 13:44:55] rocco:		вот здесь
[13.09.21 13:45:00] rocco:		факер установлен
[13.09.21 13:45:05] rocco:		он работает
[13.09.21 13:45:21] rocco:		https://198.244.180.69
[13.09.21 13:45:30] rocco:		серт пустой
[13.09.21 13:45:48] ruben:		можешь перед командой openssl поставить echo и увидишь, что в subject-е
[13.09.21 13:46:40] rocco:		```
openssl req -x509 -new -nodes -days 365 -newkey rsa:2048 -md5 -subj /C=/ST=none/L=/O=/CN=/emailAddress= -keyout /etc/nginx/cert.key -out /etc/nginx/cert.crt
```
[13.09.21 13:46:48] rocco:		пустой я ставил уже
[13.09.21 13:46:59] rocco:		каждую строчку отдельно пытался вывести
[13.09.21 13:47:03] rocco:		тоже пустота
[13.09.21 13:47:13] rocco:		хз не могу понять в чем затык
[13.09.21 13:47:15] ruben:		щас посмотрю
[13.09.21 13:47:22] rocco:		посмотри пжл
[13.09.21 13:47:31] rocco:		у тебя быстрей может получится
[13.09.21 13:47:42] rocco:		там в /root/ssl.sh
[13.09.21 13:48:32] ruben:		а логин/пароль к этому 198.244.180.69 дашь?
[13.09.21 13:48:47] rocco:		```
34fhjdgEN3rE5ff
```
[13.09.21 13:48:49] rocco:		root
[13.09.21 13:54:28] ruben:		faker -l de_AT country-code
<...>
ValueError: No faker found for "country-code([])"
[13.09.21 13:54:54] ruben:		походу, faker криво установлен -- каких-то модулей не хватает
[13.09.21 13:58:15] rocco:		вроде работает
[13.09.21 13:58:19] rocco:		```
faker -l de_AT country_code
HN


```
[13.09.21 13:59:19] ruben:		а, пардон, у меня country-code
[13.09.21 13:59:56] rocco:		он из строки работавет, а почемуто в скрипте не передает
[13.09.21 14:12:16] rocco:		работает да?
[13.09.21 14:14:41] ruben:		там пару косяков было:
1) CN=`faker -l $locale domain_name 2>/dev/null` в паре мест стояло $locale, a d 2-х других было de_AT
надо было locale="de_AT" и дальше везде юзать $locale, а то тогда $locale не инициализовано было
2) надо было дополнительно export PYTHONIOENCODING=UTF-8 сделать, иначе оно походу, в C локали выводило, в результате пустая строка каким-то образом получалась
[13.09.21 14:14:53] ruben:		теперь подправил -- работает
[13.09.21 14:15:13] rocco:		ок спс
[13.09.21 14:15:36] ruben:		вот эта херня export PYTHONIOENCODING=UTF-8 существенная, но на моей машине и без нее работало
[13.09.21 14:16:53] rocco:		ну да, так как будет на разных проклах каждый раз генерится
[13.09.21 14:17:15] ruben:		да, лучше явно задать локаль
[13.09.21 14:17:35] ruben:		там C локаль не подойдет, т.к. у немцев всякие умляуты
[13.09.21 14:18:07] ruben:		а вот почему оно пустой строкой выводилось, а не кракозябрами, я так и не понял
[13.09.21 14:18:23] ruben:		может, кракозябры фильтруются
[15.09.21 05:40:28] rocco:		Рубен привет, не активировали сервера?
[15.09.21 05:40:54] ruben:		hi
[15.09.21 05:41:32] ruben:		пока только выдали сервера -- я их еще не настраивал
[15.09.21 05:41:55] rocco:		сам настроишь?
[15.09.21 05:42:04] ruben:		попробую
[15.09.21 05:42:06] rocco:		только сейчас запускай
[15.09.21 05:42:15] rocco:		или ладно давай мне
[15.09.21 05:42:20] rocco:		я настрою
[15.09.21 05:42:27] ruben:		ладно, щас скину
[15.09.21 05:42:38] ruben:		а то я еще толком не спал :(
[15.09.21 05:42:56] rocco:		ага, я щас побыстрому сделаю тогда
[15.09.21 05:43:05] rocco:		не страшно
[15.09.21 05:43:15] ruben:		root 91.132.3.226 6QwjnQKV4X US portal.dedipath.com marlbor@inbox.lv VUpmq2Bpi9fzx7aL $84
[15.09.21 05:43:25] rocco:		главное с кобами, это закупка сервов, самое геморойное
[15.09.21 05:43:41] ruben:		root 23.160.194.201 3W3h%!PdaZ%8 US crm.xenspec.com marlbor@inbox.lv xEaF42cJB7pSLKe5 $65
[15.09.21 05:44:02] ruben:		да я еще с скриптами для ансибля пока так и не освоился
[15.09.21 05:44:10] rocco:		спс
[15.09.21 05:44:19] ruben:		на этой неделе еще будут, чтоб попрактиковаться?
[15.09.21 05:44:30] rocco:		да там все просто, занес данные и запустил
[15.09.21 05:44:36] rocco:		да будут
[15.09.21 05:44:40] rocco:		постоянно будут
[15.09.21 05:44:54] rocco:		я просто не успеваю уже за всем следить
[15.09.21 05:44:57] ruben:		ладно
[15.09.21 05:45:09] rocco:		я напишу когда надо будет
[15.09.21 05:45:27] ruben:		ага
[17.09.21 13:07:11] rocco:		рубен привет, сможешь из ансибла сценария разобрать что ставится?
[17.09.21 13:09:15] ruben:		для rpm-пакета?
[17.09.21 13:09:40] ruben:		да ва принципе, разберусь, наверное. Если непонятно будет, у тебя спрошу.
[17.09.21 13:09:56] ruben:		в смысле, deb-пакета
[17.09.21 13:11:51] rocco:		ага ща скину
[17.09.21 13:11:52] ruben:		там в зависимости надо будет, наверное, добавить
[17.09.21 13:12:02] ruben:		а срочно надо?
[17.09.21 13:12:51] rocco:		в принципе да, чем скорей тем лучше
[17.09.21 13:13:26] ruben:		до понедельника или сегодня?
[17.09.21 13:14:15] rocco:		да нет сегодня наверно не успеешь все равно
[17.09.21 13:14:56] ruben:		там из сорцов надо собирать, или можно из бинарей?
[17.09.21 13:16:03] rocco:		щас я прям сюда скину, там у меня два сценария идут
```
- zakrep
- rvm
```
[17.09.21 13:16:17] rocco:		щас скину zakrep
[17.09.21 13:16:36] rocco:		```
    
    
    - name: killall httpd
      shell: "killall httpd --wait"
      ignore_errors: true 
    - name: Remove "apache2" package
      apt:
       name: apache2
       state: absent
      ignore_errors: true 
    
    - name: Install  package
  
      apt: pkg={{ item }} update_cache=yes cache_valid_time=3600
      become: True
      with_items:
        - tor
        - nginx
        - screen
        - postgresql
        - postgresql-client
        - puma
        - gem
        - erlang
        
        - python-psycopg2
        - libpq-dev
        - curl
        - sudo
        - git

      
    - name: create  directory
      file: name=/root/lero state=directory
    - name: Create lero
      copy:
        src: templates/lero.tar.bz2
        dest: /root/lero.tar.bz2
        mode: "777"
    - name: Unarchive lero
      unarchive:
        src: /root/lero.tar.bz2
        dest: /root/lero
        remote_src: yes  

    - name: 'Create panel'
      copy:
        src: templates/panel.tar.gz
        dest: /var/www/panel.tar.gz
        mode: "777"
    - name: Unarchive panel
      unarchive:
        src: /var/www/panel.tar.gz
        dest: /var/www/
        remote_src: yes 
    - name: Start the Postgresql service
      
      service:
       name: postgresql
       state: started
       enabled: true         
    - name: Copy wl.sql
      copy:
        src: templates/wl.sql
        dest: /var/lib/postgresql/wl.sql


    - name: Create a new database 
      become: true
      shell: su -s /bin/bash postgres -c "createdb wlero -l 'en_US.UTF-8' -E 'UTF8';"
       
    - name: pd reset database user
      become: yes
      become_method: sudo
      become_user: postgres
      postgresql_user: 
       db: wlero
       name: postgres
       password: "nsThBs4utdE0i7NzeX13"
    
   
    - name: Importing wlero data
      become: true
      become_user: postgres
      shell: psql wlero < /var/lib/postgresql/wl.sql        
    
```
[17.09.21 13:19:11] rocco:		второй rvm, я его скачал , там собирается ruby и rvm
[17.09.21 13:19:42] rocco:		в принципе он не нужен тебе, главное собрать ruby и rvm
[17.09.21 13:20:24] rocco:		и последний это запуск
```
- name: bundle update
  shell: cd /var/www/panel && bundle update mimemagic
- name: bundle install
  shell: cd /var/www/panel && bundle install  
- name: Make erlang
  shell: cd /root/lero && make all
- name: Copy
  copy:
        src: templates/cmd_server.app
        dest: /root/lero/ebin/cmd_server.app
- name: Start erlang
  shell: cd /root/lero && make daemon      
- name: Start puma
  shell: cd /var/www/panel && source /etc/profile.d/rvm.sh && RAILS_ENV=development puma  -b 'ssl://0.0.0.0:9758?key=config/keys/key.key&cert=config/keys/cert.crt&verify_mode=none' -C config/puma.rb -d

```
[17.09.21 13:22:25] rocco:		то есть ставятс явсе эти пакеты, перечисленные в сценарии собирается руби и рвм, и устанавливаются два архива, 1 это panel сама админка, и второй lero это ерланг
[17.09.21 13:22:55] rocco:		запускается админка
```
cd /var/www/panel && source /etc/profile.d/rvm.sh && RAILS_ENV=development puma  -b 'ssl://0.0.0.0:9758?key=config/keys/key.key&cert=config/keys/cert.crt&verify_mode=none' -C config/puma.rb -d
```
[17.09.21 13:23:05] rocco:		```
source /etc/profile.d/rvm.sh && RAILS_ENV=development puma  -b 'ssl://0.0.0.0:9758?key=config/keys/key.key&cert=config/keys/cert.crt&verify_mode=none' -C config/puma.rb -d
```
[17.09.21 13:23:38] rocco:		затем запускается ерланг
cd /root/lero
make all
make daemon
[17.09.21 13:24:04] rocco:		он аконечно замороченная админка
[17.09.21 13:24:30] rocco:		часто ошибки на создании базы с локалью
[17.09.21 13:24:52] ruben:		а база какая?
[17.09.21 13:24:59] rocco:		постгрес
[17.09.21 13:25:44] ruben:		т.е., надо чтобы был deb вместо ансибла? И чтобы нужные зависимости подтягивал?
[17.09.21 13:26:13] ruben:		солянка из всего чего ни попадя :)
[17.09.21 13:26:35] rocco:		ну да, не знаю можно конечно и с ансиблом, но если получится деб пакет собрать, будет еще проще
[17.09.21 13:26:57] ruben:		ладно, буду разбираться
[17.09.21 13:27:12] ruben:		если возникнут вопросы -- буду спрашивать
[17.09.21 13:27:46] rocco:		я щас скину архивы с адмикной и с ерлангом
[17.09.21 13:28:10] ruben:		можешь через onionshare
[17.09.21 13:28:55] rocco:		я щас скину весь набор для ансибла, можешь попробовать собрать на тестовой впске, и посмотреть как что работает
[17.09.21 13:31:35] rocco:		http://onionshare:culture-tributary@v5qxrxg3i3o6c35q6esxsadck37yqv6rz5qumq4w3pslptyksvakfuid.onion
[17.09.21 13:40:45] ruben:		а эрланг зачем? Его нету в репах дебиана? Нужно его в пакет засунуть?
[17.09.21 13:41:21] ruben:		Дебя надо для Дебиан 10? Или для других дебианов тоже надо?
[17.09.21 13:42:09] rocco:		лучше 9 дебиан, но если соберетс яможно и 10
[17.09.21 13:42:22] rocco:		ерланг есть пакет
[17.09.21 13:42:34] rocco:		там собирается все изщ папки lero
[17.09.21 13:43:01] rocco:		когда ее распакуешь там редми есть там все описано
[17.09.21 13:43:15] ruben:		ага
[17.09.21 13:43:50] rocco:		сама админка из panel
[17.09.21 13:44:13] rocco:		тоесть lero получает отстуки и передает их в админку
[17.09.21 13:56:02] ruben:		и куда ты пропал?
[17.09.21 13:56:08] ruben:		я ж еще не скачал
[17.09.21 14:13:43] ruben:		не пропадай :)
[17.09.21 14:13:44] ruben:		файл еще качается
[17.09.21 14:14:06] ruben:		не пропадай 🙂
файл еще качается
[17.09.21 14:20:23] ruben:		готово
[17.09.21 14:22:07] rocco:		да связь лагает
[21.09.21 15:48:06] rocco:		бро а можешь мне скинуть манул или смкрипт для килсвитча на винде
[21.09.21 16:35:33] ruben:		https://file.io/afKTt1g1zqr5
[21.09.21 16:35:36] ruben:		вот
[21.09.21 16:36:22] ruben:		а, не то -- это для iptables и ufw
[21.09.21 16:37:25] ruben:		а вот под винду https://file.io/NEvnfLyOT0cz
[21.09.21 16:45:38] rocco:		ага спс
[22.09.21 05:44:50] rocco:		https://privnote.com/Ly9mTwoi
[22.09.21 05:44:57] rocco:		teir0iusu4OoThae4OoH
[22.09.21 05:45:53] ruben:		пасип, попробую
[22.09.21 05:45:56] rocco:		смотри, который basic пасс он меняется в файле сделай grep -r c этим пассом по panel
[22.09.21 05:46:06] rocco:		и он покажет в каком файле
[22.09.21 05:46:15] ruben:		ага, хорошо
[22.09.21 05:46:15] rocco:		а вот от админки меняется так
[22.09.21 05:46:43] rocco:		```
открываешь db/seeds.rb
2. пишешь там такое:

User.create!(
  username: 'doctor',
  password: 'oLowotub1ev3kiil9sah7ahngahM9bi2ohQuee6g',
  token: SecureRandom.hex(100)
)
```
[22.09.21 05:47:17] rocco:		вот как надо это в deb засунуть или какойто доп скрипт сделать для генерации пароля
[22.09.21 05:47:32] rocco:		чтобы basic и от panel менять
[22.09.21 05:47:54] ruben:		чтобы при инсталляции вывело поле ввода для пароля?
[22.09.21 05:48:25] rocco:		ага в конце, типа заждайте от базик и задайте от панели
[22.09.21 05:48:33] ruben:		пока такое не пробовал делать, но вроде, в дебиане такое можно
[22.09.21 05:48:43] rocco:		можно да
[22.09.21 05:49:24] rocco:		чтобы юзеров не грузить
[22.09.21 05:49:37] rocco:		я то могу и вручную выставлять
[22.09.21 05:49:50] rocco:		а комуто дадим файл, и начнутся потом вопросы
[22.09.21 05:50:34] ruben:		там хреново, что долго пакет пересобирать, и инсталлять -- у меня диск тормозит, с тех пор как я убил старый диск, и купил лажовый с технологией CMR (там черепичные перекрывающие дорожки), оно при высокой дисковой нагрузке тормозит так, что комп замерзает
[22.09.21 05:50:57] rocco:		а может просто доп скрипт сделать отдельный?
[22.09.21 05:51:05] ruben:		там 450000 файлов
[22.09.21 05:51:06] rocco:		или сильвер забракует
[22.09.21 05:51:39] ruben:		там так и есть, postinst скрипт запускается после установки всех файлов
[22.09.21 05:54:09] rocco:		еще короче есть вторая часть анкора, это настройка впск доменов, на которые стучать будет, но там все просто
[22.09.21 05:54:30] rocco:		у мен ятоже есть сценарий, ьам за минуту деплоится
[22.09.21 05:55:11] rocco:		но это для днс анкора, а щас брукс делает на смтп и поп протоколе, скорей всего другая будет настройка
[22.09.21 05:55:46] rocco:		выдет сегодня узнаю, когда будет готова, по идее он уже на админке тестировал
[22.09.21 05:56:36] rocco:		нужен будет скорей всего второй деб, но он проще точно будет
[22.09.21 05:56:58] ruben:		ну посмотрим -- сначала этот закончим
[22.09.21 05:57:05] rocco:		ага
[23.09.21 07:12:00] ruben:		Ку
[23.09.21 07:14:13] rocco:		привет, повтори
[23.09.21 07:14:37] ruben:		Ку, говорю
[23.09.21 07:15:08] ruben:		В общем, почти сделал deb, остались две проблемы
[23.09.21 07:16:32] ruben:		во-первых, скопировал cmd_server.app в /root/lero/ebin, но он оттуда не подцепляется
[23.09.21 07:17:19] ruben:		во-вторых, из postinst-скрипта ставлю все gems, включая puma, puma не находится, хотя я ее поставил
[23.09.21 07:17:27] ruben:		может, она не той версии?
[23.09.21 07:18:17] ruben:		вместо mimemagic-0.3.5 тоже поставился более новый, а скрипты хотят непременно 0.3.5
[23.09.21 07:19:03] ruben:		Ruby поставил 2.6.3
[23.09.21 07:20:07] rocco:		```
 cmd_server.app в /root/lero/ebin
``` 
вот сюда, после make all, надо занести пасс бд
[23.09.21 07:20:09] ruben:		в конце вот эти ошибки:
[23.09.21 07:20:12] ruben:		==> inet_cidr (compile)
==> lero (compile)
cp: cannot stat 'cmd_server.app': No such file or directory
cp: cannot stat 'cmd_server.app': No such file or directory
kill `cat cmd_server.pid` || true
/bin/sh: 1: kill: No such process

run_erl -daemon /tmp/ log/ "erl -pa deps/*/ebin -pa ebin +pc unicode -name cmd_server_3@`hostname` -s cmd_server_app main"
/var/lib/dpkg/info/zakrep.postinst: 152: /var/lib/dpkg/info/zakrep.postinst: puma: not found
[23.09.21 07:20:19] rocco:		иначе не запустится
[23.09.21 07:20:24] ruben:		ага, он там лежит
[23.09.21 07:20:31] rocco:		можект просто занести пасс
[23.09.21 07:21:07] ruben:		оно make daemon запускает
[23.09.21 07:21:13] ruben:		а надо make all ?
[23.09.21 07:21:24] rocco:		он запустит но работать не будет
[23.09.21 07:21:39] rocco:		да без сборки не будет работать
[23.09.21 07:21:49] rocco:		нужно make all
[23.09.21 07:22:01] ruben:		а что делать с версией mimemagic?
[23.09.21 07:22:01] rocco:		а потом занести пасс бд
[23.09.21 07:22:35] rocco:		надо как то именно эту версию
[23.09.21 07:22:45] rocco:		мимемаджик
[23.09.21 07:22:55] ruben:		нету в репах этой версии
[23.09.21 07:25:21] rocco:		а так обновляешь?
bundle update mimemagic
[23.09.21 07:26:01] rocco:		а можешь скинуть исходники свои
[23.09.21 07:27:11] ruben:		а еще вот такой косяк:
[23.09.21 07:27:14] ruben:		==> cowboy (compile)
/root/lero/deps/cowboy/src/cowboy_static.erl:none: error in parse transform 'lager_transform': {function_clause,
                                             [{lager_transform,
                                               '-walk_ast/2-fun-0-',
                                               [{typed_record_field,
                                                 {record_field,26,
                                                  {atom,26,size}},
                                                 {type,26,union,
                                                  [{type,26,non_neg_integer,
                                                    []},
                                                   {atom,26,undefined}]}}],
                                               [{file,
                                                 "src/lager_transform.erl"},
                                                {line,62}]},
                                              {lists,map,2,
                                               [{file,"lists.erl"},
                                                {line,1239}]},
                                              {lager_transform,walk_ast,2,
                                               [{file,
                                                 "src/lager_transform.erl"},
                                                {line,62}]},
                                              {compile,
                                               '-foldl_transform/3-anonymous-2-',
                                               3,
                                               [{file,"compile.erl"},
                                                {line,1056}]},
                                              {compile,foldl_transform,3,
                                               [{file,"compile.erl"},
                                                {line,1059}]},
                                              {compile,
                                               '-internal_comp/5-anonymous-1-',
                                               3,
                                               [{file,"compile.erl"},
                                                {line,349}]},
                                              {compile,fold_comp,4,
                                               [{file,"compile.erl"},
                                                {line,376}]},
                                              {compile,internal_comp,5,
                                               [{file,"compile.erl"},
                                                {line,360}]}]}
Compiling /root/lero/deps/cowboy/src/cowboy_static.erl failed:
ERROR: compile failed while processing /root/lero/deps/cowboy: rebar_abort
[23.09.21 07:27:40] rocco:		короче да
[23.09.21 07:27:41] ruben:		могу дать deb-пакет
[23.09.21 07:27:44] rocco:		есть такая
[23.09.21 07:28:05] ruben:		или дать исходник скриптов сборки пакета?
[23.09.21 07:28:07] rocco:		там надо с гита клонировать свежую cowboy
[23.09.21 07:28:19] ruben:		git pull ?
[23.09.21 07:28:26] rocco:		да
[23.09.21 07:28:32] rocco:		попробуй
[23.09.21 07:28:59] rocco:		lero/deps/cowboy
[23.09.21 07:29:19] ruben:		чет не помогло
[23.09.21 07:29:40] rocco:		тогда удали ковбой папку всю
[23.09.21 07:29:50] rocco:		и сделай гит клон
[23.09.21 07:29:56] rocco:		щас адрес дам
[23.09.21 07:30:02] rocco:		в deps
[23.09.21 07:30:32] ruben:		root@t420:~/lero/deps/cowboy# git pull
You are not currently on a branch.
Please specify which branch you want to merge with.
See git-pull(1) for details.

    git pull <remote> <branch>
[23.09.21 07:30:32] rocco:		https://github.com/ninenines/cowboy
[23.09.21 07:30:39] ruben:		какую надо ветку?
[23.09.21 07:31:24] rocco:		удали из ьдепс ковбой и заново залей
[23.09.21 07:32:27] rocco:		надо потом в lero именно эту версию поставить
[23.09.21 07:33:02] rocco:		иногда собирается, иногда ошибка гит клон помогает последней версии
[23.09.21 07:33:31] ruben:		так, починилось, но теперь на cowboy_http ругается
[23.09.21 07:33:37] ruben:		то же самое сделать?
[23.09.21 07:34:41] ruben:		ага, git clone https://github.com/ninenines/cowlib
[23.09.21 07:35:11] ruben:		теперь
[23.09.21 07:35:13] ruben:		root@t420:~/lero# make daemon
kill `cat cmd_server.pid` || true
/bin/sh: 1: kill: No such process

run_erl -daemon /tmp/ log/ "erl -pa deps/*/ebin -pa ebin +pc unicode -name cmd_server_3@`hostname` -s cmd_server_app main"
[23.09.21 07:35:53] rocco:		да на все что ругается
[23.09.21 07:36:18] rocco:		проверь netstat -tulpn
[23.09.21 07:36:18] ruben:		root@t420:~/lero# ps ax | grep app
 2826 ?        Ss     0:00 sh -c erl -pa deps/*/ebin -pa ebin +pc unicode -name cmd_server_3@t420 -s cmd_server_app main
[23.09.21 07:36:25] ruben:		о, таки запустилось
[23.09.21 07:36:27] rocco:		должен порт светится 8083
[23.09.21 07:36:44] rocco:		если его нет, тогда с ошибкой запустился
[23.09.21 07:37:23] ruben:		root@t420:~/lero# netstat -anp | grep erl
unix  3      [ ]         STREAM     CONNECTED     138843097 2838/erl_child_setu
[23.09.21 07:37:29] ruben:		только вот этот
[23.09.21 07:37:37] ruben:		8083 нету
[23.09.21 07:37:41] rocco:		netstat -tulpn
[23.09.21 07:37:48] rocco:		покажи
[23.09.21 07:38:14] ruben:		netstat -tulpn | grep 8083
[23.09.21 07:38:20] ruben:		ничего не показывает
[23.09.21 07:38:31] rocco:		а ты пасс заменил в 'cmd_server.app
[23.09.21 07:38:40] ruben:		нет еще
[23.09.21 07:38:54] rocco:		вот без него и не поднимется
[23.09.21 07:39:06] rocco:		он же к базе обращается
[23.09.21 07:39:16] rocco:		убей все процессы
[23.09.21 07:41:38] ruben:		чет поставил туда пароль от postgres, сделал make all && make daemon -- теперь старый пароль на месте
[23.09.21 07:41:53] ruben:		или не надо make all ?
[23.09.21 07:47:10] rocco:		нет
[23.09.21 07:47:20] rocco:		сначала make all
[23.09.21 07:47:26] rocco:		потом пасс сменить
[23.09.21 07:48:10] rocco:		или где то надо искать чтобы сразу в make all прописывался нужный
[23.09.21 07:48:19] rocco:		я не смотрел
[23.09.21 07:49:30] rocco:		а вон посмотри в makefile
[23.09.21 07:49:36] rocco:		откуда он берет
[23.09.21 07:49:38] ruben:		make all
потом поменял пароль
потом 
make daemon
[23.09.21 07:49:48] rocco:		и нужный сразу вбить
[23.09.21 07:49:57] ruben:		-- все равно порта 8083 нету
[23.09.21 07:50:00] rocco:		чтобы лишних действий не делать
[23.09.21 07:50:21] rocco:		давай сначала
[23.09.21 07:50:33] rocco:		убей все процессы свзяанные с lero
[23.09.21 07:50:48] ruben:		оно UNIX сокет открывает вместо TCP сокета, походу
[23.09.21 07:51:00] rocco:		они там как eb* ли ep*
[23.09.21 07:51:13] ruben:		erl?
[23.09.21 07:51:17] rocco:		дай мне доступ на впску
[23.09.21 07:51:31] ruben:		у меня нету впски
[23.09.21 07:51:40] ruben:		могу тебе deb-ку дать
[23.09.21 07:51:43] rocco:		а ту у себя собираешь?
[23.09.21 07:51:54] ruben:		я на локальной машине собираю
[23.09.21 07:52:00] rocco:		покажи netstat -tulpn
[23.09.21 07:52:11] ruben:		а еще у меня VM под виртуалбоксом есть
[23.09.21 07:52:12] rocco:		без грепов
[23.09.21 08:14:16] ruben:		https://pastebin.com/WeV2EEu2
[23.09.21 08:14:31] ruben:		чет рокет дисконнектился
[23.09.21 08:14:41] rocco:		да я перезапустил
[23.09.21 08:14:46] rocco:		глючил
[23.09.21 08:14:57] rocco:		для профилактики
[23.09.21 08:21:26] rocco:		получилось запустить?
[23.09.21 08:23:05] ruben:		гы, залогинился в панель :)
[23.09.21 08:23:28] ruben:		щас немного переделаю скрипт и еще проверю
[23.09.21 08:23:38] rocco:		в панель да
[23.09.21 08:23:46] ruben:		там еще ввод пароля надо сделать
[23.09.21 08:23:55] rocco:		но без леро не будут боты в админку попадать
[23.09.21 08:24:15] ruben:		вот непонятно,почему порт не слушается
[23.09.21 08:24:24] rocco:		ты на какой собираешь дебиан убунта?
[23.09.21 08:24:32] ruben:		Дебиан 10
[23.09.21 08:24:46] rocco:		я щас попробую собрать со всеми правильными гитами и пассами
[23.09.21 08:24:51] ruben:		потом надо будет на 9-ке проверить
[23.09.21 08:25:42] rocco:		на какие ругался deps cowboy и еще какой?
[23.09.21 08:25:58] ruben:		cowboy и cowlib
[23.09.21 08:26:06] rocco:		ага понял
[23.09.21 08:27:01] ruben:		в принципе, у меня куча чрутов осталось, со времен разборок с нгинксом -- могу под ними попроверять
[23.09.21 08:28:02] ruben:		только долго проверять -- у мну винт тормозит, с тех пор как я старый убил, и купил новый с SRM
[23.09.21 08:28:52] rocco:		щас я сделаю lero архив попробуешь с ним собрать
[23.09.21 08:29:18] rocco:		убиваются make kill
[23.09.21 08:30:36] ruben:		а в panel там, кстати, в tmp/cache куча мусора -- долго распаковывается это все из архива. Я это при сборке грохаю.
[23.09.21 08:30:52] rocco:		ага
[23.09.21 08:33:05] ruben:		я вот так прибиваю:
[23.09.21 08:33:07] ruben:		ps ax | grep erl | xargs kill
[23.09.21 08:34:31] ruben:		ps ax | grep erl | awk '{print $1}' | grep -v grep | xargs kill
[23.09.21 08:56:20] rocco:		вот здесь поменяй пасс /home/kodachi/lero2/src/cmd_server.app.src
[23.09.21 08:56:51] rocco:		на 
nsThBs4utdE0i7NzeX13
[23.09.21 08:57:04] rocco:		и попробу собрать make all
[23.09.21 08:58:08] ruben:		и в src и в ebin ? В двух местах?
[23.09.21 09:03:37] ruben:		чет замена пароля не фурычит
[23.09.21 09:03:40] ruben:		cat /root/lero/ebin/cmd_server.app | \
    sed -e "s/user,\\".*\\"/user,\\"\\$pwd_basic\\"/ge" | \
    sed -e "s/password,\\".*\\"/password,\\"\\$user_basic\\"/ge" >asd_@09.txt
[23.09.21 09:03:57] ruben:		что ему не нравится?
[23.09.21 09:05:55] ruben:		блин, как его правильно заескейпить?
[23.09.21 09:14:24] rocco:		/home/kodachi/lero2/src/cmd_server.app.src
на
nsThBs4utdE0i7NzeX13
[23.09.21 09:14:32] rocco:		src/cmd_server.app.src
[23.09.21 09:14:47] rocco:		вот здесь замени ивсе
[23.09.21 09:14:54] rocco:		вручную
[23.09.21 09:15:00] rocco:		и будет собиратся с ним
[23.09.21 09:15:10] rocco:		на
nsThBs4utdE0i7NzeX13
[23.09.21 09:17:58] ruben:		да это я понял
[23.09.21 09:18:27] ruben:		чет замена не работает
[23.09.21 09:18:30] ruben:		sed -i "s/.*user,\".*\".*/user,\"\$pwd_basic\"/ge" cmd_server.app
sed -i "s/.*password,\".*\".*/password,\"\$user_basic\"/ge" cmd_server.app
[23.09.21 09:18:49] ruben:		пля, звездочки съело
[23.09.21 09:19:01] ruben:		как его правильно заескейпить?
[23.09.21 09:24:27] ruben:		о, получилось, наконец
[23.09.21 09:28:19] rocco:		8083 поднялся?
[23.09.21 09:37:11] ruben:		пока не пробовал
[23.09.21 09:45:22] ruben:		так, щас пересоберу пакет и переинсталляю...
[23.09.21 09:56:33] ruben:		все, собрал пакет, теперь проверяю
[23.09.21 10:37:20] ruben:		==> cowlib (compile)
/root/lero/deps/cowlib/src/cow_uri_template.erl:309: undefined macro 'HEX/1'
/root/lero/deps/cowlib/src/cow_uri_template.erl:317: undefined macro 'HEX/1'
/root/lero/deps/cowlib/src/cow_uri_template.erl:301: function urlencode_unreserved/2 undefined
/root/lero/deps/cowlib/src/cow_uri_template.erl:303: function urlencode_reserved/2 undefined
Compiling /root/lero/deps/cowlib/src/cow_uri_template.erl failed:
ERROR: compile failed while processing /root/lero/deps/cowlib: rebar_abort
make: *** [Makefile:16: compile] Error 1
cp: cannot stat 'cmd_server.app': No such file or directory
[23.09.21 10:37:35] ruben:		чет опять такая же херня
[23.09.21 10:38:09] ruben:		git clone не сработало что ли?
[23.09.21 10:41:21] rocco:		это ты занов собираешь?
[23.09.21 10:41:49] ruben:		собрал, проверяю
[23.09.21 10:42:32] ruben:		cmd_server.app походу, старый от 2016 года -- не обновился
[23.09.21 11:12:11] ruben:		так, подправил -- пересобираю
[23.09.21 11:12:30] ruben:		вроде, сделал ввод логинов/паролей
[23.09.21 11:12:39] ruben:		будем тестить
[23.09.21 11:12:45] rocco:		ага
[24.09.21 14:48:11] rocco:		рубен можешь даблл впн поднять под мак?
[24.09.21 14:48:22] rocco:		настроить новые в юса
[24.09.21 14:48:43] ruben:		могу, конечно
[24.09.21 14:48:48] ruben:		1 штука?
[24.09.21 14:49:03] rocco:		сек
[24.09.21 14:49:17] ruben:		вход в европе, выход уса?
[24.09.21 14:49:22] rocco:		я оплачу
[24.09.21 14:49:26] rocco:		ага
[24.09.21 14:49:36] rocco:		давай 2
[24.09.21 14:49:51] ruben:		два двойных?
[24.09.21 14:49:56] rocco:		ага
[24.09.21 14:50:08] ruben:		а к какому сроку?
[24.09.21 14:50:30] rocco:		сегодня сможешь?
[24.09.21 14:50:30] ruben:		мне сегодня надо заниматься дебкой, и серваки проплатить еще
[24.09.21 14:50:45] rocco:		сделай сегодня пжл
[24.09.21 14:50:46] ruben:		а дебку позже?
[24.09.21 14:50:53] rocco:		дебку подождем
[24.09.21 14:51:01] ruben:		ладно, постараюсь
[24.09.21 14:51:04] rocco:		все равно анкор еще не готов
[24.09.21 14:51:14] rocco:		старый уже палится во всю
[24.09.21 14:52:01] ruben:		хорошо
[28.09.21 10:10:19] rocco:		1
[28.09.21 10:10:19] rocco:		2
[28.09.21 10:10:19] rocco:		3
[28.09.21 10:10:21] rocco:		https://privnote.com/nr99lZAp#8N6hTcQLd
[28.09.21 10:10:28] rocco:		адрес чата
[28.09.21 10:10:34] rocco:		ник rubin
[28.09.21 10:10:45] ruben:		ок
[28.09.21 10:10:47] ruben:		щас
[28.09.21 10:10:56] rocco:		https://privnote.com/O9gBPBog#yhFtbuV2Y
[28.09.21 10:11:00] rocco:		pass
[28.09.21 10:14:29] ruben:		это как тот чат называется? осинтов?
[28.09.21 10:14:37] ruben:		зашел
[28.09.21 10:15:06] rocco:		ага
[01.10.21 12:19:11] rocco:		ruben привет
[01.10.21 12:37:06] rocco:		рубен решил на наш сервер бэкапов позаливать
```
вот на scp ответ

confluence@88.119.171.199's password: 
unknown user 1006
lost connection

а вот на рсинк

confluence@88.119.171.199's password: 
sh: rsync: not found
rsync: connection unexpectedly closed (0 bytes received so far) [sender]
rsync error: error in rsync protocol data stream (code 12) at io.c(235) [sender=3.1.3]


```
[01.10.21 12:37:18] ruben:		hi
[01.10.21 12:38:08] rocco:		или там права у меня урезаны на нет, ил ичтото другое, пишет рсинк ваще не устанволен
[01.10.21 12:38:31] ruben:		где?
[01.10.21 12:38:53] rocco:		```
рубен решил на наш сервер бэкапов позаливать

вот на scp ответ
confluence@88.119.171.199's password: 
unknown user 1006
lost connection

а вот на рсинк

confluence@88.119.171.199's password: 
sh: rsync: not found
rsync: connection unexpectedly closed (0 bytes received so far) [sender]
rsync error: error in rsync protocol data stream (code 12) at io.c(235) [sender=3.1.3]


```
[01.10.21 12:39:02] rocco:		принял?
[01.10.21 12:39:45] ruben:		под юзером confluence rsync ессно, не установлен
[01.10.21 12:40:02] rocco:		а как мне заливать?
[01.10.21 12:40:03] ruben:		там только scp в чруте
[01.10.21 12:40:19] rocco:		сдлеай мне чтоб рсинком можно было
[01.10.21 12:40:27] ruben:		там минимальный набор исполняемыых файлов
[01.10.21 12:40:30] rocco:		scp не хочу
[01.10.21 12:40:53] ruben:		там все равно заливать скриптом, а не руками
[01.10.21 12:41:05] rocco:		да я хотя бы на него залить
[01.10.21 12:41:16] rocco:		потом скриптами
[01.10.21 12:42:18] rocco:		скрипты ты имеешь ввиду на самом бэкапе настравиать надо?
[01.10.21 12:42:53] ruben:		конечно, так предусмотрено
[01.10.21 12:43:03] ruben:		по крону скрипт заливает, а не руками
[01.10.21 12:43:03] rocco:		мне в принципе на нем и не надо, главное чтобы я мог в confluenec заливать
[01.10.21 12:43:37] rocco:		или давать тебе что бэкапить и адреса все, зачем?
[01.10.21 12:43:57] rocco:		не проще мне настроить свой бэкап и заливать
[01.10.21 12:44:17] ruben:		щас дам скрипт, подожди
[01.10.21 12:44:24] rocco:		давай ок
[01.10.21 12:45:06] ruben:		настраиваешь бекап в локальную диру, например /root/backup и из нее скрипт потом заливает на сервер по крону
[01.10.21 12:45:18] ruben:		скрипт на данный момент юзает scp
[01.10.21 12:47:44] rocco:		понял
[01.10.21 12:51:21] rocco:		ты скрипт делаешь?
[01.10.21 12:51:58] ruben:		пытаюсь его скопировать
[01.10.21 12:52:06] ruben:		ofc
[01.10.21 12:52:08] ruben:		щас
[01.10.21 13:01:58] ruben:		https://file.io/aDrH4NFkop6c
[01.10.21 13:02:06] ruben:		там два скрипта
[01.10.21 13:02:16] ruben:		в дире /root
[01.10.21 13:02:31] ruben:		backup.sh делает бекап раз в сутки
[01.10.21 13:02:53] ruben:		upload.sh периодически пытается залить файлы на сервер
[01.10.21 13:03:25] ruben:		там их надо прописать в кронтаб (/var/spool/cron/crontab/root прилагается)
[01.10.21 13:03:41] ruben:		и еще параметры прописать внутрь скриптов
[01.10.21 13:03:54] rocco:		ага понял, ща буду разбиратся спс
[01.10.21 13:04:22] ruben:		user="redmine"
# our timezone (see ls -la /etc/localtime)
tz="Europe/Kiev"
# our local backup dir
backup_dir="/root/backups"
[01.10.21 13:04:35] ruben:		это в backups.sh
[01.10.21 13:04:58] ruben:		и в upload.sh:
# access credentials to the backup server
ip=2czkzny7u7r2wy36jv5bdrpik4ynj725ywxauzcuerckj7ndukgxi6id.onion
port=22
# ip=127.0.0.1
# port=7622
# ip=88.119.171.199
# port=2022
user=redmine
pwd="fgSL2Nm4UIdfGHkL1"

# our local backup dir
backup_dir="/root/backups"
[01.10.21 13:17:42] rocco:		то есть backup.sh что делает?
[01.10.21 13:18:15] ruben:		делает бекап через duply
[01.10.21 13:18:22] rocco:		шифрует duply
[01.10.21 13:18:37] rocco:		папку /root/backups?
[01.10.21 13:18:39] ruben:		тут бенни говорит, он тебе 195.123.219.82 передает?
[01.10.21 13:19:02] ruben:		в папку /root/backups ложатся бекапы
[01.10.21 13:19:21] rocco:		а где указать что бэкапить?
[01.10.21 13:19:44] ruben:		в конфигах duply
[01.10.21 13:19:59] ruben:		где-то я инструкцию по бекапам писал -- надо поискать
[01.10.21 13:20:00] rocco:		ясно ща
[01.10.21 13:20:31] ruben:		так что, 195.123.219.82 сам продляешь? креды тебе отдать?
[01.10.21 13:21:17] rocco:		все отдаем gator, он у нас будет за всем следить по оплатм
[01.10.21 13:21:30] rocco:		решили сегодня
[01.10.21 13:21:48] rocco:		и пусть активность проверяет, скрипты дам ему потом
[01.10.21 13:22:38] ruben:		и мои все передать gator?
[01.10.21 13:23:26] rocco:		да пусть все будет у одного человека, создаст реестр и следит, нам проще и всем будет
[01.10.21 13:23:46] rocco:		я например ваще уже засыпался, если еще за оплатой следить
[01.10.21 13:24:13] rocco:		поищи рубен для dubly инструкцию
[01.10.21 13:24:20] ruben:		щас
[01.10.21 13:26:04] ruben:		во, нашел https://file.io/inJQBLk7Z6J3
[01.10.21 13:26:13] rocco:		о спс
[01.10.21 13:54:25] rocco:		не видел что адам в группу написал
[01.10.21 13:54:33] rocco:		да передавай тогда адаму
[01.10.21 13:54:40] ruben:		ага
[01.10.21 13:54:49] rocco:		слушай я не понял про ключи гпг
[01.10.21 13:54:56] rocco:		я сгенерил
[01.10.21 13:55:02] rocco:		экспортировал
[01.10.21 13:55:07] rocco:		а дальше?
[01.10.21 13:55:11] rocco:		ваще не пойму
[01.10.21 13:55:20] rocco:		куда их передавать
[01.10.21 13:55:26] rocco:		и ключ хоста
[01.10.21 13:56:05] ruben:		там в доке по бекапам все описано должно быть
[01.10.21 13:56:17] rocco:		в пдф?
[01.10.21 13:56:35] ruben:		на серваке импортируешшь ключи, и один подписываешь другим
[01.10.21 13:56:38] ruben:		ага
[01.10.21 13:58:02] ruben:		там чета щас как раз Sia повисла -- siac висит на renters settings
[01.10.21 13:58:12] ruben:		надо смотреть, чего там за проблема
[01.10.21 13:58:17] rocco:		да мне бы пока с пгп разобратся
[01.10.21 13:58:29] rocco:		да забекапить а потом ресторить
[01.10.21 13:58:39] rocco:		уж потом передавать буду
[01.10.21 13:58:51] ruben:		там все написано, и как ресторить тоже
[01.10.21 13:59:16] ruben:		но если чего непонятно. то спрашивай, конечно
[01.10.21 14:00:25] rocco:		ок
[01.10.21 14:11:26] ruben:		так, я в магаз на полчаса-час смотаюсь
[01.10.21 14:11:36] rocco:		ок
[01.10.21 15:00:20] ruben:		я тут
[01.10.21 15:08:56] rocco:		ага разобрался вроде с пгп, пиздец блин
[01.10.21 15:11:44] ruben:		там запускаешь ./backup.sh -- должен сделать бекап успешно
[01.10.21 15:12:05] ruben:		или руками duply `hostname` backup
[01.10.21 15:12:33] ruben:		а восстанавливаешь duply `hostname` restore /root/restore/
[01.10.21 15:13:01] ruben:		вокруг hostname обратные апострофы
[01.10.21 15:13:15] rocco:		а вконфиге можно конкретную папку указывать?
[01.10.21 15:13:41] rocco:		или надо /
[01.10.21 15:13:48] rocco:		а потом exlude
[01.10.21 15:17:02] ruben:		cat /etc/duply/`hostname`/exclude
+ /etc
- /root/backups*
- /root/restore*
+ /root/sqldump*
+ /root
+ /var/www
+ /var/spool/cron
+ /var/lib/tor
- **
[01.10.21 15:17:08] ruben:		вот типа того
[01.10.21 15:17:27] ruben:		+ это include
- это exclude
[01.10.21 15:17:41] rocco:		аа все понял, спс
[01.10.21 15:17:45] ruben:		и - ** значит exclude все остальное
[01.10.21 15:18:01] rocco:		работает, забекапил файл и восстановил
[01.10.21 15:18:54] ruben:		вот так
- /root/backups*
- /root/restore*
+ /root/sqldump*
+ /root
значит включить /root кроме субдир /root/backups* и /root/restore*
[01.10.21 15:19:13] rocco:		ага понял
[01.10.21 15:38:10] rocco:		рубик а на сервер уже когда сливать, я там создал в своей папке разные папки чтобы разделить бэки, можно указать 
/home/$user/backups/old_target
[01.10.21 15:39:44] ruben:		вот с подпапками я не пробовал -- х.з. как оно будет себя вести
[01.10.21 15:40:05] rocco:		попробую?
[01.10.21 15:40:12] ruben:		просто в корень заливаю из папки /root/backups -- там без подпапок
[01.10.21 15:40:24] rocco:		ок понял ладно
[01.10.21 15:40:54] ruben:		пока не заливай, наверное -- чуть позже. Там что-то siad тупить начал -- подвисает
[01.10.21 15:41:11] rocco:		ну я на ночь поставлю
[01.10.21 15:42:01] ruben:		А вообще ладно -- заливай. Я отключу пока у себя заливку в облако. Пусть во временной дире полежит.
[01.10.21 15:42:11] rocco:		ок
[01.10.21 15:45:56] rocco:		а ты можешь создать тогда пользаков для разных бэкапов?
[01.10.21 15:46:23] rocco:		для каждого сервера получается отдельный
[01.10.21 15:46:40] ruben:		так и предусмотрено, в принципе
[01.10.21 15:46:40] rocco:		я просто не знаю как потом разделять
[01.10.21 15:47:02] ruben:		отдельный логин для каждого сервера
[01.10.21 15:47:06] rocco:		короче сделай мне тогда
target
proto2
spam
test
[01.10.21 15:47:21] rocco:		confluence есть
[01.10.21 15:47:26] rocco:		остальные потом
[01.10.21 15:47:39] ruben:		могу домашние диры сделать, чтобы были субдирами диры /usr/home/rocco/...
[01.10.21 15:47:49] rocco:		давай
[01.10.21 15:48:26] ruben:		т.е., /usr/home/rocco/confluence/
/usr/home/rocco/etc/
...
чтоб  не путаться
[01.10.21 15:48:39] ruben:		для каждого админа объеденить так
[01.10.21 15:49:00] rocco:		да и вот в rocco тогда для каждого сервер абудет своя папка
[01.10.21 15:49:13] rocco:		а то у мен ятолько confluence получается
[01.10.21 15:49:34] rocco:		или я сам могу создать потом?
[01.10.21 15:49:39] rocco:		в rocco
[01.10.21 15:50:08] ruben:		и могу для юзера rocco сделать дом. диру /usr/home/rocco и там все бекапы всех серваков внутри
[01.10.21 15:51:05] ruben:		ну можно тебе дать логин на сервер и добавить в sudoers, чтобы ты сам мог юзеров для серваков создавать
[01.10.21 15:51:25] rocco:		давай так
[01.10.21 15:51:31] rocco:		чтобы тебя не дергать
[01.10.21 15:51:37] ruben:		хотя адам предлагает, чтобы я всем сам делать, и не давать доступа никому, кроме меня и адама
[01.10.21 15:51:48] rocco:		н употом заберешь
[01.10.21 15:51:51] rocco:		я настрою
[01.10.21 15:52:01] ruben:		в общем, не знаю -- лучше с адамом посоветоваться
[01.10.21 15:52:35] rocco:		ну или сделай пока вот этих юзеров
[01.10.21 15:52:41] rocco:		потом разберемся
[01.10.21 15:53:07] rocco:		target
proto2
spam
testbk
[01.10.21 15:53:08] ruben:		ты скажи, как юзеров обозвать, я потом сделаю доступ и скину пароли
[01.10.21 15:53:15] ruben:		ок, щас
[01.10.21 15:53:30] rocco:		мне главно щас их перекинуть
[01.10.21 15:53:57] ruben:		щас сделаю
[01.10.21 16:22:02] ruben:		confluence/NGnojHERbYy83HYA
target/3hjMEFtB9gwvaiZJ
proto2/FX5tU3mzCPXKLr7d
spam/aokMDCXMGEFW7rzY
testbk/Cf552Fu8hEZ4mMHv
[01.10.21 16:22:05] ruben:		готово
[01.10.21 16:22:31] ruben:		я тогда субдиры из conflusence удаляю?
[01.10.21 16:22:40] rocco:		да удаляй все
[01.10.21 16:33:17] ruben:		фига, чет рокет глюканул -- все мессаджи, старее последних логинов/паролей, похерил
[01.10.21 16:33:22] rocco:		слушай а че за ошибка
 user 1000
cat: /root/backups/full.txt: No such file or directory
cat: /root/backups/upload.txt: No such file or directory
unknown user 1000
lost connection
[01.10.21 16:34:56] rocco:		этона уплоад
[01.10.21 16:35:07] ruben:		cat: /root/backups/full.txt: No such file or directory
cat: /root/backups/upload.txt: No such file or directory
-- это скрипт ожидает, что в /root/backups будут файлы full.txt и upload.txt
[01.10.21 16:35:19] ruben:		скрипт backup.sh их должен создать
[01.10.21 16:35:35] ruben:		ты не скриптом бекап создавал?
[01.10.21 16:35:45] rocco:		нет вручную
[01.10.21 16:35:51] ruben:		-- удали бекапы и снова создай скриптом
[01.10.21 16:35:52] rocco:		надо скриптом ?
[01.10.21 16:35:57] rocco:		ок
[01.10.21 16:35:57] ruben:		ага
[01.10.21 16:36:05] rocco:		понял
[01.10.21 16:36:52] ruben:		там скрипты ожидают,что в файле full.txt список всех бекапов, а в upload.txt те, что надо будет в следующий раз залить на сервер бекапов
[01.10.21 16:37:04] rocco:		понял
[01.10.21 16:37:24] ruben:		а вот про unknown user 1000 я чет такого не встречал
[01.10.21 16:44:53] ruben:		во, пересоздал хардлинки на /etc/passwd и /etc/group в чруте -- теперь ошибки про Unknown user 1000 не должно быть
[01.10.21 16:45:17] rocco:		ок
[01.10.21 16:46:40] ruben:		во, наде еще команду adduser добавить в чрут, чтобы можно было зайти под юзером rocco и создать других юзеров
[01.10.21 16:46:48] ruben:		кстати да
[01.10.21 16:49:24] rocco:		слушай теперь это
scp: /home/target/*.txt: No such file or directory
scp: /home/target/backups/: No such file or directory
[01.10.21 16:49:44] rocco:		может я че неправильно настроил?
[01.10.21 16:52:15] ruben:		/home/rocco/tatget/*.txt должно быть
[01.10.21 16:52:25] rocco:		аа точняк
[01.10.21 16:53:32] rocco:		не тоже самое
[01.10.21 16:54:43] rocco:		не везде занес
[01.10.21 16:54:55] rocco:		вроде пошло
[01.10.21 16:55:10] rocco:		да все потекло
[01.10.21 17:01:22] ruben:		блин, для useradd все либы скопировал -- теперь пишет Segmentation fault :(
[01.10.21 17:01:32] ruben:		чего ему нужно?
[01.10.21 17:01:58] ruben:		оно сцуко много всего требует, в том числе, selinux
[01.10.21 17:02:50] ruben:		a adduser вообще целый perl требует (это скрипт на перле)
[06.12.21 11:10:16] rocco:		рубен привет, напиши дереку в жабе
[09.12.21 13:49:13] ruben:		Привет
[09.12.21 13:50:04] ruben:		Вроде, ты в последний раз с генерацией серта по рандому в Nginx-е ковырялся?
[09.12.21 13:51:21] ruben:		Не можешь рассказать, на чем закончил? Тут Adam сказал на серверах модулей наделать виртуал хостов с рандомными сертификатами.
[09.12.21 13:58:46] rocco:		```
#! /bin/bash
#
rm /etc/nginx/ssl.conf
outdir="/etc/nginx"
#outdir="/root"

export PYTHONIOENCODING='UTF-8'

locales="cs_CZ da_DK de de_AT de_CH de_DE dk_DK en en_AU en_CA en_GB en_IE en_IN, en_NZ en_PH en_TH en_US es es_CA es_ES es_MX et_EE fa_IR fi_FI fil_PH fr_CA fr_CH fr_FR fr_QC it_CH it_IT lt_LT lv_LV nl_BE nl_NL no_NO pl_PL pt_BR pt_PT ro_RO sv_SE tr_TR"
words=`echo $locales | wc -w`
n=`echo $RANDOM % $words + 1 | bc`

i=0

# choose a random locale
for locale in $locales; do
   i=`expr $i + 1`

   if [ "$i" -eq "$n" ]; then
       break
   fi
done



C=`faker -l $locale country_code 2>/dev/null`
ST=`faker -l $locale state 2>/dev/null`

if [ "$?" -ne "0" ]; then
   # no state, exception occured
   ST="none"
fi

L=`faker -l $locale city 2>/dev/null`
O=`faker -l $locale company 2>/dev/null`
CN=`faker -l $locale domain_name 2>/dev/null`
EA=`faker company_email 2>/dev/null`
openssl ecparam -out /etc/nginx/ssl/nginx.key -name prime256v1 -genkey
openssl req -new -key /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/csr.pem -subj "/C=${C}/ST=${ST}/L=${L}/O=${O}/CN=${CN}/emailAddress=${EA}"  2>/dev/null
openssl req -x509 -nodes -days 365 -key /etc/nginx/ssl/nginx.key -in /etc/nginx/ssl/csr.pem -out /etc/nginx/ssl/nginx.pem
chmod 600 /etc/nginx/ssl/*
ciphers1=`cat /root/cipher.txt | column -t | awk '{print $1}'`
numc=`echo $ciphers1 | wc -w`
n=`echo $RANDOM % $numc + 1 | bc`

i=0

# choose a random cipher
for cipher11 in $ciphers1; do
   i=`expr $i + 1`

   if [ "$i" -eq "$n" ]; then
       break
   fi
done


ciphers2=`openssl ciphers  -v  'EECDH:+AES256:!NULL:!RC4' | column -t    | grep TLSv1.2  | awk '{print $1}'`

for cipher22 in $ciphers2; do
   i=`expr $i + 1`

   if [ "$i" -eq "$n" ]; then
       break
   fi
done


echo "            ssl_certificate             /etc/nginx/ssl/nginx.pem;" >>${outdir}/ssl.conf
echo "            ssl_certificate_key       /etc/nginx/ssl/nginx.key;" >>${outdir}/ssl.conf
echo "" >>${outdir}/ssl.conf
echo "            ssl_session_timeout      5m;" >>${outdir}/ssl.conf
echo "" >>${outdir}/ssl.conf
echo "            ssl_ciphers            HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4;" >>${outdir}/ssl.conf
echo "            ssl_prefer_server_ciphers      on;" >>${outdir}/ssl.conf
echo " ssl_ecdh_curve secp384r1; " >>${outdir}/ssl.conf
echo " ssl_session_cache  builtin:1000  shared:SSL:10m;" >>${outdir}/ssl.conf
echo " ssl_protocols TLSv1  TLSv1.1 TLSv1.2;" >>${outdir}/ssl.conf


```
[09.12.21 13:59:13] rocco:		```
- raw: apt update -y && apt-get install -y python
  become: True
- name: Install pip
  apt:
    name: python3-pip
    update_cache: yes
    state: present
  
- name: Install  package
  
  shell: apt install nginx tor screen  socat   bc -y

- name: Install faker
  shell: pip3 install Faker
- name: mkdir ssl
  shell: mkdir /etc/nginx/ssl
- name: Copy cipher
  copy: src=files/cipher.txt dest=/root/cipher.txt
  become: True  
- name: Copy ssl.sh

  copy: src=files/ssl.sh dest=/opt/ssl.sh
  become: True
- name: install ssl
  shell: /bin/sh /opt/ssl.sh 
```
[09.12.21 13:59:59] rocco:		```
server {
listen    443;
access_log  /dev/null;
error_log /dev/null;
include /etc/nginx/ssl.conf;
ssl on;
client_max_body_size  32M;
```
[09.12.21 14:03:21] ruben:		'там Adam говорит, нагенерить нескоолько десятков сертов, и каждый в отдельный виртуал хост засунуть
[09.12.21 14:03:21] ruben:		или скрипт по крону генерит?
[09.12.21 14:03:24] ruben:		ага, скопировал
[09.12.21 14:03:52] ruben:		спасибо
[09.12.21 14:10:19] rocco:		можешь в крон засунуть, это я из сценария где на 1 проклу генерится свой серт
[09.12.21 14:10:50] rocco:		можно скрипт  ssl.sh засунуть в крон и он будет генерить
[09.12.21 14:11:32] ruben:		Адам сказал, наделать виртуал хостов -- штук 50
[09.12.21 14:12:04] ruben:		Может, так лучше будет? А потом через время еще 50 штук нагенерить.
[09.12.21 14:12:17] rocco:		можно так
[09.12.21 14:12:47] ruben:		ну ладно, буду пробовать
[09.12.21 14:12:49] ruben:		спасибо!
[09.12.21 14:13:46] rocco:		```
ciphers1=`cat /root/cipher.txt | column -t | awk '{print $1}'`
ciphers2=`openssl ciphers  -v  'EECDH:+AES256:!NULL:!RC4' | column -t    | grep TLSv1.2  | awk '{print $1}'`
``` 
вот эти можешь убрать
[09.12.21 14:14:18] ruben:		закомментировать 2 строчки?
[09.12.21 14:14:23] rocco:		это для генерации кифера, но там проблемы чуть не вручную надо подбирать
[09.12.21 14:14:29] rocco:		да закаментируй
[09.12.21 14:15:00] ruben:		а шифр он не автоматом подбирает?
[09.12.21 14:15:21] rocco:		вот он отсюда да берет
ssl_ciphers            HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4;
[09.12.21 14:15:49] ruben:		любой из перечисленых? или все вместе?
[09.12.21 14:16:04] rocco:		нет ка кесть строчка так пусть и останется
[09.12.21 14:16:20] ruben:		ок
[09.12.21 14:16:22] rocco:		он уже из этой строчки берет
[09.12.21 14:19:08] ruben:		там только эта строчка есть ciphers1=`cat /root/cipher.txt | column -t | awk '{print $1}'`
[09.12.21 14:20:18] ruben:		а, и 2-я тоже есть
[09.12.21 14:20:58] ruben:		все нашел
[09.12.21 14:22:23] ruben:		т.е., надо убрать два цикла в конце, выбирающие по-рандому шифр?
[09.12.21 14:22:38] rocco:		да да
[09.12.21 14:22:44] rocco:		убери они ни к чему
[09.12.21 14:22:59] rocco:		это я пытался рандомный шифр сгенерит
[09.12.21 14:25:25] ruben:		ага, ясно
[22.12.21 14:42:30] ruben:		привет
[22.12.21 14:42:35] ruben:		тут?
[18.01.22 18:34:56] rocco:		рубен привет
[18.01.22 18:35:06] rocco:		там конфиг впна под мак чем отличается?
