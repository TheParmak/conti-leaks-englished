[28.09.21 06:43:54] gabr:		пинг
[28.09.21 08:29:20] alexander.r:		понг
[28.09.21 08:48:31] gabr:		привет
[28.09.21 08:51:43] alexander.r:		ку
[28.09.21 08:58:11] gabr:		Пока по аудио результат отрицательный
1) инжекты в процесс с повышеными прив не работают (через СОМ тоже) 
2) между аудио процессом и СОМ нет взаимодействия через LPC/ALPC/PIPE итд, то есть эксплуатация "сервера" в данном случае не возможна, плюс ALPC фильтруется по SID
3) грузить в свой процесс АРО нет смылс так как у нас прив пользователя
Вот в частности все RPC сервера на тестовой машине
[+] Exe starting RPC Server: C:\Windows\System32\AppVShNotify.exe
[+] Exe starting RPC Server: C:\Windows\System32\BioIso.exe
[+] Exe starting RPC Server: C:\Windows\System32\ByteCodeGenerator.exe
[+] Exe starting RPC Server: C:\Windows\System32\FsIso.exe
[+] Exe starting RPC Server: C:\Windows\System32\FXSSVC.exe
[+] Exe starting RPC Server: C:\Windows\System32\LsaIso.exe
[+] Exe starting RPC Server: C:\Windows\System32\lsass.exe
[+] Exe starting RPC Server: C:\Windows\System32\mpnotify.exe
[+] Exe starting RPC Server: C:\Windows\System32\NetEvtFwdr.exe
[+] Exe starting RPC Server: C:\Windows\System32\NgcIso.exe
[+] Exe starting RPC Server: C:\Windows\System32\rdpclip.exe
[+] Exe starting RPC Server: C:\Windows\System32\rdpinit.exe
[+] Exe starting RPC Server: C:\Windows\System32\rdpshell.exe
[+] Exe starting RPC Server: C:\Windows\System32\services.exe
[+] Exe starting RPC Server: C:\Windows\System32\SgrmLpac.exe
[+] Exe starting RPC Server: C:\Windows\System32\svchost.exe
[+] Exe starting RPC Server: C:\Windows\System32\TCPSVCS.EXE
[+] Exe starting RPC Server: C:\Windows\System32\WaaSMedicAgent.exe
[+] Exe starting RPC Server: C:\Windows\System32\wimserv.exe
[+] Exe starting RPC Server: C:\Windows\System32\wininit.exe
[+] Exe starting RPC Server: C:\Windows\System32\winlogon.exe
[+] Exe starting RPC Server: C:\Windows\System32\wlanext.exe
[+] Exe starting RPC Server: C:\Windows\System32\IME\IMEJP\IMJPDCT.EXE

Положительный момент, нашлась еще одна точка автостарта через СОМ
[28.09.21 08:58:46] gabr:		Среди RPC серверов нет аудио
[28.09.21 09:00:38] alexander.r:		а что за автостарт?
[28.09.21 09:03:54] gabr:		через sihost.exe но там тоже права текущего пользователя
[28.09.21 09:04:12] alexander.r:		ну это норм
[28.09.21 09:04:20] alexander.r:		а по поводу процессинга аудио
[28.09.21 09:04:35] alexander.r:		как он осуществляется в винде
[28.09.21 09:04:57] alexander.r:		должен же быть единый процесс, который отвечает за это и трансляцию устройсвам
[28.09.21 09:06:29] gabr:		а вот тут тоже есть нюансы, audiodg.exe на реальном железе стартует только при наличии аудио потока, например если открыть ютуб в браузере, на виртуалке он всегда получается запущен, с чем связано не пойму
[28.09.21 09:07:44] gabr:		audiodg->audioses.dll + audioeng.dll  так стартует аудиосессия и аудиоенджине
[28.09.21 09:08:19] alexander.r:		тогда надо исследовать аудиоформаты получается?
[28.09.21 09:08:26] alexander.r:		и искать баги в их процессинге?
[28.09.21 09:08:48] alexander.r:		или процессинг осуществляется внутри процесса сначала, а потом идет передача в аудиодг?
[28.09.21 09:09:51] alexander.r:		про авторан в конфле есть заметка
[28.09.21 09:09:52] alexander.r:		?
[28.09.21 09:10:11] gabr:		нет декодер должен быть в системе
[28.09.21 09:10:23] gabr:		про авторан допишу
[28.09.21 09:11:12] gabr:		кстати у вас там нет тулзы IO ninja? Фри версия только FS снифает а полная пайпы и прочие IPC
[28.09.21 09:11:27] alexander.r:		я спрошу
[28.09.21 09:12:12] gabr:		https://ioninja.com/
[28.09.21 09:12:20] alexander.r:		ок
[28.09.21 09:12:51] gabr:		она типа вайршарк но более продвинуттая в плане протоколов локальных
[28.09.21 09:13:43] alexander.r:		а где там прайс7
[28.09.21 09:16:09] gabr:		шас гляну
[28.09.21 09:17:29] gabr:		у них подписка https://ioninja.com/account/subscription.html
[28.09.21 09:18:05] alexander.r:		на год тебе хватит?
[28.09.21 09:18:16] gabr:		)))
[28.09.21 09:18:32] alexander.r:		выбирай подписку, я бухгалтеру передам, и он вместе с зп закинет тебе
[28.09.21 09:18:43] gabr:		да я думаю не только мне хватит
[28.09.21 09:18:50] gabr:		1 сделать на команду
[28.09.21 09:19:06] gabr:		60 долларов год
[28.09.21 09:22:06] alexander.r:		хорошо
[28.09.21 09:22:53] gabr:		там можно офлайн сделать подписку и просто ключ получить и раздать кому надо
[28.09.21 09:23:21] gabr:		вдруг оно проверяет айди хоста илии еще чтто то
[28.09.21 09:31:01] alexander.r:		цена та же?
[28.09.21 09:31:34] gabr:		да
[29.09.21 15:37:54] gabr:		у меня 1 вопрос, насколько стоит допустим писать о персистенсе в публичном треде?
[29.09.21 15:39:56] gabr:		Имею ввиду что все читают все, думаю что это не лучшее решение в плане потери информации
[29.09.21 21:22:14] alexander.r:		так конфлю тоже читают люди
[29.09.21 21:22:34] alexander.r:		это же чат и конфля для тех специалистов
[01.10.21 09:58:55] gabr:		посмотрел форматы медиа файлов, наиболее интересный ASF , был баг в 2019 году но майкрософт деталей не расрывал, то естть надо поставить старую версию винды и дифом посмотреть что патч делает. Сам форма файла тоже не сильно документрован,  достаточно сложный, это получается контейнер в котором может лежать и мпег и ави итак далее, плюс ко всему он поддерживает выполнение скриптов интегрированых в файл
[01.10.21 10:58:19] alexander.r:		а сжатие в нем есть?
[01.10.21 10:58:21] alexander.r:		привет
[01.10.21 10:58:35] alexander.r:		а с автораном что?
[01.10.21 11:10:20] gabr:		авторан добавил
[01.10.21 11:10:27] gabr:		ну да есть сжатие
[01.10.21 11:48:15] alexander.r:		у меня к тебе просьба - указывай версию ос (вплоть до номера билда), на которой проверял и находил авторан
[01.10.21 11:51:47] gabr:		ок, ну не так критично я проверял на ВМ и на хосте, билды разные (вин10), а вот допустим на 7-8 надо тоже проверить
[01.10.21 11:53:07] alexander.r:		это важно для последующего использования
[01.10.21 11:53:17] alexander.r:		чтобы люди заранее знали, где работает это
[01.10.21 11:53:20] alexander.r:		а где еще надо тестить
[01.10.21 11:57:06] gabr:		да ок
[01.10.21 13:35:02] alexander.r:		слух, а эти ветки естьв винде, или надо создавать?
[01.10.21 13:42:15] gabr:		есть
[01.10.21 13:42:43] gabr:		это зарегестрирваные длл
[01.10.21 13:43:03] gabr:		меняем только путь к длл
[01.10.21 13:44:04] alexander.r:		а если нет и добавить?
[01.10.21 13:45:18] alexander.r:		а что отвалится? если старую длл не загрузит сихост?
[01.10.21 13:46:43] gabr:		оно по дефолту есть, сихост не отвалиться
[01.10.21 13:47:10] alexander.r:		а на какой оси тестил. скинь сюда версию и билд
[01.10.21 13:47:13] alexander.r:		и сп
[01.10.21 13:48:24] gabr:		на 10, и если не ошиюаб
[01.10.21 13:48:51] gabr:		не ошибаюсь на 7 сихост был с системными правами
[01.10.21 13:54:15] gabr:		windows pro for workstation 10 build 19041 release 191206-1406
[01.10.21 13:58:55] gabr:		на ВМ 21Н1 билд 19043-1237
[01.10.21 14:06:55] alexander.r:		а ос чистые?
[01.10.21 14:10:28] gabr:		да, даже без всяких активаторов
[01.10.21 14:23:15] gabr:		смотри суть в чем, есть длл в системе, ее назвали СОМ обьект, он прописан в реестре, все програмы обращаются к ней по номеру (clsid), тоесть если она даже при апдейте  поменяет имя итд то все останется работать как прежде
[01.10.21 14:58:20] alexander.r:		да люди интересуются. у них нет этих ком объектов похоже
[01.10.21 15:03:56] gabr:		HKEY_CLASSES_ROOT\CLSID\{27F71832-6815-48CB-902A-7A1D891BA962} - 0 cmd
HKEY_CLASSES_ROOT\CLSID\{294935CE-F637-4E7C-A41B-AB255460B862} - 0 cmd
HKEY_CLASSES_ROOT\CLSID\{41FCCC3A-1FA1-4949-953A-6EE61C46A4D1} Microsoft.Audio.AudioClient Binder - 0 cmd
HKEY_CLASSES_ROOT\CLSID\{444F7305-1D7D-4BE9-8C29-CC3F1D220C40} - 0 cmd
HKEY_CLASSES_ROOT\CLSID\{562462DD-4F9A-4110-9D6A-C3CA0407FF76} psfactorybuffer - 0 cmd
HKEY_CLASSES_ROOT\CLSID\{69A95A38-C637-46A0-9FB2-1C939AEBF2E8} psfactorybuffer - 0 cmd
HKEY_CLASSES_ROOT\CLSID\{6EC153C1-371E-47E1-A896-2F7F80EB7842} psfactorybuffer - 0 cmd
HKEY_CLASSES_ROOT\CLSID\{73843B93-848F-453B-953D-2E5B911429DC} - 0 cmd
HKEY_CLASSES_ROOT\CLSID\{870AF99C-171D-4f9e-AF0D-E63DF40C2BC9} - 9 cmd
HKEY_CLASSES_ROOT\CLSID\{8D9945C3-A621-4F52-8641-6D8B755F42E2} - 12 cmd system blocked
HKEY_CLASSES_ROOT\CLSID\{ede7f087-890f-491c-b906-9abb31896960} CLSID_EuVolumeNotificationCallback - 0 cmd
HKEY_CLASSES_ROOT\CLSID\{FD7F2B29-24D0-4B5C-B177-592C39F9CA10} psfactorybuffer - 2 cmd

пусть проверят
[01.10.21 15:06:23] alexander.r:		что это?
[01.10.21 15:06:48] alexander.r:		и на что проверять?
[01.10.21 15:07:51] gabr:		к примеру FD7F2B29-24D0-4B5C-B177-592C39F9CA10 (последний в списке) если прописать в свою длл она подгрузиться
[01.10.21 15:10:35] alexander.r:		если он есть?
[01.10.21 15:25:18] gabr:		а это не важно
[08.10.21 11:02:06] gabr:		Пинг
Краткий отчет
1) формат ASF разобрал
2) хидеры с структурами написал
3) в процессе написания генератора кастомных файлов ASF
Далее в отладчике буду смотреть как реагирует плеер на некоректные поля, скипает или что именно делает
[08.10.21 11:17:55] alexander.r:		ку
[08.10.21 11:17:57] alexander.r:		принял
[08.10.21 11:22:02] gabr:		там заголовки данных - связанй список, один на другой ссылается
[08.10.21 11:23:04] gabr:		сам процесс плеера (виндовс медиа) подтягивает джаваскрипт длл, соотвественно должен нтерпритировать джава скрипт
[08.10.21 11:54:11] alexander.r:		а ссылки в виде оффсета относительно чего?
[08.10.21 11:54:16] alexander.r:		ого, аж жс
[13.10.21 08:51:48] gabr:		понг
[02.11.21 05:37:21] gabr:		мне осталось DRM добить, скрипты разобрал
