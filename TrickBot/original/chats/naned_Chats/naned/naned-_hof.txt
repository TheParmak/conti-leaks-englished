2020-07-17T09:14:02 hof -> naned
привет

2020-07-30T14:00:17 naned -> hof
Привет, мне Buza написал что у тебя есть шаблон модуля dll, api которого описан в module_HOWTO, можешь скинуть пожалуйста

2020-07-30T14:00:36 hof -> naned
привет

2020-07-30T14:00:50 hof -> naned
через мин 15-20 скину

2020-07-30T14:01:09 naned -> hof
ок, хорошо

2020-08-12T10:45:25 naned -> hof
Привет, слушай, возникла трабла с модулем небольшая

2020-08-12T10:47:07 naned -> hof
суть: гружу ее через LoadLibrary, в x86 все ок, перехожу на 64 разрядную версию - болт Error code - 126 (The module could not be found)

2020-08-12T10:47:23 hof -> naned
привет

2020-08-12T10:47:41 naned -> hof
не сталкивались с такими проблемами? я просто никогда либы не компилил

2020-08-12T10:47:48 hof -> naned
64 версию из 32 битной программы?

2020-08-12T10:47:53 naned -> hof
нет

2020-08-12T10:47:58 naned -> hof
64 из 64

2020-08-12T10:48:40 hof -> naned
странно конечно, думаю где то баг небольшой

2020-08-12T10:48:51 hof -> naned
может имя длл не то?

2020-08-12T10:49:22 naned -> hof
ну я просто меняю платформу сборки лоадера и самой либы

2020-08-12T10:49:39 naned -> hof
компилю и заменяю либу

2020-08-12T10:49:54 naned -> hof
имена 1в1 что в 32 что в 64 разрядной версии

2020-08-12T10:50:40 hof -> naned
проверь, чтобы длл находилась в той же папке, и что битности совпадают

2020-08-12T10:50:51 hof -> naned
должно работать

2020-08-12T10:51:04 naned -> hof
а лол

2020-08-12T10:51:27 naned -> hof
все да, я тупо сувал ее в 32 разрядную версию, а запускал через отладчик 64

2020-08-12T10:51:47 naned -> hof
это эпик, сорян что отвлек

2020-08-12T10:51:56 hof -> naned
бывает )

2020-08-19T07:23:03 naned -> hof
Привет, хотел узнать а buza когда вернется?

2020-08-19T07:42:30 hof -> naned
привет

2020-08-19T07:42:39 hof -> naned
буза будет в конце месяца

2020-08-19T07:43:08 hof -> naned
как успехи с модулем?

2020-08-19T07:48:11 naned -> hof
вроде ок, я его давно накидал, но у меня вопросы именно по функционалу

2020-08-19T07:48:40 hof -> naned
тз было?

2020-08-19T07:48:54 naned -> hof
ну по факту конкретного нет

2020-08-19T07:49:41 hof -> naned
задай, может что то подскажу

2020-08-19T07:50:10 naned -> hof
перед уходом мне буза дал задание сделать лайтовую версию той тулзы которую я писал, я ее сделал достаточно быстро, потом интегрировал ее в dll, но вопрос теперь по полновесной версии

2020-08-19T07:50:50 naned -> hof
вопрос в том, делать ли дня нее отдельную версию dll модуля или все пихать в 1

2020-08-19T07:51:18 naned -> hof
там изначально какая проблема в 2х словах

2020-08-19T07:51:52 hof -> naned
мне кажется делай отдельную

2020-08-19T07:52:42 naned -> hof
я написал тулзу которая через IO читает VID DID чипсета и дальше работает в зависимости от поколения, буза просил написать чекалку платформы без драйвера

2020-08-19T07:53:36 hof -> naned
и посылать информацию на сервер?

2020-08-19T07:55:06 naned -> hof
ну вообще да, логично что отдельная просто хотел уточнить

2020-08-19T07:55:19 naned -> hof
я вот не знаю ее на счет того что дальше делать с инфой

2020-08-19T07:56:06 naned -> hof
этого буза мне не сказал, я пока просто шлю ее в виде сообщений через lpEventCallback

2020-08-19T07:56:18 hof -> naned
пока этого достаточно

2020-08-19T07:56:29 hof -> naned
сообщения дойдут на командный сервер

2020-08-19T07:57:20 hof -> naned
так что смело занимайся полной версией модуля

2020-08-19T07:58:28 naned -> hof
а вот еще, соответственно обфусцировать строки andrivet при вызовах lpEventCallback не получится, их нужно чем-нибудь обфусцировать?

2020-08-19T07:59:56 hof -> naned
мы обфусцируем строки, чтобы антивирусам не так просто было поставить детекты

2020-08-19T08:00:19 hof -> naned
т.е. чтобы в теле dll или exe было как можно меньше статики

2020-08-19T08:00:57 hof -> naned
смысл, чтобы строка расшифровывалась (или формировалась) непосредственно перед использованием

2020-08-19T08:01:14 naned -> hof
да это я понимаю

2020-08-19T08:01:22 hof -> naned
потом тут же занулялась

2020-08-19T08:01:54 hof -> naned
а почему andrivet при вызовах lpEventCallback не получится?

2020-08-19T08:04:49 naned -> hof
уже не помню, сейчас посмотрю и тогда отпишу

2020-08-19T08:05:14 hof -> naned
ок

2020-08-19T08:05:24 naned -> hof
 помоему там только на стеке строки обфусцируются

2020-08-19T08:05:32 naned -> hof
но это не точно

2020-08-19T08:05:48 hof -> naned
ну так получил строку на стек, скопировал в любое место

2020-08-19T08:06:09 hof -> naned
отправил, занулил, освободил память

2020-08-19T08:07:31 naned -> hof
сейчас попробую, я помню у меня какие-то траблы с этим были, может опять какую-нибудь лайтовую ошибку допустил где

2020-08-19T08:30:55 naned -> hof
хм, все работает вообще без всяких бубнов

2020-08-19T08:31:18 hof -> naned
отлично

2020-08-19T08:31:41 naned -> hof
странно, похоже я опять где-то накосячил тогда(

2020-08-19T08:32:05 hof -> naned
от оптимизации компилятора многое зависит

2020-08-19T08:32:17 hof -> naned
нужно проверять всегда после изменения настроек

2020-08-19T08:32:18 naned -> hof
а

2020-08-19T08:32:35 naned -> hof
может быть да, я настраивал опции после этого

2020-08-19T08:33:04 naned -> hof
понял, спасибо за информацию!

2020-08-19T08:33:14 hof -> naned
не за что

2020-09-16T08:34:03 naned -> hof
Привет, я допилил свой модуль, буза сказал тебе его сбросить, вот сам релиз, также сейчас добавлю права в гит

2020-09-16T08:34:08 naned -> hof
Download: https://qaz.im/load/S36GNA/EQy6Ke
Delete: https://qaz.im/index.php?a=delete&q=514565449

2020-09-16T08:34:27 naned -> hof
sldMSTIAXd?o$F~bW1C5

2020-09-16T09:22:46 hof -> naned
привет, хорошо

2020-09-16T09:26:48 hof -> naned
в ресурсах драйвер?

2020-09-16T09:26:56 naned -> hof
да

2020-09-16T09:27:21 hof -> naned
зашифровать бы желательно

2020-09-16T09:27:24 hof -> naned
d:\src\rw\rwxe3\rw\driver\objfre_win7_x86\i386\RwDrv.pdb

2020-09-16T09:27:30 naned -> hof
окей

2020-09-16T09:27:44 hof -> naned
убрать debug info из драйвера

2020-09-16T09:27:48 naned -> hof
да, я думал над этим, забыл у буза узнать

2020-09-16T09:27:54 naned -> hof
он подписан

2020-09-16T09:28:04 naned -> hof
проще тогда зашифровать

2020-09-16T09:28:59 hof -> naned
и может не в ресурсы, а в секцию кода или данных его спрятать

2020-09-16T09:29:01 naned -> hof
драйвер не мой, это драйвер тулзы для работы с всякими регистрами , портами памятью и т.п.

2020-09-16T09:29:08 hof -> naned
я понимаю

2020-09-16T09:29:21 hof -> naned
\rwdrv.sys - зашифровать в .rdata

2020-09-16T09:29:27 hof -> naned
строку

2020-09-16T09:30:46 naned -> hof
да упустил что-то

2020-09-16T09:31:07 hof -> naned
проверь, просмотри в hex редакторе бинарники

2020-09-16T09:31:54 naned -> hof
да вроде проверил, в IDA смотрел, может не ту в релиз засунул, сейчас поправлю
так что на счет драйвера, куда его пихнуть и как?

2020-09-16T09:32:16 naned -> hof
есть какие-нибудь средства автоматизации таких вещей?

2020-09-16T09:32:50 naned -> hof
или просто самому положить руками?

2020-09-16T09:32:57 hof -> naned
самому придется сделать утилитку

2020-09-16T09:33:15 naned -> hof
ну и лучше зашифровать?

2020-09-16T09:33:34 hof -> naned
да, зашифруй

2020-09-16T09:34:10 hof -> naned
если в секцию данных, то может какое то простое шифрование типа xor, а потом допустим перевести в base64

2020-09-16T09:34:36 hof -> naned
если в секцию кода, то думаю xor будет достаточно

2020-09-16T09:35:00 naned -> hof
ну а критично с секцией данных

2020-09-16T09:35:05 hof -> naned
можешь и в ресурсы, но по моему так больше палят ав

2020-09-16T09:35:33 hof -> naned
делай как тебе проще

2020-09-16T09:35:44 hof -> naned
начнут палить, переделаешь

2020-09-16T09:35:50 naned -> hof
окей

2020-09-16T09:37:52 hof -> naned
по моему вот так раньше работало, в новых версия vs не проверял

2020-09-16T09:37:54 hof -> naned

#pragma code_seg(push, ".text")
char const __declspec(allocate(".text")) _read64ptr[] = {
    0x48, 0x8b, 0x44, 0x24, 0x08,   /* mov rax, [rsp + 8] */
    0x8b, 0x00,                     /* mov eax. [rax] */
    0x8b, 0x50, 0x04,               /* mov edx, [rax + 4] */
    0xcb                            /* retf */
};
#pragma code_seg(pop)

2020-09-16T09:39:25 naned -> hof
сейчас попробую

2020-09-16T09:59:18 naned -> hof
да работает в таком виде:
#pragma code_seg(push, ".text")
__declspec(allocate(".text"))
const char _read64ptr[] =
{
	0x48, 0x8b, 0x44, 0x24, 0x08,   /* mov rax, [rsp + 8] */
	0x8b, 0x00,                     /* mov eax. [rax] */
	0x8b, 0x50, 0x04,               /* mov edx, [rax + 4] */
	0xcb                            /* retf */
};
#pragma code_seg(pop)

2020-09-16T09:59:51 hof -> naned
замечательно

2020-09-16T10:00:55 naned -> hof
сейчас тогда переделаю

2020-09-16T10:01:11 hof -> naned
окей

2020-09-16T10:49:31 naned -> hof
получилось, все ок работает, сейчас все проверю, подготовлю версии и скину

2020-09-16T10:49:51 naned -> hof
сделал обычный xor но в коде

2020-09-16T10:50:30 hof -> naned
ок

2020-09-16T10:54:30 naned -> hof
ничего страшного что этот код компоновщик засовывает с самое начало сегмента?

2020-09-16T10:58:12 hof -> naned
думаю пока ничего страшного, хотя можно добавить байт 500 какого то мусора

2020-09-16T10:58:54 naned -> hof
ок

2020-09-16T12:15:11 naned -> hof
Исправил
Download: https://qaz.im/load/byd3HG/zSNdrh
Delete: https://qaz.im/index.php?a=delete&q=117077848

2020-09-16T12:15:17 naned -> hof
eAGS~gx~ICEz5$95Y$ib

2020-09-16T14:05:35 hof -> naned
ок, принял

2020-09-16T19:18:46 naned -> hof
Блин я там фримем забыл сделать, в функции распаковки драйвера, чета подумал об этом, проверил, реально забыл, завтра сброшу поправленную версию

2020-09-16T19:19:21 hof -> naned
ок

2020-09-17T08:09:41 naned -> hof
Привет, вот поправленная версия
Download: https://qaz.im/load/nZY4KH/ektTA4
Delete: https://qaz.im/index.php?a=delete&q=1582727175
b~r9tRnaWG#|bxTOIZ#W

2020-09-17T08:09:53 hof -> naned
привет, ок

2020-09-17T08:11:21 hof -> naned
а информацию модуль через события отсылает?

2020-09-17T08:11:35 naned -> hof
да

2020-09-17T08:11:40 hof -> naned
ок

2020-09-17T08:11:42 naned -> hof
буза сказал пока так оставить

2020-09-17T08:11:49 hof -> naned
да, норм

2020-09-17T14:49:26 hof -> naned
а как ты передаешь сообщение? скинь плиз код в том месте, в котором передаешь ErrorInitPlatform

2020-09-17T15:33:23 naned -> hof
	//Если платформа не интел выходим
	if (InitPlatform() != SUCCESS)
	{

		lpEventCallback(hModuleHandle, OBFUSCATED("ErrorInitPlatform"), OBFUSCATED("NoIntelPlatform"), NULL, 0, OBFUSCATED("Tag"), lpEventContext);
		goto Finish;
	}

2020-09-17T15:34:20 hof -> naned
а как платформу проверяешь?

2020-09-17T15:34:34 naned -> hof
а InitPlatform возвращает не SUCCESS только в случае 
	if (PlatformInfo.PCHPlatformInfo.vid != 0x8086)
		return ERROR_VID;

2020-09-17T15:34:53 hof -> naned
т.е. на x64 не работает?

2020-09-17T15:35:02 naned -> hof
нет не работает на amd

2020-09-17T15:35:42 hof -> naned
тогда модуль 64 бита не к чему?

2020-09-17T15:35:47 naned -> hof
они как-то спеки свои незахотели выкладывать в публичный доступ

2020-09-17T15:36:08 naned -> hof
нет работает только на Intell чипсетах

2020-09-17T15:36:16 hof -> naned
беда

2020-09-17T15:36:38 naned -> hof
а какой у тебя чипсет, может я конкретно для него найду

2020-09-17T15:37:31 hof -> naned
просто машин x86 совсем мало, основное кол-во как раз amd64

2020-09-17T15:39:39 naned -> hof
стоп

2020-09-17T15:39:54 naned -> hof
amd64 это разрядность, набор инструкций

2020-09-17T15:40:55 naned -> hof
просто так называется amd, хз наверное потому что может это на процах amd сначала появилось

2020-09-17T15:43:32 hof -> naned
так, а что тогда имеется ввиду под платформой?

2020-09-17T15:43:34 naned -> hof
а чипсет, это набор контроллеров в материнке, просто у Intell есть спеки на них, и я быстро разобрался что и куда писать, с amd процесс не пошел так легко и я бузе сказал что пока это только Intell чипсеты, он сказал ок, нужно вообще понять будет ли это работать и на каком числе машин

2020-09-17T15:43:53 naned -> hof
ну у меня аппаратная часть

2020-09-17T15:44:01 hof -> naned
т.е. битность не имеет значения?

2020-09-17T15:44:04 naned -> hof
нет

2020-09-17T15:44:20 naned -> hof
я же сделал 2 версии, х64 и х86

2020-09-17T15:44:34 hof -> naned
ок, понятно теперь

2020-09-17T15:45:15 naned -> hof
они обе работают, только 32 работает только в 32х разрядной системе, 64 соответственно только в 64, мне буза сказал сделать без гибкости

2020-09-17T15:45:40 naned -> hof
По факту тут	if (PlatformInfo.PCHPlatformInfo.vid != 0x8086)
		return ERROR_VID;

2020-09-17T15:45:55 naned -> hof
чичается вендор айди чипсета

2020-09-17T15:46:05 naned -> hof
он у интелл всегда x8086

2020-09-17T15:46:46 hof -> naned
ок

2020-09-17T15:46:46 naned -> hof
у тебя матенринка не Intell скорее всего

2020-09-17T15:46:56 hof -> naned
я на виртуалке проверял

2020-09-17T15:47:00 naned -> hof
а

2020-09-17T15:47:02 naned -> hof
смотри

2020-09-17T15:47:12 naned -> hof
это отдельная песня

2020-09-17T15:47:21 naned -> hof
Виртуалбокс?

2020-09-17T15:48:26 hof -> naned
да

2020-09-17T15:48:40 naned -> hof
на гитлабе есть заметка по поводу тестирования, так вот, в виртуалбоксе, да и вмваре есть эмуляция чипсета, но древнего (2006года чтоли у виртуал, у вмваре, так вообще 97 года)

2020-09-17T15:48:59 naned -> hof
в виртуалбоксе есть 2 чипсета, 1 амд другой интел

2020-09-17T15:49:09 hof -> naned
ясно

2020-09-17T15:49:22 naned -> hof
интел это ICH9

2020-09-17T15:49:59 hof -> naned
там при передаче данных небольшая ошибка, переделай плиз вот так

CHAR buf[1024];
lstrcpyA(buf,OBFUSCATED("NoIntelPlatform"));
lpEventCallback(hModuleHandle, OBFUSCATED("ErrorInitPlatform"), buf, NULL, 0, OBFUSCATED("Tag"), lpEventContext);

2020-09-17T15:50:15 hof -> naned
просто копируется из процесса 1024 байт

2020-09-17T15:50:52 naned -> hof
понял

2020-09-17T15:52:16 naned -> hof
я завтра тогда сброшу ок?

2020-09-17T15:52:41 hof -> naned
да, не срочно

2020-09-17T15:53:50 naned -> hof
я бузе уже писал, отлаживать именно полезную часть этой тулзы не очень получится на виртуалке

2020-09-17T15:54:31 hof -> naned
да, я понимаю теперь

2020-09-18T08:28:27 naned -> hof
Привет, я правильно понял, везде в lpEventCallback параметр pszEventInfo передавать 1024 байта?

2020-09-18T08:28:52 naned -> hof
указатель на стек с массивом 1024 байт

2020-09-18T08:34:14 hof -> naned
привет, да, не обязательно в стеке, но размер буфера 1024 байта

2020-09-18T08:34:30 naned -> hof
понял

2020-09-18T08:40:11 naned -> hof
а остальные параметры указатели LPCSTR не нужно расширять до 1024 байт?

2020-09-18T08:40:55 naned -> hof
там такой перечень параметров:
 typedef VOID (__stdcall *RemoteEventCallback)(PVOID hModuleHandle, LPCSTR pszEventName, LPCSTR pszEventInfo,
  PVOID pvOutData, DWORD dwOutDataSize, LPCSTR pszOutDataTag, PVOID pvContext);

2020-09-18T08:41:05 hof -> naned
можно и там расширить, но пока проблем не было

2020-09-18T08:41:17 naned -> hof
ок

2020-09-18T08:53:53 naned -> hof
Поправил
Download: https://qaz.im/load/rZBR3Z/irD3ff
Delete: https://qaz.im/index.php?a=delete&q=957833796

Ui}hvvT%Hbsv7p*ACNS~

2020-09-18T08:58:00 hof -> naned
ок, спс

2020-10-06T10:07:42 naned -> hof
Привет, я по поводу запуска модуля,  буза просил тебе напомнить про его запуск

2020-10-06T11:10:34 hof -> naned
привет, писал админу про запуск, напомню еще раз

2020-10-06T11:10:38 hof -> naned
сорри

2020-10-06T11:40:35 naned -> hof
окей

2020-10-09T09:15:07 naned -> hof
Привет, ну что есть новости по запуску или еще не запускали?

2020-10-09T09:15:45 hof -> naned
привет, сейчас уточню

2020-10-09T09:33:08 hof -> naned
сейчас прогрузит

2020-10-09T09:33:16 naned -> hof
окей

2020-10-09T09:33:22 hof -> naned
там у них проблемы были с беком

2020-10-09T09:33:31 hof -> naned
не смогли тогда прогрузить

2020-10-09T09:33:40 naned -> hof
понял

2020-10-09T09:33:47 naned -> hof
спасибо

2020-10-12T10:14:57 naned -> hof
Привет, ну что есть результаты какие-нибудь?

2020-10-12T10:16:30 hof -> naned
привет

2020-10-19T10:54:07 naned -> hof
Привет, слушай, а запуск со сбором "PlatformCheckResult" планируется?

2020-10-19T10:54:28 hof -> naned
привет

2020-10-19T10:54:39 hof -> naned
без него никак?

2020-10-19T10:55:21 naned -> hof
по факту вся инфа что собрана это просто список чипсетов, как на них реализована защита можно понять по PlatformCheckResult

2020-10-19T10:56:07 hof -> naned
ок, попробуем собрать

2020-10-19T10:56:54 naned -> hof
единственное, я чутка тоже потестил на своих машинах и чуть поменял подход, я тогда сейчас подготовлю новые  версии и сброшу  тебе

2020-10-19T10:57:53 hof -> naned
т.е. нужно запустить новую версию?

2020-10-19T10:58:02 naned -> hof
ну лучше ее

2020-10-19T10:58:14 naned -> hof
если это не слишком геморно

2020-10-19T10:59:10 hof -> naned
тогда давай вместо tag PlatformInfo сразу в таг пиши P0 или P1 или P3

2020-10-19T10:59:18 naned -> hof
ок

2020-10-19T10:59:27 hof -> naned
проще будет выборку делать

2020-10-19T11:00:56 naned -> hof
понял, так а на 10ке "InitError" ошибка еще вроде была?

2020-10-19T11:01:42 hof -> naned
я уже не помню

2020-10-19T11:01:42 hof -> naned
я уже не помню

2020-10-19T11:29:29 naned -> hof
https://www.sendspace.com/file/0ysvqv
O@{Nmrl3yaQmThASz5%P

2020-10-19T11:29:41 hof -> naned
ок

2020-10-19T11:29:43 naned -> hof
готово

